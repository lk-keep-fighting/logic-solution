"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[5184],{96641:function(oe,p,o){o.d(p,{B0:function(){return v.Z},FQ:function(){return Z.F}});var K=o(52670),v=o(25616),Z=o(52758)},65184:function(oe,p,o){o.d(p,{Z:function(){return Le}});var K=o(48305),v=o.n(K),Z=o(80401),te=o(8674),ie=o(16020),le=o(94474),de=o(74354),U=o(91505),se=o(81376),re=o(61943),ae=o(90541),ue=o(66508),ce=o(37348),ge=o(95719),b=o(58107),H=o(65586),h=o(27491),ve=o(83693),G=o(74912),Q=o(28836),r=o(87363),fe=o.n(r),me=o(74987),he=o(54804),xe=o(5833),Ie=o(13891),be=o(20281),ye=o(15146),E=o(52670),je=o(96641),e=o(62086),Re=fe().createContext({logic:new me.Iz("")}),Se=function(u){var F,N,B,$,T,O,A,D,P,k,M,Ce=(0,r.useState)(),V=v()(Ce,2),d=V[0],pe=V[1],Ze=(0,r.useState)(),Y=v()(Ze,2),x=Y[0],Ee=Y[1],Fe=(0,r.useState)(!0),X=v()(Fe,2),j=X[0],S=X[1],Ne=(0,r.useState)(),w=v()(Ne,2),n=w[0],z=w[1],Be=(0,r.useState)(),q=v()(Be,2),l=q[0],$e=q[1],Te=(0,r.useState)(),_=v()(Te,2),J=_[0],Oe=_[1],Ae=(0,r.useState)(),ee=v()(Ae,2),L=ee[0],R=ee[1],De=(0,r.useState)(),ne=v()(De,2),Pe=ne[0],ke=ne[1],W=(0,r.useRef)();function Me(i,c,t,a){return{name:"button",args:{markup:[{tagName:"circle",selector:"button",attrs:{r:14,x:0,y:0,stroke:c.success?"#52C41A":"red","stroke-width":5-t<1?1:5-t,fill:"white",cursor:"pointer"}},{tagName:"text",textContent:i,selector:"icon",attrs:{"font-size":20-t<12?12:20-t,"text-anchor":"middle","pointer-events":"none",y:"0.3em"}}],x:(a-1)*28,y:0,onClick:function(f){var I=f.view,m=I.cell;R(m),S(!1),z(c)}}}}(0,r.useEffect)(function(){J&&(d==null||d.centerCell(J))},[J,d]),(0,r.useEffect)(function(){console.log("select curItemLog",n)},[n]),(0,r.useEffect)(function(){var i=d==null?void 0:d.getNodes().find(function(c){return c.id==u.nextId});i==null||i.attr("body/fill","red"),Oe(i)},[u.nextId]),(0,r.useEffect)(function(){var i;d==null||(i=d.getNodes().find(function(c){return c.id==u.nextId}))===null||i===void 0||i.attr("body/fill","red")},[d]),(0,r.useEffect)(function(){u.config&&Ee(u.config)},[u.config]),(0,r.useEffect)(function(){var i;console.log("props.debugLogs",u.debugLogs);var c=[];u&&((i=u.debugLogs)===null||i===void 0||i.forEach(function(t){var a,g;c.push({children:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("span",{style:{cursor:"pointer",fontWeight:t.id==(l==null?void 0:l.id)?"bolder":"normal",color:t.id==(l==null?void 0:l.id)?"#52c41a":"black"},onClick:function(){$e(t),d==null||d.fromJSON(x==null?void 0:x.visualConfig);var I,m={};t.itemLogs.forEach(function(y,C){var s=d==null?void 0:d.getNodes().find(function(Je){return Je.id==y.config.id});console.log("\u9009\u4E2D\u7684\u8282\u70B9"),console.log(s),s&&(s.addTools({name:"boundary",args:{attrs:{stroke:"red",strokeWidth:1.5,rx:5,ry:5}}}),I=s),m[s==null?void 0:s.id]?m[s==null?void 0:s.id]+=1:m[s==null?void 0:s.id]=1,s==null||s.addTools(Me(C,y,C,m[s==null?void 0:s.id]))}),d==null||d.centerCell(I),z({}),R({})},children:[(0,e.jsx)("p",{children:(a=t.itemLogs[0])===null||a===void 0?void 0:a.config.name}),(0,e.jsxs)("p",{children:["\u5F00\u59CB\uFF1A",t.itemLogs[0].beginTime]}),(0,e.jsxs)("p",{children:["\u7ED3\u675F\uFF1A",t.itemLogs[t.itemLogs.length-1].endTime]}),((g=u.logicIns)===null||g===void 0?void 0:g.version)==t.version?(0,e.jsx)("p",{}):(0,e.jsx)("p",{children:(0,e.jsxs)(ge.Z,{children:[(0,e.jsx)(b.Z.Paragraph,{style:{color:"red"},children:"\u7248\u672C\u53F7:"}),(0,e.jsxs)(b.Z.Paragraph,{copyable:{tooltips:["\u70B9\u51FB\u590D\u5236","\u590D\u5236\u6210\u529F!"],text:t.version},children:[t.version,(0,e.jsx)(b.Z.Link,{style:{margin:"5px"},href:"#/assets/logic/i/".concat(t.logicId,"/view/").concat(t.version),target:"_blank",children:(0,e.jsx)(Z.Z,{})})]})]})}),(0,e.jsx)("p",{children:t.message})]})}),color:t.success?"green":"red"})})),ke(c)},[u.debugLogs,u.logicIns,d,l]),(0,r.useEffect)(function(){if(x){try{var i=(0,he.K)(),c=i.Shapes;(0,xe.m)(c)}catch(a){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(a)}if(W.current!=null){var t=new U.kJ({container:W.current,embedding:{enabled:!0,validate:function(g){return g.child.setData({hoverNode:g.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new U.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(g){var f=g.targetMagnet;return!!f}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}},background:{color:"#F2F7FA"},grid:!0});t.use(new ue.H({enabled:!0,sharp:!0})).use(new se.A({enabled:!0})).use(new ae.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new ce.T({enabled:!0})).use(new re.N),t.on("edge:dblclick",function(){}),t.on("edge:mouseenter",function(){}),t.on("edge:mouseleave",function(){}),t.on("node:moved",function(){}),t.on("node:mouseenter",function(){}),t.on("node:mouseleave",function(){}),t.on("node:added",function(){}),t.on("node:dblclick",function(a){var g=a.node}),t.on("blank:dblclick",function(a){var g=a.x,f=a.y}),t.fromJSON(x.visualConfig),(0,Ie.V)(t),pe(t)}}},[x]);var Ke=function(){},ze=[{key:"debug-node-input",label:"\u8282\u70B9\u5165\u51FA\u53C2",children:(0,e.jsxs)("div",{children:[(n==null||(F=n.configInstance)===null||F===void 0?void 0:F.type)=="sub-logic"?(0,e.jsxs)("div",{children:[(0,e.jsxs)(b.Z.Text,{style:{margin:"15px"},copyable:{tooltips:["","\u590D\u5236\u6210\u529F!"],text:n==null||(N=n.configInstance)===null||N===void 0?void 0:N.objectId},children:["\u5B50\u903B\u8F91\u65E5\u5FD7:",(0,e.jsx)("a",{target:"_blank",href:"#/debug/logic-log/i/".concat(n==null||(B=n.configInstance)===null||B===void 0?void 0:B.objectId),children:n==null||($=n.configInstance)===null||$===void 0?void 0:$.objectId})]}),(0,e.jsx)(H.Z,{})]}):"",(0,e.jsx)(E.Z,{formId:"debug-node-input",values:{success:n==null?void 0:n.success,msg:n==null?void 0:n.msg,returnData:n==null?void 0:n.returnData,body:n==null||(T=n.configInstance)===null||T===void 0?void 0:T.body,bizId:n==null||(O=n.configInstance)===null||O===void 0?void 0:O.bizId,logicId:n==null||(A=n.configInstance)===null||A===void 0?void 0:A.url},onSubmit:function(){}}),(0,e.jsx)(b.Z.Text,{style:{margin:"15px"},copyable:{tooltips:["\u590D\u5236\u8282\u70B9\u7F16\u53F7","\u590D\u5236\u6210\u529F!"],text:L==null?void 0:L.id},children:"\u8282\u70B9\u7F16\u53F7"}),(0,e.jsx)("div",{})]})},{key:"config",label:"\u8282\u70B9\u914D\u7F6E",children:(0,e.jsx)("div",{children:(0,e.jsx)(ye.Z,{onSubmit:function(){},editNode:L})})},{key:"configIns",label:"\u8282\u70B9\u5B9E\u4F8B",children:(0,e.jsx)("div",{children:(0,e.jsx)(E.Z,{formId:(n==null||(D=n.config)===null||D===void 0?void 0:D.type)||"",values:n==null?void 0:n.configInstance,onSubmit:function(){}})})},{key:"debug-context",label:"\u6267\u884C\u4E0A\u4E0B\u6587",children:(0,e.jsx)(E.Z,{formId:"debug-context",values:{varsJson:l==null?void 0:l.varsJson,paramsJson:l==null?void 0:l.paramsJson,varsJsonEnd:l==null?void 0:l.varsJsonEnd,startNodeId:l==null?void 0:l.itemLogs[0].config.id,startNodeName:l==null?void 0:l.itemLogs[0].config.name,logicId:(P=u.logicIns)===null||P===void 0?void 0:P.logicId,bizId:(k=u.logicIns)===null||k===void 0?void 0:k.bizId},onSubmit:function(){}})}];return(0,e.jsxs)(h.Z,{style:{margin:0,height:"100vh"},children:[(0,e.jsxs)(h.Z.Sider,{theme:"light",collapsedWidth:0,width:260,style:{overflow:"auto",height:"100vh",position:"fixed",left:0,top:0,bottom:0,borderRight:"0.5px solid"},children:[(0,e.jsx)(H.Z,{children:"\u6267\u884C\u8BB0\u5F55"}),(0,e.jsx)(ve.Z,{style:{height:"100%"},items:Pe})]}),(0,e.jsxs)(h.Z,{style:{margin:0,marginLeft:260,padding:0},children:[(0,e.jsxs)(h.Z.Header,{style:{backgroundColor:"white",padding:0},children:[(M=u.btns)===null||M===void 0?void 0:M.map(function(i){return i}),(0,e.jsx)(G.ZP,{type:"text",icon:j?(0,e.jsx)(te.Z,{}):(0,e.jsx)(ie.Z,{}),onClick:function(){S(!j)},style:{float:"right",right:"16px",fontSize:"16px",width:64,height:64}})]}),(0,e.jsx)(h.Z.Content,{className:"app-content",children:(0,e.jsx)(Q.Z,{size:"small",style:{backgroundColor:"white",padding:5,margin:0},items:[le.Z,de.Z].map(function(i,c){var t=String(c+1);return c==0?{key:t,label:"\u903B\u8F91\u56FE",children:(0,e.jsx)(be.Z,{ref:W}),icon:(0,e.jsx)(i,{})}:{key:t,label:"\u6267\u884C\u8282\u70B9",children:(0,e.jsx)(je.B0,{pageId:"itemLogs-table",data:{items:l==null?void 0:l.itemLogs},onBroadcast:function(g,f){var I=f.item.config.id,m=f.item,y=d==null?void 0:d.getNodes().find(function(C){return C.id==I});y&&(R(y),S(!1),z(m))}}),icon:(0,e.jsx)(i,{})}})})})]}),(0,e.jsxs)(h.Z.Sider,{theme:"light",collapsed:j,collapsedWidth:0,style:{overflow:"scroll"},width:500,children:[(0,e.jsx)(Q.Z,{items:ze,defaultActiveKey:"inout"}),(0,e.jsx)(G.ZP,{type:"text",onClick:function(){S(!j)},style:{position:"absolute",top:0,right:0,fontSize:"16px",width:64,height:64},children:"x"})]})]})},Le=Se}}]);
