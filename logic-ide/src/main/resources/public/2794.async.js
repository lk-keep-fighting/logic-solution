"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[2794],{62794:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Chart:function(){return Chart},ChartRenderer:function(){return ChartRenderer}});var tslib__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(15767),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(87363),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__),amis_core__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(42977),classnames__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(84875),classnames__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_2__),mobx_state_tree__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(6663),lodash_debounce__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(66292),lodash_debounce__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(lodash_debounce__WEBPACK_IMPORTED_MODULE_3__),lodash_pick__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(19334),lodash_pick__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(lodash_pick__WEBPACK_IMPORTED_MODULE_4__),lodash_isString__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(56549),lodash_isString__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(lodash_isString__WEBPACK_IMPORTED_MODULE_5__),DEFAULT_EVENT_PARAMS=["componentType","seriesType","seriesIndex","seriesName","name","dataIndex","data","dataType","value","color"],EVAL_CACHE={};function recoverFunctionType(config){["interval","formatter","color","min","max","labelFormatter","valueFormatter","pageFormatter","optionToContent","contentToOption","animationDelay","animationDurationUpdate","animationDelayUpdate","animationDuration","position","sort","renderItem"].forEach(function(key){var e_1,_a,objects=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.jbC)(config,key);try{for(var objects_1=(0,tslib__WEBPACK_IMPORTED_MODULE_6__.XA)(objects),objects_1_1=objects_1.next();!objects_1_1.done;objects_1_1=objects_1.next()){var object=objects_1_1.value,code=object[key];if(typeof code=="string"&&code.trim().startsWith("function"))try{code in EVAL_CACHE||(EVAL_CACHE[code]=eval("("+code+")")),object[key]=EVAL_CACHE[code]}catch(M){console.warn(code,M)}}}catch(M){e_1={error:M}}finally{try{objects_1_1&&!objects_1_1.done&&(_a=objects_1.return)&&_a.call(objects_1)}finally{if(e_1)throw e_1.error}}})}var Chart=function(M){(0,tslib__WEBPACK_IMPORTED_MODULE_6__.ZT)(o,M);function o(e){var _=M.call(this,e)||this;return _.refFn=_.refFn.bind(_),_.reload=_.reload.bind(_),_.reloadEcharts=lodash_debounce__WEBPACK_IMPORTED_MODULE_3___default()(_.reloadEcharts.bind(_),300),_.handleClick=_.handleClick.bind(_),_.dispatchEvent=_.dispatchEvent.bind(_),_.loadChartMapData=_.loadChartMapData.bind(_),_.mounted=!0,e.config&&_.renderChart(e.config),_}return o.prototype.componentDidMount=function(){return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.mG)(this,void 0,void 0,function(){var e,_,t,a,n,r,i,s;return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.Jh)(this,function(c){switch(c.label){case 0:return e=this.props,_=e.api,t=e.data,a=e.initFetch,n=e.source,r=e.dispatchEvent,[4,r("init",t,this)];case 1:return i=c.sent(),i!=null&&i.prevented?[2]:(n&&(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.SSQ)(n)?(s=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.OgC)(n,t,"| raw"),s&&this.renderChart(s)):_&&a!==!1&&this.reload(),[2])}})})},o.prototype.componentDidUpdate=function(e){var _=this,t=this.props;if((0,amis_core__WEBPACK_IMPORTED_MODULE_1__.rMT)(e.api,t.api,e.data,t.data))this.reload();else if(t.source&&(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.SSQ)(t.source)){var a=e.source?(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.OgC)(e.source,e.data,"| raw"):null,n=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.OgC)(t.source,t.data,"| raw");a!==n&&this.renderChart(n||{})}else if(t.config!==e.config)this.renderChart(t.config||{});else if(t.config&&t.trackExpression&&(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.hXT)(t.trackExpression,t.data)!==(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.hXT)(e.trackExpression,e.data))this.renderChart(t.config||{});else if((0,amis_core__WEBPACK_IMPORTED_MODULE_1__.rMT)(e.mapURL,t.mapURL,e.data,t.data)){var r=t.source,i=t.data,s=t.api,c=t.config;this.loadChartMapData(function(){if(r&&(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.SSQ)(r)){var D=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.OgC)(r,i,"| raw");D&&_.renderChart(D)}else s?_.reload():c&&_.renderChart(c||{})})}},o.prototype.componentWillUnmount=function(){this.mounted=!1,this.reloadEcharts.cancel(),clearTimeout(this.timer)},o.prototype.loadChartMapData=function(e){return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.mG)(this,void 0,void 0,function(){var _,t,a,n,r,i,s;return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.Jh)(this,function(c){switch(c.label){case 0:return _=this.props,t=_.env,a=_.data,n=this.props,r=n.mapName,i=n.mapURL,i&&r&&window.echarts?((0,amis_core__WEBPACK_IMPORTED_MODULE_1__.SSQ)(r)&&(r=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.OgC)(r,a)),[4,t.fetcher(i,a)]):[3,2];case 1:s=c.sent(),s.ok||console.warn("fetch map geo error "+i),window.echarts.registerMap(r,s.data),c.label=2;case 2:return e&&e(),[2]}})})},o.prototype.handleClick=function(e){return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.mG)(this,void 0,void 0,function(){var _,t,a,n,r,i;return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.Jh)(this,function(s){switch(s.label){case 0:return _=this.props,t=_.onAction,a=_.clickAction,n=_.data,r=_.dispatchEvent,[4,r(e.event,(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.nW9)(n,(0,tslib__WEBPACK_IMPORTED_MODULE_6__.pi)({},lodash_pick__WEBPACK_IMPORTED_MODULE_4___default()(e,DEFAULT_EVENT_PARAMS))))];case 1:return i=s.sent(),i!=null&&i.prevented?[2]:(a&&t&&t(null,a,(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.nW9)(n,e)),[2])}})})},o.prototype.dispatchEvent=function(e){var _=this.props,t=_.data,a=_.dispatchEvent;a(e.event||e.type,(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.nW9)(t,(0,tslib__WEBPACK_IMPORTED_MODULE_6__.pi)({},lodash_pick__WEBPACK_IMPORTED_MODULE_4___default()(e,e.type==="legendselectchanged"?["name","selected"]:DEFAULT_EVENT_PARAMS))))},o.prototype.refFn=function(e){var _=this,t=this.props.chartRef,a=this.props,n=a.chartTheme,r=a.onChartWillMount,i=a.onChartUnMount,s=a.env,c=a.loadBaiduMap,D=a.data,C=this.props,O=C.mapURL,l=C.mapName,h=this.props.onChartMount||this.onChartMount;e?Promise.all([__webpack_require__.e(1124).then(__webpack_require__.bind(__webpack_require__,51124)),__webpack_require__.e(7160).then(__webpack_require__.t.bind(__webpack_require__,87160,23)),Promise.all([__webpack_require__.e(1124),__webpack_require__.e(3099)]).then(__webpack_require__.bind(__webpack_require__,83099)),Promise.all([__webpack_require__.e(1124),__webpack_require__.e(1764)]).then(__webpack_require__.bind(__webpack_require__,91764)),__webpack_require__.e(6021).then(__webpack_require__.t.bind(__webpack_require__,46021,23))]).then(function(d){var v=(0,tslib__WEBPACK_IMPORTED_MODULE_6__.CR)(d,2),E=v[0],p=v[1];return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.mG)(_,void 0,void 0,function(){var m,P=this;return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.Jh)(this,function(u){switch(u.label){case 0:return window.echarts=E,window.ecStat=(p==null?void 0:p.default)||p,O&&l?[4,this.loadChartMapData()]:[3,2];case 1:u.sent(),u.label=2;case 2:return c?[4,(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.veE)("//api.map.baidu.com/api?v=3.0&ak=".concat(this.props.ak,"&callback={{callback}}"))]:[3,4];case 3:u.sent(),u.label=4;case 4:return m="default",n&&(E.registerTheme("custom",n),m="custom"),r?[4,r(E)]:[3,6];case 5:u.sent(),u.label=6;case 6:return p.transform&&(E.registerTransform(p.transform.regression),E.registerTransform(p.transform.histogram),E.registerTransform(p.transform.clustering)),s.loadChartExtends?[4,s.loadChartExtends()]:[3,8];case 7:u.sent(),u.label=8;case 8:return this.echarts=E.init(e,m),typeof h=="string"&&(h=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.PqP)(h,"chart","echarts")),h==null||h(this.echarts,E),this.echarts.on("click",this.handleClick),this.echarts.on("mouseover",this.dispatchEvent),this.echarts.on("legendselectchanged",this.dispatchEvent),this.unSensor=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.Adl)(e,function(){var b,f=e.offsetWidth,T=e.offsetHeight;(b=P.echarts)===null||b===void 0||b.resize({width:f,height:T})}),t&&t(this.echarts),this.renderChart(),[2]}})})}):(t&&t(null),this.unSensor&&this.unSensor(),this.echarts&&(i==null||i(this.echarts,window.echarts),this.echarts.dispose(),delete this.echarts)),this.ref=e},o.prototype.doAction=function(e,_,t){var a,n;return t===void 0&&(t=!1),(n=(a=this.echarts)===null||a===void 0?void 0:a.dispatchAction)===null||n===void 0?void 0:n.call(a,(0,tslib__WEBPACK_IMPORTED_MODULE_6__.pi)({type:e.actionType},_))},o.prototype.reload=function(e,_,t,a,n){var r,i,s,c,D,C;return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.mG)(this,void 0,void 0,function(){var O,l,h,d,v,E,p,m,P,u,b=this;return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.Jh)(this,function(f){switch(f.label){case 0:if(O=this.props,l=O.api,h=O.env,d=O.store,v=O.translate,_)return[2,this.receive(_,void 0,n)];if(!h||!h.fetcher||!(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.X1t)(l,d.data))return[2];clearTimeout(this.timer),this.reloadCancel&&(this.reloadCancel(),delete this.reloadCancel,(r=this.echarts)===null||r===void 0||r.hideLoading()),(i=this.echarts)===null||i===void 0||i.showLoading(),d.markFetching(!0),f.label=1;case 1:return f.trys.push([1,3,,4]),[4,h.fetcher(l,d.data,{cancelExecutor:function(T){return b.reloadCancel=T}})];case 2:return E=f.sent(),(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_7__.fh)(d)&&d.markFetching(!1),E.ok?(delete this.reloadCancel,p=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.Mpd)(E.data),!p.series&&this.props.config?(m=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.nW9)(this.props.data,p),this.renderChart(this.props.config,m)):this.renderChart(E.data||{}),(D=this.echarts)===null||D===void 0||D.hideLoading(),P=this.props.interval,P&&lodash_isString__WEBPACK_IMPORTED_MODULE_5___default()(P)&&(P=Number.parseInt(P)),P&&this.mounted&&(this.timer=setTimeout(this.reload,Math.max(P,1e3))),[2,d.data]):(!(l!=null&&l.silent)&&h.notify("error",(c=(s=l==null?void 0:l.messages)===null||s===void 0?void 0:s.failed)!==null&&c!==void 0?c:E.msg||v("fetchFailed"),E.msgTimeout!==void 0?{closeButton:!0,timeout:E.msgTimeout}:void 0),[2]);case 3:return u=f.sent(),h.isCancel(u)?[2]:((0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_7__.fh)(d)&&d.markFetching(!1),!(l!=null&&l.silent)&&h.notify("error",u),(C=this.echarts)===null||C===void 0||C.hideLoading(),[3,4]);case 4:return[2]}})})},o.prototype.receive=function(e,_,t){var a=this.props.store;a.updateData(e,void 0,t),this.reload()},o.prototype.renderChart=function(e,_){var t,a;if(e&&(this.pending=e),_&&(this.pendingCtx=_),!!this.echarts){var n=this.props.store,r=this.props.onDataFilter,i=this.props.dataFilter;!r&&typeof i=="string"&&(r=new Function("config","echarts","data",i)),e=e||this.pending,_=_||this.pendingCtx||this.props.data,typeof e=="string"&&(e=new Function("return "+e)());try{r&&(e=r(e,window.echarts,_)||e)}catch(s){console.warn(s)}if(e)try{this.props.disableDataMapping||(e=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.buJ)(e,_,function(s,c){return typeof c=="function"||typeof c=="string"&&c.startsWith("function")})),recoverFunctionType(e),(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_7__.fh)(n)&&n.loading?(t=this.echarts)===null||t===void 0||t.showLoading():(a=this.echarts)===null||a===void 0||a.hideLoading(),this.reloadEcharts(e)}catch(s){console.warn(s)}}},o.prototype.reloadEcharts=function(e){var _=this,t;(t=this.echarts)===null||t===void 0||t.setOption(e,this.props.replaceChartOption),this.echarts.on("finished",function(){return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.mG)(_,void 0,void 0,function(){var a,n,r,i;return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.Jh)(this,function(s){switch(s.label){case 0:return a=this.props,n=a.data,r=a.dispatchEvent,[4,r("finished",(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.nW9)(n,{},{echarts:{value:this.echarts,enumerable:!1,configurable:!0,writable:!0}}))];case 1:return i=s.sent(),i!=null&&i.prevented?[2]:[2]}})})})},o.prototype.render=function(){var e=this,_=this.props,t=_.className,a=_.width,n=_.height,r=_.classPrefix,i=_.unMountOnHidden,s=_.data,c=_.id,D=_.wrapperCustomStyle,C=_.env,O=_.themeCss,l=_.baseControlClassName,h=this.props.style||{};h.width=h.width||a||"100%",h.height=h.height||n||"300px";var d=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.uBL)(h,s);return react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div",{className:classnames__WEBPACK_IMPORTED_MODULE_2___default()("".concat(r,"Chart"),t,(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.GwQ)((0,tslib__WEBPACK_IMPORTED_MODULE_6__.pi)((0,tslib__WEBPACK_IMPORTED_MODULE_6__.pi)({},this.props),{name:"baseControlClassName",id:c,themeCss:O})),(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.GwQ)((0,tslib__WEBPACK_IMPORTED_MODULE_6__.pi)((0,tslib__WEBPACK_IMPORTED_MODULE_6__.pi)({},this.props),{name:"wrapperCustomStyle",id:c,themeCss:D}))),style:d},react__WEBPACK_IMPORTED_MODULE_0___default().createElement(amis_core__WEBPACK_IMPORTED_MODULE_1__.crj,{unMountOnHidden:i,placeholder:"...",component:function(){return react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div",{className:"".concat(r,"Chart-content"),ref:e.refFn})}}),react__WEBPACK_IMPORTED_MODULE_0___default().createElement(amis_core__WEBPACK_IMPORTED_MODULE_1__.cWM,(0,tslib__WEBPACK_IMPORTED_MODULE_6__.pi)({},this.props,{config:{wrapperCustomStyle:D,id:c,themeCss:O,classNames:[{key:"baseControlClassName"}]},env:C})))},o.defaultProps={replaceChartOption:!1,unMountOnHidden:!1},o.propsList=[],o}(react__WEBPACK_IMPORTED_MODULE_0___default().Component),ChartRenderer=function(M){(0,tslib__WEBPACK_IMPORTED_MODULE_6__.ZT)(o,M);function o(e,_){var t=M.call(this,e)||this,a=_;return a.registerComponent(t),t}return o.prototype.componentWillUnmount=function(){M.prototype.componentWillUnmount.call(this);var e=this.context;e.unRegisterComponent(this)},o.prototype.setData=function(e,_){var t=this.props.store;t.updateData(e,void 0,_),this.renderChart(this.props.config,t.data)},o.prototype.getData=function(){var e=this.props.store;return e.data},o.contextType=amis_core__WEBPACK_IMPORTED_MODULE_1__.ZHe,o=(0,tslib__WEBPACK_IMPORTED_MODULE_6__.gn)([(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.Thl)({type:"chart",storeType:amis_core__WEBPACK_IMPORTED_MODULE_1__.Y5f.name}),(0,tslib__WEBPACK_IMPORTED_MODULE_6__.w6)("design:paramtypes",[Object,Object])],o),o}(Chart)}}]);
