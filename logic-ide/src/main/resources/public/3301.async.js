"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[3301],{60860:function(B,h,t){t.d(h,{l:function(){return E.Z}});var E=t(23914)},8678:function(B,h,t){t.d(h,{n:function(){return c}});var E=t(15451);function c(D){var g=D.createNode({shape:"start",width:50,height:50,ports:E.Tt,data:{config:{type:"start",name:"\u5F00\u59CB"}}});D.addNode(g)}},74737:function(B,h,t){t.d(h,{S8:function(){return f},nq:function(){return s}});var E=t(26068),c=t.n(E),D=t(25298),g=t.n(D),O=t(17069),p=t.n(O),m=t(63121),P=t(1143),v=t(15451),M=null;function _(n,r,e,a){var i,u,o=n.data.config,l=o.type,d=e.flatMap(function(y){return y.source.cell===n.id?r[y.target.cell]:[]}),A=n.attrs,C=new P.Du((i=n.id)!==null&&i!==void 0?i:"",l);if(C=c()(c()({},o),{},{id:n.id,name:A==null||(u=A.text)===null||u===void 0?void 0:u.text,nextId:""}),!(a.findIndex(function(y){return y.id===C.id})>-1)&&(a.push(C),d.length!==0))switch(l){default:if(d.length>1||C.type==="switch"){var b;console.log((b=n.data)===null||b===void 0?void 0:b.config),console.log(d),C.branches=[],d.forEach(function(y){var L,U;if(console.log((L=y.data)===null||L===void 0?void 0:L.config),((U=y.data)===null||U===void 0?void 0:U.config.type)==="switch-cases"){var T;(T=y.data)===null||T===void 0||(T=T.config)===null||T===void 0||(T=T.cases)===null||T===void 0||T.forEach(function(R){var x;(x=C.branches)===null||x===void 0||x.push({when:R,nextId:y.id})})}else{var K,I;(K=C.branches)===null||K===void 0||K.push({when:(I=y.data)===null||I===void 0||(I=I.config)===null||I===void 0?void 0:I.case,nextId:y.id})}_(r[y.id],r,e,a)})}else C.nextId=d[0].id,_(r[d[0].id],r,e,a);break}}function s(n,r){var e=new P.Iz(n),a=[],i=[],u={},o=void 0;r.forEach(function(l){var d=l.id||"";l.shape==="edge"?a.push(l):(u[d]=l,i.push(l),l.data.config.type==="start"&&(o=l))});debugger;if(!o){m.ZP.error("\u672A\u53D1\u73B0\u5F00\u59CB\u8282\u70B9\uFF0C\u8BF7\u914D\u7F6E\uFF01");return}return _(o,u,a,e.items),console.log("logic.items"),console.log(e.items),e}function f(n){var r;if(!(n!=null&&(r=n.items)!==null&&r!==void 0&&r.length))return{nodes:[],edges:[]};var e=function(l){switch(console.log("type"),console.log(l),l){case"http":case"js":case"java":case"sub-logic":return{size:{width:100,height:50}};case"switch":return{size:{width:200,height:50}};case"switch-case":case"switch-default":case"switch-cases":return{size:{width:120,height:50}};case"assign-global":case"assign-local":return{size:{width:150,height:40}};default:return{size:{width:50,height:50}}}},a={shape:"edge"},i=n.items.map(function(o){return c()(c()({},e(o.type)),{},{id:o.id,ports:c()(c()({},v.Tt),{},{items:v.Tt.items.map(function(l){return c()(c()({},l),{},{id:"".concat(o.id,"-").concat(l.group)})})}),shape:o.type,data:{config:o}})}),u=n.items.flatMap(function(o){var l;return(l=o.branches)!==null&&l!==void 0&&l.length?o.branches.map(function(d){return c()(c()({},a),{},{source:{cell:o.id,port:o.id+"-bottom"},target:{cell:d.nextId,port:d.nextId+"-top"}})}):o.nextId?[c()(c()({},a),{},{source:{cell:o.id,port:o.id+"-bottom"},target:{cell:o.nextId,port:o.nextId+"-top"}})]:[]});return{nodes:i,edges:u}}},20210:function(B,h,t){t.d(h,{y:function(){return _}});var E=t(31759),c=t.n(E),D=t(25298),g=t.n(D),O=t(17069),p=t.n(O),m=t(1143),P=t(82092),v=t.n(P),M=p()(function s(f){g()(this,s),v()(this,"concept","EnvParam"),v()(this,"name",void 0),v()(this,"description",void 0),v()(this,"typeAnnotation",void 0),v()(this,"required",!1),v()(this,"defaultValue",void 0),this.name=f}),_=function(){function s(){g()(this,s)}return p()(s,null,[{key:"valueToTypeAnnotaion",value:function(n){var r=this,e={concept:m.Ld.TypeAnnotation,typeKind:"primitive",typeName:"string",defaultValue:n};if(Array.isArray(n))e.typeName="array";else{var a=c()(n);switch(a){case"boolean":e.typeKind="primitive",e.typeName="boolean";break;case"number":e.typeKind="primitive",e.typeName="number";break;case"string":e.typeKind="primitive",e.typeName="string";break;case"object":n==null?e.typeName="null":n instanceof Date?(e.typeKind="primitive",e.typeName="date"):n instanceof RegExp?(e.typeKind="primitive",e.typeName="regexp"):n instanceof Function?(e.typeKind="primitive",e.typeName="function"):(e.typeKind="anonymousStructure",e.typeName="object",e.properties=[],Object.keys(n).map(function(i){var u,o=n[i],l=r.valueToTypeAnnotaion(o),d=new m.X0(i);d.typeAnnotation=l,d.defaultValue=o,(u=e.properties)===null||u===void 0||u.push(d)}));break;default:e.typeKind="unknown",e.typeName=a;break}}return e}},{key:"typeAnnotaionToValue",value:function(n){var r,e,a=this,i;switch(n.typeName){case"array":i=(r=n.defaultValue)!==null&&r!==void 0?r:[];break;case"boolean":i=n.defaultValue?n.defaultValue=="true":!1;break;case"number":i=parseFloat(n.defaultValue);break;case"null":i=null;break;case"date":i=new Date(n.defaultValue);break;case"regexp":i=new RegExp(n.defaultValue);break;case"object":i={},(e=n.properties)===null||e===void 0||e.forEach(function(u){i[u.name]=a.typeAnnotaionToValue(u.typeAnnotation)});break;case"string":case"function":default:i=n.defaultValue;break}return i}},{key:"getParamArrayByJson",value:function(n){var r=[];return n&&Object.keys(n).forEach(function(e){var a=new m.dO(e);a.typeAnnotation=s.valueToTypeAnnotaion(n[e]),a.defaultValue=n[e],r.push(a)}),r}},{key:"getReturnArrayByJson",value:function(n){var r=[];return n&&Object.keys(n).forEach(function(e){var a=new m.z1(e);a.typeAnnotation=s.valueToTypeAnnotaion(n[e]),a.defaultValue=n[e],r.push(a)}),r}},{key:"getVariableArrayByJson",value:function(n){var r=[];return n&&Object.keys(n).forEach(function(e){var a=new m._w(e);a.typeAnnotation=s.valueToTypeAnnotaion(n[e]),a.defaultValue=n[e],r.push(a)}),r}},{key:"getEnvsArrayByJson",value:function(n){var r=[];return n&&Object.keys(n).forEach(function(e){var a=new M(e);a.typeAnnotation=s.valueToTypeAnnotaion(n[e]),a.defaultValue=n[e],r.push(a)}),r}},{key:"getJsonByParams",value:function(n){var r=this,e={};return n==null||n.forEach(function(a){e[a.name]=a.typeAnnotation?r.typeAnnotaionToValue(a.typeAnnotation):a.defaultValue}),e}}]),s}()},76262:function(B,h,t){var E=t(48305),c=t.n(E),D=t(85343),g=t(20210),O=t(39710),p=t(63121),m=t(87363),P=t.n(m),v=t(62086),M=function(s){var f,n=(0,m.useState)({}),r=c()(n,2),e=r[0],a=r[1];(0,m.useEffect)(function(){var u=s.values,o=u.params,l=u.variables,d=u.envs,A=u.returns,C=u.log;a({params:JSON.stringify(g.y.getJsonByParams(o)),variables:JSON.stringify(g.y.getJsonByParams(l)),returns:JSON.stringify(g.y.getJsonByParams(A)),envs:JSON.stringify(g.y.getJsonByParams(d)),log:C})},[s.values]);var i=(0,m.useCallback)(function(u){try{return JSON.parse(u),!0}catch(o){return!1}},[]);return(0,v.jsxs)("span",{children:[s.children,(0,v.jsx)(O.Z,{open:(f=s.open)!==null&&f!==void 0?f:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return s==null?void 0:s.setOpen(!1)},children:(0,v.jsx)(D.Z,{formId:"logic-setting",values:e,onSubmit:function(o){console.log("\u63D0\u4EA4\u53C2\u6570"),console.log(o);var l=!1;Object.keys(o).forEach(function(d){var A=o[d];if(!i(A)){var C=d==="params"?"\u5165\u53C2":d==="variables"?"\u5C40\u90E8\u53D8\u91CF":d==="returns"?"\u8FD4\u56DE\u53C2\u6570":"\u73AF\u5883\u53D8\u91CF";switch(d){case"params":return p.ZP.error("\u5165\u53C2json\u683C\u5F0F\u9519\u8BEF"),l=!0,!1;break;case"variables":return p.ZP.error("\u5C40\u90E8\u53D8\u91CFjson\u683C\u5F0F\u9519\u8BEF"),l=!0,!1;break;case"returns":return p.ZP.error("\u8FD4\u56DE\u53C2\u6570json\u683C\u5F0F\u9519\u8BEF"),l=!0,!1;break;case"ens":return p.ZP.error("\u73AF\u5883\u53D8\u91CFjson\u683C\u5F0F\u9519\u8BEF"),l=!0,!1;break;default:break}}}),l||(s!=null&&s.onSubmit&&s.onSubmit(o),s==null||s.setOpen(!1))}})})]})};h.Z=M},98496:function(B,h,t){var E=t(85343),c=t(20210),D=t(63121),g=t(39710),O=t(22778),p=t(87363),m=t.n(p),P=t(62086),v=function(_){var s,f=(0,O.cI)();(0,p.useEffect)(function(){var e=_.values.params;f.setValues({params:JSON.stringify(c.y.getJsonByParams(e))})},[_.values]);var n=(0,p.useCallback)(function(e){try{return JSON.parse(e),!0}catch(a){return!1}},[]);function r(e){var a=!1;Object.keys(e).forEach(function(i){var u=e[i];if(["params","headers"].indexOf(i)>-1&&!n(u)){var o=i==="params"?"\u5165\u53C2":"\u8BF7\u6C42\u5934";return D.ZP.error("".concat(o,"json\u683C\u5F0F\u9519\u8BEF")),a=!0,!1}}),a||(_!=null&&_.onSubmit&&_.onSubmit(e,e.debugType),_==null||_.setOpen(!1))}return(0,P.jsxs)("span",{children:[_.children,(0,P.jsx)(g.Z,{open:(s=_.open)!==null&&s!==void 0?s:!1,title:"\u8C03\u8BD5\u53C2\u6570\u914D\u7F6E",width:1e3,footer:!1,onCancel:function(){return _==null?void 0:_.setOpen(!1)},children:(0,P.jsx)(E.Z,{formId:"logic-debug-input",onSubmit:r})})]})};h.Z=v},72677:function(B,h,t){t.d(h,{W:function(){return P}});var E=t(26068),c=t.n(E),D=t(25298),g=t.n(D),O=t(17069),p=t.n(O),m=t(74737),P=function(){function v(){g()(this,v)}return p()(v,[{key:"graphToLogicItems",value:function(_,s){var f=(0,m.nq)(s==null?void 0:s.id,_==null?void 0:_.getCells());return f.visualConfig=_==null?void 0:_.toJSON(),c()(c()({},s),{},{visualConfig:f.visualConfig,items:f.items})}},{key:"logicToGraphJson",value:function(_){var s=(0,m.S8)(_);return s}}]),v}()},30098:function(B,h,t){t.d(h,{O:function(){return s}});var E=t(90228),c=t.n(E),D=t(87999),g=t.n(D),O=t(950),p=t(8250),m=t(15451),P=t(12119),v={buildGroup:function(r,e,a,i){var u=Number.parseInt(e/2),o=e%2==0;return{name:r,title:a,graphHeight:(o?u:u+1)*(i||70)+10}}},M=v;function _(n){return n.length>7?"".concat(n.substring(0,7),`\r
`).concat(n.substring(7)):n}function s(n){return f.apply(this,arguments)}function f(){return f=g()(c()().mark(function n(r){var e,a;return c()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return e=[],a="/api/ide/asset/v1/logic-item/readFromCode",r&&(a="/api/ide/papi/".concat(r,"/api/ide/asset/v1/logic-item/readFromCode")),u.abrupt("return",Promise.all([(0,p.K)(),O.Z.get(a)]).then(function(o){if(console.log("getPanelData"),o[1].status==200){var l=o[1].data.data;Object.keys(l).forEach(function(d,A){var C=M.buildGroup(d,l[d].length,d);e.push(C),l[d].sort(function(b,y){return b.order?b.order.localeCompare(y.order):1}).forEach(function(b){o[0].Nodes.push(new P.Z({shape:b.shape?b.shape:"ExtShape"+(A%3==0?"1":A%3==1?"2":"3"),ports:m.Tt,width:100,height:50,text:b.name,data:{config:b.logicItem},_groups:[b.group]}))})})}return{Nodes:o[0].Nodes,Groups:e}}));case 4:case"end":return u.stop()}},n)})),f.apply(this,arguments)}}}]);
