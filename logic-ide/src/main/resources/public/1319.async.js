"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[1319],{81319:function(re,j,h){h.r(j),h.d(j,{TagControlRenderer:function(){return ee},default:function(){return L}});var n=h(15767),W=h(87363),g=h.n(W),v=h(42977),Z=h(30673),z=h(33170),G=h.n(z),J=h(96789),M=h.n(J),H=h(23804),Q=h.n(H),$=h(72976),X=h.n($),Y=h(4363),k=h.n(Y),N=h(61533),le=h.n(N),I=h(94391),q=h(45581),U=h(8427),L=function(C){(0,n.ZT)(s,C);function s(t){var e=C.call(this,t)||this;return e.input=g().createRef(),e.state={isOpened:!1,inputValue:"",isFocused:!1,selectedOptions:t.selectedOptions,cacheOptions:[]},e}return s.prototype.componentDidUpdate=function(t){var e=this.props;t.value!==e.value&&this.setState({inputValue:""})},s.prototype.doAction=function(t,e,i){var o,a,r=this.props,u=r.resetValue,l=r.onChange,p=r.formStore,d=r.store,c=r.name,m=t==null?void 0:t.actionType;if(m==="clear")l==null||l("");else if(m==="reset"){var w=(a=(0,v.E04)((o=p==null?void 0:p.pristine)!==null&&o!==void 0?o:d==null?void 0:d.pristine,c))!==null&&a!==void 0?a:u;l==null||l(w!=null?w:"")}},s.prototype.dispatchEvent=function(t,e){return e===void 0&&(e={}),(0,n.mG)(this,void 0,void 0,function(){var i,o,a,r;return(0,n.Jh)(this,function(u){switch(u.label){case 0:return i=this.props,o=i.dispatchEvent,a=i.options,[4,o(t,(0,v.vXk)(this.props,(0,n.pi)({options:a,items:a},e)))];case 1:return r=u.sent(),[2,!!(r!=null&&r.prevented)]}})})},s.prototype.normalizeInputValue=function(t){var e=this.props,i=e.enableBatchAdd,o=e.separator,a=e.valueField,r=e.labelField,u=e.delimiter,l=[];if(i&&o&&typeof o=="string")l=t.split(o);else{var p=k()(X()(t.split(u||",")));l.push.apply(l,(0,n.ev)([],(0,n.CR)(p),!1))}return l.filter(Boolean).map(function(d){var c;return c={},c["".concat(a||"value")]=d,c["".concat(r||"label")]=d,c})},s.prototype.normalizeOptions=function(t){var e=this.props,i=e.joinValues,o=e.extractValue,a=e.delimiter,r=e.valueField;return i?t.map(function(u){return u[r||"value"]}).join(a||","):o?t.map(function(u){return u[r||"value"]}):t},s.prototype.normalizeMergedValue=function(t,e){e===void 0&&(e=!0);var i=this.props,o=i.selectedOptions,a=i.valueField,r=Q()(o.concat(),this.normalizeInputValue(t),function(u,l){return u[a||"value"]===l[a||"value"]});return e?this.normalizeOptions(r):r},s.prototype.validateInputValue=function(t){var e=this.props,i=e.max,o=e.maxTagLength,a=e.enableBatchAdd,r=e.separator,u=e.onInputValidateFailed,l=e.valueField,p=this.normalizeMergedValue(t,!1);if(i!=null&&M()(i)&&p.length>i)return u==null||u(p.map(function(c){return c[l||"value"]}),"max"),!1;var d=this.normalizeInputValue(t);return o!=null&&M()(o)&&d.some(function(c){return c[l||"value"].length>o})?(u==null||u(d.map(function(c){return c[l||"value"]}),"maxLength"),!1):!0},s.prototype.getValue=function(t,e,i){t===void 0&&(t="normal"),e===void 0&&(e={});var o=this.props,a=o.joinValues,r=o.extractValue,u=o.delimiter,l=o.valueField;i=i||this.props.selectedOptions;var p=i.concat();return t==="push"?p.push(e):t==="pop"&&p.pop(),a?p.map(function(d){return d[l||"value"]}).join(u||","):r?p.map(function(d){return d[l||"value"]}):p},s.prototype.addItem=function(t){return(0,n.mG)(this,void 0,void 0,function(){var e,i,o,a,r,u,l;return(0,n.Jh)(this,function(p){switch(p.label){case 0:return this.isReachMax()?[2]:(e=this.props,i=e.selectedOptions,o=e.onChange,a=e.valueField,r=i.concat(),G()(r,function(d){return d[a||"value"]==t[a||"value"]})?[2]:(u=this.getValue("push",t),[4,this.dispatchEvent("change",{value:u,selectedItems:i.concat(t)})]));case 1:return l=p.sent(),l||o(u),[2]}})})},s.prototype.addItem2=function(t){var e=this.props,i=e.mobileUI,o=e.valueField,a=o===void 0?"value":o;if(i){var r=this.state.selectedOptions.concat(),u=r.findIndex(function(l){return l[a]===t[a]});~u?r.splice(u,1):this.isReachMaxFromState()||r.push(t),this.setState({selectedOptions:r})}},s.prototype.isExist=function(t){var e=this.props,i=e.options,o=e.valueField,a=o===void 0?"value":o,r=this.state.cacheOptions;return i.some(function(u){return u[a]===t})||r.some(function(u){return u[a]===t})},s.prototype.addSelection=function(){var t=this.state.inputValue,e=this.props.maxTagLength,i=this.state.selectedOptions.slice(),o=this.state.cacheOptions.slice();if(e!==void 0&&(t=t.trim(),t=t.slice(0,e)),!this.isExist(t)&&t&&!this.isReachMaxFromState()){var a=this.normalizeInputValue(t);i.push(a[0]),o.push(a[0]),this.setState({inputValue:"",selectedOptions:i,cacheOptions:o})}},s.prototype.onConfirm=function(){return(0,n.mG)(this,void 0,void 0,function(){var t,e,i,o;return(0,n.Jh)(this,function(a){switch(a.label){case 0:return t=this.state.selectedOptions,e=this.props.onChange,i=this.getValue("normal",{},t),[4,this.dispatchEvent("change",{value:i,selectedItems:t})];case 1:return o=a.sent(),o||e(i),this.close(),[2]}})})},s.prototype.handleFocus=function(t){var e,i;return(0,n.mG)(this,void 0,void 0,function(){var o,a;return(0,n.Jh)(this,function(r){switch(r.label){case 0:return this.setState({isFocused:!0,isOpened:!0,selectedOptions:this.props.selectedOptions}),o=this.getValue("normal"),[4,this.dispatchEvent("focus",{value:o,selectedItems:this.props.selectedOptions})];case 1:return a=r.sent(),a||((i=(e=this.props).onFocus)===null||i===void 0||i.call(e,t)),[2]}})})},s.prototype.handleBlur=function(t){var e,i;return(0,n.mG)(this,void 0,void 0,function(){var o,a,r,u,l,p,d,c;return(0,n.Jh)(this,function(m){switch(m.label){case 0:return o=this.props,a=o.selectedOptions,r=o.onChange,u=o.mobileUI,l=o.options,u&&l.length?[2]:(p=this.state.inputValue.trim(),this.validateInputValue(p)?(d=this.normalizeMergedValue(p),[4,this.dispatchEvent("blur",{value:d,selectedItems:a})]):(this.setState({isFocused:!1,isOpened:!1}),[2]));case 1:return c=m.sent(),c||((i=(e=this.props).onBlur)===null||i===void 0||i.call(e,t)),this.setState({isFocused:!1,isOpened:!1,inputValue:""},p?function(){a.length!==d.length&&(r==null||r(d))}:void 0),[2]}})})},s.prototype.close=function(){this.setState({isOpened:!1})},s.prototype.handleInputChange=function(t){this.setState({inputValue:t})},s.prototype.handleChange=function(t){return(0,n.mG)(this,void 0,void 0,function(){var e,i,o,a,r,u,l,p;return(0,n.Jh)(this,function(d){switch(d.label){case 0:return e=this.props,i=e.joinValues,o=e.extractValue,a=e.delimiter,r=e.valueField,u=e.onChange,l=Array.isArray(t)?t.concat():[],(i||o)&&(l=t.map(function(c){return c[r||"value"]})),i&&(l=l.join(a||",")),[4,this.dispatchEvent("change",{value:l,selectedItems:t})];case 1:return p=d.sent(),p||u(l),[2]}})})},s.prototype.renderItem=function(t){var e=this.props.labelField;return"".concat(t[e||"label"])},s.prototype.handleKeyDown=function(t){return(0,n.mG)(this,void 0,void 0,function(){var e,i,o,a,r,u,l,p,d,c,d,c;return(0,n.Jh)(this,function(m){switch(m.label){case 0:return e=this.props,i=e.selectedOptions,o=e.onChange,a=e.delimiter,r=e.labelField,u=e.valueField,l=this.state.inputValue.trim(),p=i.concat(this.normalizeMergedValue(l,!1)),i.length&&!l&&t.key=="Backspace"?(d=this.getValue("pop"),[4,this.dispatchEvent("change",{value:d,selectedItems:p})]):[3,2];case 1:return c=m.sent(),c||o(d),[3,5];case 2:return l&&(t.key==="Enter"||t.key===a)?(t.preventDefault(),t.stopPropagation(),d=this.normalizeMergedValue(l),[4,this.dispatchEvent("change",{value:d,selectedItems:p})]):[3,4];case 3:return c=m.sent(),this.validateInputValue(l)?(!c&&i.length!==d.length&&o(d),this.setState({inputValue:""}),[3,5]):(this.setState({isFocused:!1,isOpened:!1}),[2]);case 4:!l&&t.key==="Enter"&&this.handleBlur(t),m.label=5;case 5:return[2]}})})},s.prototype.handleOptionChange=function(t){var e=this.props.mobileUI;if(e){this.addItem2(t);return}this.isReachMax()||!t||this.addItem(t)},s.prototype.getTarget=function(){return this.input.current},s.prototype.getParent=function(){return this.input.current&&(0,N.findDOMNode)(this.input.current).parentElement},s.prototype.reload=function(t,e){var i=this.props.reloadOptions;i&&i(t,e)},s.prototype.isReachMax=function(){var t=this.props,e=t.max,i=t.selectedOptions;return e!=null&&M()(e)&&i.length>=e},s.prototype.isReachMaxFromState=function(){var t=this.state.selectedOptions,e=this.props.max;return e!=null&&M()(e)&&t.length>=e},s.prototype.render=function(){var t=this,e=this.props,i=e.className,o=e.style,a=e.classnames,r=e.disabled,u=e.placeholder,l=e.name,p=e.clearable,d=e.selectedOptions,c=e.loading,m=e.popOverContainer,w=e.dropdown,_=e.options,S=e.optionsTip,K=e.maxTagCount,te=e.overflowTagPopover,R=e.translate,ne=e.loadingConfig,T=e.valueField,F=e.env,f=e.mobileUI,ie=e.labelField,P=e.testIdBuilder,ae=this.state.inputValue,V=Array.isArray(_)?(0,v.get)(_,function(O,b,B,x){return O[T||"value"]!==void 0&&(f||!~d.indexOf(O))&&((0,U.Lu)([O].concat(x),ae,{keys:[ie||"label",T||"value"],threshold:U.Lu.rankings.CONTAINS}).length||Array.isArray(O.children)&&!!O.children.length)},0,!0):[],D=this.isReachMax();return g().createElement(Z.ZP,{selectedItem:d,isOpen:f?this.state.isOpened:this.state.isFocused,inputValue:this.state.inputValue,onChange:this.handleOptionChange,itemToString:this.renderItem},function(O){var b=O.isOpen,B=O.highlightedIndex,x=O.getItemProps,oe=O.getInputProps;return g().createElement("div",{className:a(i,"TagControl")},g().createElement(I.AlT,(0,n.pi)({},oe({name:l,ref:t.input,placeholder:R(u!=null?u:"Tag.placeholder"),value:t.state.inputValue,onKeyDown:t.handleKeyDown,onFocus:f?void 0:t.handleFocus,onBlur:t.handleBlur,disabled:r}),{onResultClick:f?t.handleFocus:void 0,inputPlaceholder:"",onChange:t.handleInputChange,className:a("TagControl-input"),result:d,onResultChange:t.handleChange,itemRender:t.renderItem,clearable:p,maxTagCount:K,overflowTagPopover:te,popOverContainer:m||F.getModalContainer,allowInput:!f||f&&!(_!=null&&_.length),mobileUI:f,testIdBuilder:P==null?void 0:P.getChild("resule-box")}),c?g().createElement(I.$jN,{loadingConfig:ne,size:"sm"}):void 0),w!==!1?f?g().createElement(I.N4A,{className:a("Tag-popup"),container:f?F==null?void 0:F.getModalContainer:m||F.getModalContainer,isShow:b&&!!V.length,showConfirm:!0,onConfirm:t.onConfirm,onHide:t.close},g().createElement("div",null,g().createElement(I.QE3,{selectedOptions:d,mobileUI:f,options:V.concat(t.state.cacheOptions),itemRender:t.renderItem,highlightIndex:B,getItemProps:function(y){var E=y.item,A=y.index;return(0,n.pi)({},x({index:A,item:E,className:a("ListMenu-item",{"is-active":~(t.state.selectedOptions.map(function(se){return se[T]})||[]).indexOf(E[T])})}))}}),f&&!t.isReachMaxFromState()?g().createElement("div",{className:a("ListMenu-add-wrap")},g().createElement(I.AlT,{placeholder:R("placeholder.enter")+"...",allowInput:!0,value:t.state.inputValue,mobileUI:f,clearable:!0,maxTagCount:K,onChange:function(y){t.setState({inputValue:y})},onBlur:t.addSelection})):null)):g().createElement(v.aVW,{container:m||t.getParent,target:t.getTarget,placement:"auto",show:b&&!!V.length},g().createElement(v.v$m,{overlay:!0,className:a("TagControl-popover"),onHide:t.close},g().createElement(I.QE3,{options:V,itemRender:t.renderItem,highlightIndex:B,testIdBuilder:P==null?void 0:P.getChild("options"),getItemProps:function(y){var E=y.item,A=y.index;return(0,n.pi)({},x({index:A,item:E,disabled:D||E.disabled,className:a("ListMenu-item",{"is-disabled":D})}))}}))):g().createElement("div",{className:a("TagControl-sug")},S?g().createElement("div",{className:a("TagControl-sugTip")},R(S)):null,_.map(function(y,E){return g().createElement("div",{className:a("TagControl-sugItem",{"is-disabled":y.disabled||r||D}),key:E,onClick:t.addItem.bind(t,y)},y.label)})))})},s.defaultProps={resetValue:"",labelField:"label",valueField:"value",multiple:!0,placeholder:"Tag.placeholder",optionsTip:"Tag.tip",separator:"-"},(0,n.gn)([v.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[String,Object]),(0,n.w6)("design:returntype",Promise)],s.prototype,"dispatchEvent",null),(0,n.gn)([v.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[String,Object,Array]),(0,n.w6)("design:returntype",void 0)],s.prototype,"getValue",null),(0,n.gn)([v.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],s.prototype,"addSelection",null),(0,n.gn)([v.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",Promise)],s.prototype,"onConfirm",null),(0,n.gn)([v.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object]),(0,n.w6)("design:returntype",Promise)],s.prototype,"handleFocus",null),(0,n.gn)([v.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object]),(0,n.w6)("design:returntype",Promise)],s.prototype,"handleBlur",null),(0,n.gn)([v.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],s.prototype,"close",null),(0,n.gn)([v.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[String]),(0,n.w6)("design:returntype",void 0)],s.prototype,"handleInputChange",null),(0,n.gn)([v.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Array]),(0,n.w6)("design:returntype",Promise)],s.prototype,"handleChange",null),(0,n.gn)([v.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object]),(0,n.w6)("design:returntype",Object)],s.prototype,"renderItem",null),(0,n.gn)([v.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object]),(0,n.w6)("design:returntype",Promise)],s.prototype,"handleKeyDown",null),(0,n.gn)([v.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object]),(0,n.w6)("design:returntype",void 0)],s.prototype,"handleOptionChange",null),(0,n.gn)([v.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],s.prototype,"getTarget",null),(0,n.gn)([v.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],s.prototype,"getParent",null),(0,n.gn)([v.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],s.prototype,"isReachMax",null),(0,n.gn)([v.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],s.prototype,"isReachMaxFromState",null),(0,n.gn)([(0,q.i)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],s.prototype,"render",null),s}(g().PureComponent),ee=function(C){(0,n.ZT)(s,C);function s(){return C!==null&&C.apply(this,arguments)||this}return s=(0,n.gn)([(0,v.oZB)({type:"input-tag"})],s),s}(L)}}]);
