"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[5567],{30531:function(Se,k,e){e.d(k,{B0:function(){return g.Z},FQ:function(){return w.F}});var Y=e(85343),g=e(68784),w=e(30697)},76039:function(Se,k,e){var Y=e(90228),g=e.n(Y),w=e(31759),de=e.n(w),ce=e(87999),ge=e.n(ce),ve=e(48305),B=e.n(ve),q=e(75487),_e=e.n(q),ee=e(87363),T=e.n(ee),fe=e(63121),me=e(39710),he=e(82494),C=e(30531),J=e(99511),ne=e(31336),m=e(62086),be=function(a){var E=a.logicLog,z=a.show,Z=a.onClose,Ie=T().useState(""),oe=B()(Ie,2),xe=oe[0],te=oe[1],G=T().useState(),se=B()(G,2),pe=se[0],n=se[1],Oe=T().useState(""),ie=B()(Oe,2),Ce=ie[0],Me=ie[1],d=T().useState(!1),R=B()(d,2),H=R[0],y=R[1];(0,ee.useEffect)(function(){z&&E&&(te(""),V(E))},[z,E]);function V(j){return D.apply(this,arguments)}function D(){return D=ge()(g()().mark(function j(F){var U,W,I,$,L,S,i,O,le,M,h,Q,re,P,A,x,_,N;return g()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,y(!0),console.log("\u5F00\u59CB\u83B7\u53D6\u6570\u636E",F),U=F.itemLogs,W=U.filter(function(ye){return ye.success==!1}),I=W[0],I){t.next=11;break}return fe.ZP.error("\u6CA1\u6709\u627E\u5230\u9519\u8BEF\u7684\u7EC4\u4EF6\u65E5\u5FD7"),y(!1),Z&&Z(),t.abrupt("return");case 11:if($=I.msg,L=I.config,n(L),S=L.type,S!="java"){t.next=24;break}return t.next=18,(0,J.kZ)(L);case 18:i=t.sent,console.log("\u83B7\u53D6\u6E90\u7801",i),O="",i&&i.sourceCode&&(O=i.sourceCode),t.next=25;break;case 24:S=="js"&&(O=L.script);case 25:return Me(O),t.next=28,fetch("/api/ide/ai/chat/completions",{method:"post",body:JSON.stringify({model:"qwen2.5-coder:32b",stream:!0,messages:[{role:"system",content:'1\u3001\u62A5\u9519\u4FE1\u606F:"'.concat($,'";2\u3001\u62A5\u9519\u7684').concat(S,"\u7EC4\u4EF6\u4EE3\u7801:```").concat(O,"```;\u3002\u5E2E\u6211\u6839\u636E\u4EE5\u4E0A\u4FE1\u606F\u7EFC\u5408\u5206\u6790\u62A5\u9519\u7684\u539F\u56E0\u3002\n")}]}),headers:{"Content-Type":"application/json",Accept:"text/event-stream","Cache-Control":"no-cache"}});case 28:le=t.sent,M="",h=!1,Q=!1,t.prev=32,P=_e()((0,ne.Z)({readableStream:le.body}));case 34:return t.next=36,P.next();case 36:if(!(h=!(A=t.sent).done)){t.next=46;break}x=A.value,console.log("XStream chunk"),console.log(x),_=JSON.parse(x.data),typeof _=="string"&&(_=JSON.parse(_),console.log(de()(_))),_&&_.choices&&_.choices.length>0&&_.choices[0].delta&&_.choices[0].delta.content&&(N=_.choices[0].delta.content.toString(),console.log("newMsg:",N),console.log("curMsg:",M),M+=N,te(M));case 43:h=!1,t.next=34;break;case 46:t.next=52;break;case 48:t.prev=48,t.t0=t.catch(32),Q=!0,re=t.t0;case 52:if(t.prev=52,t.prev=53,!(h&&P.return!=null)){t.next=57;break}return t.next=57,P.return();case 57:if(t.prev=57,!Q){t.next=60;break}throw re;case 60:return t.finish(57);case 61:return t.finish(52);case 62:t.next=68;break;case 64:t.prev=64,t.t1=t.catch(0),console.error("\u8BF7\u6C42\u5931\u8D25:",t.t1),y(!1);case 68:case"end":return t.stop()}},j,null,[[0,64],[32,48,52,62],[53,,57,61]])})),D.apply(this,arguments)}return(0,m.jsx)(me.Z,{open:z,title:"AI\u8F85\u52A9\u5206\u6790(Beta)",width:1e3,footer:null,onCancel:function(){Z&&Z()},children:(0,m.jsxs)("div",{children:[(0,m.jsx)(C.B0,{pageId:"ai-debug-log",data:{message:E==null?void 0:E.message,content:xe,code:Ce,config:pe}}),(0,m.jsx)(he.Z,{style:{marginLeft:"10px"},spinning:H})]})})};k.Z=be},75567:function(Se,k,e){e.d(k,{Z:function(){return Ce}});var Y=e(48305),g=e.n(Y),w=e(80401),de=e(9565),ce=e(8674),ge=e(16020),ve=e(94474),B=e(74354),q=e(91505),_e=e(81376),ee=e(61943),T=e(90541),fe=e(66508),me=e(37348),he=e(58523),C=e(77154),J=e(39765),ne=e(90171),m=e(67703),be=e(54625),Ee=e(12315),a=e(87363),E=e.n(a),z=e(1143),Z=e(8250),Ie=e(72233),oe=e(83359),xe=e(66839),te=e(89202),G=e(85343),se=e(30531),pe=e(76039),n=e(62086),Oe=E().createContext({logic:new z.Iz("")}),ie=function(d){var R,H,y,V,D,j,F,U,W,I,$,L=(0,a.useState)(),S=g()(L,2),i=S[0],O=S[1],le=(0,a.useState)(),M=g()(le,2),h=M[0],Q=M[1],re=(0,a.useState)(!0),P=g()(re,2),A=P[0],x=P[1],_=(0,a.useState)(),N=g()(_,2),o=N[0],t=N[1],ye=(0,a.useState)(),Pe=g()(ye,2),r=Pe[0],Fe=Pe[1],Ue=(0,a.useState)(),Ae=g()(Ue,2),De=Ae[0],We=Ae[1],$e=(0,a.useState)(),Be=g()($e,2),ae=Be[0],je=Be[1],Ne=(0,a.useState)(),Te=g()(Ne,2),Ke=Te[0],ke=Te[1],Le=(0,a.useRef)(),we=(0,a.useState)(!1),Ze=g()(we,2),Je=Ze[0],Re=Ze[1];function ze(l,v,s,c){return{name:"button",args:{markup:[{tagName:"circle",selector:"button",attrs:{r:14,x:0,y:0,stroke:v.success?"#52C41A":"red","stroke-width":5-s<1?1:5-s,fill:"white",cursor:"pointer"}},{tagName:"text",textContent:l,selector:"icon",attrs:{"font-size":20-s<12?12:20-s,"text-anchor":"middle","pointer-events":"none",y:"0.3em"}}],x:(c-1)*28,y:0,onClick:function(b){var K=b.view,p=K.cell;je(p),x(!1),t(v)}}}}(0,a.useEffect)(function(){De&&(i==null||i.centerCell(De))},[De,i]),(0,a.useEffect)(function(){console.log("select curItemLog",o)},[o]),(0,a.useEffect)(function(){var l=i==null?void 0:i.getNodes().find(function(v){return v.id==d.nextId});l==null||l.attr("body/fill","red"),We(l)},[d.nextId]),(0,a.useEffect)(function(){var l;i==null||(l=i.getNodes().find(function(v){return v.id==d.nextId}))===null||l===void 0||l.attr("body/fill","red")},[i]),(0,a.useEffect)(function(){d.config&&Q(d.config)},[d.config]),(0,a.useEffect)(function(){var l;console.log("props.debugLogs",d.debugLogs);var v=[];d&&((l=d.debugLogs)===null||l===void 0||l.forEach(function(s){var c,f;v.push({children:(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("span",{style:{cursor:"pointer",fontWeight:s.id==(r==null?void 0:r.id)?"bolder":"normal",color:s.id==(r==null?void 0:r.id)?"#52c41a":"black"},onClick:function(){Fe(s),i==null||i.fromJSON(h==null?void 0:h.visualConfig);var K,p={};s.itemLogs.forEach(function(X,ue){var u=i==null?void 0:i.getNodes().find(function(He){return He.id==X.config.id});console.log("\u9009\u4E2D\u7684\u8282\u70B9"),console.log(u),u&&(u.addTools({name:"boundary",args:{attrs:{stroke:"red",strokeWidth:1.5,rx:5,ry:5}}}),K=u),p[u==null?void 0:u.id]?p[u==null?void 0:u.id]+=1:p[u==null?void 0:u.id]=1,u==null||u.addTools(ze(ue,X,ue,p[u==null?void 0:u.id]))}),i==null||i.centerCell(K),t({}),je({})},children:[(0,n.jsx)("p",{children:(c=s.itemLogs[0])===null||c===void 0?void 0:c.config.name}),(0,n.jsxs)("p",{children:["\u5F00\u59CB\uFF1A",s.itemLogs[0].beginTime]}),(0,n.jsxs)("p",{children:["\u7ED3\u675F\uFF1A",s.itemLogs[s.itemLogs.length-1].endTime]}),((f=d.logicIns)===null||f===void 0?void 0:f.version)==s.version?(0,n.jsx)("p",{}):(0,n.jsx)("p",{children:(0,n.jsxs)(he.Z,{children:[(0,n.jsx)(C.Z.Paragraph,{style:{color:"red"},children:"\u7248\u672C\u53F7:"}),(0,n.jsxs)(C.Z.Paragraph,{copyable:{tooltips:["\u70B9\u51FB\u590D\u5236","\u590D\u5236\u6210\u529F!"],text:s.version},children:[s.version,(0,n.jsx)(C.Z.Link,{style:{margin:"5px"},href:"#/assets/logic/i/".concat(s.logicId,"/view/").concat(s.version),target:"_blank",children:(0,n.jsx)(w.Z,{})})]})]})}),(0,n.jsx)("p",{children:s.message}),(0,n.jsx)(J.ZP,{type:"primary",size:"small",icon:(0,n.jsx)(de.Z,{}),onClick:function(){Re(!0)},children:"AI\u5206\u6790"})]})}),color:s.success?"green":"red"})})),ke(v)},[d.debugLogs,d.logicIns,i,r]),(0,a.useEffect)(function(){if(h){try{var l=(0,Z.K)(),v=l.Shapes;(0,Ie.m)(v)}catch(c){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(c)}if(Le.current!=null){var s=new q.kJ({container:Le.current,embedding:{enabled:!0,validate:function(f){return f.child.setData({hoverNode:f.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new q.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(f){var b=f.targetMagnet;return!!b}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}},background:{color:"#F2F7FA"},grid:!0});s.use(new fe.H({enabled:!0,sharp:!0})).use(new _e.A({enabled:!0})).use(new T.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new me.T({enabled:!0})).use(new ee.N),s.on("edge:dblclick",function(){}),s.on("edge:mouseenter",function(){}),s.on("edge:mouseleave",function(){}),s.on("node:moved",function(){}),s.on("node:mouseenter",function(){}),s.on("node:mouseleave",function(){}),s.on("node:added",function(){}),s.on("node:dblclick",function(c){var f=c.node}),s.on("blank:dblclick",function(c){var f=c.x,b=c.y}),s.fromJSON(h.visualConfig),(0,oe.V)(s),O(s)}}},[h]);var Ve=function(){},Ge=[{key:"debug-node-input",label:"\u8282\u70B9\u5165\u51FA\u53C2",children:(0,n.jsxs)("div",{children:[(o==null||(R=o.configInstance)===null||R===void 0?void 0:R.type)=="sub-logic"?(0,n.jsxs)("div",{children:[(0,n.jsxs)(C.Z.Text,{style:{margin:"15px"},copyable:{tooltips:["","\u590D\u5236\u6210\u529F!"],text:o==null||(H=o.configInstance)===null||H===void 0?void 0:H.objectId},children:["\u5B50\u903B\u8F91\u65E5\u5FD7:",(0,n.jsx)("a",{target:"_blank",href:"#/debug/logic-log/i/".concat(o==null||(y=o.configInstance)===null||y===void 0?void 0:y.objectId),children:o==null||(V=o.configInstance)===null||V===void 0?void 0:V.objectId})]}),(0,n.jsx)(ne.Z,{})]}):"",(0,n.jsx)(G.Z,{formId:"debug-node-input",values:{success:o==null?void 0:o.success,msg:o==null?void 0:o.msg,returnData:o==null?void 0:o.returnData,body:o==null||(D=o.configInstance)===null||D===void 0?void 0:D.body,bizId:o==null||(j=o.configInstance)===null||j===void 0?void 0:j.bizId,logicId:o==null||(F=o.configInstance)===null||F===void 0?void 0:F.url},onSubmit:function(){}}),(0,n.jsx)(C.Z.Text,{style:{margin:"15px"},copyable:{tooltips:["\u590D\u5236\u8282\u70B9\u7F16\u53F7","\u590D\u5236\u6210\u529F!"],text:ae==null?void 0:ae.id},children:"\u8282\u70B9\u7F16\u53F7"}),(0,n.jsx)("div",{})]})},{key:"config",label:"\u8282\u70B9\u914D\u7F6E",children:(0,n.jsx)("div",{children:(0,n.jsx)(te.Z,{onSubmit:function(){},editNode:ae})})},{key:"configIns",label:"\u8282\u70B9\u5B9E\u4F8B",children:(0,n.jsx)("div",{children:(0,n.jsx)(G.Z,{formId:(o==null||(U=o.config)===null||U===void 0?void 0:U.type)||"",values:o==null?void 0:o.configInstance,onSubmit:function(){}})})},{key:"debug-context",label:"\u6267\u884C\u4E0A\u4E0B\u6587",children:(0,n.jsx)(G.Z,{formId:"debug-context",values:{varsJson:r==null?void 0:r.varsJson,paramsJson:r==null?void 0:r.paramsJson,varsJsonEnd:r==null?void 0:r.varsJsonEnd,startNodeId:r==null?void 0:r.itemLogs[0].config.id,startNodeName:r==null?void 0:r.itemLogs[0].config.name,logicId:(W=d.logicIns)===null||W===void 0?void 0:W.logicId,bizId:(I=d.logicIns)===null||I===void 0?void 0:I.bizId},onSubmit:function(){}})}];return(0,n.jsxs)(m.Z,{style:{margin:0,height:"100vh"},children:[(0,n.jsxs)(m.Z.Sider,{theme:"light",collapsedWidth:0,width:260,style:{overflow:"auto",height:"100vh",position:"fixed",left:0,top:0,bottom:0,borderRight:"0.5px solid"},children:[(0,n.jsx)(ne.Z,{children:"\u6267\u884C\u8BB0\u5F55"}),(0,n.jsx)(be.Z,{style:{height:"100%"},items:Ke})]}),(0,n.jsxs)(m.Z,{style:{margin:0,marginLeft:260,padding:0},children:[(0,n.jsxs)(m.Z.Header,{style:{backgroundColor:"white",padding:0},children:[($=d.btns)===null||$===void 0?void 0:$.map(function(l){return l}),(0,n.jsx)(J.ZP,{type:"text",icon:A?(0,n.jsx)(ce.Z,{}):(0,n.jsx)(ge.Z,{}),onClick:function(){x(!A)},style:{float:"right",right:"16px",fontSize:"16px",width:64,height:64}})]}),(0,n.jsxs)(m.Z.Content,{className:"app-content",children:[(0,n.jsx)(Ee.Z,{size:"small",style:{backgroundColor:"white",padding:5,margin:0},items:[ve.Z,B.Z].map(function(l,v){var s=String(v+1);return v==0?{key:s,label:"\u903B\u8F91\u56FE",children:(0,n.jsx)(xe.Z,{ref:Le}),icon:(0,n.jsx)(l,{})}:{key:s,label:"\u6267\u884C\u8282\u70B9",children:(0,n.jsx)(se.B0,{pageId:"itemLogs-table",data:{items:r==null?void 0:r.itemLogs},onBroadcast:function(f,b){var K=b.item.config.id,p=b.item,X=i==null?void 0:i.getNodes().find(function(ue){return ue.id==K});X&&(je(X),x(!1),t(p))}}),icon:(0,n.jsx)(l,{})}})}),(0,n.jsx)(pe.Z,{show:Je,logicLog:r,onClose:function(){return Re(!1)}})]})]}),(0,n.jsxs)(m.Z.Sider,{theme:"light",collapsed:A,collapsedWidth:0,style:{overflow:"scroll"},width:500,children:[(0,n.jsx)(Ee.Z,{items:Ge,defaultActiveKey:"inout"}),(0,n.jsx)(J.ZP,{type:"text",onClick:function(){x(!A)},style:{position:"absolute",top:0,right:0,fontSize:"16px",width:64,height:64},children:"x"})]})]})},Ce=ie}}]);
