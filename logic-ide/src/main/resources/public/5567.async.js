"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[5567],{30531:function(Oe,J,e){e.d(J,{B0:function(){return v.Z},FQ:function(){return z.F}});var q=e(85343),v=e(68784),z=e(30697)},76039:function(Oe,J,e){var q=e(90228),v=e.n(q),z=e(31759),de=e.n(z),ce=e(87999),ge=e.n(ce),ve=e(48305),A=e.n(ve),ee=e(75487),_e=e.n(ee),ne=e(87363),B=e.n(ne),fe=e(63121),me=e(39710),he=e(82494),L=e(30531),G=e(99511),oe=e(31336),m=e(62086),be=function(a){var I=a.logicLog,H=a.show,T=a.onClose,Ie=B().useState(""),te=A()(Ie,2),xe=te[0],se=te[1],V=B().useState(),ie=A()(V,2),pe=ie[0],n=ie[1],Me=B().useState(""),le=A()(Me,2),Ce=le[0],Pe=le[1],d=B().useState(!1),Z=A()(d,2),Q=Z[0],j=Z[1];(0,ne.useEffect)(function(){H&&I&&(se(""),X(I))},[H,I]);function X(O){return S.apply(this,arguments)}function S(){return S=ge()(v()().mark(function O(R){var F,U,x,$,h,p,M,C,l,W,N,K,b,k,re,w,c,y;return v()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,j(!0),console.log("\u5F00\u59CB\u83B7\u53D6\u6570\u636E",R),F=R.itemLogs,U=F.filter(function(o){return o.success==!1}),x=U[0],x){t.next=11;break}return fe.ZP.error("\u6CA1\u6709\u627E\u5230\u9519\u8BEF\u7684\u7EC4\u4EF6\u65E5\u5FD7"),j(!1),T&&T(),t.abrupt("return");case 11:if($=x.msg,h=x.config,n(h),p=h.type,p!="java"){t.next=24;break}return t.next=18,(0,G.kZ)(h);case 18:M=t.sent,console.log("\u83B7\u53D6\u6E90\u7801",M),C="",M&&M.sourceCode&&(C=M.sourceCode),t.next=25;break;case 24:p=="js"&&(C=h.script);case 25:return Pe(C),t.next=28,fetch("/api/ide/ai/chat/completions",{method:"post",body:JSON.stringify({model:"qwen2.5-coder:32b",stream:!0,messages:[{role:"system",content:'1\u3001\u62A5\u9519\u4FE1\u606F:"'.concat($,'";2\u3001\u62A5\u9519\u7684').concat(p,"\u7EC4\u4EF6\u4EE3\u7801:```").concat(C,"```;\u3002\u5E2E\u6211\u6839\u636E\u4EE5\u4E0A\u4FE1\u606F\u7EFC\u5408\u5206\u6790\u62A5\u9519\u7684\u539F\u56E0\u3002\n")}]}),headers:{"Content-Type":"application/json",Accept:"text/event-stream","Cache-Control":"no-cache"}});case 28:l=t.sent,W="",N=!1,K=!1,t.prev=32,k=_e()((0,oe.Z)({readableStream:l.body}));case 34:return t.next=36,k.next();case 36:if(!(N=!(re=t.sent).done)){t.next=46;break}w=re.value,console.log("XStream chunk"),console.log(w),c=JSON.parse(w.data),typeof c=="string"&&(c=JSON.parse(c),console.log(de()(c))),c&&c.choices&&c.choices.length>0&&c.choices[0].delta&&c.choices[0].delta.content&&(y=c.choices[0].delta.content.toString(),console.log("newMsg:",y),console.log("curMsg:",W),W+=y,se(W));case 43:N=!1,t.next=34;break;case 46:t.next=52;break;case 48:t.prev=48,t.t0=t.catch(32),K=!0,b=t.t0;case 52:if(t.prev=52,t.prev=53,!(N&&k.return!=null)){t.next=57;break}return t.next=57,k.return();case 57:if(t.prev=57,!K){t.next=60;break}throw b;case 60:return t.finish(57);case 61:return t.finish(52);case 62:t.next=68;break;case 64:t.prev=64,t.t1=t.catch(0),console.error("\u8BF7\u6C42\u5931\u8D25:",t.t1),j(!1);case 68:case"end":return t.stop()}},O,null,[[0,64],[32,48,52,62],[53,,57,61]])})),S.apply(this,arguments)}return(0,m.jsx)(me.Z,{open:H,title:"AI\u8F85\u52A9\u5206\u6790(Beta)",width:1e3,footer:null,onCancel:function(){T&&T()},children:(0,m.jsxs)("div",{children:[(0,m.jsx)(L.B0,{pageId:"ai-debug-log",data:{message:I==null?void 0:I.message,content:xe,code:Ce,config:pe}}),(0,m.jsx)(he.Z,{style:{marginLeft:"10px"},spinning:Q})]})})};J.Z=be},75567:function(Oe,J,e){e.d(J,{Z:function(){return Ce}});var q=e(48305),v=e.n(q),z=e(80401),de=e(9565),ce=e(8674),ge=e(16020),ve=e(94474),A=e(74354),ee=e(91505),_e=e(81376),ne=e(61943),B=e(90541),fe=e(66508),me=e(37348),he=e(58523),L=e(77154),G=e(39765),oe=e(90171),m=e(67703),be=e(54625),Ee=e(12315),a=e(87363),I=e.n(a),H=e(1143),T=e(8250),Ie=e(72233),te=e(83359),xe=e(66839),se=e(89202),V=e(85343),ie=e(30531),pe=e(76039),n=e(62086),Me=I().createContext({logic:new H.Iz("")}),le=function(d){var Z,Q,j,X,S,O,R,F,U,x,$,h,p,M=(0,a.useState)(),C=v()(M,2),l=C[0],W=C[1],N=(0,a.useState)(),K=v()(N,2),b=K[0],k=K[1],re=(0,a.useState)(!0),w=v()(re,2),c=w[0],y=w[1],Ae=(0,a.useState)(),t=v()(Ae,2),o=t[0],ye=t[1],$e=(0,a.useState)(),Be=v()($e,2),r=Be[0],We=Be[1],Ne=(0,a.useState)(),Te=v()(Ne,2),De=Te[0],Ke=Te[1],ke=(0,a.useState)(),Ze=v()(ke,2),ae=Ze[0],Le=Ze[1],we=(0,a.useState)(),Re=v()(we,2),Je=Re[0],ze=Re[1],je=(0,a.useRef)(),Ge=(0,a.useState)(!1),Fe=v()(Ge,2),He=Fe[0],Ue=Fe[1];function Ve(i,_,s,g){return{name:"button",args:{markup:[{tagName:"circle",selector:"button",attrs:{r:14,x:0,y:0,stroke:_.success?"#52C41A":"red","stroke-width":5-s<1?1:5-s,fill:"white",cursor:"pointer"}},{tagName:"text",textContent:i,selector:"icon",attrs:{"font-size":20-s<12?12:20-s,"text-anchor":"middle","pointer-events":"none",y:"0.3em"}}],x:(g-1)*28,y:0,onClick:function(E){var P=E.view,D=P.cell;Le(D),y(!1),ye(_)}}}}(0,a.useEffect)(function(){De&&(l==null||l.centerCell(De))},[De,l]),(0,a.useEffect)(function(){console.log("select curItemLog",o)},[o]),(0,a.useEffect)(function(){var i=l==null?void 0:l.getNodes().find(function(_){return _.id==d.nextId});i==null||i.attr("body/fill","red"),Ke(i)},[d.nextId]),(0,a.useEffect)(function(){var i;l==null||(i=l.getNodes().find(function(_){return _.id==d.nextId}))===null||i===void 0||i.attr("body/fill","red")},[l]),(0,a.useEffect)(function(){d.config&&k(d.config)},[d.config]),(0,a.useEffect)(function(){var i;console.log("props.debugLogs",d.debugLogs);var _=[];d&&((i=d.debugLogs)===null||i===void 0||i.forEach(function(s){var g,f;_.push({children:(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("span",{style:{cursor:"pointer",fontWeight:s.id==(r==null?void 0:r.id)?"bolder":"normal",color:s.id==(r==null?void 0:r.id)?"#52c41a":"black"},onClick:function(){We(s),l==null||l.fromJSON(b==null?void 0:b.visualConfig);var P,D={};s.itemLogs.forEach(function(Y,ue){var u=l==null?void 0:l.getNodes().find(function(Xe){var Se;return Xe.id==((Se=Y.config)===null||Se===void 0?void 0:Se.id)});console.log("\u9009\u4E2D\u7684\u8282\u70B9"),console.log(u),u&&(u.addTools({name:"boundary",args:{attrs:{stroke:"red",strokeWidth:1.5,rx:5,ry:5}}}),P=u),D[u==null?void 0:u.id]?D[u==null?void 0:u.id]+=1:D[u==null?void 0:u.id]=1,u==null||u.addTools(Ve(ue,Y,ue,D[u==null?void 0:u.id]))}),P&&(l==null||l.centerCell(P)),ye({}),Le({})},children:[(0,n.jsx)("p",{children:(g=s.itemLogs[0].config)===null||g===void 0?void 0:g.name}),(0,n.jsxs)("p",{children:["\u5F00\u59CB\uFF1A",s.itemLogs[0].beginTime]}),(0,n.jsxs)("p",{children:["\u7ED3\u675F\uFF1A",s.itemLogs[s.itemLogs.length-1].endTime]}),((f=d.logicIns)===null||f===void 0?void 0:f.version)==s.version?(0,n.jsx)("p",{}):(0,n.jsx)("p",{children:(0,n.jsxs)(he.Z,{children:[(0,n.jsx)(L.Z.Paragraph,{style:{color:"red"},children:"\u7248\u672C\u53F7:"}),(0,n.jsxs)(L.Z.Paragraph,{copyable:{tooltips:["\u70B9\u51FB\u590D\u5236","\u590D\u5236\u6210\u529F!"],text:s.version},children:[s.version,(0,n.jsx)(L.Z.Link,{style:{margin:"5px"},href:"#/assets/logic/i/".concat(s.logicId,"/view/").concat(s.version),target:"_blank",children:(0,n.jsx)(z.Z,{})})]})]})}),(0,n.jsx)("p",{children:s.message}),(0,n.jsx)(G.ZP,{type:"primary",size:"small",icon:(0,n.jsx)(de.Z,{}),onClick:function(){Ue(!0)},children:"AI\u5206\u6790"})]})}),color:s.success?"green":"red"})})),ze(_)},[d.debugLogs,d.logicIns,l,r]),(0,a.useEffect)(function(){if(b){try{var i=(0,T.K)(),_=i.Shapes;(0,Ie.m)(_)}catch(g){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(g)}if(je.current!=null){var s=new ee.kJ({container:je.current,embedding:{enabled:!0,validate:function(f){return f.child.setData({hoverNode:f.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new ee.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(f){var E=f.targetMagnet;return!!E}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}},background:{color:"#F2F7FA"},grid:!0});s.use(new fe.H({enabled:!0,sharp:!0})).use(new _e.A({enabled:!0})).use(new B.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new me.T({enabled:!0})).use(new ne.N),s.on("edge:dblclick",function(){}),s.on("edge:mouseenter",function(){}),s.on("edge:mouseleave",function(){}),s.on("node:moved",function(){}),s.on("node:mouseenter",function(){}),s.on("node:mouseleave",function(){}),s.on("node:added",function(){}),s.on("node:dblclick",function(g){var f=g.node}),s.on("blank:dblclick",function(g){var f=g.x,E=g.y}),s.fromJSON(b.visualConfig),(0,te.V)(s),W(s)}}},[b]);var Ye=function(){},Qe=[{key:"debug-node-input",label:"\u8282\u70B9\u5165\u51FA\u53C2",children:(0,n.jsxs)("div",{children:[(o==null||(Z=o.configInstance)===null||Z===void 0?void 0:Z.type)=="sub-logic"?(0,n.jsxs)("div",{children:[(0,n.jsxs)(L.Z.Text,{style:{margin:"15px"},copyable:{tooltips:["","\u590D\u5236\u6210\u529F!"],text:o==null||(Q=o.configInstance)===null||Q===void 0?void 0:Q.objectId},children:["\u5B50\u903B\u8F91\u65E5\u5FD7:",(0,n.jsx)("a",{target:"_blank",href:"#/debug/logic-log/i/".concat(o==null||(j=o.configInstance)===null||j===void 0?void 0:j.objectId),children:o==null||(X=o.configInstance)===null||X===void 0?void 0:X.objectId})]}),(0,n.jsx)(oe.Z,{})]}):"",(0,n.jsx)(V.Z,{formId:"debug-node-input",values:{success:o==null?void 0:o.success,msg:o==null?void 0:o.msg,returnData:o==null?void 0:o.returnData,body:o==null||(S=o.configInstance)===null||S===void 0?void 0:S.body,bizId:o==null||(O=o.configInstance)===null||O===void 0?void 0:O.bizId,logicId:o==null||(R=o.configInstance)===null||R===void 0?void 0:R.url},onSubmit:function(){}}),(0,n.jsx)(L.Z.Text,{style:{margin:"15px"},copyable:{tooltips:["\u590D\u5236\u8282\u70B9\u7F16\u53F7","\u590D\u5236\u6210\u529F!"],text:ae==null?void 0:ae.id},children:"\u8282\u70B9\u7F16\u53F7"}),(0,n.jsx)("div",{})]})},{key:"config",label:"\u8282\u70B9\u914D\u7F6E",children:(0,n.jsx)("div",{children:(0,n.jsx)(se.Z,{onSubmit:function(){},editNode:ae})})},{key:"configIns",label:"\u8282\u70B9\u5B9E\u4F8B",children:(0,n.jsx)("div",{children:(0,n.jsx)(V.Z,{formId:(o==null||(F=o.config)===null||F===void 0?void 0:F.type)||"",values:o==null?void 0:o.configInstance,onSubmit:function(){}})})},{key:"debug-context",label:"\u6267\u884C\u4E0A\u4E0B\u6587",children:(0,n.jsx)(V.Z,{formId:"debug-context",values:{varsJson:r==null?void 0:r.varsJson,paramsJson:r==null?void 0:r.paramsJson,varsJsonEnd:r==null?void 0:r.varsJsonEnd,startNodeId:r==null||(U=r.itemLogs[0].config)===null||U===void 0?void 0:U.id,startNodeName:r==null||(x=r.itemLogs[0].config)===null||x===void 0?void 0:x.name,logicId:($=d.logicIns)===null||$===void 0?void 0:$.logicId,bizId:(h=d.logicIns)===null||h===void 0?void 0:h.bizId},onSubmit:function(){}})}];return(0,n.jsxs)(m.Z,{style:{margin:0,height:"100vh"},children:[(0,n.jsxs)(m.Z.Sider,{theme:"light",collapsedWidth:0,width:260,style:{overflow:"auto",height:"100vh",position:"fixed",left:0,top:0,bottom:0,borderRight:"0.5px solid"},children:[(0,n.jsx)(oe.Z,{children:"\u6267\u884C\u8BB0\u5F55"}),(0,n.jsx)(be.Z,{style:{height:"100%"},items:Je})]}),(0,n.jsxs)(m.Z,{style:{margin:0,marginLeft:260,padding:0},children:[(0,n.jsxs)(m.Z.Header,{style:{backgroundColor:"white",padding:0},children:[(p=d.btns)===null||p===void 0?void 0:p.map(function(i){return i}),(0,n.jsx)(G.ZP,{type:"text",icon:c?(0,n.jsx)(ce.Z,{}):(0,n.jsx)(ge.Z,{}),onClick:function(){y(!c)},style:{float:"right",right:"16px",fontSize:"16px",width:64,height:64}})]}),(0,n.jsxs)(m.Z.Content,{className:"app-content",children:[(0,n.jsx)(Ee.Z,{size:"small",style:{backgroundColor:"white",padding:5,margin:0},items:[ve.Z,A.Z].map(function(i,_){var s=String(_+1);return _==0?{key:s,label:"\u903B\u8F91\u56FE",children:(0,n.jsx)(xe.Z,{ref:je}),icon:(0,n.jsx)(i,{})}:{key:s,label:"\u6267\u884C\u8282\u70B9",children:(0,n.jsx)(ie.B0,{pageId:"itemLogs-table",data:{items:r==null?void 0:r.itemLogs},onBroadcast:function(f,E){var P=E.item.config.id,D=E.item,Y=l==null?void 0:l.getNodes().find(function(ue){return ue.id==P});Y&&(Le(Y),y(!1),ye(D))}}),icon:(0,n.jsx)(i,{})}})}),(0,n.jsx)(pe.Z,{show:He,logicLog:r,onClose:function(){return Ue(!1)}})]})]}),(0,n.jsxs)(m.Z.Sider,{theme:"light",collapsed:c,collapsedWidth:0,style:{overflow:"scroll"},width:500,children:[(0,n.jsx)(Ee.Z,{items:Qe,defaultActiveKey:"inout"}),(0,n.jsx)(G.ZP,{type:"text",onClick:function(){y(!c)},style:{position:"absolute",top:0,right:0,fontSize:"16px",width:64,height:64},children:"x"})]})]})},Ce=le}}]);
