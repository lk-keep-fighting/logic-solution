"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[1021],{55104:function(ve,$,e){var Y=e(54306),g=e.n(Y),D=e(70517),W=e(90010),I=e.n(W),k=e(23620),L=e(52943),n=e(87363),K=e.n(n),m=e(94744),N=e(84191),A=e(47533),J=e(33358),c=e(49500),h=e(16123),i=e(99273),r=e(33130),C=function(d){var X=(0,n.useContext)(A.r),p=X.logic,ee=(0,n.useState)(),ae=g()(ee,2),se=ae[0],_=ae[1];function U(R,V,b){R==="formSubmited"?(console.log("\u5185\u90E8\u8868\u5355\u63D0\u4EA4\u4E86",b),d.onSubmit(b)):console.log("\u5185\u90E8\u8868\u5355\u89E6\u53D1\u4E86Broadcast",b)}(0,n.useEffect)(function(){if(d.config&&d.config.body){var R,V=d.config.body[0];(R=V.body)===null||R===void 0||R.forEach(function(b){console.log("deal editor autotip"),le(b)})}},[d.config]),(0,n.useEffect)(function(){var R=se==null?void 0:se.getComponentByName("page1.form1");console.log("update values",d.values),R==null||R.props.store.clear(),R==null||R.props.store.setValues(d.values)},[d.values]);var te=(0,n.useState)(),O=g()(te,2),M=O[0],Z=O[1];function le(R){R.type=="editor"&&R.language=="javascript"?R.editorDidMount=function(V,b){if(Z(b),p){var ue,ne,fe,q;console.log("editor autotip by logic");var re=m.y.getJsonByParams((ue=p.variables)!==null&&ue!==void 0?ue:[]),xe=(0,N.k)("_var",re),ye=m.y.getJsonByParams((ne=p.params)!==null&&ne!==void 0?ne:[]),_e=(0,N.k)("_par",ye),pe=m.y.getJsonByParams((fe=p.returns)!==null&&fe!==void 0?fe:[]),De=(0,N.k)("_ret",pe),Te=m.y.getJsonByParams((q=p.envs)!==null&&q!==void 0?q:[]),je=(0,N.k)("_env",Te);b==null||b.languages.typescript.javascriptDefaults.addExtraLib(xe,"var.ts"),b==null||b.languages.typescript.javascriptDefaults.addExtraLib(_e,"input.ts"),b==null||b.languages.typescript.javascriptDefaults.addExtraLib(De,"return.ts"),b==null||b.languages.typescript.javascriptDefaults.addExtraLib(je,"env.ts"),b==null||b.languages.typescript.javascriptDefaults.addExtraLib("let _lastRet:{}","lastRet.ts")}return function(){var Se,Ce;console.log("effect dispose"),V==null||V.dispose(),V==null||(Se=V.current)===null||Se===void 0||Se.dispose(),b==null||(Ce=b.current)===null||Ce===void 0||Ce.dispose()}}:R.body&&R.body.forEach(function(V){le(V)})}return(0,n.useEffect)(function(){if(p){var R,V,b,ue;console.log("monaco editor autotip by logic");var ne=m.y.getJsonByParams((R=p.variables)!==null&&R!==void 0?R:[]),fe=(0,N.k)("_var",ne),q=m.y.getJsonByParams((V=p.params)!==null&&V!==void 0?V:[]),re=(0,N.k)("_par",q),xe=m.y.getJsonByParams((b=p.returns)!==null&&b!==void 0?b:[]),ye=(0,N.k)("_ret",xe),_e=m.y.getJsonByParams((ue=p.envs)!==null&&ue!==void 0?ue:[]),pe=(0,N.k)("_env",_e);M==null||M.languages.typescript.javascriptDefaults.addExtraLib(fe,"var.ts"),M==null||M.languages.typescript.javascriptDefaults.addExtraLib(re,"input.ts"),M==null||M.languages.typescript.javascriptDefaults.addExtraLib(ye,"return.ts"),M==null||M.languages.typescript.javascriptDefaults.addExtraLib(pe,"env.ts"),M==null||M.languages.typescript.javascriptDefaults.addExtraLib("let _lastRet:{}","lastRet.ts")}},[p,p==null?void 0:p.params,p==null?void 0:p.variables,p==null?void 0:p.returns,p==null?void 0:p.envs]),(0,r.jsxs)("div",{children:[(0,r.jsx)(L.qR,{theme:"cxd",position:"top-right",locale:"zh-CN"},"toast"),(0,r.jsx)(L.wx,{theme:"cxd",locale:"zh-CN"},"alert"),(0,k.sYA)(d==null?void 0:d.config,{onBroadcast:U,scopeRef:function(V){return _(V)}},{fetcher:function(V){var b=V.url,ue=V.method,ne=V.data,fe=V.responseType,q=V.config,re=V.headers;return q=q||{},q.withCredentials=!0,fe&&(q.responseType=fe),q.cancelExecutor&&(q.cancelToken=new D.Z.CancelToken(q.cancelExecutor)),q.headers=re||{},q.headers.Authorization||(q.headers.Authorization="Bearer "+i.F.getTokenFormLocal()),ue!=="post"&&ue!=="put"&&ue!=="patch"?(ne&&(q.params=ne),D.Z[ue](b,q)):(ne&&ne instanceof FormData?(q.headers=q.headers||{},q.headers["Content-Type"]="multipart/form-data"):ne&&typeof ne!="string"&&!(ne instanceof Blob)&&!(ne instanceof ArrayBuffer)&&(ne=JSON.stringify(ne),q.headers=q.headers||{},q.headers["Content-Type"]="application/json"),D.Z[ue](b,ne,q))},isCancel:function(V){return D.Z.isCancel(V)},copy:function(V){I()(V),L.Am.success("\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u7C98\u8D34\u677F")},theme:"cxd",jumpTo:function(V,b){debugger;b.blank==!0?window.open(window.location.origin+window.location.pathname+"#"+V,"_blank"):window.location.hash=V}})]})};$.Z=K().memo(C)},62835:function(ve,$,e){var Y=e(57213),g=e.n(Y),D=e(54306),W=e.n(D),I=e(87363),k=e.n(I),L=e(70256),n=e(55104),K=e(83603),m=e(98306),N=e(31120),A=e(33130),J=function(h){var i=(0,I.useState)({type:"page"}),r=W()(i,2),C=r[0],Q=r[1],d=(0,I.useState)(null),X=W()(d,2),p=X[0],ee=X[1];return(0,I.useEffect)(function(){(0,L.CD)(h.formId).then(function(ae){Q(ae)})},[h.formId]),(0,A.jsxs)("div",{children:[(0,A.jsx)(n.Z,g()(g()({},h),{},{config:C})),(0,A.jsx)(K.Z,{offsetBottom:2,target:function(){return p},style:{position:"absolute",right:16},children:(0,A.jsx)(m.rU,{to:"/set/design/form/".concat(h.formId),target:"_blank",children:(0,A.jsx)(N.Z,{})})})]})};$.Z=J},11331:function(ve,$,e){var Y=e(54306),g=e.n(Y),D=e(70517),W=e(90010),I=e.n(W),k=e(23620),L=e(52943),n=e(87363),K=e.n(n),m=e(70256),N=e(33358),A=e(49500),J=e(16123),c=e(99273),h=e(33130);D.Z.interceptors.response.use(function(r){return console.log("axios response"),console.log(r),r&&r.data?(console.log("--\u8BF7\u6C42\u672A\u62A5\u9519\uFF0C\u9002\u914Dstatus=0"),r.data.error||(r.data.error={code:0}),r.data.code==500&&(r.data.error={code:500,message:r.data.msg}),r.data.data&&r.data.data.records&&(r.data.data.items=r.data.data.records),r):(console.log("--\u8FD4\u56DE\u6570\u636E\u4E3A\u7A7A\uFF0C\u5224\u65AD\u4E3A\u5F02\u5E38"),console.log(r.data),Promise.reject(new Error(r.data.message)))},function(r){if(console.log("\u6355\u6349axios error"),console.log(r),r.response&&r.response.data){var C,Q=r.response;return console.log("--data\u6709\u8FD4\u56DE\u503C\uFF0C\u5224\u5B9A\u4E3A\u4E1A\u52A1\u5F02\u5E38\uFF0C\u7EE7\u7EED\u8FD4\u56DEresponse,\u9002\u914Dstatus=500\uFF01"),((C=r.response.data.error)===null||C===void 0?void 0:C.code)==0&&(r.response.data.error.code=500),console.log(Q),Q}return Promise.reject(r)});var i=function(C){var Q=(0,n.useState)({type:"page"}),d=g()(Q,2),X=d[0],p=d[1],ee="cxd",ae="zh-CN";return(0,n.useEffect)(function(){C.pageId&&(0,m.UD)(C.pageId).then(function(se){p(se)})},[C.pageId]),(0,h.jsxs)("div",{children:[(0,h.jsx)(L.qR,{theme:ee,position:"top-right",locale:ae},"toast"),(0,h.jsx)(L.wx,{theme:ee,locale:ae},"alert"),(0,k.sYA)(X,{data:C.data},{fetcher:function(_){var U=_.url,te=_.method,O=_.data,M=_.responseType,Z=_.config,le=_.headers;return Z=Z||{},Z.withCredentials=!0,M&&(Z.responseType=M),Z.cancelExecutor&&(Z.cancelToken=new D.Z.CancelToken(Z.cancelExecutor)),Z.headers=le||{},Z.headers.Authorization||(Z.headers.Authorization="Bearer "+c.F.getTokenFormLocal()),te!=="post"&&te!=="put"&&te!=="patch"?(O&&(Z.params=O),D.Z[te](U,Z)):(O&&O instanceof FormData?(Z.headers=Z.headers||{},Z.headers["Content-Type"]="multipart/form-data"):O&&typeof O!="string"&&!(O instanceof Blob)&&!(O instanceof ArrayBuffer)&&(O=JSON.stringify(O),Z.headers=Z.headers||{},Z.headers["Content-Type"]="application/json"),D.Z[te](U,O,Z))},isCancel:function(_){return D.Z.isCancel(_)},copy:function(_){I()(_),L.Am.success("\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u7C98\u8D34\u677F")},theme:ee,jumpTo:function(_,U){debugger;U.blank==!0?window.open(window.location.origin+window.location.pathname+"#"+_,"_blank"):window.location.hash=_}})]})};$.Z=i},72107:function(ve,$,e){e.d($,{Ld:function(){return Y},Iz:function(){return m},Du:function(){return N},dO:function(){return J},z1:function(){return C},X0:function(){return K},_w:function(){return Q}});var Y=function(d){return d.TypeAnnotation="TypeAnnotation",d.Structure="Structure",d.StructureProperty="StructureProperty",d.TypeParam="TypeParam",d.Variable="Variable",d.Logic="Logic",d.LogicItem="LogicItem",d}({}),g=function(d){return d.start="start",d.end="end",d.switch="switch",d["switch-case"]="switch-case",d["switch-def"]="switch-def",d["mqtt-pub"]="mqtt-pub",d["mqtt-sub"]="mqtt-sub",d["mqtt-unsub"]="mqtt-unsub",d["mqtt-client"]="mqtt-client",d["mqtt-server"]="mqtt-server",d["mqtt-broker"]="mqtt-broker",d.http="http",d.logic="logic",d.js="js",d.wait="wait",d}({}),D=e(63466),W=e.n(D),I=e(21140),k=e.n(I),L=e(52510),n=e.n(L),K=W()(function d(X){k()(this,d),n()(this,"concept",void 0),n()(this,"name",void 0),n()(this,"label",void 0),n()(this,"description",void 0),n()(this,"typeAnnotation",void 0),n()(this,"required",!1),n()(this,"defaultValue",void 0),this.concept=Y.StructureProperty,this.name=X}),m=W()(function d(X){k()(this,d),n()(this,"concept",Y.Logic),n()(this,"schemeVersion",void 0),n()(this,"version",void 0),n()(this,"id",void 0),n()(this,"name",void 0),n()(this,"label",void 0),n()(this,"description",void 0),n()(this,"triggerType",void 0),n()(this,"cron",void 0),n()(this,"typeParams",void 0),n()(this,"params",void 0),n()(this,"returns",void 0),n()(this,"variables",void 0),n()(this,"envs",void 0),n()(this,"items",[]),n()(this,"visualConfig",void 0),this.id=X,this.schemeVersion="0.1"}),N=W()(function d(X,p){var ee=this;k()(this,d),n()(this,"concept","LogicItem"),n()(this,"id",void 0),n()(this,"name",void 0),n()(this,"type",void 0),n()(this,"label",void 0),n()(this,"description",void 0),n()(this,"params",void 0),n()(this,"returns",void 0),n()(this,"envs",void 0),n()(this,"afterReturnAdaptor",void 0),n()(this,"returnAccept",void 0),n()(this,"nextId",void 0),n()(this,"endId",void 0),n()(this,"condition",void 0),n()(this,"script",void 0),n()(this,"timeout",void 0),n()(this,"branches",void 0),n()(this,"url",void 0),n()(this,"method",void 0),n()(this,"headers",void 0),n()(this,"queryParams",void 0),n()(this,"body",void 0),n()(this,"setEnv",function(ae){ee.envs=ae}),this.type=p,this.id=X}),A=null,J=W()(function d(X){k()(this,d),n()(this,"concept","Param"),n()(this,"name",void 0),n()(this,"description",void 0),n()(this,"typeAnnotation",void 0),n()(this,"required",void 0),n()(this,"defaultValue",void 0),this.name=X}),c=e(58853),h=e.n(c),i=e(38888),r=e.n(i),C=function(d){h()(p,d);var X=r()(p);function p(ee){var ae;return k()(this,p),ae=X.call(this,ee),ae.concept="Return",ae}return W()(p)}(J),Q=function(d){h()(p,d);var X=r()(p);function p(ee){var ae;return k()(this,p),ae=X.call(this,ee),ae.concept="Variable",ae}return W()(p)}(J)},94744:function(ve,$,e){e.d($,{y:function(){return N}});var Y=e(37635),g=e.n(Y),D=e(21140),W=e.n(D),I=e(63466),k=e.n(I),L=e(72107),n=e(52510),K=e.n(n),m=k()(function A(J){W()(this,A),K()(this,"concept","EnvParam"),K()(this,"name",void 0),K()(this,"description",void 0),K()(this,"typeAnnotation",void 0),K()(this,"required",!1),K()(this,"defaultValue",void 0),this.name=J}),N=function(){function A(){W()(this,A)}return k()(A,null,[{key:"valueToTypeAnnotaion",value:function(c){var h=this,i={concept:L.Ld.TypeAnnotation,typeKind:"primitive",typeName:"string",defaultValue:c};if(Array.isArray(c))i.typeName="array";else{var r=g()(c);switch(r){case"boolean":i.typeKind="primitive",i.typeName="boolean";break;case"number":i.typeKind="primitive",i.typeName="number";break;case"string":i.typeKind="primitive",i.typeName="string";break;case"object":c==null?i.typeName="null":c instanceof Date?(i.typeKind="primitive",i.typeName="date"):c instanceof RegExp?(i.typeKind="primitive",i.typeName="regexp"):c instanceof Function?(i.typeKind="primitive",i.typeName="function"):(i.typeKind="anonymousStructure",i.typeName="object",i.properties=[],Object.keys(c).map(function(C){var Q,d=c[C],X=h.valueToTypeAnnotaion(d),p=new L.X0(C);p.typeAnnotation=X,p.defaultValue=d,(Q=i.properties)===null||Q===void 0||Q.push(p)}));break;default:i.typeKind="unknown",i.typeName=r;break}}return i}},{key:"typeAnnotaionToValue",value:function(c){var h,i,r=this,C;switch(c.typeName){case"array":C=(h=c.defaultValue)!==null&&h!==void 0?h:[];break;case"boolean":C=c.defaultValue?c.defaultValue=="true":!1;break;case"number":C=parseFloat(c.defaultValue);break;case"null":C=null;break;case"date":C=new Date(c.defaultValue);break;case"regexp":C=new RegExp(c.defaultValue);break;case"object":C={},(i=c.properties)===null||i===void 0||i.forEach(function(Q){C[Q.name]=r.typeAnnotaionToValue(Q.typeAnnotation)});break;case"string":case"function":default:C=c.defaultValue;break}return C}},{key:"getParamArrayByJson",value:function(c){var h=[];return c&&Object.keys(c).forEach(function(i){var r=new L.dO(i);r.typeAnnotation=A.valueToTypeAnnotaion(c[i]),r.defaultValue=c[i],h.push(r)}),h}},{key:"getReturnArrayByJson",value:function(c){var h=[];return c&&Object.keys(c).forEach(function(i){var r=new L.z1(i);r.typeAnnotation=A.valueToTypeAnnotaion(c[i]),r.defaultValue=c[i],h.push(r)}),h}},{key:"getVariableArrayByJson",value:function(c){var h=[];return c&&Object.keys(c).forEach(function(i){var r=new L._w(i);r.typeAnnotation=A.valueToTypeAnnotaion(c[i]),r.defaultValue=c[i],h.push(r)}),h}},{key:"getEnvsArrayByJson",value:function(c){var h=[];return c&&Object.keys(c).forEach(function(i){var r=new m(i);r.typeAnnotation=A.valueToTypeAnnotaion(c[i]),r.defaultValue=c[i],h.push(r)}),h}},{key:"getJsonByParams",value:function(c){var h=this,i={};return c==null||c.forEach(function(r){i[r.name]=r.typeAnnotation?h.typeAnnotaionToValue(r.typeAnnotation):r.defaultValue}),i}}]),A}()},84191:function(ve,$,e){e.d($,{k:function(){return W}});var Y=e(37635),g=e.n(Y),D=function I(k){var L="{";return Object.keys(k).forEach(function(n){var K=k[n];L+="".concat(n,":"),Array.isArray(K)?L+="[],":g()(K)=="object"?L+=I(K)+",":typeof K=="string"?L+="'".concat(K,"',"):L+="".concat(K,",")}),L+="}",L},W=function(k,L){var n="";L&&(Object.keys(L).forEach(function(m){var N=L[m];n+="".concat(m,":"),Array.isArray(N)?n+="[],":g()(N)=="object"?n+=D(N)+",":typeof N=="string"?n+="'".concat(N,"',"):n+="".concat(N,",")}),n=n.substring(0,n.length-1));var K="const ".concat(k,"={").concat(n,"}");return K}},47533:function(ve,$,e){e.d($,{r:function(){return Be},Z:function(){return rt}});var Y=e(57213),g=e.n(Y),D=e(93525),W=e.n(D),I=e(21140),k=e.n(I),L=e(63466),n=e.n(L),K=e(68608),m=e.n(K),N=e(58853),A=e.n(N),J=e(38888),c=e.n(J),h=e(52510),i=e.n(h),r=e(22465),C=e(14990),Q=e(72237),d=e(11150),X=e(93853),p=e(28110),ee=e(5671),ae=e(9722),se=e(17696),_=e(19227),U=e(75476),te=e(1167),O=e(22046),M=e(22150),Z=e(11250),le=e(43702),R=e(58856),V=e(40767),b=e(75904),ue=e(29830),ne=e(46464),fe=e(32246),q=e(47097),re=e(87363),xe=e.n(re),ye=e(72107),_e=null;function pe(y,o,u,P){var t,F,x=y.data.config,S=x.type,E=u.flatMap(function(s){return s.source.cell===y.id?o[s.target.cell]:[]}),w=y.attrs,j=new ye.Du((t=y.id)!==null&&t!==void 0?t:"",S);if(j=g()(g()({},x),{},{id:y.id,name:w==null||(F=w.text)===null||F===void 0?void 0:F.text}),!(P.findIndex(function(s){return s.id===j.id})>-1)&&(P.push(j),E.length!==0))switch(S){default:if(E.length>1||j.type==="switch"){var f;console.log((f=y.data)===null||f===void 0?void 0:f.config),console.log(E),j.branches=[],E.forEach(function(s){var a,z,T,G;console.log((a=s.data)===null||a===void 0?void 0:a.config),(z=j.branches)===null||z===void 0||z.push({when:(T=s.data)===null||T===void 0||(G=T.config)===null||G===void 0?void 0:G.case,nextId:s.id}),pe(o[s.id],o,u,P)})}else j.nextId=E[0].id,pe(o[E[0].id],o,u,P);break}}function De(y,o,u,P){var t,F,x=y.data.config,S=x.type,E=u.flatMap(function(s){return s.source.cell===y.id?o[s.target.cell]:[]}),w=y.attrs,j=new LogicItem((t=y.id)!==null&&t!==void 0?t:"",S);if(j=_objectSpread(_objectSpread({},x),{},{id:y.id,name:w==null||(F=w.text)===null||F===void 0?void 0:F.text}),!(P.findIndex(function(s){return s.id===j.id})>-1)&&(P.push(j),E.length!==0))switch(S){default:if(E.length>1||j.type==="switch"){var f;console.log((f=y.data)===null||f===void 0?void 0:f.config),console.log(E),j.branches=[],E.forEach(function(s){var a,z,T,G;console.log((a=s.data)===null||a===void 0?void 0:a.config),(z=j.branches)===null||z===void 0||z.push({when:(T=s.data)===null||T===void 0||(G=T.config)===null||G===void 0?void 0:G.case,nextId:s.id}),pe(o[s.id],o,u,P)})}else j.nextId=E[0].id,pe(o[E[0].id],o,u,P);break}}function Te(y,o){var u=new ye.Iz(y),P=[],t=[],F={},x=void 0;if(o.forEach(function(S){var E=S.id||"";if(S.shape==="edge")P.push(S);else{var w=S.attrs;F[E]=S,t.push(S),S.data.config.type==="start"&&(x=S)}}),!x){le.ZP.error("\u672A\u53D1\u73B0\u5F00\u59CB\u8282\u70B9\uFF0C\u8BF7\u914D\u7F6E\uFF01");return}return pe(x,F,P,u.items),console.log("logic.items"),console.log(u.items),u}function je(y,o){var u=new Logic(y),P=[],t=[],F={},x=void 0;if(o.forEach(function(S){var E=S.id||"";if(S.shape==="edge")P.push(S);else{var w=S.attrs;F[E]=S,t.push(S),x==null&&(x=S)}}),!x){message.error("\u672A\u53D1\u73B0\u5F00\u59CB\u8282\u70B9\uFF0C\u8BF7\u914D\u7F6E\uFF01");return}return De(x,F,P,u.items),console.log("logic.items"),console.log(u.items),u}function Se(y){var o=[];return y.items.forEach(function(u){var P={id:u.id,shape:u.type,size:{width:80,height:40},data:{config:u},attrs:{text:{text:u.name}}};if(o.push(P),u.branches&&u.branches.length>0)u.branches.forEach(function(F){var x={shape:"edge",source:{cell:u.id},target:{cell:F.nextId},labels:[{position:.5,attrs:{label:{text:F.when}}}]};o.push(x)});else if(u.nextId){var t={shape:"edge",source:{cell:u.id},target:{cell:u.nextId}};o.push(t)}}),o}var Ce=e(54306),Pe=e.n(Ce),Re=e(55104),Fe=e(70256),v=e(33130),we=function(y){var o=(0,re.useState)({type:"form"}),u=Pe()(o,2),P=u[0],t=u[1],F=(0,re.useState)({}),x=Pe()(F,2),S=x[0],E=x[1],w=function(s){var a,z,T;(a=y.editNode)===null||a===void 0||a.setAttrByPath("text/text",s.name);var G=(z=y.editNode)===null||z===void 0?void 0:z.data.config;y.editNode&&(console.log("update graph data",s),y.editNode.setData({config:g()(g()({},G),s)},{overwrite:!0})),console.log("submit---props.editNode.data.config"),console.log((T=y.editNode)===null||T===void 0?void 0:T.data.config),y==null||y.onSubmit()},j=function(s){if(s&&s.data){var a,z=s.data.config||{},T=s.attrs;return z.name=T==null||(a=T.text)===null||a===void 0?void 0:a.text,z}else return{name:""}};return(0,re.useEffect)(function(){if(y.editNode&&y.editNode.data){var f=y.editNode.data.config||{};(0,Fe.CD)(y.editNode.data.configSchema||f.type).then(function(s){console.log("nodeConfigSchema"),console.log(s),t(s)})}},[y.editNode]),(0,re.useEffect)(function(){var f,s,a=((f=y.editNode)===null||f===void 0?void 0:f.data.config)||{},z=g()({},a),T=(s=y.editNode)===null||s===void 0?void 0:s.attrs;T&&T.text&&T.text.text&&(z.name=T.text.text),E(z)},[P]),(0,v.jsx)(Re.Z,{config:P,values:g()({},S),onSubmit:w})};function Ue(y){return(0,v.jsxs)("div",{style:{margin:0,height:"95vh",overflowY:"scroll"},children:[(0,v.jsx)(we,{logic:y.logic,editNode:y.editNode,onSubmit:y.onSubmit}),y!=null&&y.isCollapsed?"":(0,v.jsx)(b.ZP,{type:"text",style:{position:"absolute",top:10,right:15,fontSize:20,textAlign:"center"},onClick:function(){y==null||y.onClose()},children:"x"})]})}var We=Ue,Ke=e(10486),Le=e(14232),Ze=e(37555),Ne=e(62835),me=e(94744),ze=function(o){var u,P=(0,re.useState)({}),t=Pe()(P,2),F=t[0],x=t[1];(0,re.useEffect)(function(){var E=o.values,w=E.params,j=E.variables,f=E.envs,s=E.returns;x({params:JSON.stringify(me.y.getJsonByParams(w)),variables:JSON.stringify(me.y.getJsonByParams(j)),returns:JSON.stringify(me.y.getJsonByParams(s)),envs:JSON.stringify(me.y.getJsonByParams(f))})},[o.values]);var S=(0,re.useCallback)(function(E){try{return JSON.parse(E),!0}catch(w){return!1}},[]);return(0,v.jsxs)("span",{children:[o.children,(0,v.jsx)(ne.Z,{open:(u=o.open)!==null&&u!==void 0?u:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return o==null?void 0:o.setOpen(!1)},children:(0,v.jsx)(Ne.Z,{formId:"logic-setting",values:F,onSubmit:function(w){console.log("\u63D0\u4EA4\u53C2\u6570"),console.log(w);var j=!1;Object.keys(w).forEach(function(f){var s=w[f];if(!S(s)){var a=f==="params"?"\u5165\u53C2":f==="variables"?"\u5C40\u90E8\u53D8\u91CF":f==="returns"?"\u8FD4\u56DE\u53C2\u6570":"\u73AF\u5883\u53D8\u91CF";return le.ZP.error("".concat(a,"json\u683C\u5F0F\u9519\u8BEF")),j=!0,!1}}),j||(o!=null&&o.onSubmit&&o.onSubmit(w),o==null||o.setOpen(!1))}})})]})},Je=ze,Ee=e(36808),Ve=function(o,u){var P,t,F,x,S=u.getData(),E=u.getPosition(),w=o.getNodes(),j;if(["ExtSharp","polygon"].indexOf(u.shape)>-1)switch(S.config.type){case"switch":var f=200,s=o.addNode({shape:"switch",position:E,width:f,height:50,ports:Ee.Tt,data:u.data,attrs:{body:{stroke:"#8f8f8f",strokeWidth:1,fill:"#fff",rx:6,ry:6}}});o.removeNode(u);var a=o.addNode({shape:"switch-case",position:{y:E.y+100,x:E.x-f/2},width:120,height:50,ports:Ee.Tt,data:{config:{type:"switch-case"}}}),z=o.addNode({shape:"switch-default",position:{y:E.y+100,x:E.x+f},width:120,height:50,ports:Ee.Tt,data:{config:{type:"switch-default"}}}),T=o.addEdge({source:s,sourcePort:(P=s.ports.items.find(function(ce){return ce.group=="bottom"}))===null||P===void 0?void 0:P.id,target:a,targetPort:(t=a.ports.items.find(function(ce){return ce.group=="top"}))===null||t===void 0?void 0:t.id,zIndex:0}),G=o.addEdge({source:s,sourcePort:(F=s.ports.items.find(function(ce){return ce.group=="bottom"}))===null||F===void 0?void 0:F.id,target:z,targetPort:(x=z.ports.items.find(function(ce){return ce.group=="top"}))===null||x===void 0?void 0:x.id,zIndex:0});j=s;break;case"switch-case":var l=o.createNode({shape:"switch-case",position:u.position(),width:120,height:50,ports:Ee.Tt,data:u.data});o.removeNode(u),o.addNode(l),j=l;break;case"string":var B=o.createNode({shape:"string",position:u.position(),width:100,height:50,ports:Ee.Tt,data:u.data});o.removeNode(u),o.addNode(B),j=B;break;case"num":var H=o.createNode({shape:"num",position:u.position(),width:100,height:50,ports:Ee.Tt,data:u.data});o.removeNode(u),o.addNode(H),j=H;break;case"assignment":var oe=o.createNode({shape:"assignment",position:u.position(),width:220,height:50,ports:Ee.Tt,data:u.data});o.removeNode(u),o.addNode(oe),j=oe;break;default:break}if(console.log("node:added"),j&&w.length==1){var ie,de,he,ge,be;o.addEdge({source:w[0],sourcePort:(ie=w[0].ports.items.find(function(ce){return ce.group=="bottom"}))===null||ie===void 0?void 0:ie.id,target:j,targetPort:(de=j)===null||de===void 0||(he=de.ports)===null||he===void 0||(ge=he.items)===null||ge===void 0||(be=ge.find(function(ce){return ce.group=="top"}))===null||be===void 0?void 0:be.id,zIndex:0})}},ke=e(59998),Ge=e(85772),Ye=function(o){var u,P=(0,Ge.cI)();(0,re.useEffect)(function(){var x=o.values.params;P.setValues({params:JSON.stringify(me.y.getJsonByParams(x))})},[o.values]);var t=(0,re.useCallback)(function(x){try{return JSON.parse(x),!0}catch(S){return!1}},[]);function F(x){var S=!1;Object.keys(x).forEach(function(E){var w=x[E];if(["params","headers"].indexOf(E)>-1&&!t(w)){var j=E==="params"?"\u5165\u53C2":"\u8BF7\u6C42\u5934";return le.ZP.error("".concat(j,"json\u683C\u5F0F\u9519\u8BEF")),S=!0,!1}}),S||(o!=null&&o.onSubmit&&o.onSubmit(x,x.debugType),o==null||o.setOpen(!1))}return(0,v.jsxs)("span",{children:[o.children,(0,v.jsx)(ne.Z,{open:(u=o.open)!==null&&u!==void 0?u:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return o==null?void 0:o.setOpen(!1)},children:(0,v.jsx)(Ne.Z,{formId:"logic-debug-input",onSubmit:F})})]})},Xe=Ye,He=e(61719),Ae=e(97944),Qe=e(47503),$e=e(49425),lt=null,qe=function(o){var u=(0,Ae.Ik)(),P=(0,re.useState)(!1),t=Pe()(P,2),F=t[0],x=t[1];return(0,v.jsx)("div",{style:{width:"100%"},children:F?(0,v.jsx)(Qe.Z,{title:"js\u7F16\u8F91\u5668",centered:!0,width:1200,bodyStyle:{height:"80vh"},open:F,footer:null,onCancel:function(){return x(!1)},children:(0,v.jsx)(Ae.ML,g()(g()({theme:"vs-dark",defaultValue:o.value,defaultLanguage:o.language,options:{minimap:{enabled:!1}}},o),{},{height:"100%"}))}):(0,v.jsxs)("div",{children:[(0,v.jsx)(Ae.ML,g()({className:"editorByLoader",theme:"vs-dark",defaultValue:o.value,defaultLanguage:o.language,onMount:function(E){var w;(w=E.getAction("editor.action.formatDocument"))===null||w===void 0||w.run(),E.setValue(E.getValue())},options:{minimap:{enabled:!1}},height:500},o)),(0,v.jsx)(b.ZP,{size:"small",type:"text",icon:(0,v.jsx)($e.Z,{}),style:{position:"absolute",top:0,right:0,margin:"10px",color:"whitesmoke"},onClick:function(){return x(!0)}})]})})},et=xe().memo(qe),tt=e(5726),nt=e.n(tt),at=e(23620),ot=e(71731),Me=e(11331),it=[{key:"saveToPng",label:"\u5BFC\u51FA\u56FE\u7247"},{key:"saveToClipboard",label:"\u590D\u5236\u5230\u526A\u8D34\u677F"}],Be=xe().createContext({logic:new ye.Iz("")}),Ie=function(o,u){for(var P=0,t=o.length;P<t;P+=1)o[P].style.visibility=u?"visible":"hidden"},rt=function(y){A()(u,y);var o=c()(u);function u(P){var t;k()(this,u),t=o.call(this,P),i()(m()(t),"container",void 0),i()(m()(t),"stencilContainer",void 0),i()(m()(t),"state",{editingNode:void 0,openEdgeEditor:!1,embeddingEnable:!1,editingEdge:void 0,leftToolCollapsed:!1,rightToolCollapsed:!0,openFlowSetting:!1,openRunLogic:!1,editorCtx:{logic:new ye.Iz("1")},logs:[],panel:{nodes:[],groups:[]}}),i()(m()(t),"handleEdgeSubmit",function(f){var s;(s=t.state.editingEdge)===null||s===void 0||s.setLabels(f)}),i()(m()(t),"initGraph",function(f){var s,a=new ee.kJ({container:f,embedding:{enabled:t.state.embeddingEnable,validate:function(B){return B.child.setData({hoverNode:B.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new ee.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(B){var H=B.targetMagnet;return!!H}},background:{color:"#F2F7FA"},grid:!0});a.use(new te.H({enabled:!0,sharp:!0})).use(new se.A({enabled:!0})).use(new U.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new M.T({enabled:!0})).use(new _.N).use(new ae.T).use(new Z.D).use(new ot.w({resizing:{enabled:!0,minWidth:50,maxWidth:200,minHeight:50,maxHeight:50,orthogonal:!1,restrict:!1,preserveAspectRatio:!1}})),a.on("edge:dblclick",function(l){var B=l.cell}),a.on("edge:mouseenter",function(l){var B=l.cell;B.addTools([{name:"button-remove",args:{distance:-40}}])}),a.on("edge:mouseleave",function(l){var B=l.cell;B.removeTools()}),a.on("node:moved",function(l){var B,H=l.e,oe=l.x,ie=l.y,de=l.node,he=l.view,ge=(B=de.data)===null||B===void 0?void 0:B.hoverNode;if(t.state.embeddingEnable&&ge){var be,ce,st=a.createEdge({source:ge,sourcePort:(be=ge.ports.items.find(function(Oe){return Oe.group=="bottom"}))===null||be===void 0?void 0:be.id,target:de,targetPort:(ce=de.ports.items.find(function(Oe){return Oe.group=="top"}))===null||ce===void 0?void 0:ce.id,zIndex:0});de.data.hoverNode=void 0,a.addEdge(st),t.autoLayout(a)}}),a.on("node:mouseenter",function(l){var B,H,oe,ie=l.cell;((B=ie.data)===null||B===void 0||(H=B.config)===null||H===void 0?void 0:H.type)!="start"&&ie.addTools([{name:"button-remove",args:{x:"100%",y:0,offset:{x:-10,y:10}}}]);var de=(oe=t.container)===null||oe===void 0?void 0:oe.querySelectorAll(".x6-port-body");Ie(de,!0)}),a.on("node:mouseleave",function(l){var B,H=l.cell;H.removeTools();var oe=(B=t.container)===null||B===void 0?void 0:B.querySelectorAll(".x6-port-body");Ie(oe,!1)}),a.on("node:click",function(l){var B=l.e,H=l.x,oe=l.y,ie=l.node,de=l.view;ie.removeTools(),t.setState({editingNode:ie})}),a.on("node:added",function(l){var B=l.node,H=l.index,oe=l.options;Ve(a,B)}),a.on("node:dblclick",function(l){var B=l.e,H=l.x,oe=l.y,ie=l.node,de=l.view;t.setState({rightToolCollapsed:!1,editingNode:ie})}),a.bindKey(["meta+c","ctrl+c"],function(){var l=a.getSelectedCells();return l.length&&a.copy(l),!1}),a.bindKey(["meta+x","ctrl+x"],function(){var l=a.getSelectedCells();return l.length&&a.cut(l),!1}),a.bindKey(["meta+v","ctrl+v"],function(){if(!a.isClipboardEmpty()){var l=a.paste({offset:32});a.cleanSelection(),a.select(l)}return!1}),a.bindKey(["meta+z","ctrl+z"],function(){return a.canUndo()&&a.undo(),!1}),a.bindKey(["meta+shift+z","ctrl+shift+z"],function(){return a.canRedo()&&a.redo(),!1}),a.bindKey("backspace",function(){var l=a.getSelectedCells();l.length&&(l.find(function(B){var H;return B.data?["start"].indexOf((H=B.data.config)===null||H===void 0?void 0:H.type)>-1:!1})?le.ZP.error("\u7981\u6B62\u5220\u9664\u5F00\u59CB\u8282\u70B9\uFF01"):a.removeCells(l))}),a.on("blank:dblclick",function(l){var B=l.e,H=l.x,oe=l.y;console.log("blank:dbclick",H,oe),t.autoLayout(a)}),a.bindKey(["ctrl+1","meta+1"],function(){var l=a.zoom();l<1.5&&a.zoom(.1)}),a.bindKey(["ctrl+2","meta+2"],function(){var l=a.zoom();l>.5&&a.zoom(-.1)}),t.state.graph=a;var z=t.state.panel.groups,T=new O.t({title:"\u5C55\u5F00/\u6536\u8D77",target:a,search:function(B,H){var oe=B.getAttrByPath("text/text");return(oe==null?void 0:oe.indexOf(H))!==-1},notFoundText:"\u672A\u627E\u5230",collapsable:!0,stencilGraphWidth:250,groups:z,layoutOptions:{rowHeight:100}}),G={};return t.state.panel.nodes.forEach(function(l){var B=a.createNode(l);z.forEach(function(H){l.groups.includes(H.name)&&(G[H.name]?G[H.name].push(B):G[H.name]=[B])})}),Object.keys(G).forEach(function(l){T.load(W()(G[l]),l)}),(s=t.stencilContainer)===null||s===void 0||s.appendChild(T.container),t.props.config?(t.state.editorCtx.logic=t.props.config,a.fromJSON(t.state.editorCtx.logic.visualConfig)):((0,Le.X)(a),t.autoLayout(a)),a}),i()(m()(t),"autoLayout",function(f){(0,ke.V)(f)}),i()(m()(t),"refContainer",function(f){t.container=f}),i()(m()(t),"refStencil",function(f){t.stencilContainer=f}),i()(m()(t),"handleSubmit",function(f){t.saveAndConvertGraphToDsl()}),i()(m()(t),"handleOnConfigChange",function(f){try{var s=JSON.parse(f);t.setState({stepFlow:s})}catch(a){console.log(a)}}),i()(m()(t),"onSaveMenuClick",function(f){var s;switch(f.key){case"saveToBrowser":break;case"loadFromBrowser":var a=localStorage.getItem("logic-json");if(a){var z,T=JSON.parse(a);t.state.editorCtx.logic=T,(z=t.state.graph)===null||z===void 0||z.fromJSON(T.visualConfig),t.saveAndConvertGraphToDsl()}else le.ZP.info("\u6D4F\u89C8\u5668\u65E0\u7F13\u5B58\u6570\u636E");break;case"saveToClipboard":try{navigator.clipboard.writeText(JSON.stringify(t.state.editorCtx.logic))}catch(G){console.error(G)}break;case"saveToPng":(s=t.state.graph)===null||s===void 0||s.exportPNG(new Date().toLocaleDateString(),{backgroundColor:"#F2F7FA",padding:10,quality:1});break}}),i()(m()(t),"updateLogicAndEditorCtx",function(f){var s=g()(g()({},t.state.editorCtx.logic),f);return s.version=nt()(Date.now()).format("YYYYMMDDHHmmss"),t.setState({editorCtx:g()(g()({},t.state.editorCtx),{},{logic:s})}),s}),i()(m()(t),"saveAndConvertGraphToDsl",function(){var f,s=(f=t.state.graph)===null||f===void 0?void 0:f.toJSON(),a=t.convertGraphToDsl(s);if(a){var z,T=t.updateLogicAndEditorCtx({items:a.items,visualConfig:a.visualConfig});t.props.config&&(T.id=(z=t.props.config)===null||z===void 0?void 0:z.id),t.props.onSave&&t.props.onSave(T);var G=JSON.stringify(T);localStorage.setItem("logic-"+T.name,G)}}),i()(m()(t),"saveFlowSettingAndConvertGraphToDsl",function(f){var s,a,z,T,G,l=me.y.getParamArrayByJson(JSON.parse((s=f.params)!==null&&s!==void 0?s:"{}")),B=me.y.getReturnArrayByJson(JSON.parse((a=f.returns)!==null&&a!==void 0?a:"{}")),H=me.y.getVariableArrayByJson(JSON.parse((z=f.variables)!==null&&z!==void 0?z:"{}")),oe=me.y.getEnvsArrayByJson(JSON.parse((T=f.envs)!==null&&T!==void 0?T:"{}")),ie=t.updateLogicAndEditorCtx({params:l,returns:B,variables:H,envs:oe});t.props.config&&(ie.id=(G=t.props.config)===null||G===void 0?void 0:G.id),t.props.onSave&&t.props.onSave(ie);var de=JSON.stringify(ie);localStorage.setItem("logic-json-"+ie.id,de)}),i()(m()(t),"convertGraphToDsl",function(f){var s,a=Te((s=t.props.config)===null||s===void 0?void 0:s.id,f.cells);return a&&(a.visualConfig=f),a}),i()(m()(t),"setFlowSetting",function(f){t.setState({openFlowSetting:f})});try{var F,x,S=(0,Ke.K)(P.customNodes,P.customGroups,P.customSharps),E=S.Nodes,w=S.Shapes,j=S.Groups;(0,Le.m)(w),t.state.leftToolCollapsed=!(!((F=P.showLeft)!==null&&F!==void 0)||F),t.state.rightToolCollapsed=!((x=P.showRight)!==null&&x!==void 0&&x),t.state.panel.nodes=E,t.state.panel.groups=j}catch(f){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(f)}return t}return n()(u,[{key:"componentDidUpdate",value:function(t,F,x){if(this.props.config&&this.state.editorCtx.logic.id!=this.props.config.id){var S,E,w,j;this.state.editorCtx.logic=this.props.config,(S=this.state.editorCtx)!==null&&S!==void 0&&(E=S.logic)!==null&&E!==void 0&&E.visualConfig&&((w=this.state.graph)===null||w===void 0||w.fromJSON((j=this.state.editorCtx.logic)===null||j===void 0?void 0:j.visualConfig)),this.setState({editingNode:void 0})}}},{key:"componentDidMount",value:function(){var t;this.initGraph(this.container),this.updateLogicAndEditorCtx((t=this.state.editorCtx)===null||t===void 0?void 0:t.logic)}},{key:"render",value:function(){var t=this,F,x=this.state,S=x.editingNode,E=x.leftToolCollapsed,w=x.rightToolCollapsed,j=x.editorCtx,f=x.embeddingEnable,s=x.graph,a=x.openFlowSetting,z=x.openRunLogic,T=j.logic;return console.log("editorCtx",j),(0,v.jsx)(Be.Provider,{value:j,children:(0,v.jsxs)(R.Z,{style:{height:"100vh",width:"100%",margin:0},children:[(0,v.jsx)(R.Z.Sider,{theme:"light",collapsed:E,collapsedWidth:0,width:250,ref:this.refStencil}),(0,v.jsxs)(R.Z,{style:{height:"100%"},children:[(0,v.jsxs)(R.Z.Header,{style:{padding:0,backgroundColor:"white"},children:[(0,v.jsxs)(V.Z,{direction:"horizontal",children:[(0,v.jsx)(b.ZP,{type:"text",icon:E?(0,v.jsx)(r.Z,{}):(0,v.jsx)(C.Z,{}),onClick:function(){t.setState({leftToolCollapsed:!E})},style:{fontSize:"16px",width:64,height:64}}),(0,v.jsx)(ue.Z.Button,{style:{float:"inline-start"},menu:{items:it,onClick:this.onSaveMenuClick},buttonsRender:function(l){return[(0,v.jsx)(b.ZP,{type:"primary",icon:(0,v.jsx)(Q.Z,{}),onClick:t.saveAndConvertGraphToDsl,children:"\u4FDD\u5B58"}),(0,v.jsx)(b.ZP,{type:"primary",icon:(0,v.jsx)(d.Z,{})})]},children:"\u4FDD\u5B58"}),(0,v.jsx)(Je,{open:a,values:g()({},T),setOpen:this.setFlowSetting,onSubmit:this.saveFlowSettingAndConvertGraphToDsl,children:(0,v.jsx)(b.ZP,{onClick:function(){return t.setFlowSetting(!0)},icon:(0,v.jsx)(X.Z,{}),children:"\u914D\u7F6E\u53C2\u6570"})}),(F=this.props.btns)===null||F===void 0?void 0:F.map(function(G){return(0,v.jsx)(b.ZP,g()({},G))}),(0,v.jsx)(Xe,{open:z,setOpen:function(l){return t.setState({openRunLogic:l})},values:{params:T==null?void 0:T.params},onSubmit:function(l,B){if(t.setState({openRunLogic:!1}),T){var H=l.params,oe=l.bizId,ie=l.headers,de=l.bizStartCode;(0,He.L7)(T.id,JSON.parse(H),oe,de,B,JSON.parse(ie)).then(function(he){he.data.code==0?ne.Z.success({title:"\u6267\u884C\u6210\u529F",width:"1000px",closable:!0,content:(0,v.jsx)("div",{children:(0,v.jsx)(Me.Z,{pageId:"debug-info",data:he.data})})}):ne.Z.error({title:(0,v.jsx)("span",{children:he.data.msg}),width:"1200px",closable:!0,content:(0,v.jsx)("div",{children:(0,v.jsx)(Me.Z,{pageId:"debug-info",data:he.data})})})}).catch(function(he){var ge=he.response.data;ne.Z.error({title:(0,v.jsx)("span",{children:ge.msg}),width:"1200px",closable:!0,content:(0,v.jsx)("div",{children:(0,v.jsx)(fe.Z,{children:(0,v.jsx)(q.Z,{children:(0,v.jsxs)(fe.Z,{children:[(0,v.jsxs)(q.Z,{span:12,children:[(0,v.jsx)("h4",{children:"\u9519\u8BEF\u8BE6\u7EC6:"}),(0,v.jsx)(at.gcu,{src:ge.error,collapsed:1})]}),(0,v.jsxs)(q.Z,{span:12,children:[(0,v.jsx)("h4",{children:"\u8FD4\u56DE\u6570\u636E:"}),(0,v.jsx)(et,{language:"json",value:JSON.stringify(ge.data),width:500})]})]})})})})})}),t.state.logs.push({data:new Date().toLocaleTimeString()})}},children:(0,v.jsx)(b.ZP,{type:"default",onClick:function(){t.setState({openRunLogic:!0})},icon:(0,v.jsx)(p.Z,{}),children:"\u8C03\u8BD5"})}),(0,v.jsxs)("span",{children:["\u5F53\u524D\u7248\u672C:",T.version]})]}),(0,v.jsx)(V.Z,{style:{float:"right",right:"16px"}})]}),(0,v.jsx)(R.Z.Content,{className:"app-content",children:(0,v.jsx)(Ze.Z,{ref:this.refContainer})})]}),(0,v.jsx)(R.Z.Sider,{theme:"light",collapsed:w,collapsedWidth:0,width:600,children:(0,v.jsx)(We,{logic:T,onClear:function(){return t.setState({logs:[]})},editNode:S,onSubmit:this.handleSubmit,logs:this.state.logs,onClose:function(){t.setState({rightToolCollapsed:!0})},isCollapsed:w})})]})})}}]),u}(xe().Component)},37555:function(ve,$,e){e.d($,{Z:function(){return W}});var Y=e(87363),g=e(33130),D=(0,Y.forwardRef)(function(I,k){return(0,g.jsx)("div",{className:"drag-graph",ref:k})}),W=D},59998:function(ve,$,e){e.d($,{V:function(){return g}});var Y=e(59490),g=function(W){var I=new Y.Vq({type:"dagre",begin:[400,100],rankdir:"TB",ranksep:20,nodeSize:50,controlPoints:!0}),k=W.getNodes(),L=W.getEdges(),n=I.layout({nodes:k,edges:L}),K=n.nodes,m=K===void 0?[]:K;k.forEach(function(N){var A=m.find(function(J){return J.id===N.id});A.x-=N.size().width/2,A.y-=N.size().height/2,N.position(A.x,A.y)})}},36808:function(ve,$,e){e.d($,{Hi:function(){return D},Tt:function(){return Y}});var Y={groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]},g={groups:{right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1}},items:[{group:"right"}]},D={groups:{bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1}},items:[{group:"bottom"}]}},14232:function(ve,$,e){e.d($,{X:function(){return i},m:function(){return h}});var Y=e(5671),g=e(11904),D=e(54882),W={customNode:"customNode___AyPI8",input:"input___Q5PmS",switchNode:"switchNode___fqB9a"},I=e(33130),k=function(C){return(0,I.jsx)("div",{className:W.customNode,children:(0,I.jsx)(D.Z,{className:"input",value:C==null?void 0:C.data,width:80})})},L=e(42761),n=function(C){return(0,I.jsx)("div",{className:styles.customNode,children:(0,I.jsx)(L.Z,{className:"input",value:C==null?void 0:C.data,width:80})})},K=e(57213),m=e.n(K),N=function(C){var Q,d,X,p=C.node,ee=(Q=p.data.config)===null||Q===void 0?void 0:Q.name,ae=ee||"case";return(0,I.jsxs)("div",{className:W.customNode,children:[(0,I.jsx)("span",{children:"case"}),(0,I.jsx)(D.Z,{addonAfter:ee,className:"input",value:p==null||(d=p.data)===null||d===void 0||(X=d.config)===null||X===void 0?void 0:X.case,width:150,onChange:function(_){var U=p.data;p.setData(m()(m()({},U),{},{config:m()(m()({},U.config),{},{case:_.target.value})}))}})]})},A=function(C){var Q,d=C.node;return(0,I.jsx)("div",{className:W.customNode,children:(0,I.jsx)(D.Z,{addonBefore:"switch",className:"input",value:(Q=d.data)===null||Q===void 0?void 0:Q.config.condition,onChange:function(p){var ee=d.data;d.setData(m()(m()({},ee),{},{config:m()(m()({},ee.config),{},{condition:p.target.value})}))},width:100})})},J=e(36808),c=function(C){return(0,I.jsx)("div",{className:W.customNode,children:(0,I.jsx)("div",{style:{textAlign:"center",fontSize:"15px"},children:"default"})})};function h(r){r.forEach(function(C){console.log("\u6CE8\u518C\u65B0\u8282\u70B9:"+C.name),Y.kJ.registerNode(C.name,C.config,!0)}),(0,g.z2)({shape:"string",component:k}),(0,g.z2)({shape:"num",component:n}),(0,g.z2)({shape:"switch",component:A}),(0,g.z2)({shape:"switch-case",component:N}),(0,g.z2)({shape:"switch-default",component:c})}function i(r){var C=r.createNode({shape:"circle",label:"start",width:50,height:50,attrs:{body:{}},ports:J.Hi,data:{config:{type:"start"}}});r.addNode(C)}},10486:function(ve,$,e){e.d($,{K:function(){return L}});var Y=e(57213),g=e.n(Y),D=e(36808),W=50,I=50,k=[{name:"ExtSharp",config:{width:100,height:I,attrs:{body:{rx:6,ry:6,stroke:"#5F95FF",strokeWidth:1,fill:"rgba(95,149,255,0.05)",refWidth:1,refHeight:1},image:{refX:2,refY:0},text:{refX:4,refY:20,fontSize:12,"text-anchor":"start"}},markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}}];function L(n,K,m){var N=50,A=50,J={body:{}},c=[{shape:"circle",width:N,height:A,attrs:{body:g()(g()({},J.body),{},{fill:"white"}),text:{text:"\u4EA4\u4E92\u70B9"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:D.Tt,data:{config:{type:"wait-for-continue"}},groups:["global"]},{shape:"circle",label:"end",width:N,height:A,attrs:{body:g()(g()({},J.body),{},{fill:"#d9d9d9"}),text:{text:"end"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:D.Tt,data:{config:{type:"end"}},groups:["global"]},{shape:"ExtSharp",attrs:{text:{text:"http\u8BF7\u6C42",fontSize:14},image:{"xlink:href":"/icons/http.svg",width:20,x:2,y:2}},data:{config:{type:"http",method:"POST"}},ports:D.Tt,groups:["biz"]},{shape:"ExtSharp",ports:D.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/code.svg"},text:{text:"js\u811A\u672C",fontSize:14}},data:{config:{type:"js"}},groups:["biz"]},{shape:"ExtSharp",ports:D.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/code.svg"},text:{text:"java\u65B9\u6CD5",fontSize:14}},data:{config:{type:"java"}},groups:["biz"]},{shape:"ExtSharp",ports:D.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/CarbonSubflowLocal.svg"},text:{text:"\u590D\u7528\u903B\u8F91",fontSize:14}},data:{config:{type:"sub-logic"}},groups:["biz"]},{shape:"ExtSharp",width:50,height:A,label:"switch",attrs:{image:{"xlink:href":"/icons/switch.svg",width:45,x:1,y:2},text:{text:"switch",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"switch"}},ports:D.Tt,groups:["ctrl"]},{shape:"ExtSharp",width:N,height:A,attrs:{image:{"xlink:href":"/icons/text.svg",width:30,x:8,y:10},text:{text:"case",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"switch-case"}},ports:D.Tt,groups:["ctrl"]},{shape:"ExtSharp",width:N,height:A,attrs:{image:{"xlink:href":"/icons/delay.svg",width:30,x:8,y:10},text:{text:"\u7B49\u5F85",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"wait",timeout:"2000"}},ports:D.Tt,groups:["ctrl"]}];n&&n.length>0&&Array.prototype.push.apply(c,n);var h=[{name:"global",title:"\u5168\u5C40\u8282\u70B9",graphHeight:110},{name:"ctrl",title:"\u903B\u8F91\u63A7\u5236",graphHeight:220},{name:"biz",title:"\u4E1A\u52A1\u8C03\u7528",graphHeight:220}];K&&K.length>0&&Array.prototype.push.apply(h,K);var i=k;return m&&m.length>0&&Array.prototype.push.apply(i,m),{Shapes:i,Nodes:c,Groups:h}}},61719:function(ve,$,e){e.d($,{L7:function(){return c}});var Y=e(57213),g=e.n(Y),D=e(25359),W=e.n(D),I=e(49811),k=e.n(I),L=e(70517);function n(_,U){return axios.get(_,U)}function K(_,U,te){return axios.put(_,U,te)}function m(_,U){return axios.delete(_,U)}function N(_,U,te){return L.Z.post(_,U,te)}function A(_,U){return J.apply(this,arguments)}function J(){return J=_asyncToGenerator(_regeneratorRuntime().mark(function _(U,te){return _regeneratorRuntime().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.abrupt("return",post("/api/runtime/logic/v1/run-fn/".concat(U),te,{headers:{"Content-Type":"application/json"}}));case 1:case"end":return M.stop()}},_)})),J.apply(this,arguments)}function c(_,U,te,O,M,Z){return h.apply(this,arguments)}function h(){return h=k()(W()().mark(function _(U,te,O,M,Z,le){var R;return W()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:R="",b.t0=Z,b.next=b.t0==="biz"?4:6;break;case 4:return M?R="/api/runtime/logic/v1/biz/".concat(U,"/").concat(M,"/").concat(O,"?debug=true"):R="/api/runtime/logic/v1/run-biz/".concat(U,"/").concat(O,"?debug=true"),b.abrupt("break",8);case 6:return R="/api/runtime/logic/v1/run-api/".concat(U,"?debug=true"),b.abrupt("break",8);case 8:return b.abrupt("return",N(R,te,{headers:g()({"Content-Type":"application/json"},le)}));case 9:case"end":return b.stop()}},_)})),h.apply(this,arguments)}function i(_,U){return r.apply(this,arguments)}function r(){return r=_asyncToGenerator(_regeneratorRuntime().mark(function _(U,te){return _regeneratorRuntime().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.abrupt("return",axios.post("/api/form/logic_instance/query",{filters:[{dataIndex:"logicId",values:[U],type:"="},{dataIndex:"bizId",values:[te],type:"="}]}).then(function(Z){var le=Z.data.result.items[0];return le}));case 1:case"end":return M.stop()}},_)})),r.apply(this,arguments)}function C(_){return Q.apply(this,arguments)}function Q(){return Q=_asyncToGenerator(_regeneratorRuntime().mark(function _(U){return _regeneratorRuntime().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.abrupt("return",axios.get("/api/ide/logic-instance/".concat(U)).then(function(M){var Z=M.data.data;return Z}));case 1:case"end":return O.stop()}},_)})),Q.apply(this,arguments)}function d(_){return X.apply(this,arguments)}function X(){return X=_asyncToGenerator(_regeneratorRuntime().mark(function _(U){return _regeneratorRuntime().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.abrupt("return",axios.post("/api/form/logic/add",U).then(function(M){var Z=M.data.result;return Z}));case 1:case"end":return O.stop()}},_)})),X.apply(this,arguments)}function p(_){return ee.apply(this,arguments)}function ee(){return ee=_asyncToGenerator(_regeneratorRuntime().mark(function _(U){return _regeneratorRuntime().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.abrupt("return",axios.delete("/api/form/logic/delete/".concat(U)).then(function(M){return M.data.result}));case 1:case"end":return O.stop()}},_)})),ee.apply(this,arguments)}function ae(){return se.apply(this,arguments)}function se(){return se=_asyncToGenerator(_regeneratorRuntime().mark(function _(){var U,te,O=arguments;return _regeneratorRuntime().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return U=O.length>0&&O[0]!==void 0?O[0]:1,te=O.length>1&&O[1]!==void 0?O[1]:10,Z.abrupt("return",axios.post("/api/form/logic/query",{page:U,pageSize:te}).then(function(le){return le.data}));case 3:case"end":return Z.stop()}},_)})),se.apply(this,arguments)}},70256:function(ve,$,e){e.d($,{CD:function(){return n},UD:function(){return k},n4:function(){return m}});var Y=e(25359),g=e.n(Y),D=e(49811),W=e.n(D),I=e(70517);function k(A){return L.apply(this,arguments)}function L(){return L=W()(g()().mark(function A(J){return g()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,I.Z.get("/setting/pages/".concat(J,".json"));case 2:return h.abrupt("return",h.sent.data);case 3:case"end":return h.stop()}},A)})),L.apply(this,arguments)}function n(A){return K.apply(this,arguments)}function K(){return K=W()(g()().mark(function A(J){return g()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,I.Z.get("/setting/forms/".concat(J,".json"));case 2:return h.abrupt("return",h.sent.data);case 3:case"end":return h.stop()}},A)})),K.apply(this,arguments)}function m(A,J){return N.apply(this,arguments)}function N(){return N=W()(g()().mark(function A(J,c){return g()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,I.Z.get("/setting/".concat(J,"s/").concat(c,".json"));case 2:return i.abrupt("return",i.sent.data);case 3:case"end":return i.stop()}},A)})),N.apply(this,arguments)}},99273:function(ve,$,e){e.d($,{F:function(){return Y}});var Y={getTokenFormLocal:function(){return localStorage.getItem("token")},setTokenToLocal:function(D){return localStorage.setItem("token",D)}}}}]);
