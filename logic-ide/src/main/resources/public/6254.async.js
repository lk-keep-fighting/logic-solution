"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[6254],{55104:function(ve,Q,e){var Y=e(54306),g=e.n(Y),S=e(70517),w=e(90010),I=e.n(w),J=e(23620),D=e(52943),o=e(87363),F=e.n(o),p=e(94744),A=e(84191),N=e(28576),R=e(33358),f=e(49500),c=e(16123),t=e(99273),n=e(33130),v=function(i){var C=(0,o.useContext)(N.r),d=C.logic,_=(0,o.useState)(),X=g()(_,2),V=X[0],m=X[1];function h(L,z,x){L==="formSubmited"&&(console.log("\u5185\u90E8\u8868\u5355\u63D0\u4EA4\u4E86",x),i.onSubmit(x))}(0,o.useEffect)(function(){var L=V==null?void 0:V.getComponentByName("page1.form1");console.log("update values",i.values),L==null||L.props.store.clear(),L==null||L.props.store.setValues(i.values)},[i.config,i.values]);var k=(0,o.useState)(),y=g()(k,2),E=y[0],P=y[1];function de(L){L.type=="editor"&&L.language=="javascript"?L.editorDidMount=function(z,x){if(P(x),d){var ue,ae,fe,$;console.log("editor autotip by logic");var re=p.y.getJsonByParams((ue=d.variables)!==null&&ue!==void 0?ue:[]),me=(0,A.k)("_var",re),Ce=p.y.getJsonByParams((ae=d.params)!==null&&ae!==void 0?ae:[]),Se=(0,A.k)("_par",Ce),_e=p.y.getJsonByParams((fe=d.returns)!==null&&fe!==void 0?fe:[]),be=(0,A.k)("_ret",_e),De=p.y.getJsonByParams(($=d.envs)!==null&&$!==void 0?$:[]),Te=(0,A.k)("_env",De);x==null||x.languages.typescript.javascriptDefaults.addExtraLib(me,"var.ts"),x==null||x.languages.typescript.javascriptDefaults.addExtraLib(Se,"input.ts"),x==null||x.languages.typescript.javascriptDefaults.addExtraLib(be,"return.ts"),x==null||x.languages.typescript.javascriptDefaults.addExtraLib(Te,"env.ts"),x==null||x.languages.typescript.javascriptDefaults.addExtraLib("let _lastRet:{}","lastRet.ts")}return function(){var l,Pe;console.log("effect dispose"),z==null||z.dispose(),z==null||(l=z.current)===null||l===void 0||l.dispose(),x==null||(Pe=x.current)===null||Pe===void 0||Pe.dispose()}}:L.body&&L.body.forEach(function(z){de(z)})}return(0,o.useEffect)(function(){if(i.config&&i.config.body){var L,z=i.config.body[0];(L=z.body)===null||L===void 0||L.forEach(function(x){console.log("deal editor autotip"),de(x)})}},[i.config]),(0,o.useEffect)(function(){if(d){var L,z,x,ue;console.log("monaco editor autotip by logic");var ae=p.y.getJsonByParams((L=d.variables)!==null&&L!==void 0?L:[]),fe=(0,A.k)("_var",ae),$=p.y.getJsonByParams((z=d.params)!==null&&z!==void 0?z:[]),re=(0,A.k)("_par",$),me=p.y.getJsonByParams((x=d.returns)!==null&&x!==void 0?x:[]),Ce=(0,A.k)("_ret",me),Se=p.y.getJsonByParams((ue=d.envs)!==null&&ue!==void 0?ue:[]),_e=(0,A.k)("_env",Se);E==null||E.languages.typescript.javascriptDefaults.addExtraLib(fe,"var.ts"),E==null||E.languages.typescript.javascriptDefaults.addExtraLib(re,"input.ts"),E==null||E.languages.typescript.javascriptDefaults.addExtraLib(Ce,"return.ts"),E==null||E.languages.typescript.javascriptDefaults.addExtraLib(_e,"env.ts"),E==null||E.languages.typescript.javascriptDefaults.addExtraLib("let _lastRet:{}","lastRet.ts")}},[d,d==null?void 0:d.params,d==null?void 0:d.variables,d==null?void 0:d.returns,d==null?void 0:d.envs]),(0,n.jsxs)("div",{children:[(0,n.jsx)(D.qR,{theme:"cxd",position:"top-right",locale:"zh-CN"},"toast"),(0,n.jsx)(D.wx,{theme:"cxd",locale:"zh-CN"},"alert"),(0,J.sYA)(i==null?void 0:i.config,{onBroadcast:h,data:i.values,scopeRef:function(z){return m(z)}},{fetcher:function(z){var x=z.url,ue=z.method,ae=z.data,fe=z.responseType,$=z.config,re=z.headers;return $=$||{},$.withCredentials=!0,fe&&($.responseType=fe),$.cancelExecutor&&($.cancelToken=new S.Z.CancelToken($.cancelExecutor)),$.headers=re||{},$.headers.Authorization||($.headers.Authorization="Bearer "+t.F.getTokenFormLocal()),ue!=="post"&&ue!=="put"&&ue!=="patch"?(ae&&($.params=ae),S.Z[ue](x,$)):(ae&&ae instanceof FormData?($.headers=$.headers||{},$.headers["Content-Type"]="multipart/form-data"):ae&&typeof ae!="string"&&!(ae instanceof Blob)&&!(ae instanceof ArrayBuffer)&&(ae=JSON.stringify(ae),$.headers=$.headers||{},$.headers["Content-Type"]="application/json"),S.Z[ue](x,ae,$))},isCancel:function(z){return S.Z.isCancel(z)},copy:function(z){I()(z),D.Am.success("\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u7C98\u8D34\u677F")},theme:"cxd",jumpTo:function(z,x){debugger;x.blank==!0?window.open(window.location.origin+window.location.pathname+"#"+z,"_blank"):window.location.hash=z}})]})};Q.Z=F().memo(v)},11331:function(ve,Q,e){var Y=e(54306),g=e.n(Y),S=e(70517),w=e(90010),I=e.n(w),J=e(23620),D=e(52943),o=e(87363),F=e.n(o),p=e(70256),A=e(33358),N=e(49500),R=e(16123),f=e(99273),c=e(33130);S.Z.interceptors.response.use(function(n){return console.log("axios response"),console.log(n),n&&n.data?(console.log("--\u8BF7\u6C42\u672A\u62A5\u9519\uFF0C\u9002\u914Dstatus=0"),n.data.error||(n.data.error={code:0}),n.data.status=0,n.data.data&&n.data.data.records&&(n.data.data.items=n.data.data.records),n):(console.log("--\u8FD4\u56DE\u6570\u636E\u4E3A\u7A7A\uFF0C\u5224\u65AD\u4E3A\u5F02\u5E38"),console.log(n.data),Promise.reject(new Error(n.data.message)))},function(n){if(console.log("\u6355\u6349axios error"),console.log(n),n.response&&n.response.data){var v,T=n.response;return console.log("--data\u6709\u8FD4\u56DE\u503C\uFF0C\u5224\u5B9A\u4E3A\u4E1A\u52A1\u5F02\u5E38\uFF0C\u7EE7\u7EED\u8FD4\u56DEresponse,\u9002\u914Dstatus=500\uFF01"),((v=n.response.data.error)===null||v===void 0?void 0:v.code)==0&&(n.response.data.error.code=500),console.log(T),T}return Promise.reject(n)});var t=function(v){var T=(0,o.useState)({type:"page"}),i=g()(T,2),C=i[0],d=i[1],_="cxd",X="zh-CN";return(0,o.useEffect)(function(){v.pageId&&(0,p.UD)(v.pageId).then(function(V){d(V)})},[v.pageId]),(0,c.jsxs)("div",{children:[(0,c.jsx)(D.qR,{theme:_,position:"top-right",locale:X},"toast"),(0,c.jsx)(D.wx,{theme:_,locale:X},"alert"),(0,J.sYA)(C,{data:v.data},{fetcher:function(m){var h=m.url,k=m.method,y=m.data,E=m.responseType,P=m.config,de=m.headers;return P=P||{},P.withCredentials=!0,E&&(P.responseType=E),P.cancelExecutor&&(P.cancelToken=new S.Z.CancelToken(P.cancelExecutor)),P.headers=de||{},P.headers.Authorization||(P.headers.Authorization="Bearer "+f.F.getTokenFormLocal()),k!=="post"&&k!=="put"&&k!=="patch"?(y&&(P.params=y),S.Z[k](h,P)):(y&&y instanceof FormData?(P.headers=P.headers||{},P.headers["Content-Type"]="multipart/form-data"):y&&typeof y!="string"&&!(y instanceof Blob)&&!(y instanceof ArrayBuffer)&&(y=JSON.stringify(y),P.headers=P.headers||{},P.headers["Content-Type"]="application/json"),S.Z[k](h,y,P))},isCancel:function(m){return S.Z.isCancel(m)},copy:function(m){I()(m),D.Am.success("\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u7C98\u8D34\u677F")},theme:_,jumpTo:function(m,h){debugger;h.blank==!0?window.open(window.location.origin+window.location.pathname+"#"+m,"_blank"):window.location.hash=m}})]})};Q.Z=t},72107:function(ve,Q,e){e.d(Q,{Ld:function(){return Y},Iz:function(){return p},Du:function(){return A},dO:function(){return R},z1:function(){return v},X0:function(){return F},_w:function(){return T}});var Y=function(i){return i.TypeAnnotation="TypeAnnotation",i.Structure="Structure",i.StructureProperty="StructureProperty",i.TypeParam="TypeParam",i.Variable="Variable",i.Logic="Logic",i.LogicItem="LogicItem",i}({}),g=function(i){return i.start="start",i.end="end",i.switch="switch",i["switch-case"]="switch-case",i["switch-def"]="switch-def",i["mqtt-pub"]="mqtt-pub",i["mqtt-sub"]="mqtt-sub",i["mqtt-unsub"]="mqtt-unsub",i["mqtt-client"]="mqtt-client",i["mqtt-server"]="mqtt-server",i["mqtt-broker"]="mqtt-broker",i.http="http",i.logic="logic",i.js="js",i.wait="wait",i}({}),S=e(63466),w=e.n(S),I=e(21140),J=e.n(I),D=e(52510),o=e.n(D),F=w()(function i(C){J()(this,i),o()(this,"concept",void 0),o()(this,"name",void 0),o()(this,"label",void 0),o()(this,"description",void 0),o()(this,"typeAnnotation",void 0),o()(this,"required",!1),o()(this,"defaultValue",void 0),this.concept=Y.StructureProperty,this.name=C}),p=w()(function i(C){J()(this,i),o()(this,"concept",Y.Logic),o()(this,"schemeVersion",void 0),o()(this,"version",void 0),o()(this,"id",void 0),o()(this,"name",void 0),o()(this,"label",void 0),o()(this,"description",void 0),o()(this,"triggerType",void 0),o()(this,"cron",void 0),o()(this,"typeParams",void 0),o()(this,"params",void 0),o()(this,"returns",void 0),o()(this,"variables",void 0),o()(this,"envs",void 0),o()(this,"items",[]),o()(this,"visualConfig",void 0),this.id=C,this.schemeVersion="0.1"}),A=w()(function i(C,d){var _=this;J()(this,i),o()(this,"concept","LogicItem"),o()(this,"id",void 0),o()(this,"name",void 0),o()(this,"type",void 0),o()(this,"label",void 0),o()(this,"description",void 0),o()(this,"params",void 0),o()(this,"returns",void 0),o()(this,"envs",void 0),o()(this,"afterReturnAdaptor",void 0),o()(this,"returnAccept",void 0),o()(this,"nextId",void 0),o()(this,"endId",void 0),o()(this,"condition",void 0),o()(this,"script",void 0),o()(this,"timeout",void 0),o()(this,"branches",void 0),o()(this,"url",void 0),o()(this,"method",void 0),o()(this,"headers",void 0),o()(this,"queryParams",void 0),o()(this,"body",void 0),o()(this,"setEnv",function(X){_.envs=X}),this.type=d,this.id=C}),N=null,R=w()(function i(C){J()(this,i),o()(this,"concept","Param"),o()(this,"name",void 0),o()(this,"description",void 0),o()(this,"typeAnnotation",void 0),o()(this,"required",void 0),o()(this,"defaultValue",void 0),this.name=C}),f=e(58853),c=e.n(f),t=e(38888),n=e.n(t),v=function(i){c()(d,i);var C=n()(d);function d(_){var X;return J()(this,d),X=C.call(this,_),X.concept="Return",X}return w()(d)}(R),T=function(i){c()(d,i);var C=n()(d);function d(_){var X;return J()(this,d),X=C.call(this,_),X.concept="Variable",X}return w()(d)}(R)},77357:function(ve,Q,e){e.d(Q,{nq:function(){return N},zI:function(){return R}});var Y=e(57213),g=e.n(Y),S=e(21140),w=e.n(S),I=e(63466),J=e.n(I),D=e(43702),o=e(72107),F=null;function p(c,t,n,v){var T,i,C=c.data.config,d=C.type,_=n.flatMap(function(h){return h.source.cell===c.id?t[h.target.cell]:[]}),X=c.attrs,V=new o.Du((T=c.id)!==null&&T!==void 0?T:"",d);if(V=g()(g()({},C),{},{id:c.id,name:X==null||(i=X.text)===null||i===void 0?void 0:i.text}),!(v.findIndex(function(h){return h.id===V.id})>-1)&&(v.push(V),_.length!==0))switch(d){default:if(_.length>1||V.type==="switch"){var m;console.log((m=c.data)===null||m===void 0?void 0:m.config),console.log(_),V.branches=[],_.forEach(function(h){var k,y,E,P;console.log((k=h.data)===null||k===void 0?void 0:k.config),(y=V.branches)===null||y===void 0||y.push({when:(E=h.data)===null||E===void 0||(P=E.config)===null||P===void 0?void 0:P.case,nextId:h.id}),p(t[h.id],t,n,v)})}else V.nextId=_[0].id,p(t[_[0].id],t,n,v);break}}function A(c,t,n,v){var T,i,C=c.data.config,d=C.type,_=n.flatMap(function(h){return h.source.cell===c.id?t[h.target.cell]:[]}),X=c.attrs,V=new o.Du((T=c.id)!==null&&T!==void 0?T:"",d);if(V=g()(g()({},C),{},{id:c.id,name:X==null||(i=X.text)===null||i===void 0?void 0:i.text}),!(v.findIndex(function(h){return h.id===V.id})>-1)&&(v.push(V),_.length!==0))switch(d){default:if(_.length>1||V.type==="switch"){var m;console.log((m=c.data)===null||m===void 0?void 0:m.config),console.log(_),V.branches=[],_.forEach(function(h){var k,y,E,P;console.log((k=h.data)===null||k===void 0?void 0:k.config),(y=V.branches)===null||y===void 0||y.push({when:(E=h.data)===null||E===void 0||(P=E.config)===null||P===void 0?void 0:P.case,nextId:h.id}),p(t[h.id],t,n,v)})}else V.nextId=_[0].id,p(t[_[0].id],t,n,v);break}}function N(c,t){var n=new o.Iz(c),v=[],T=[],i={},C=void 0;if(t.forEach(function(d){var _=d.id||"";if(d.shape==="edge")v.push(d);else{var X=d.attrs;i[_]=d,T.push(d),d.data.config.type==="start"&&(C=d)}}),!C){D.ZP.error("\u672A\u53D1\u73B0\u5F00\u59CB\u8282\u70B9\uFF0C\u8BF7\u914D\u7F6E\uFF01");return}return p(C,i,v,n.items),console.log("logic.items"),console.log(n.items),n}function R(c,t){var n=new o.Iz(c),v=[],T=[],i={},C=void 0;if(t.forEach(function(d){var _=d.id||"";if(d.shape==="edge")v.push(d);else{var X=d.attrs;i[_]=d,T.push(d),C==null&&(C=d)}}),!C){D.ZP.error("\u672A\u53D1\u73B0\u5F00\u59CB\u8282\u70B9\uFF0C\u8BF7\u914D\u7F6E\uFF01");return}return A(C,i,v,n.items),console.log("logic.items"),console.log(n.items),n}function f(c){var t=[];return c.items.forEach(function(n){var v={id:n.id,shape:n.type,size:{width:80,height:40},data:{config:n},attrs:{text:{text:n.name}}};if(t.push(v),n.branches&&n.branches.length>0)n.branches.forEach(function(i){var C={shape:"edge",source:{cell:n.id},target:{cell:i.nextId},labels:[{position:.5,attrs:{label:{text:i.when}}}]};t.push(C)});else if(n.nextId){var T={shape:"edge",source:{cell:n.id},target:{cell:n.nextId}};t.push(T)}}),t}},94744:function(ve,Q,e){e.d(Q,{y:function(){return A}});var Y=e(37635),g=e.n(Y),S=e(21140),w=e.n(S),I=e(63466),J=e.n(I),D=e(72107),o=e(52510),F=e.n(o),p=J()(function N(R){w()(this,N),F()(this,"concept","EnvParam"),F()(this,"name",void 0),F()(this,"description",void 0),F()(this,"typeAnnotation",void 0),F()(this,"required",!1),F()(this,"defaultValue",void 0),this.name=R}),A=function(){function N(){w()(this,N)}return J()(N,null,[{key:"valueToTypeAnnotaion",value:function(f){var c=this,t={concept:D.Ld.TypeAnnotation,typeKind:"primitive",typeName:"string",defaultValue:f};if(Array.isArray(f))t.typeName="array";else{var n=g()(f);switch(n){case"boolean":t.typeKind="primitive",t.typeName="boolean";break;case"number":t.typeKind="primitive",t.typeName="number";break;case"string":t.typeKind="primitive",t.typeName="string";break;case"object":f==null?t.typeName="null":f instanceof Date?(t.typeKind="primitive",t.typeName="date"):f instanceof RegExp?(t.typeKind="primitive",t.typeName="regexp"):f instanceof Function?(t.typeKind="primitive",t.typeName="function"):(t.typeKind="anonymousStructure",t.typeName="object",t.properties=[],Object.keys(f).map(function(v){var T,i=f[v],C=c.valueToTypeAnnotaion(i),d=new D.X0(v);d.typeAnnotation=C,d.defaultValue=i,(T=t.properties)===null||T===void 0||T.push(d)}));break;default:t.typeKind="unknown",t.typeName=n;break}}return t}},{key:"typeAnnotaionToValue",value:function(f){var c,t,n=this,v;switch(f.typeName){case"array":v=(c=f.defaultValue)!==null&&c!==void 0?c:[];break;case"boolean":v=f.defaultValue?f.defaultValue=="true":!1;break;case"number":v=parseFloat(f.defaultValue);break;case"null":v=null;break;case"date":v=new Date(f.defaultValue);break;case"regexp":v=new RegExp(f.defaultValue);break;case"object":v={},(t=f.properties)===null||t===void 0||t.forEach(function(T){v[T.name]=n.typeAnnotaionToValue(T.typeAnnotation)});break;case"string":case"function":default:v=f.defaultValue;break}return v}},{key:"getParamArrayByJson",value:function(f){var c=[];return f&&Object.keys(f).forEach(function(t){var n=new D.dO(t);n.typeAnnotation=N.valueToTypeAnnotaion(f[t]),n.defaultValue=f[t],c.push(n)}),c}},{key:"getReturnArrayByJson",value:function(f){var c=[];return f&&Object.keys(f).forEach(function(t){var n=new D.z1(t);n.typeAnnotation=N.valueToTypeAnnotaion(f[t]),n.defaultValue=f[t],c.push(n)}),c}},{key:"getVariableArrayByJson",value:function(f){var c=[];return f&&Object.keys(f).forEach(function(t){var n=new D._w(t);n.typeAnnotation=N.valueToTypeAnnotaion(f[t]),n.defaultValue=f[t],c.push(n)}),c}},{key:"getEnvsArrayByJson",value:function(f){var c=[];return f&&Object.keys(f).forEach(function(t){var n=new p(t);n.typeAnnotation=N.valueToTypeAnnotaion(f[t]),n.defaultValue=f[t],c.push(n)}),c}},{key:"getJsonByParams",value:function(f){var c=this,t={};return f==null||f.forEach(function(n){t[n.name]=n.typeAnnotation?c.typeAnnotaionToValue(n.typeAnnotation):n.defaultValue}),t}}]),N}()},84191:function(ve,Q,e){e.d(Q,{k:function(){return w}});var Y=e(37635),g=e.n(Y),S=function I(J){var D="{";return Object.keys(J).forEach(function(o){var F=J[o];D+="".concat(o,":"),Array.isArray(F)?D+="[],":g()(F)=="object"?D+=I(F)+",":typeof F=="string"?D+="'".concat(F,"',"):D+="".concat(F,",")}),D+="}",D},w=function(J,D){var o="";D&&(Object.keys(D).forEach(function(p){var A=D[p];o+="".concat(p,":"),Array.isArray(A)?o+="[],":g()(A)=="object"?o+=S(A)+",":typeof A=="string"?o+="'".concat(A,"',"):o+="".concat(A,",")}),o=o.substring(0,o.length-1));var F="const ".concat(J,"={").concat(o,"}");return F}},28576:function(ve,Q,e){e.d(Q,{r:function(){return Fe},Z:function(){return ct}});var Y=e(57213),g=e.n(Y),S=e(93525),w=e.n(S),I=e(21140),J=e.n(I),D=e(63466),o=e.n(D),F=e(68608),p=e.n(F),A=e(58853),N=e.n(A),R=e(38888),f=e.n(R),c=e(52510),t=e.n(c),n=e(22465),v=e(14990),T=e(72237),i=e(11150),C=e(93853),d=e(28110),_=e(5671),X=e(9722),V=e(17696),m=e(19227),h=e(75476),k=e(1167),y=e(22046),E=e(22150),P=e(11250),de=e(43702),L=e(58856),z=e(40767),x=e(75904),ue=e(29830),ae=e(46464),fe=e(32246),$=e(47097),re=e(87363),me=e.n(re),Ce=e(77357),Se=e(5981),_e=e(32125),be=e(97944),De=e(97563),Te=e(18725),l=e(33130);function Pe(O){var u=[{key:"sharps-panel",label:(0,l.jsx)(Se.Z,{style:{fontSize:"20px",marginTop:10}}),children:(0,l.jsx)("div",{ref:O.refStencil,style:{margin:0,height:"100vh",width:"100%"}})},{key:"logic",label:(0,l.jsx)(_e.Z,{style:{fontSize:"20px",marginTop:10}}),children:(0,l.jsxs)("div",{style:{margin:0,height:"100vh"},children:[(0,l.jsx)(De.Z,{title:"\u7528\u4E8E\u89E3\u6790\u6267\u884C\u7F16\u6392\u7684\u903B\u8F91\u3002",children:(0,l.jsx)("h3",{children:"Logic DSL"})}),(0,l.jsx)(be.ZP,{defaultLanguage:"json",options:{lineNumbers:"off",lineDecorationsWidth:0,minimap:{enabled:!1}},value:JSON.stringify(O.logic),onChange:O.onConfigChange})]})}];return(0,l.jsx)(Te.Z,{tabPosition:"left",style:{margin:0},items:u,tabBarStyle:{width:50,margin:0}})}var Re=Pe,Ue=e(54306),Ee=e.n(Ue),Ae=e(55104),Oe=e(70256),Ne=function(O){var u,M=(0,re.useState)({type:"form"}),q=Ee()(M,2),a=q[0],oe=q[1],U=(0,re.useState)({}),ne=Ee()(U,2),Z=ne[0],ee=ne[1],te=O.configSchemaProvider,b=function(W){var K,G,r;(K=O.editNode)===null||K===void 0||K.setAttrByPath("text/text",W.name);var j=(G=O.editNode)===null||G===void 0?void 0:G.data.config;O.editNode&&(console.log("update graph data",W),O.editNode.setData({config:g()(g()({},j),W)},{overwrite:!0})),console.log("submit---props.editNode.data.config"),console.log((r=O.editNode)===null||r===void 0?void 0:r.data.config),O==null||O.onSubmit()},B=function(W){if(W&&W.data){var K,G=W.data.config||{},r=W.attrs;return G.name=r==null||(K=r.text)===null||K===void 0?void 0:K.text,G}else return{name:""}};return(0,re.useEffect)(function(){if(O.editNode&&O.editNode.data){var s=O.editNode.data.config||{};(0,Oe.CD)(O.editNode.data.configSchema||s.type).then(function(W){console.log("nodeConfigSchema"),console.log(W),oe(W)})}},[O.editNode]),(0,re.useEffect)(function(){var s,W,K=((s=O.editNode)===null||s===void 0?void 0:s.data.config)||{},G=g()({},K),r=(W=O.editNode)===null||W===void 0?void 0:W.attrs;r&&r.text&&r.text.text&&(G.name=r.text.text),ee(G)},[a,(u=O.editNode)===null||u===void 0?void 0:u.data]),(0,l.jsx)(Ae.Z,{config:a,values:g()({},Z),onSubmit:b})};function Ze(O){var u=[{key:"1",label:"\u8282\u70B9\u914D\u7F6E",children:(0,l.jsx)("div",{style:{padding:5},children:(0,l.jsx)(Ne,{editNode:O.editNode,onSubmit:O.onSubmit})})}];return(0,l.jsxs)("div",{style:{margin:0,height:"95vh",overflowY:"scroll"},children:[(0,l.jsx)(Ne,{logic:O.logic,editNode:O.editNode,onSubmit:O.onSubmit}),O!=null&&O.isCollapsed?"":(0,l.jsx)(x.ZP,{type:"text",style:{position:"absolute",top:10,right:15,fontSize:20,textAlign:"center"},onClick:function(){O==null||O.onClose()},children:"x"})]})}var ze=Ze,We=e(10486),Le=e(14232),Ke=e(37555),Je=e(83603),Ve=e(98306),ke=e(31120),Ge=function(u){var M=(0,re.useState)({type:"page"}),q=Ee()(M,2),a=q[0],oe=q[1],U=(0,re.useState)(null),ne=Ee()(U,2),Z=ne[0],ee=ne[1];(0,re.useEffect)(function(){(0,Oe.CD)(u.formId).then(function(b){oe(b)})},[u.formId]);function te(b,B,s){console.log(b),console.log(s),b==="formSubmited"&&(console.log("\u5185\u90E8\u8868\u5355\u63D0\u4EA4\u4E86"),u.onSubmit(s))}return(0,l.jsxs)("div",{children:[(0,l.jsx)(Ae.Z,g()(g()({},u),{},{config:a})),(0,l.jsx)(Je.Z,{offsetBottom:2,target:function(){return Z},style:{position:"absolute",right:16},children:(0,l.jsx)(Ve.rU,{to:"/set/design/form/".concat(u.formId),target:"_blank",children:(0,l.jsx)(ke.Z,{})})})]})},Be=Ge,pe=e(94744),Ye=function(u){var M,q=(0,re.useState)({}),a=Ee()(q,2),oe=a[0],U=a[1];(0,re.useEffect)(function(){var Z=u.values,ee=Z.params,te=Z.variables,b=Z.envs,B=Z.returns;U({params:JSON.stringify(pe.y.getJsonByParams(ee)),variables:JSON.stringify(pe.y.getJsonByParams(te)),returns:JSON.stringify(pe.y.getJsonByParams(B)),envs:JSON.stringify(pe.y.getJsonByParams(b))})},[u.values]);var ne=(0,re.useCallback)(function(Z){try{return JSON.parse(Z),!0}catch(ee){return!1}},[]);return(0,l.jsxs)("span",{children:[u.children,(0,l.jsx)(ae.Z,{open:(M=u.open)!==null&&M!==void 0?M:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return u==null?void 0:u.setOpen(!1)},children:(0,l.jsx)(Be,{formId:"logic-setting",values:oe,onSubmit:function(ee){console.log("\u63D0\u4EA4\u53C2\u6570"),console.log(ee);var te=!1;Object.keys(ee).forEach(function(b){var B=ee[b];if(!ne(B)){var s=b==="params"?"\u5165\u53C2":b==="variables"?"\u5C40\u90E8\u53D8\u91CF":b==="returns"?"\u8FD4\u56DE\u53C2\u6570":"\u73AF\u5883\u53D8\u91CF";return de.ZP.error("".concat(s,"json\u683C\u5F0F\u9519\u8BEF")),te=!0,!1}}),te||(u!=null&&u.onSubmit&&u.onSubmit(ee),u==null||u.setOpen(!1))}})})]})},Xe=Ye,ye=e(36808),He=function(u,M){var q,a,oe,U,ne=M.getData(),Z=M.getPosition(),ee=u.getNodes(),te;if(["ExtSharp","polygon"].indexOf(M.shape)>-1)switch(ne.config.type){case"switch":var b=200,B=u.addNode({shape:"switch",position:Z,width:b,height:50,ports:ye.Tt,data:M.data,attrs:{body:{stroke:"#8f8f8f",strokeWidth:1,fill:"#fff",rx:6,ry:6}}});u.removeNode(M);var s=u.addNode({shape:"switch-case",position:{y:Z.y+100,x:Z.x-b/2},width:120,height:50,ports:ye.Tt,data:{config:{type:"switch-case"}}}),W=u.addNode({shape:"switch-default",position:{y:Z.y+100,x:Z.x+b},width:120,height:50,ports:ye.Tt,data:{config:{type:"switch-default"}}}),K=u.addEdge({source:B,sourcePort:(q=B.ports.items.find(function(ce){return ce.group=="bottom"}))===null||q===void 0?void 0:q.id,target:s,targetPort:(a=s.ports.items.find(function(ce){return ce.group=="top"}))===null||a===void 0?void 0:a.id,zIndex:0}),G=u.addEdge({source:B,sourcePort:(oe=B.ports.items.find(function(ce){return ce.group=="bottom"}))===null||oe===void 0?void 0:oe.id,target:W,targetPort:(U=W.ports.items.find(function(ce){return ce.group=="top"}))===null||U===void 0?void 0:U.id,zIndex:0});te=B;break;case"switch-case":var r=u.createNode({shape:"switch-case",position:M.position(),width:120,height:50,ports:ye.Tt,data:M.data});u.removeNode(M),u.addNode(r),te=r;break;case"string":var j=u.createNode({shape:"string",position:M.position(),width:100,height:50,ports:ye.Tt,data:M.data});u.removeNode(M),u.addNode(j),te=j;break;case"num":var H=u.createNode({shape:"num",position:M.position(),width:100,height:50,ports:ye.Tt,data:M.data});u.removeNode(M),u.addNode(H),te=H;break;case"assignment":var ie=u.createNode({shape:"assignment",position:M.position(),width:220,height:50,ports:ye.Tt,data:M.data});u.removeNode(M),u.addNode(ie),te=ie;break;default:break}if(console.log("node:added"),te&&ee.length==1){var se,le,he,ge,xe;u.addEdge({source:ee[0],sourcePort:(se=ee[0].ports.items.find(function(ce){return ce.group=="bottom"}))===null||se===void 0?void 0:se.id,target:te,targetPort:(le=te)===null||le===void 0||(he=le.ports)===null||he===void 0||(ge=he.items)===null||ge===void 0||(xe=ge.find(function(ce){return ce.group=="top"}))===null||xe===void 0?void 0:xe.id,zIndex:0})}},Qe=e(59998),Me=e(72107),$e=e(61293),qe=function(u){var M,q=(0,$e.cI)();(0,re.useEffect)(function(){var U=u.values.params;q.setValues({params:JSON.stringify(pe.y.getJsonByParams(U))})},[u.values]);var a=(0,re.useCallback)(function(U){try{return JSON.parse(U),!0}catch(ne){return!1}},[]);function oe(U){var ne=!1;Object.keys(U).forEach(function(Z){var ee=U[Z];if(["params","headers"].indexOf(Z)>-1&&!a(ee)){var te=Z==="params"?"\u5165\u53C2":"\u8BF7\u6C42\u5934";return de.ZP.error("".concat(te,"json\u683C\u5F0F\u9519\u8BEF")),ne=!0,!1}}),ne||(u!=null&&u.onSubmit&&u.onSubmit(U,U.debugType),u==null||u.setOpen(!1))}return(0,l.jsxs)("span",{children:[u.children,(0,l.jsx)(ae.Z,{open:(M=u.open)!==null&&M!==void 0?M:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return u==null?void 0:u.setOpen(!1)},children:(0,l.jsx)(Be,{formId:"logic-debug-input",onSubmit:oe})})]})},et=qe,tt=e(61719),nt=e(47503),at=e(49425),ft=null,ot=function(u){var M=(0,be.Ik)(),q=(0,re.useState)(!1),a=Ee()(q,2),oe=a[0],U=a[1];return(0,l.jsx)("div",{style:{width:"100%"},children:oe?(0,l.jsx)(nt.Z,{title:"js\u7F16\u8F91\u5668",centered:!0,width:1200,bodyStyle:{height:"80vh"},open:oe,footer:null,onCancel:function(){return U(!1)},children:(0,l.jsx)(be.ML,g()(g()({theme:"vs-dark",defaultValue:u.value,defaultLanguage:u.language,options:{minimap:{enabled:!1}}},u),{},{height:"100%"}))}):(0,l.jsxs)("div",{children:[(0,l.jsx)(be.ML,g()({className:"editorByLoader",theme:"vs-dark",defaultValue:u.value,defaultLanguage:u.language,onMount:function(Z){var ee;(ee=Z.getAction("editor.action.formatDocument"))===null||ee===void 0||ee.run(),Z.setValue(Z.getValue())},options:{minimap:{enabled:!1}},height:500},u)),(0,l.jsx)(x.ZP,{size:"small",type:"text",icon:(0,l.jsx)(at.Z,{}),style:{position:"absolute",top:0,right:0,margin:"10px",color:"whitesmoke"},onClick:function(){return U(!0)}})]})})},it=me().memo(ot),rt=e(5726),st=e.n(rt),lt=e(23620),dt=e(71731),Ie=e(11331),ut=[{key:"saveToPng",label:"\u5BFC\u51FA\u56FE\u7247"},{key:"saveToClipboard",label:"\u590D\u5236\u5230\u526A\u8D34\u677F"}],Fe=me().createContext({logic:new Me.Iz("")}),we=function(u,M){for(var q=0,a=u.length;q<a;q+=1)u[q].style.visibility=M?"visible":"hidden"},ct=function(O){N()(M,O);var u=f()(M);function M(q){var a;J()(this,M),a=u.call(this,q),t()(p()(a),"container",void 0),t()(p()(a),"stencilContainer",void 0),t()(p()(a),"state",{editingNode:void 0,openEdgeEditor:!1,embeddingEnable:!1,editingEdge:void 0,leftToolCollapsed:!1,rightToolCollapsed:!0,openFlowSetting:!1,openRunLogic:!1,editorCtx:{logic:new Me.Iz("1")},logs:[],panel:{nodes:[],groups:[]}}),t()(p()(a),"handleEdgeSubmit",function(b){var B;(B=a.state.editingEdge)===null||B===void 0||B.setLabels(b)}),t()(p()(a),"initGraph",function(b){var B,s=new _.kJ({container:b,embedding:{enabled:a.state.embeddingEnable,validate:function(j){return j.child.setData({hoverNode:j.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new _.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(j){var H=j.targetMagnet;return!!H}},background:{color:"#F2F7FA"},grid:!0});s.use(new k.H({enabled:!0,sharp:!0})).use(new V.A({enabled:!0})).use(new h.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new E.T({enabled:!0})).use(new m.N).use(new X.T).use(new P.D).use(new dt.w({resizing:{enabled:!0,minWidth:50,maxWidth:200,minHeight:50,maxHeight:50,orthogonal:!1,restrict:!1,preserveAspectRatio:!1}})),s.on("edge:dblclick",function(r){var j=r.cell}),s.on("edge:mouseenter",function(r){var j=r.cell;j.addTools([{name:"button-remove",args:{distance:-40}}])}),s.on("edge:mouseleave",function(r){var j=r.cell;j.removeTools()}),s.on("node:moved",function(r){var j,H=r.e,ie=r.x,se=r.y,le=r.node,he=r.view,ge=(j=le.data)===null||j===void 0?void 0:j.hoverNode;if(a.state.embeddingEnable&&ge){var xe,ce,vt=s.createEdge({source:ge,sourcePort:(xe=ge.ports.items.find(function(je){return je.group=="bottom"}))===null||xe===void 0?void 0:xe.id,target:le,targetPort:(ce=le.ports.items.find(function(je){return je.group=="top"}))===null||ce===void 0?void 0:ce.id,zIndex:0});le.data.hoverNode=void 0,s.addEdge(vt),a.autoLayout(s)}}),s.on("node:mouseenter",function(r){var j,H,ie,se=r.cell;((j=se.data)===null||j===void 0||(H=j.config)===null||H===void 0?void 0:H.type)!="start"&&se.addTools([{name:"button-remove",args:{x:"100%",y:0,offset:{x:-10,y:10}}}]);var le=(ie=a.container)===null||ie===void 0?void 0:ie.querySelectorAll(".x6-port-body");we(le,!0)}),s.on("node:mouseleave",function(r){var j,H=r.cell;H.removeTools();var ie=(j=a.container)===null||j===void 0?void 0:j.querySelectorAll(".x6-port-body");we(ie,!1)}),s.on("node:click",function(r){var j=r.e,H=r.x,ie=r.y,se=r.node,le=r.view;se.removeTools(),a.setState({editingNode:se})}),s.on("node:added",function(r){var j=r.node,H=r.index,ie=r.options;He(s,j)}),s.on("node:dblclick",function(r){var j=r.e,H=r.x,ie=r.y,se=r.node,le=r.view;a.setState({rightToolCollapsed:!1,editingNode:se})}),s.bindKey(["meta+c","ctrl+c"],function(){var r=s.getSelectedCells();return r.length&&s.copy(r),!1}),s.bindKey(["meta+x","ctrl+x"],function(){var r=s.getSelectedCells();return r.length&&s.cut(r),!1}),s.bindKey(["meta+v","ctrl+v"],function(){if(!s.isClipboardEmpty()){var r=s.paste({offset:32});s.cleanSelection(),s.select(r)}return!1}),s.bindKey(["meta+z","ctrl+z"],function(){return s.canUndo()&&s.undo(),!1}),s.bindKey(["meta+shift+z","ctrl+shift+z"],function(){return s.canRedo()&&s.redo(),!1}),s.bindKey("backspace",function(){var r=s.getSelectedCells();r.length&&(r.find(function(j){var H;return j.data?["start"].indexOf((H=j.data.config)===null||H===void 0?void 0:H.type)>-1:!1})?de.ZP.error("\u7981\u6B62\u5220\u9664\u5F00\u59CB\u8282\u70B9\uFF01"):s.removeCells(r))}),s.on("blank:dblclick",function(r){var j=r.e,H=r.x,ie=r.y;console.log("blank:dbclick",H,ie),a.autoLayout(s)}),s.bindKey(["ctrl+1","meta+1"],function(){var r=s.zoom();r<1.5&&s.zoom(.1)}),s.bindKey(["ctrl+2","meta+2"],function(){var r=s.zoom();r>.5&&s.zoom(-.1)}),a.state.graph=s;var W=a.state.panel.groups,K=new y.t({title:"\u5C55\u5F00/\u6536\u8D77",target:s,search:function(j,H){var ie=j.getAttrByPath("text/text");return(ie==null?void 0:ie.indexOf(H))!==-1},notFoundText:"\u672A\u627E\u5230",collapsable:!0,stencilGraphWidth:250,groups:W,layoutOptions:{rowHeight:100}}),G={};return a.state.panel.nodes.forEach(function(r){var j=s.createNode(r);W.forEach(function(H){r.groups.includes(H.name)&&(G[H.name]?G[H.name].push(j):G[H.name]=[j])})}),Object.keys(G).forEach(function(r){K.load(w()(G[r]),r)}),(B=a.stencilContainer)===null||B===void 0||B.appendChild(K.container),a.props.config?(a.state.editorCtx.logic=a.props.config,s.fromJSON(a.state.editorCtx.logic.visualConfig)):((0,Le.X)(s),a.autoLayout(s)),s}),t()(p()(a),"autoLayout",function(b){(0,Qe.V)(b)}),t()(p()(a),"refContainer",function(b){a.container=b}),t()(p()(a),"refStencil",function(b){a.stencilContainer=b}),t()(p()(a),"handleSubmit",function(b){a.saveAndConvertGraphToDsl()}),t()(p()(a),"handleOnConfigChange",function(b){try{var B=JSON.parse(b);a.setState({stepFlow:B})}catch(s){console.log(s)}}),t()(p()(a),"onSaveMenuClick",function(b){var B;switch(b.key){case"saveToBrowser":break;case"loadFromBrowser":var s=localStorage.getItem("logic-json");if(s){var W,K=JSON.parse(s);a.state.editorCtx.logic=K,(W=a.state.graph)===null||W===void 0||W.fromJSON(K.visualConfig),a.saveAndConvertGraphToDsl()}else de.ZP.info("\u6D4F\u89C8\u5668\u65E0\u7F13\u5B58\u6570\u636E");break;case"saveToClipboard":try{navigator.clipboard.writeText(JSON.stringify(a.state.editorCtx.logic))}catch(G){console.error(G)}break;case"saveToPng":(B=a.state.graph)===null||B===void 0||B.exportPNG(new Date().toLocaleDateString(),{backgroundColor:"#F2F7FA",padding:10,quality:1});break}}),t()(p()(a),"updateLogicAndEditorCtx",function(b){var B=g()(g()({},a.state.editorCtx.logic),b);return B.version=st()(Date.now()).format("YYYYMMDDHHmmss"),a.setState({editorCtx:g()(g()({},a.state.editorCtx),{},{logic:B})}),B}),t()(p()(a),"saveAndConvertGraphToDsl",function(){var b,B=(b=a.state.graph)===null||b===void 0?void 0:b.toJSON(),s=a.convertGraphToDsl(B);if(s){var W,K=a.updateLogicAndEditorCtx({items:s.items,visualConfig:s.visualConfig});a.props.config&&(K.id=(W=a.props.config)===null||W===void 0?void 0:W.id),a.props.onSave&&a.props.onSave(K);var G=JSON.stringify(K);localStorage.setItem("logic-"+K.name,G)}}),t()(p()(a),"saveFlowSettingAndConvertGraphToDsl",function(b){var B,s,W,K,G,r=pe.y.getParamArrayByJson(JSON.parse((B=b.params)!==null&&B!==void 0?B:"{}")),j=pe.y.getReturnArrayByJson(JSON.parse((s=b.returns)!==null&&s!==void 0?s:"{}")),H=pe.y.getVariableArrayByJson(JSON.parse((W=b.variables)!==null&&W!==void 0?W:"{}")),ie=pe.y.getEnvsArrayByJson(JSON.parse((K=b.envs)!==null&&K!==void 0?K:"{}")),se=a.updateLogicAndEditorCtx({params:r,returns:j,variables:H,envs:ie});a.props.config&&(se.id=(G=a.props.config)===null||G===void 0?void 0:G.id),a.props.onSave&&a.props.onSave(se);var le=JSON.stringify(se);localStorage.setItem("logic-json-"+se.id,le)}),t()(p()(a),"convertGraphToDsl",function(b){var B,s=(0,Ce.nq)((B=a.props.config)===null||B===void 0?void 0:B.id,b.cells);return s&&(s.visualConfig=b),s}),t()(p()(a),"setFlowSetting",function(b){a.setState({openFlowSetting:b})});try{var oe,U,ne=(0,We.K)(q.customNodes,q.customGroups,q.customSharps),Z=ne.Nodes,ee=ne.Shapes,te=ne.Groups;(0,Le.m)(ee),a.state.leftToolCollapsed=!(!((oe=q.showLeft)!==null&&oe!==void 0)||oe),a.state.rightToolCollapsed=!((U=q.showRight)!==null&&U!==void 0&&U),a.state.panel.nodes=Z,a.state.panel.groups=te}catch(b){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(b)}return a}return o()(M,[{key:"componentDidUpdate",value:function(a,oe,U){if(this.props.config&&this.state.editorCtx.logic.id!=this.props.config.id){var ne,Z,ee,te;this.state.editorCtx.logic=this.props.config,(ne=this.state.editorCtx)!==null&&ne!==void 0&&(Z=ne.logic)!==null&&Z!==void 0&&Z.visualConfig&&((ee=this.state.graph)===null||ee===void 0||ee.fromJSON((te=this.state.editorCtx.logic)===null||te===void 0?void 0:te.visualConfig)),this.setState({editingNode:void 0})}}},{key:"componentDidMount",value:function(){var a;this.initGraph(this.container),this.updateLogicAndEditorCtx((a=this.state.editorCtx)===null||a===void 0?void 0:a.logic)}},{key:"render",value:function(){var a=this,oe,U=this.state,ne=U.editingNode,Z=U.leftToolCollapsed,ee=U.rightToolCollapsed,te=U.editorCtx,b=U.embeddingEnable,B=U.graph,s=U.openFlowSetting,W=U.openRunLogic,K=te.logic;return console.log("editorCtx",te),(0,l.jsx)(Fe.Provider,{value:te,children:(0,l.jsxs)(L.Z,{style:{height:"100vh",width:"100%",margin:0},children:[(0,l.jsx)(L.Z.Sider,{theme:"light",collapsed:Z,collapsedWidth:0,width:300,children:(0,l.jsx)(Re,{refStencil:this.refStencil,graph:this.state.graph,logic:K,onConfigChange:this.handleOnConfigChange})}),(0,l.jsxs)(L.Z,{style:{height:"100%"},children:[(0,l.jsxs)(L.Z.Header,{style:{padding:0,backgroundColor:"white"},children:[(0,l.jsxs)(z.Z,{direction:"horizontal",children:[(0,l.jsx)(x.ZP,{type:"text",icon:Z?(0,l.jsx)(n.Z,{}):(0,l.jsx)(v.Z,{}),onClick:function(){a.setState({leftToolCollapsed:!Z})},style:{fontSize:"16px",width:64,height:64}}),(0,l.jsx)(ue.Z.Button,{style:{float:"inline-start"},menu:{items:ut,onClick:this.onSaveMenuClick},buttonsRender:function(r){return[(0,l.jsx)(x.ZP,{type:"primary",icon:(0,l.jsx)(T.Z,{}),onClick:a.saveAndConvertGraphToDsl,children:"\u4FDD\u5B58"}),(0,l.jsx)(x.ZP,{type:"primary",icon:(0,l.jsx)(i.Z,{})})]},children:"\u4FDD\u5B58"}),(0,l.jsx)(Xe,{open:s,values:g()({},K),setOpen:this.setFlowSetting,onSubmit:this.saveFlowSettingAndConvertGraphToDsl,children:(0,l.jsx)(x.ZP,{onClick:function(){return a.setFlowSetting(!0)},icon:(0,l.jsx)(C.Z,{}),children:"\u914D\u7F6E\u53C2\u6570"})}),(oe=this.props.btns)===null||oe===void 0?void 0:oe.map(function(G){return(0,l.jsx)(x.ZP,g()({},G))}),(0,l.jsx)(et,{open:W,setOpen:function(r){return a.setState({openRunLogic:r})},values:{params:K==null?void 0:K.params},onSubmit:function(r,j){if(a.setState({openRunLogic:!1}),K){var H=r.params,ie=r.bizId,se=r.headers,le=r.bizStartCode;(0,tt.L7)(K.id,JSON.parse(H),ie,le,j,JSON.parse(se)).then(function(he){he.data.code==0?ae.Z.success({title:"\u6267\u884C\u6210\u529F",width:"1000px",closable:!0,content:(0,l.jsx)("div",{children:(0,l.jsx)(Ie.Z,{pageId:"debug-info",data:he.data})})}):ae.Z.error({title:(0,l.jsx)("span",{children:he.data.msg}),width:"1200px",closable:!0,content:(0,l.jsx)("div",{children:(0,l.jsx)(Ie.Z,{pageId:"debug-info",data:he.data})})})}).catch(function(he){var ge=he.response.data;ae.Z.error({title:(0,l.jsx)("span",{children:ge.msg}),width:"1200px",closable:!0,content:(0,l.jsx)("div",{children:(0,l.jsx)(fe.Z,{children:(0,l.jsx)($.Z,{children:(0,l.jsxs)(fe.Z,{children:[(0,l.jsxs)($.Z,{span:12,children:[(0,l.jsx)("h4",{children:"\u9519\u8BEF\u8BE6\u7EC6:"}),(0,l.jsx)(lt.gcu,{src:ge.error,collapsed:1})]}),(0,l.jsxs)($.Z,{span:12,children:[(0,l.jsx)("h4",{children:"\u8FD4\u56DE\u6570\u636E:"}),(0,l.jsx)(it,{language:"json",value:JSON.stringify(ge.data),width:500})]})]})})})})})}),a.state.logs.push({data:new Date().toLocaleTimeString()})}},children:(0,l.jsx)(x.ZP,{type:"default",onClick:function(){a.setState({openRunLogic:!0})},icon:(0,l.jsx)(d.Z,{}),children:"\u8C03\u8BD5"})}),(0,l.jsxs)("span",{children:["\u5F53\u524D\u7248\u672C:",K.version]})]}),(0,l.jsx)(z.Z,{style:{float:"right",right:"16px"}})]}),(0,l.jsx)(L.Z.Content,{className:"app-content",children:(0,l.jsx)(Ke.Z,{ref:this.refContainer})})]}),(0,l.jsx)(L.Z.Sider,{theme:"light",collapsed:ee,collapsedWidth:0,width:600,children:(0,l.jsx)(ze,{logic:K,onClear:function(){return a.setState({logs:[]})},editNode:ne,onSubmit:this.handleSubmit,logs:this.state.logs,onClose:function(){a.setState({rightToolCollapsed:!0})},isCollapsed:ee})})]})})}}]),M}(me().Component)},37555:function(ve,Q,e){e.d(Q,{Z:function(){return w}});var Y=e(87363),g=e(33130),S=(0,Y.forwardRef)(function(I,J){return(0,g.jsx)("div",{className:"drag-graph",ref:J})}),w=S},59998:function(ve,Q,e){e.d(Q,{V:function(){return g}});var Y=e(59490),g=function(w){var I=new Y.Vq({type:"dagre",begin:[400,100],rankdir:"TB",ranksep:20,nodeSize:50,controlPoints:!0}),J=w.getNodes(),D=w.getEdges(),o=I.layout({nodes:J,edges:D}),F=o.nodes,p=F===void 0?[]:F;J.forEach(function(A){var N=p.find(function(R){return R.id===A.id});N.x-=A.size().width/2,N.y-=A.size().height/2,A.position(N.x,N.y)})}},36808:function(ve,Q,e){e.d(Q,{Hi:function(){return S},Tt:function(){return Y}});var Y={groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]},g={groups:{right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1}},items:[{group:"right"}]},S={groups:{bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1}},items:[{group:"bottom"}]}},14232:function(ve,Q,e){e.d(Q,{X:function(){return t},m:function(){return c}});var Y=e(5671),g=e(95812),S=e(54882),w={customNode:"customNode___AyPI8",input:"input___Q5PmS",switchNode:"switchNode___fqB9a"},I=e(33130),J=function(v){return(0,I.jsx)("div",{className:w.customNode,children:(0,I.jsx)(S.Z,{className:"input",value:v==null?void 0:v.data,width:80})})},D=e(42761),o=function(v){return(0,I.jsx)("div",{className:styles.customNode,children:(0,I.jsx)(D.Z,{className:"input",value:v==null?void 0:v.data,width:80})})},F=e(57213),p=e.n(F),A=function(v){var T,i,C,d=v.node,_=(T=d.data.config)===null||T===void 0?void 0:T.name,X=_||"case";return(0,I.jsxs)("div",{className:w.customNode,children:[(0,I.jsx)("span",{children:"case"}),(0,I.jsx)(S.Z,{addonAfter:_,className:"input",value:d==null||(i=d.data)===null||i===void 0||(C=i.config)===null||C===void 0?void 0:C.case,width:150,onChange:function(m){var h=d.data;d.setData(p()(p()({},h),{},{config:p()(p()({},h.config),{},{case:m.target.value})}))}})]})},N=function(v){var T,i=v.node;return(0,I.jsx)("div",{className:w.customNode,children:(0,I.jsx)(S.Z,{addonBefore:"switch",className:"input",value:(T=i.data)===null||T===void 0?void 0:T.config.condition,onChange:function(d){var _=i.data;i.setData(p()(p()({},_),{},{config:p()(p()({},_.config),{},{condition:d.target.value})}))},width:100})})},R=e(36808),f=function(v){return(0,I.jsx)("div",{className:w.customNode,children:(0,I.jsx)("div",{style:{textAlign:"center",fontSize:"15px"},children:"default"})})};function c(n){n.forEach(function(v){console.log("\u6CE8\u518C\u65B0\u8282\u70B9:"+v.name),Y.kJ.registerNode(v.name,v.config,!0)}),(0,g.z2)({shape:"string",component:J}),(0,g.z2)({shape:"num",component:o}),(0,g.z2)({shape:"switch",component:N}),(0,g.z2)({shape:"switch-case",component:A}),(0,g.z2)({shape:"switch-default",component:f})}function t(n){var v=n.createNode({shape:"circle",label:"start",width:50,height:50,attrs:{body:{}},ports:R.Hi,data:{config:{type:"start"}}});n.addNode(v)}},10486:function(ve,Q,e){e.d(Q,{K:function(){return D}});var Y=e(57213),g=e.n(Y),S=e(36808),w=50,I=50,J=[{name:"ExtSharp",config:{width:100,height:I,attrs:{body:{rx:6,ry:6,stroke:"#5F95FF",strokeWidth:1,fill:"rgba(95,149,255,0.05)",refWidth:1,refHeight:1},image:{refX:2,refY:0},text:{refX:4,refY:20,fontSize:12,"text-anchor":"start"}},markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}}];function D(o,F,p){var A=50,N=50,R={body:{}},f=[{shape:"circle",width:A,height:N,attrs:{body:g()(g()({},R.body),{},{fill:"white"}),text:{text:"\u4EA4\u4E92\u70B9"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:S.Tt,data:{config:{type:"wait-for-continue"}},groups:["global"]},{shape:"circle",label:"end",width:A,height:N,attrs:{body:g()(g()({},R.body),{},{fill:"#d9d9d9"}),text:{text:"end"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:S.Tt,data:{config:{type:"end"}},groups:["global"]},{shape:"ExtSharp",attrs:{text:{text:"http\u8BF7\u6C42",fontSize:14},image:{"xlink:href":"/icons/http.svg",width:20,x:2,y:2}},data:{config:{type:"http",method:"POST"}},ports:S.Tt,groups:["biz"]},{shape:"ExtSharp",ports:S.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/code.svg"},text:{text:"js\u811A\u672C",fontSize:14}},data:{config:{type:"js"}},groups:["biz"]},{shape:"ExtSharp",ports:S.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/code.svg"},text:{text:"java\u65B9\u6CD5",fontSize:14}},data:{config:{type:"java"}},groups:["biz"]},{shape:"ExtSharp",ports:S.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/CarbonSubflowLocal.svg"},text:{text:"\u590D\u7528\u903B\u8F91",fontSize:14}},data:{config:{type:"sub-logic"}},groups:["biz"]},{shape:"ExtSharp",width:50,height:N,label:"switch",attrs:{image:{"xlink:href":"/icons/switch.svg",width:45,x:1,y:2},text:{text:"switch",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"switch"}},ports:S.Tt,groups:["ctrl"]},{shape:"ExtSharp",width:A,height:N,attrs:{image:{"xlink:href":"/icons/text.svg",width:30,x:8,y:10},text:{text:"case",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"switch-case"}},ports:S.Tt,groups:["ctrl"]},{shape:"ExtSharp",width:A,height:N,attrs:{image:{"xlink:href":"/icons/delay.svg",width:30,x:8,y:10},text:{text:"\u7B49\u5F85",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"wait",timeout:"2000"}},ports:S.Tt,groups:["ctrl"]}];o&&o.length>0&&Array.prototype.push.apply(f,o);var c=[{name:"global",title:"\u5168\u5C40\u8282\u70B9",graphHeight:110},{name:"ctrl",title:"\u903B\u8F91\u63A7\u5236",graphHeight:220},{name:"biz",title:"\u4E1A\u52A1\u8C03\u7528",graphHeight:220}];F&&F.length>0&&Array.prototype.push.apply(c,F);var t=J;return p&&p.length>0&&Array.prototype.push.apply(t,p),{Shapes:t,Nodes:f,Groups:c}}},61719:function(ve,Q,e){e.d(Q,{L7:function(){return f}});var Y=e(57213),g=e.n(Y),S=e(25359),w=e.n(S),I=e(49811),J=e.n(I),D=e(70517);function o(m,h){return axios.get(m,h)}function F(m,h,k){return axios.put(m,h,k)}function p(m,h){return axios.delete(m,h)}function A(m,h,k){return D.Z.post(m,h,k)}function N(m,h){return R.apply(this,arguments)}function R(){return R=_asyncToGenerator(_regeneratorRuntime().mark(function m(h,k){return _regeneratorRuntime().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.abrupt("return",post("/api/runtime/logic/v1/run-fn/".concat(h),k,{headers:{"Content-Type":"application/json"}}));case 1:case"end":return E.stop()}},m)})),R.apply(this,arguments)}function f(m,h,k,y,E,P){return c.apply(this,arguments)}function c(){return c=J()(w()().mark(function m(h,k,y,E,P,de){var L;return w()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:L="",x.t0=P,x.next=x.t0==="biz"?4:6;break;case 4:return E?L="/api/runtime/logic/v1/biz/".concat(h,"/").concat(E,"/").concat(y,"?debug=true"):L="/api/runtime/logic/v1/run-biz/".concat(h,"/").concat(y,"?debug=true"),x.abrupt("break",8);case 6:return L="/api/runtime/logic/v1/run-api/".concat(h,"?debug=true"),x.abrupt("break",8);case 8:return x.abrupt("return",A(L,k,{headers:g()({"Content-Type":"application/json"},de)}));case 9:case"end":return x.stop()}},m)})),c.apply(this,arguments)}function t(m,h){return n.apply(this,arguments)}function n(){return n=_asyncToGenerator(_regeneratorRuntime().mark(function m(h,k){return _regeneratorRuntime().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.abrupt("return",axios.post("/api/form/logic_instance/query",{filters:[{dataIndex:"logicId",values:[h],type:"="},{dataIndex:"bizId",values:[k],type:"="}]}).then(function(P){var de=P.data.result.items[0];return de}));case 1:case"end":return E.stop()}},m)})),n.apply(this,arguments)}function v(m){return T.apply(this,arguments)}function T(){return T=_asyncToGenerator(_regeneratorRuntime().mark(function m(h){return _regeneratorRuntime().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.abrupt("return",axios.get("/api/ide/logic-instance/".concat(h)).then(function(E){var P=E.data.data;return P}));case 1:case"end":return y.stop()}},m)})),T.apply(this,arguments)}function i(m){return C.apply(this,arguments)}function C(){return C=_asyncToGenerator(_regeneratorRuntime().mark(function m(h){return _regeneratorRuntime().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.abrupt("return",axios.post("/api/form/logic/add",h).then(function(E){var P=E.data.result;return P}));case 1:case"end":return y.stop()}},m)})),C.apply(this,arguments)}function d(m){return _.apply(this,arguments)}function _(){return _=_asyncToGenerator(_regeneratorRuntime().mark(function m(h){return _regeneratorRuntime().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.abrupt("return",axios.delete("/api/form/logic/delete/".concat(h)).then(function(E){return E.data.result}));case 1:case"end":return y.stop()}},m)})),_.apply(this,arguments)}function X(){return V.apply(this,arguments)}function V(){return V=_asyncToGenerator(_regeneratorRuntime().mark(function m(){var h,k,y=arguments;return _regeneratorRuntime().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return h=y.length>0&&y[0]!==void 0?y[0]:1,k=y.length>1&&y[1]!==void 0?y[1]:10,P.abrupt("return",axios.post("/api/form/logic/query",{page:h,pageSize:k}).then(function(de){return de.data}));case 3:case"end":return P.stop()}},m)})),V.apply(this,arguments)}},70256:function(ve,Q,e){e.d(Q,{CD:function(){return o},UD:function(){return J},n4:function(){return p}});var Y=e(25359),g=e.n(Y),S=e(49811),w=e.n(S),I=e(70517);function J(N){return D.apply(this,arguments)}function D(){return D=w()(g()().mark(function N(R){return g()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,I.Z.get("/setting/pages/".concat(R,".json"));case 2:return c.abrupt("return",c.sent.data);case 3:case"end":return c.stop()}},N)})),D.apply(this,arguments)}function o(N){return F.apply(this,arguments)}function F(){return F=w()(g()().mark(function N(R){return g()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,I.Z.get("/setting/forms/".concat(R,".json"));case 2:return c.abrupt("return",c.sent.data);case 3:case"end":return c.stop()}},N)})),F.apply(this,arguments)}function p(N,R){return A.apply(this,arguments)}function A(){return A=w()(g()().mark(function N(R,f){return g()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,I.Z.get("/setting/".concat(R,"s/").concat(f,".json"));case 2:return t.abrupt("return",t.sent.data);case 3:case"end":return t.stop()}},N)})),A.apply(this,arguments)}},99273:function(ve,Q,e){e.d(Q,{F:function(){return Y}});var Y={getTokenFormLocal:function(){return localStorage.getItem("token")},setTokenToLocal:function(S){return localStorage.setItem("token",S)}}}}]);
