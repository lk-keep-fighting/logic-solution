"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[1215],{60341:function(B,D,e){e.d(D,{l:function(){return h.Z}});var h=e(93797)},65020:function(B,D,e){e.d(D,{n:function(){return d}});var h=e(12490);function d(b){var f=b.createNode({shape:"start",width:50,height:50,ports:h.Tt,data:{config:{type:"start",name:"\u5F00\u59CB"}}});b.addNode(f)}},77357:function(B,D,e){e.d(D,{S8:function(){return v},nq:function(){return r}});var h=e(57213),d=e.n(h),b=e(21140),f=e.n(b),P=e(63466),p=e.n(P),E=e(83217),y=e(72107),c=e(12490),C=null;function i(n,o,t,_){var a,l,s=n.data.config,u=s.type,m=t.flatMap(function(M){return M.source.cell===n.id?o[M.target.cell]:[]}),U=n.attrs,g=new y.Du((a=n.id)!==null&&a!==void 0?a:"",u);if(g=d()(d()({},s),{},{id:n.id,name:U==null||(l=U.text)===null||l===void 0?void 0:l.text}),!(_.findIndex(function(M){return M.id===g.id})>-1)&&(_.push(g),m.length!==0))switch(u){default:if(m.length>1||g.type==="switch"){var T;console.log((T=n.data)===null||T===void 0?void 0:T.config),console.log(m),g.branches=[],m.forEach(function(M){var x,S;if(console.log((x=M.data)===null||x===void 0?void 0:x.config),((S=M.data)===null||S===void 0?void 0:S.config.type)==="switch-cases"){var j,I,F;(j=M.data)===null||j===void 0||(I=j.config)===null||I===void 0||(F=I.cases)===null||F===void 0||F.forEach(function(G){var V;(V=g.branches)===null||V===void 0||V.push({when:G,nextId:M.id})})}else{var w,N,L;(w=g.branches)===null||w===void 0||w.push({when:(N=M.data)===null||N===void 0||(L=N.config)===null||L===void 0?void 0:L.case,nextId:M.id})}i(o[M.id],o,t,_)})}else g.nextId=m[0].id,i(o[m[0].id],o,t,_);break}}function r(n,o){var t=new y.Iz(n),_=[],a=[],l={},s=void 0;if(o.forEach(function(u){var m=u.id||"";u.shape==="edge"?_.push(u):(l[m]=u,a.push(u),u.data.config.type==="start"&&(s=u))}),!s){E.ZP.error("\u672A\u53D1\u73B0\u5F00\u59CB\u8282\u70B9\uFF0C\u8BF7\u914D\u7F6E\uFF01");return}return i(s,l,_,t.items),console.log("logic.items"),console.log(t.items),t}function v(n){var o;if(!(n!=null&&(o=n.items)!==null&&o!==void 0&&o.length))return{nodes:[],edges:[]};var t=function(u){switch(console.log("type"),console.log(u),u){case"http":case"js":case"java":case"sub-logic":return{size:{width:100,height:50}};case"switch":return{size:{width:200,height:50}};case"switch-case":case"switch-default":case"switch-cases":return{size:{width:120,height:50}};default:return{size:{width:50,height:50}}}},_={shape:"edge"},a=n.items.map(function(s){return d()(d()({},t(s.type)),{},{id:s.id,ports:d()(d()({},c.Tt),{},{items:c.Tt.items.map(function(u){return d()(d()({},u),{},{id:"".concat(s.id,"-").concat(u.group)})})}),shape:s.type,data:{config:s}})}),l=n.items.flatMap(function(s){var u;return(u=s.branches)!==null&&u!==void 0&&u.length?s.branches.map(function(m){return d()(d()({},_),{},{source:{cell:s.id,port:s.id+"-bottom"},target:{cell:m.nextId,port:m.nextId+"-top"}})}):s.nextId?[d()(d()({},_),{},{source:{cell:s.id,port:s.id+"-bottom"},target:{cell:s.nextId,port:s.nextId+"-top"}})]:[]});return{nodes:a,edges:l}}},94744:function(B,D,e){e.d(D,{y:function(){return i}});var h=e(37635),d=e.n(h),b=e(21140),f=e.n(b),P=e(63466),p=e.n(P),E=e(72107),y=e(52510),c=e.n(y),C=p()(function r(v){f()(this,r),c()(this,"concept","EnvParam"),c()(this,"name",void 0),c()(this,"description",void 0),c()(this,"typeAnnotation",void 0),c()(this,"required",!1),c()(this,"defaultValue",void 0),this.name=v}),i=function(){function r(){f()(this,r)}return p()(r,null,[{key:"valueToTypeAnnotaion",value:function(n){var o=this,t={concept:E.Ld.TypeAnnotation,typeKind:"primitive",typeName:"string",defaultValue:n};if(Array.isArray(n))t.typeName="array";else{var _=d()(n);switch(_){case"boolean":t.typeKind="primitive",t.typeName="boolean";break;case"number":t.typeKind="primitive",t.typeName="number";break;case"string":t.typeKind="primitive",t.typeName="string";break;case"object":n==null?t.typeName="null":n instanceof Date?(t.typeKind="primitive",t.typeName="date"):n instanceof RegExp?(t.typeKind="primitive",t.typeName="regexp"):n instanceof Function?(t.typeKind="primitive",t.typeName="function"):(t.typeKind="anonymousStructure",t.typeName="object",t.properties=[],Object.keys(n).map(function(a){var l,s=n[a],u=o.valueToTypeAnnotaion(s),m=new E.X0(a);m.typeAnnotation=u,m.defaultValue=s,(l=t.properties)===null||l===void 0||l.push(m)}));break;default:t.typeKind="unknown",t.typeName=_;break}}return t}},{key:"typeAnnotaionToValue",value:function(n){var o,t,_=this,a;switch(n.typeName){case"array":a=(o=n.defaultValue)!==null&&o!==void 0?o:[];break;case"boolean":a=n.defaultValue?n.defaultValue=="true":!1;break;case"number":a=parseFloat(n.defaultValue);break;case"null":a=null;break;case"date":a=new Date(n.defaultValue);break;case"regexp":a=new RegExp(n.defaultValue);break;case"object":a={},(t=n.properties)===null||t===void 0||t.forEach(function(l){a[l.name]=_.typeAnnotaionToValue(l.typeAnnotation)});break;case"string":case"function":default:a=n.defaultValue;break}return a}},{key:"getParamArrayByJson",value:function(n){var o=[];return n&&Object.keys(n).forEach(function(t){var _=new E.dO(t);_.typeAnnotation=r.valueToTypeAnnotaion(n[t]),_.defaultValue=n[t],o.push(_)}),o}},{key:"getReturnArrayByJson",value:function(n){var o=[];return n&&Object.keys(n).forEach(function(t){var _=new E.z1(t);_.typeAnnotation=r.valueToTypeAnnotaion(n[t]),_.defaultValue=n[t],o.push(_)}),o}},{key:"getVariableArrayByJson",value:function(n){var o=[];return n&&Object.keys(n).forEach(function(t){var _=new E._w(t);_.typeAnnotation=r.valueToTypeAnnotaion(n[t]),_.defaultValue=n[t],o.push(_)}),o}},{key:"getEnvsArrayByJson",value:function(n){var o=[];return n&&Object.keys(n).forEach(function(t){var _=new C(t);_.typeAnnotation=r.valueToTypeAnnotaion(n[t]),_.defaultValue=n[t],o.push(_)}),o}},{key:"getJsonByParams",value:function(n){var o=this,t={};return n==null||n.forEach(function(_){t[_.name]=_.typeAnnotation?o.typeAnnotaionToValue(_.typeAnnotation):_.defaultValue}),t}}]),r}()},44132:function(B,D,e){var h=e(57213),d=e.n(h),b=e(54306),f=e.n(b),P=e(70517),p=e(90010),E=e.n(p),y=e(23620),c=e(2069),C=e(87363),i=e.n(C),r=e(12472),v=e(33358),n=e(49500),o=e(16123),t=e(78057),_=e(69078),a=e(98896),l=e(31837),s=e(32126),u=e(33130),m=function(g){var T=(0,C.useState)({type:"page"}),M=f()(T,2),x=M[0],S=M[1],j=(0,C.useState)(),I=f()(j,2),F=I[0],w=I[1],N=(0,C.useState)(),L=f()(N,2),G=L[0],V=L[1],Z="cxd",z="zh-CN";return(0,C.useEffect)(function(){(0,a.m)(P.Z)},[]),(0,C.useEffect)(function(){g.pageId&&((0,r.UD)(g.pageId).then(function(K){S(K)}),s.S.getEnvJson().then(function(K){w(JSON.parse(l.j.getEnv()))}))},[g.pageId]),(0,u.jsxs)("div",{children:[(0,u.jsx)(c.qR,{theme:Z,position:"top-right",locale:z},"toast"),(0,u.jsx)(c.wx,{theme:Z,locale:z},"alert"),(0,y.sYA)(x,{data:d()({envs:F},g.data)},{fetcher:function(A){var W=A.url,J=A.method,R=A.data,k=A.responseType,O=A.config,X=A.headers;return g.data&&g.data.runtime&&(W="/api/ide/papi/".concat(g.data.runtime).concat(W)),O=O||{},O.withCredentials=!0,k&&(O.responseType=k),O.cancelExecutor&&(O.cancelToken=new P.Z.CancelToken(O.cancelExecutor)),O.headers=X||{},O.headers.Authorization||(O.headers.Authorization="Bearer "+_.F.getTokenFormLocal()),J!=="post"&&J!=="put"&&J!=="patch"?(R&&(O.params=R),P.Z[J](W,O)):(R&&R instanceof FormData?(O.headers=O.headers||{},O.headers["Content-Type"]="multipart/form-data"):R&&typeof R!="string"&&!(R instanceof Blob)&&!(R instanceof ArrayBuffer)&&(R=JSON.stringify(R),O.headers=O.headers||{},O.headers["Content-Type"]="application/json"),P.Z[J](W,R,O))},isCancel:function(A){return P.Z.isCancel(A)},copy:function(A){E()(A),c.Am.success("\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u7C98\u8D34\u677F")},theme:Z,jumpTo:function(A,W){debugger;W.blank==!0?window.open(window.location.origin+window.location.pathname+"#"+A,"_blank"):window.location.hash=A}})]})};D.Z=m},7944:function(B,D,e){var h=e(54306),d=e.n(h),b=e(94990),f=e(94744),P=e(51394),p=e(83217),E=e(87363),y=e.n(E),c=e(33130),C=function(r){var v,n=(0,E.useState)({}),o=d()(n,2),t=o[0],_=o[1];(0,E.useEffect)(function(){var l=r.values,s=l.params,u=l.variables,m=l.envs,U=l.returns,g=l.log;_({params:JSON.stringify(f.y.getJsonByParams(s)),variables:JSON.stringify(f.y.getJsonByParams(u)),returns:JSON.stringify(f.y.getJsonByParams(U)),envs:JSON.stringify(f.y.getJsonByParams(m)),log:g})},[r.values]);var a=(0,E.useCallback)(function(l){try{return JSON.parse(l),!0}catch(s){return!1}},[]);return(0,c.jsxs)("span",{children:[r.children,(0,c.jsx)(P.Z,{open:(v=r.open)!==null&&v!==void 0?v:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return r==null?void 0:r.setOpen(!1)},children:(0,c.jsx)(b.Z,{formId:"logic-setting",values:t,onSubmit:function(s){console.log("\u63D0\u4EA4\u53C2\u6570"),console.log(s);var u=!1;Object.keys(s).forEach(function(m){var U=s[m];if(!a(U)){var g=m==="params"?"\u5165\u53C2":m==="variables"?"\u5C40\u90E8\u53D8\u91CF":m==="returns"?"\u8FD4\u56DE\u53C2\u6570":"\u73AF\u5883\u53D8\u91CF";switch(m){case"params":return p.ZP.error("\u5165\u53C2json\u683C\u5F0F\u9519\u8BEF"),u=!0,!1;break;case"variables":return p.ZP.error("\u5C40\u90E8\u53D8\u91CFjson\u683C\u5F0F\u9519\u8BEF"),u=!0,!1;break;case"returns":return p.ZP.error("\u8FD4\u56DE\u53C2\u6570json\u683C\u5F0F\u9519\u8BEF"),u=!0,!1;break;case"ens":return p.ZP.error("\u73AF\u5883\u53D8\u91CFjson\u683C\u5F0F\u9519\u8BEF"),u=!0,!1;break;default:break}}}),u||(r!=null&&r.onSubmit&&r.onSubmit(s),r==null||r.setOpen(!1))}})})]})};D.Z=C},79671:function(B,D,e){var h=e(94990),d=e(94744),b=e(83217),f=e(51394),P=e(77129),p=e(87363),E=e.n(p),y=e(33130),c=function(i){var r,v=(0,P.cI)();(0,p.useEffect)(function(){var t=i.values.params;v.setValues({params:JSON.stringify(d.y.getJsonByParams(t))})},[i.values]);var n=(0,p.useCallback)(function(t){try{return JSON.parse(t),!0}catch(_){return!1}},[]);function o(t){var _=!1;Object.keys(t).forEach(function(a){var l=t[a];if(["params","headers"].indexOf(a)>-1&&!n(l)){var s=a==="params"?"\u5165\u53C2":"\u8BF7\u6C42\u5934";return b.ZP.error("".concat(s,"json\u683C\u5F0F\u9519\u8BEF")),_=!0,!1}}),_||(i!=null&&i.onSubmit&&i.onSubmit(t,t.debugType),i==null||i.setOpen(!1))}return(0,y.jsxs)("span",{children:[i.children,(0,y.jsx)(f.Z,{open:(r=i.open)!==null&&r!==void 0?r:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return i==null?void 0:i.setOpen(!1)},children:(0,y.jsx)(h.Z,{formId:"logic-debug-input",onSubmit:o})})]})};D.Z=c},21558:function(B,D,e){e.d(D,{W:function(){return y}});var h=e(57213),d=e.n(h),b=e(21140),f=e.n(b),P=e(63466),p=e.n(P),E=e(77357),y=function(){function c(){f()(this,c)}return p()(c,[{key:"graphToLogicItems",value:function(i,r){var v=(0,E.nq)(r==null?void 0:r.id,i==null?void 0:i.getCells());return v.visualConfig=i==null?void 0:i.toJSON(),d()(d()({},r),{},{visualConfig:v.visualConfig,items:v.items})}},{key:"logicToGraphJson",value:function(i){var r=(0,E.S8)(i);return r}}]),c}()},79716:function(B,D,e){e.d(D,{O:function(){return r}});var h=e(25359),d=e.n(h),b=e(49811),f=e.n(b),P=e(70517),p=e(9364),E=e(12490),y=e(42651),c={buildGroup:function(o,t,_,a){var l=Number.parseInt(t/2),s=t%2==0;return{name:o,title:_,graphHeight:(s?l:l+1)*(a||70)+10}}},C=c;function i(n){return n.length>7?"".concat(n.substring(0,7),`\r
`).concat(n.substring(7)):n}function r(n){return v.apply(this,arguments)}function v(){return v=f()(d()().mark(function n(o){var t,_;return d()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return t=[],_="/api/ide/asset/v1/logic-item/readFromCode",o&&(_="/api/ide/papi/".concat(o,"/api/ide/asset/v1/logic-item/readFromCode")),l.abrupt("return",Promise.all([(0,p.K)(),P.Z.get(_)]).then(function(s){if(console.log("getPanelData"),s[1].status==200){var u=s[1].data.data;Object.keys(u).forEach(function(m,U){var g=C.buildGroup(m,u[m].length,m);t.push(g),u[m].sort(function(T,M){return T.order?T.order.localeCompare(M.order):1}).forEach(function(T){s[0].Nodes.push(new y.Z({shape:T.shape?T.shape:"ExtShape"+(U%3==0?"1":U%3==1?"2":"3"),ports:E.Tt,width:100,height:50,text:T.name,data:{config:T.logicItem},_groups:[T.group]}))})})}return{Nodes:s[0].Nodes,Groups:t}}));case 4:case"end":return l.stop()}},n)})),v.apply(this,arguments)}},32126:function(B,D,e){e.d(D,{S:function(){return i}});var h=e(25359),d=e.n(h),b=e(49811),f=e.n(b),P=e(21140),p=e.n(P),E=e(63466),y=e.n(E),c=e(31837),C=e(57475),i=function(){function r(){p()(this,r)}return y()(r,null,[{key:"getEnvJson",value:function(){var v=f()(d()().mark(function o(){return d()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.abrupt("return",(0,C.U2)("/api/runtime/env").then(function(a){return a.data.data}).then(function(a){return c.j.setModel(a.UI_CONFIG_MODEL),c.j.setEnv(JSON.stringify(a)),c.j.setApiUrlPrefix(a.API_GATEWAY_PREFIX),c.j.setReryApi(a.CUSTOM_RETRY_URL),c.j.setReryApi(a.CUSTOM_RETRY_URL),a}));case 1:case"end":return _.stop()}},o)}));function n(){return v.apply(this,arguments)}return n}()},{key:"getRemoteRuntimeConfig",value:function(){var v=f()(d()().mark(function o(){return d()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.abrupt("return",(0,C.v_)("/api/ide/remote-runtimes").then(function(a){return a.data}).then(function(a){return console.log("remote runtimes:",a.data),c.j.setRemoteRuntimes(JSON.stringify(a.data)),a}));case 1:case"end":return _.stop()}},o)}));function n(){return v.apply(this,arguments)}return n}()}]),r}()}}]);
