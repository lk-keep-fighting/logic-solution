"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[3974],{53974:function(W,O,m){m.r(O),m.d(O,{IFrameRenderer:function(){return R},default:function(){return _}});var e=m(15767),N=m(87363),d=m.n(N),i=m(42977),_=function(l){(0,e.ZT)(a,l);function a(){var t=l!==null&&l.apply(this,arguments)||this;return t.IFrameRef=d().createRef(),t.state={width:t.props.width||"100%",height:t.props.height||"100%"},t}return a.prototype.componentDidMount=function(){window.addEventListener("message",this.onMessage)},a.prototype.componentDidUpdate=function(t){var r=this.props.data;r!==t.data?this.postMessage("update",r):(this.props.width!==t.width||this.props.height!==t.height)&&this.setState({width:this.props.width||"100%",height:this.props.height||"100%"})},a.prototype.componentWillUnmount=function(){window.removeEventListener("message",this.onMessage)},a.prototype.validateURL=function(t){return t&&typeof t=="string"&&/^data:([a-zA-Z0-9]+\/[a-zA-Z0-9]+);base64,.*/.test(t)?!0:!(t&&typeof t=="string"&&!/^(\.\/|\.\.\/|\/|(blob\:)?https?\:\/\/|\/\/)/.test(t))},a.prototype.onMessage=function(t){var r,s,n;return(0,e.mG)(this,void 0,void 0,function(){var o,v,f,C,w,c,b,p,g,y,h;return(0,e.Jh)(this,function(u){switch(u.label){case 0:return o=this.props,v=o.events,f=o.onEvent,C=o.onAction,w=o.data,typeof((r=t==null?void 0:t.data)===null||r===void 0?void 0:r.type)!="string"?[2]:(c=(0,e.CR)(t.data.type.split(":"),2),b=c[0],p=c[1],b!=="amis"||!p?[2]:p==="resize"&&t.data.data?(this.setState({width:t.data.data.width||"100%",height:t.data.data.height||"100%"}),[3,4]):[3,1]);case 1:return g=f==null?void 0:f[p],g&&(!((s=g.actions)===null||s===void 0)&&s.length)?(y=(0,i.ALw)(p,{env:(n=this.props)===null||n===void 0?void 0:n.env,nativeEvent:t,data:(0,i.nW9)(w,t.data.data),scoped:this.context}),[4,(0,i.X1x)(g.actions,this,y)]):[3,3];case 2:if(u.sent(),y.prevented)return[2];u.label=3;case 3:v&&(h=v[p],h&&C(t,h,(0,i.nW9)(w,t.data.data))),u.label=4;case 4:return[2]}})})},a.prototype.onLoad=function(){var t=this.props,r=t.src,s=t.data;r&&this.postMessage("init",s)},a.prototype.reload=function(t,r){if(r)return this.receive(r);var s=this.props,n=s.src,o=s.data;n&&(this.IFrameRef.current.src=(0,i.OgC)(n,o,"| raw"))},a.prototype.receive=function(t){var r=this.props,s=r.src,n=r.data,o=(0,i.nW9)(n,t);this.postMessage("receive",o),(0,i.rMT)(s,s,n,o)&&(this.IFrameRef.current.src=(0,i.OgC)(s,o,"| raw"))},a.prototype.postMessage=function(t,r){var s,n;(n=(s=this.IFrameRef.current)===null||s===void 0?void 0:s.contentWindow)===null||n===void 0||n.postMessage({type:"amis:".concat(t),data:JSON.parse(JSON.stringify(r))},"*")},a.prototype.render=function(){var t=this.state,r=t.width,s=t.height,n=this.props,o=n.className,v=n.src,f=n.name,C=n.frameBorder,w=n.data,c=n.style,b=n.allow,p=n.sandbox,g=n.referrerpolicy,y=n.translate,h=n.id,u=n.wrapperCustomStyle,F=n.env,I=n.themeCss,j=n.baseControlClassName,L=n.classnames,M={};r!==void 0&&(M.width=r),s!==void 0&&(M.height=s),c=(0,e.pi)((0,e.pi)({},M),c);var E=v?(0,i.OgC)(v,w,"| raw"):void 0;return this.validateURL(E)?(location.protocol==="https:"&&E&&E.startsWith("http://")&&F.notify("error",y("Iframe.invalidProtocol")),d().createElement(d().Fragment,null,d().createElement("iframe",{name:f,className:L("IFrame",o,(0,i.GwQ)((0,e.pi)((0,e.pi)({},this.props),{name:"baseControlClassName",id:h,themeCss:I})),(0,i.GwQ)((0,e.pi)((0,e.pi)({},this.props),{name:"wrapperCustomStyle",id:h,themeCss:u}))),frameBorder:C,style:c,ref:this.IFrameRef,onLoad:this.onLoad,src:E,allow:b,referrerPolicy:g,sandbox:p}),d().createElement(i.cWM,(0,e.pi)({},this.props,{config:{wrapperCustomStyle:u,id:h,themeCss:I,classNames:[{key:"baseControlClassName"}]},env:F})))):d().createElement("p",null,y("Iframe.invalid"))},a.propsList=["src","className"],a.defaultProps={className:"",frameBorder:0},(0,e.gn)([i.NjZ,(0,e.w6)("design:type",Function),(0,e.w6)("design:paramtypes",[MessageEvent]),(0,e.w6)("design:returntype",Promise)],a.prototype,"onMessage",null),(0,e.gn)([i.NjZ,(0,e.w6)("design:type",Function),(0,e.w6)("design:paramtypes",[]),(0,e.w6)("design:returntype",void 0)],a.prototype,"onLoad",null),(0,e.gn)([i.NjZ,(0,e.w6)("design:type",Function),(0,e.w6)("design:paramtypes",[Object,Object]),(0,e.w6)("design:returntype",void 0)],a.prototype,"reload",null),(0,e.gn)([i.NjZ,(0,e.w6)("design:type",Function),(0,e.w6)("design:paramtypes",[Object]),(0,e.w6)("design:returntype",void 0)],a.prototype,"receive",null),(0,e.gn)([i.NjZ,(0,e.w6)("design:type",Function),(0,e.w6)("design:paramtypes",[String,Object]),(0,e.w6)("design:returntype",void 0)],a.prototype,"postMessage",null),a}(d().Component),R=function(l){(0,e.ZT)(a,l);function a(t,r){var s=l.call(this,t)||this,n=r;return n.registerComponent(s),s}return a.prototype.componentWillUnmount=function(){var t=this.context;t.unRegisterComponent(this),l.prototype.componentWillUnmount.call(this)},a.contextType=i.ZHe,a=(0,e.gn)([(0,i.Thl)({type:"iframe"}),(0,e.w6)("design:paramtypes",[Object,Object])],a),a}(_)}}]);
