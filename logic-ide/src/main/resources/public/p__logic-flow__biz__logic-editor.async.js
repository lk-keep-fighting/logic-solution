"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[883],{60341:function(oe,R,t){t.d(R,{l:function(){return M.Z}});var M=t(93797)},2325:function(oe,R,t){t.d(R,{C:function(){return M}});var M=new Map,L=50,b=50;M.set("ExtSharp",{name:"ExtSharp",config:{width:100,height:b,attrs:{body:{rx:6,ry:6,stroke:"#5F95FF",strokeWidth:1,fill:"rgba(95,149,255,0.05)",refWidth:1,refHeight:1},image:{refX:2,refY:0},text:{refX:4,refY:20,fontSize:12,"text-anchor":"start"}},markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}})},44132:function(oe,R,t){var M=t(54306),L=t.n(M),b=t(70517),Q=t(90010),ae=t.n(Q),V=t(23620),$=t(2069),T=t(87363),ve=t.n(T),x=t(70256),se=t(33358),z=t(49500),k=t(16123),U=t(78057),I=t(69078),E=t(98896),N=t(33130),ue=function(W){var G=(0,T.useState)({type:"page"}),re=L()(G,2),H=re[0],le=re[1],j="cxd",l="zh-CN";return(0,T.useEffect)(function(){(0,E.m)(b.Z)},[]),(0,T.useEffect)(function(){W.pageId&&(0,x.UD)(W.pageId).then(function(s){le(s)})},[W.pageId]),(0,N.jsxs)("div",{children:[(0,N.jsx)($.qR,{theme:j,position:"top-right",locale:l},"toast"),(0,N.jsx)($.wx,{theme:j,locale:l},"alert"),(0,V.sYA)(H,{data:W.data},{fetcher:function(c){var d=c.url,g=c.method,f=c.data,Z=c.responseType,p=c.config,ce=c.headers;return p=p||{},p.withCredentials=!0,Z&&(p.responseType=Z),p.cancelExecutor&&(p.cancelToken=new b.Z.CancelToken(p.cancelExecutor)),p.headers=ce||{},p.headers.Authorization||(p.headers.Authorization="Bearer "+I.F.getTokenFormLocal()),g!=="post"&&g!=="put"&&g!=="patch"?(f&&(p.params=f),b.Z[g](d,p)):(f&&f instanceof FormData?(p.headers=p.headers||{},p.headers["Content-Type"]="multipart/form-data"):f&&typeof f!="string"&&!(f instanceof Blob)&&!(f instanceof ArrayBuffer)&&(f=JSON.stringify(f),p.headers=p.headers||{},p.headers["Content-Type"]="application/json"),b.Z[g](d,f,p))},isCancel:function(c){return b.Z.isCancel(c)},copy:function(c){ae()(c),$.Am.success("\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u7C98\u8D34\u677F")},theme:j,jumpTo:function(c,d){debugger;d.blank==!0?window.open(window.location.origin+window.location.pathname+"#"+c,"_blank"):window.location.hash=c}})]})};R.Z=ue},64435:function(oe,R,t){t.r(R),t.d(R,{default:function(){return ot}});var M=t(25359),L=t.n(M),b=t(93525),Q=t.n(b),ae=t(49811),V=t.n(ae),$=t(57213),T=t.n($),ve=t(54306),x=t.n(ve),se=t(60341),z=t(83217),k=t(72197),U=t(54145),I=t(51394),E=t(87363),N=t(98306),ue=t(5671),_=t(14990),W=t(22465),G=t(72237),re=t(93853),H=t(28110),le=t(58146);function j(){return l.apply(this,arguments)}function l(){return l=V()(L()().mark(function u(){return L()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(r,n){r((0,le.K)())}));case 1:case"end":return e.stop()}},u)})),l.apply(this,arguments)}var s=t(21140),c=t.n(s),d=t(63466),g=t.n(d),f=t(72107),Z=null;function p(u,a,e,r){var n,i,o=u.data.config,m=o.type,y=e.flatMap(function(A){return A.source.cell===u.id?a[A.target.cell]:[]}),P=u.attrs,C=new f.Du((n=u.id)!==null&&n!==void 0?n:"",m);if(C=T()(T()({},o),{},{id:u.id,name:P==null||(i=P.text)===null||i===void 0?void 0:i.text}),!(r.findIndex(function(A){return A.id===C.id})>-1)&&(r.push(C),y.length!==0))switch(m){default:if(y.length>1||C.type==="switch"){var O;console.log((O=u.data)===null||O===void 0?void 0:O.config),console.log(y),C.branches=[],y.forEach(function(A){var Y,ee,X,ie;console.log((Y=A.data)===null||Y===void 0?void 0:Y.config),(ee=C.branches)===null||ee===void 0||ee.push({when:(X=A.data)===null||X===void 0||(ie=X.config)===null||ie===void 0?void 0:ie.case,nextId:A.id}),p(a[A.id],a,e,r)})}else C.nextId=y[0].id,p(a[y[0].id],a,e,r);break}}function ce(u,a){var e=new f.Iz(u),r=[],n=[],i={},o=void 0;if(a.forEach(function(m){var y=m.id||"";if(m.shape==="edge")r.push(m);else{var P=m.attrs;i[y]=m,n.push(m),m.data.config.type==="start"&&(o=m)}}),!o){z.ZP.error("\u672A\u53D1\u73B0\u5F00\u59CB\u8282\u70B9\uFF0C\u8BF7\u914D\u7F6E\uFF01");return}return p(o,i,r,e.items),console.log("logic.items"),console.log(e.items),e}function F(u){var a=[];return u.items.forEach(function(e){var r={id:e.id,shape:e.type,size:{width:80,height:40},data:{config:e},attrs:{text:{text:e.name}}};if(a.push(r),e.branches&&e.branches.length>0)e.branches.forEach(function(i){var o={shape:"edge",source:{cell:e.id},target:{cell:i.nextId},labels:[{position:.5,attrs:{label:{text:i.when}}}]};a.push(o)});else if(e.nextId){var n={shape:"edge",source:{cell:e.id},target:{cell:e.nextId}};a.push(n)}}),a}var Ke=function(){function u(){c()(this,u)}return g()(u,[{key:"graphToLogicItems",value:function(e,r){var n=ce(r==null?void 0:r.id,e==null?void 0:e.getCells());return n.visualConfig=e==null?void 0:e.toJSON(),T()(T()({},r),{},{visualConfig:n.visualConfig,items:n.items})}}]),u}(),Ve=t(12490);function $e(u){var a=u.createNode({shape:"circle",label:"start",width:50,height:50,attrs:{body:{}},ports:Ve.Hi,data:{config:{type:"start"}}});u.addNode(a)}var Ce=t(2325),Pe=t(48364),ze=t(89147),Ue=t(3619),Te=t(94990),We=t(37635),Ge=t.n(We),He=t(52510),q=t.n(He),Ye=g()(function u(a){c()(this,u),q()(this,"concept","EnvParam"),q()(this,"name",void 0),q()(this,"description",void 0),q()(this,"typeAnnotation",void 0),q()(this,"required",!1),q()(this,"defaultValue",void 0),this.name=a}),B=function(){function u(){c()(this,u)}return g()(u,null,[{key:"valueToTypeAnnotaion",value:function(e){var r=this,n={concept:f.Ld.TypeAnnotation,typeKind:"primitive",typeName:"string",defaultValue:e};if(Array.isArray(e))n.typeName="array";else{var i=Ge()(e);switch(i){case"boolean":n.typeKind="primitive",n.typeName="boolean";break;case"number":n.typeKind="primitive",n.typeName="number";break;case"string":n.typeKind="primitive",n.typeName="string";break;case"object":e==null?n.typeName="null":e instanceof Date?(n.typeKind="primitive",n.typeName="date"):e instanceof RegExp?(n.typeKind="primitive",n.typeName="regexp"):e instanceof Function?(n.typeKind="primitive",n.typeName="function"):(n.typeKind="anonymousStructure",n.typeName="object",n.properties=[],Object.keys(e).map(function(o){var m,y=e[o],P=r.valueToTypeAnnotaion(y),C=new f.X0(o);C.typeAnnotation=P,C.defaultValue=y,(m=n.properties)===null||m===void 0||m.push(C)}));break;default:n.typeKind="unknown",n.typeName=i;break}}return n}},{key:"typeAnnotaionToValue",value:function(e){var r,n,i=this,o;switch(e.typeName){case"array":o=(r=e.defaultValue)!==null&&r!==void 0?r:[];break;case"boolean":o=e.defaultValue?e.defaultValue=="true":!1;break;case"number":o=parseFloat(e.defaultValue);break;case"null":o=null;break;case"date":o=new Date(e.defaultValue);break;case"regexp":o=new RegExp(e.defaultValue);break;case"object":o={},(n=e.properties)===null||n===void 0||n.forEach(function(m){o[m.name]=i.typeAnnotaionToValue(m.typeAnnotation)});break;case"string":case"function":default:o=e.defaultValue;break}return o}},{key:"getParamArrayByJson",value:function(e){var r=[];return e&&Object.keys(e).forEach(function(n){var i=new f.dO(n);i.typeAnnotation=u.valueToTypeAnnotaion(e[n]),i.defaultValue=e[n],r.push(i)}),r}},{key:"getReturnArrayByJson",value:function(e){var r=[];return e&&Object.keys(e).forEach(function(n){var i=new f.z1(n);i.typeAnnotation=u.valueToTypeAnnotaion(e[n]),i.defaultValue=e[n],r.push(i)}),r}},{key:"getVariableArrayByJson",value:function(e){var r=[];return e&&Object.keys(e).forEach(function(n){var i=new f._w(n);i.typeAnnotation=u.valueToTypeAnnotaion(e[n]),i.defaultValue=e[n],r.push(i)}),r}},{key:"getEnvsArrayByJson",value:function(e){var r=[];return e&&Object.keys(e).forEach(function(n){var i=new Ye(n);i.typeAnnotation=u.valueToTypeAnnotaion(e[n]),i.defaultValue=e[n],r.push(i)}),r}},{key:"getJsonByParams",value:function(e){var r=this,n={};return e==null||e.forEach(function(i){n[i.name]=i.typeAnnotation?r.typeAnnotaionToValue(i.typeAnnotation):i.defaultValue}),n}}]),u}(),h=t(33130),Xe=function(a){var e,r=(0,E.useState)({}),n=x()(r,2),i=n[0],o=n[1];(0,E.useEffect)(function(){var y=a.values,P=y.params,C=y.variables,O=y.envs,A=y.returns;o({params:JSON.stringify(B.getJsonByParams(P)),variables:JSON.stringify(B.getJsonByParams(C)),returns:JSON.stringify(B.getJsonByParams(A)),envs:JSON.stringify(B.getJsonByParams(O))})},[a.values]);var m=(0,E.useCallback)(function(y){try{return JSON.parse(y),!0}catch(P){return!1}},[]);return(0,h.jsxs)("span",{children:[a.children,(0,h.jsx)(I.Z,{open:(e=a.open)!==null&&e!==void 0?e:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return a==null?void 0:a.setOpen(!1)},children:(0,h.jsx)(Te.Z,{formId:"logic-setting",values:i,onSubmit:function(P){console.log("\u63D0\u4EA4\u53C2\u6570"),console.log(P);var C=!1;Object.keys(P).forEach(function(O){var A=P[O];if(!m(A)){var Y=O==="params"?"\u5165\u53C2":O==="variables"?"\u5C40\u90E8\u53D8\u91CF":O==="returns"?"\u8FD4\u56DE\u53C2\u6570":"\u73AF\u5883\u53D8\u91CF";return z.ZP.error("".concat(Y,"json\u683C\u5F0F\u9519\u8BEF")),C=!0,!1}}),C||(a!=null&&a.onSubmit&&a.onSubmit(P),a==null||a.setOpen(!1))}})})]})},Qe=Xe,ke=t(5726),_e=t.n(ke),qe=t(11455),et=function(a){var e,r=(0,qe.cI)();(0,E.useEffect)(function(){var o=a.values.params;r.setValues({params:JSON.stringify(B.getJsonByParams(o))})},[a.values]);var n=(0,E.useCallback)(function(o){try{return JSON.parse(o),!0}catch(m){return!1}},[]);function i(o){var m=!1;Object.keys(o).forEach(function(y){var P=o[y];if(["params","headers"].indexOf(y)>-1&&!n(P)){var C=y==="params"?"\u5165\u53C2":"\u8BF7\u6C42\u5934";return z.ZP.error("".concat(C,"json\u683C\u5F0F\u9519\u8BEF")),m=!0,!1}}),m||(a!=null&&a.onSubmit&&a.onSubmit(o,o.debugType),a==null||a.setOpen(!1))}return(0,h.jsxs)("span",{children:[a.children,(0,h.jsx)(I.Z,{open:(e=a.open)!==null&&e!==void 0?e:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return a==null?void 0:a.setOpen(!1)},children:(0,h.jsx)(Te.Z,{formId:"logic-debug-input",onSubmit:i})})]})},tt=et,nt=t(61719),xe=t(44132),at=t(70517);function rt(){return ge.apply(this,arguments)}function ge(){return ge=V()(L()().mark(function u(){return L()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",at.Z.get("/api/runtime/env").then(function(r){return r.data.data}));case 1:case"end":return e.stop()}},u)})),ge.apply(this,arguments)}var it=function(){var a=(0,E.useState)({}),e=x()(a,2),r=e[0],n=e[1],i=(0,E.useState)({}),o=x()(i,2),m=o[0],y=o[1],P=(0,E.useState)({}),C=x()(P,2),O=C[0],A=C[1],Y=(0,E.useState)(!0),ee=x()(Y,2),X=ee[0],ie=ee[1],st=(0,E.useState)(!1),Ae=x()(st,2),ut=Ae[0],te=Ae[1],lt=(0,E.useState)("1"),Oe=x()(lt,2),pe=Oe[0],xt=Oe[1],ct=(0,E.useState)(),De=x()(ct,2),Le=De[0],dt=De[1],ft=(0,E.useState)([]),be=x()(ft,2),vt=be[0],gt=be[1],pt=(0,E.useState)(!1),Ie=x()(pt,2),Be=Ie[0],Je=Ie[1],ht=(0,E.useState)(!1),Re=x()(ht,2),Me=Re[0],he=Re[1],mt=(0,E.useState)(new Map),Fe=x()(mt,2),de=Fe[0],Ne=Fe[1],yt=(0,N.UO)(),fe=yt.id,St=new Ke;function je(){te(!0);var v=St.graphToLogicItems(Le,r);v.version=Ze(),n(v),we(v)}function Ze(){return _e()(Date.now()).format("YYYYMMDDHHmmss")}function we(v){(0,Pe.az)(fe,v.version,JSON.stringify(v)).then(function(S){te(!1),z.ZP.success("\u4FDD\u5B58\u6210\u529F"),console.log("save logic"),console.log(v)}).catch(function(S){te(!1),console.log("err"),console.log(S),z.ZP.error("\u4FDD\u5B58\u5931\u8D25")})}(0,E.useEffect)(function(){y({jsTips:T()({},de)})},[de]);function Et(v){var S,D,w,ne,J={};J._par=v.params,J._var=v.variables,Ne(T()(T()({},de),J));var ye=B.getParamArrayByJson(JSON.parse((S=v.params)!==null&&S!==void 0?S:"{}")),K=B.getReturnArrayByJson(JSON.parse((D=v.returns)!==null&&D!==void 0?D:"{}")),Se=B.getVariableArrayByJson(JSON.parse((w=v.variables)!==null&&w!==void 0?w:"{}")),Tt=B.getEnvsArrayByJson(JSON.parse((ne=v.envs)!==null&&ne!==void 0?ne:"{}")),Ee=T()(T()({},r),{},{params:ye,returns:K,variables:Se,envs:Tt});Ee.version=Ze(),n(Ee),we(Ee)}function Ct(v){return me.apply(this,arguments)}function me(){return me=V()(L()().mark(function v(S){var D,w;return L()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return D={},D._par=JSON.stringify(B.getJsonByParams(S.params)),D._var=JSON.stringify(B.getJsonByParams(S.variables)),J.next=5,rt();case 5:w=J.sent,D._env=JSON.stringify(w),D._lastRet="{}",Ne(D),te(!1);case 10:case"end":return J.stop()}},v)})),me.apply(this,arguments)}(0,E.useEffect)(function(){(0,ze.m)([Ce.C.get("ExtSharp")]),te(!0),(0,Pe.YH)(fe).then(function(v){var S=v;S.id=fe,n(S),A(S==null?void 0:S.visualConfig),Ct(S)}).catch(function(v){te(!1),console.log("err"),console.log(v)}),j().then(function(v){gt(v.Nodes)})},[]);var Pt=(0,E.useCallback)(function(){return new ue.bn.kS({attrs:{line:{targetMarker:"classic",stroke:pe=="1"?"#000000":"#FF9900"}},zIndex:0,data:{type:pe}})},[pe]);return(0,h.jsx)("div",{children:(0,h.jsx)(k.Z,{spinning:ut,children:(0,h.jsx)(se.l,{editorCtx:m,panelData:{Nodes:Q()(vt),Shapes:[Ce.C.get("ExtSharp")],Groups:[{name:"global",title:"\u5168\u5C40\u8282\u70B9",graphHeight:110},{name:"ctrl",title:"\u903B\u8F91\u63A7\u5236",graphHeight:220},{name:"biz",title:"\u4E1A\u52A1\u8C03\u7528",graphHeight:220}]},showLeft:X,graphIns:Le,toolElements:[(0,h.jsx)(U.ZP,{type:"text",icon:X?(0,h.jsx)(_.Z,{}):(0,h.jsx)(W.Z,{}),onClick:function(){ie(!X)},style:{fontSize:"16px",width:64,height:64}}),(0,h.jsx)(U.ZP,{icon:(0,h.jsx)(G.Z,{}),type:"primary",onClick:function(){return je()},children:"\u4FDD\u5B58"}),(0,h.jsx)(Qe,{open:Be,values:T()({},r),setOpen:function(){Je(!Be)},onSubmit:Et,children:(0,h.jsx)(U.ZP,{onClick:function(){return Je(!0)},icon:(0,h.jsx)(re.Z,{}),children:"\u914D\u7F6E\u53C2\u6570"})}),(0,h.jsx)(tt,{open:Me,setOpen:function(){return he(!Me)},values:{params:r==null?void 0:r.params},onSubmit:function(S,D){if(he(!1),r){var w=S.params,ne=S.bizId,J=S.headers,ye=S.bizStartCode;(0,nt.L7)(fe,JSON.parse(w),ne,ye,D,JSON.parse(J)).then(function(K){K.data.code==0?I.Z.success({title:"\u6267\u884C\u6210\u529F",width:"1000px",closable:!0,content:(0,h.jsx)("div",{children:(0,h.jsx)(xe.Z,{pageId:"debug-info",data:K.data})})}):I.Z.error({title:(0,h.jsx)("span",{children:K.data.msg}),width:"1200px",closable:!0,content:(0,h.jsx)("div",{children:(0,h.jsx)(xe.Z,{pageId:"debug-info",data:K.data})})})}).catch(function(K){var Se=K.response.data;I.Z.error({title:(0,h.jsx)("span",{children:Se.msg}),width:"1200px",closable:!0})})}},children:(0,h.jsx)(U.ZP,{type:"default",onClick:function(){he(!0)},icon:(0,h.jsx)(H.Z,{}),children:"\u8C03\u8BD5"})}),(0,h.jsxs)("span",{children:["\u5F53\u524D\u7248\u672C:",r.version]})],graphJson:O,onGraphJsonEmpty:$e,createEdge:Pt,edgeTools:["button-remove","vertices","segments"],onSave:function(){return je()},jsTipMap:de,autoLayout:function(S){return(0,Ue.V)(S)},onGraphInsChange:function(S){return dt(S)}})})})},ot=it},61719:function(oe,R,t){t.d(R,{L7:function(){return U}});var M=t(57213),L=t.n(M),b=t(25359),Q=t.n(b),ae=t(49811),V=t.n(ae),$=t(70517);function T(l,s){return axios.get(l,s)}function ve(l,s,c){return axios.put(l,s,c)}function x(l,s){return axios.delete(l,s)}function se(l,s,c){return $.Z.post(l,s,c)}function z(l,s){return k.apply(this,arguments)}function k(){return k=_asyncToGenerator(_regeneratorRuntime().mark(function l(s,c){return _regeneratorRuntime().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",post("/api/runtime/logic/v1/run-fn/".concat(s),c,{headers:{"Content-Type":"application/json"}}));case 1:case"end":return g.stop()}},l)})),k.apply(this,arguments)}function U(l,s,c,d,g,f){return I.apply(this,arguments)}function I(){return I=V()(Q()().mark(function l(s,c,d,g,f,Z){var p;return Q()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:p="",F.t0=f,F.next=F.t0==="biz"?4:6;break;case 4:return g?p="/api/runtime/logic/v1/biz/".concat(s,"/").concat(g,"/").concat(d,"?debug=true"):p="/api/runtime/logic/v1/run-biz/".concat(s,"/").concat(d,"?debug=true"),F.abrupt("break",8);case 6:return p="/api/runtime/logic/v1/run-api/".concat(s,"?debug=true"),F.abrupt("break",8);case 8:return F.abrupt("return",se(p,c,{headers:L()({"Content-Type":"application/json"},Z)}));case 9:case"end":return F.stop()}},l)})),I.apply(this,arguments)}function E(l,s){return N.apply(this,arguments)}function N(){return N=_asyncToGenerator(_regeneratorRuntime().mark(function l(s,c){return _regeneratorRuntime().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",axios.post("/api/form/logic_instance/query",{filters:[{dataIndex:"logicId",values:[s],type:"="},{dataIndex:"bizId",values:[c],type:"="}]}).then(function(f){var Z=f.data.result.items[0];return Z}));case 1:case"end":return g.stop()}},l)})),N.apply(this,arguments)}function ue(l){return _.apply(this,arguments)}function _(){return _=_asyncToGenerator(_regeneratorRuntime().mark(function l(s){return _regeneratorRuntime().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",axios.get("/api/ide/logic-instance/".concat(s)).then(function(g){var f=g.data.data;return f}));case 1:case"end":return d.stop()}},l)})),_.apply(this,arguments)}function W(l){return G.apply(this,arguments)}function G(){return G=_asyncToGenerator(_regeneratorRuntime().mark(function l(s){return _regeneratorRuntime().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",axios.post("/api/form/logic/add",s).then(function(g){var f=g.data.result;return f}));case 1:case"end":return d.stop()}},l)})),G.apply(this,arguments)}function re(l){return H.apply(this,arguments)}function H(){return H=_asyncToGenerator(_regeneratorRuntime().mark(function l(s){return _regeneratorRuntime().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",axios.delete("/api/form/logic/delete/".concat(s)).then(function(g){return g.data.result}));case 1:case"end":return d.stop()}},l)})),H.apply(this,arguments)}function le(){return j.apply(this,arguments)}function j(){return j=_asyncToGenerator(_regeneratorRuntime().mark(function l(){var s,c,d=arguments;return _regeneratorRuntime().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=d.length>0&&d[0]!==void 0?d[0]:1,c=d.length>1&&d[1]!==void 0?d[1]:10,f.abrupt("return",axios.post("/api/form/logic/query",{page:s,pageSize:c}).then(function(Z){return Z.data}));case 3:case"end":return f.stop()}},l)})),j.apply(this,arguments)}}}]);
