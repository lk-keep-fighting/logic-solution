"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[883],{60341:function(le,F,t){t.d(F,{l:function(){return I.Z}});var I=t(93797)},72107:function(le,F,t){t.d(F,{Ld:function(){return I},Iz:function(){return E},Du:function(){return K},dO:function(){return q},z1:function(){return se},X0:function(){return Q},_w:function(){return H}});var I=function(l){return l.TypeAnnotation="TypeAnnotation",l.Structure="Structure",l.StructureProperty="StructureProperty",l.TypeParam="TypeParam",l.Variable="Variable",l.Logic="Logic",l.LogicItem="LogicItem",l}({}),b=function(l){return l.start="start",l.end="end",l.switch="switch",l["switch-case"]="switch-case",l["switch-def"]="switch-def",l["mqtt-pub"]="mqtt-pub",l["mqtt-sub"]="mqtt-sub",l["mqtt-unsub"]="mqtt-unsub",l["mqtt-client"]="mqtt-client",l["mqtt-server"]="mqtt-server",l["mqtt-broker"]="mqtt-broker",l.http="http",l.logic="logic",l.js="js",l.wait="wait",l}({}),R=t(63466),D=t.n(R),N=t(21140),_=t.n(N),Z=t(52510),i=t.n(Z),Q=D()(function l(O){_()(this,l),i()(this,"concept",void 0),i()(this,"name",void 0),i()(this,"label",void 0),i()(this,"description",void 0),i()(this,"typeAnnotation",void 0),i()(this,"required",!1),i()(this,"defaultValue",void 0),this.concept=I.StructureProperty,this.name=O}),E=D()(function l(O){_()(this,l),i()(this,"concept",I.Logic),i()(this,"schemeVersion",void 0),i()(this,"version",void 0),i()(this,"id",void 0),i()(this,"name",void 0),i()(this,"label",void 0),i()(this,"description",void 0),i()(this,"triggerType",void 0),i()(this,"log",void 0),i()(this,"cron",void 0),i()(this,"typeParams",void 0),i()(this,"params",void 0),i()(this,"returns",void 0),i()(this,"variables",void 0),i()(this,"envs",void 0),i()(this,"items",[]),i()(this,"visualConfig",void 0),this.id=O,this.schemeVersion="0.1"}),K=D()(function l(O,C){var V=this;_()(this,l),i()(this,"concept","LogicItem"),i()(this,"id",void 0),i()(this,"name",void 0),i()(this,"type",void 0),i()(this,"label",void 0),i()(this,"description",void 0),i()(this,"params",void 0),i()(this,"returns",void 0),i()(this,"envs",void 0),i()(this,"afterReturnAdaptor",void 0),i()(this,"returnAccept",void 0),i()(this,"nextId",void 0),i()(this,"endId",void 0),i()(this,"condition",void 0),i()(this,"script",void 0),i()(this,"timeout",void 0),i()(this,"branches",void 0),i()(this,"url",void 0),i()(this,"method",void 0),i()(this,"headers",void 0),i()(this,"queryParams",void 0),i()(this,"tranScope",void 0),i()(this,"body",void 0),i()(this,"setEnv",function(L){V.envs=L}),this.type=C,this.id=O}),P=null,q=D()(function l(O){_()(this,l),i()(this,"concept","Param"),i()(this,"name",void 0),i()(this,"description",void 0),i()(this,"typeAnnotation",void 0),i()(this,"required",void 0),i()(this,"defaultValue",void 0),this.name=O}),G=t(58853),U=t.n(G),ee=t(38888),p=t.n(ee),se=function(l){U()(C,l);var O=p()(C);function C(V){var L;return _()(this,C),L=O.call(this,V),L.concept="Return",L}return D()(C)}(q),H=function(l){U()(C,l);var O=p()(C);function C(V){var L;return _()(this,C),L=O.call(this,V),L.concept="Variable",L}return D()(C)}(q)},44132:function(le,F,t){var I=t(54306),b=t.n(I),R=t(70517),D=t(90010),N=t.n(D),_=t(23620),Z=t(2069),i=t(87363),Q=t.n(i),E=t(70256),K=t(33358),P=t(49500),q=t(16123),G=t(78057),U=t(69078),ee=t(98896),p=t(32126),se=t(31837),H=t(33130),l=function(C){var V=(0,i.useState)({type:"page"}),L=b()(V,2),ge=L[0],pe=L[1],me=(0,i.useState)(),W=b()(me,2),ye=W[0],Se=W[1],Pe=(0,i.useState)(),ce=b()(Pe,2),je=ce[0],de=ce[1],oe="cxd",te="zh-CN";return(0,i.useEffect)(function(){(0,ee.m)(R.Z)},[]),(0,i.useEffect)(function(){C.pageId&&((0,E.UD)(C.pageId).then(function(z){pe(z)}),(0,p.U)().then(function(z){Se(JSON.parse(se.j.getEnv()))}))},[C.pageId]),(0,H.jsxs)("div",{children:[(0,H.jsx)(Z.qR,{theme:oe,position:"top-right",locale:te},"toast"),(0,H.jsx)(Z.wx,{theme:oe,locale:te},"alert"),(0,_.sYA)(ge,{data:{envs:ye}},{fetcher:function(x){var M=x.url,ne=x.method,T=x.data,ve=x.responseType,S=x.config,Ee=x.headers;return S=S||{},S.withCredentials=!0,ve&&(S.responseType=ve),S.cancelExecutor&&(S.cancelToken=new R.Z.CancelToken(S.cancelExecutor)),S.headers=Ee||{},S.headers.Authorization||(S.headers.Authorization="Bearer "+U.F.getTokenFormLocal()),ne!=="post"&&ne!=="put"&&ne!=="patch"?(T&&(S.params=T),R.Z[ne](M,S)):(T&&T instanceof FormData?(S.headers=S.headers||{},S.headers["Content-Type"]="multipart/form-data"):T&&typeof T!="string"&&!(T instanceof Blob)&&!(T instanceof ArrayBuffer)&&(T=JSON.stringify(T),S.headers=S.headers||{},S.headers["Content-Type"]="application/json"),R.Z[ne](M,T,S))},isCancel:function(x){return R.Z.isCancel(x)},copy:function(x){N()(x),Z.Am.success("\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u7C98\u8D34\u677F")},theme:oe,jumpTo:function(x,M){debugger;M.blank==!0?window.open(window.location.origin+window.location.pathname+"#"+x,"_blank"):window.location.hash=x}})]})};F.Z=l},8499:function(le,F,t){t.r(F),t.d(F,{default:function(){return xt}});var I=t(25359),b=t.n(I),R=t(93525),D=t.n(R),N=t(49811),_=t.n(N),Z=t(57213),i=t.n(Z),Q=t(54306),E=t.n(Q),K=t(60341),P=t(83217),q=t(72197),G=t(54145),U=t(51394),ee=t(36267),p=t(87363),se=t(98306),H=t(5671),l=t(14990),O=t(22465),C=t(72237),V=t(93853),L=t(28110),ge=t(49228),pe=t(70517),me=t(9364),W=t(12490),ye=t(42651),Se={buildGroup:function(r,n,e,a){var s=Number.parseInt(n/2),u=n%2==0;return{name:r,title:e,graphHeight:(u?s:s+1)*(a||70)+10}}},Pe=Se;function ce(o){return o.length>7?"".concat(o.substring(0,7),`\r
`).concat(o.substring(7)):o}function je(){return de.apply(this,arguments)}function de(){return de=_()(b()().mark(function o(){var r;return b()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],e.abrupt("return",Promise.all([(0,me.K)(),pe.Z.get("/api/ide/asset/v1/logic-item/readFromCode")]).then(function(a){if(console.log("getPanelData"),a[1].status==200){var s=a[1].data.data;Object.keys(s).forEach(function(u,d){var f=Pe.buildGroup(u,s[u].length,u);r.push(f),s[u].sort(function(v,g){return v.order?v.order.localeCompare(g.order):1}).forEach(function(v){a[0].Nodes.push(new ye.Z({shape:v.shape?v.shape:"ExtShape"+(d%3==0?"1":d%3==1?"2":"3"),ports:W.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/logic/icons/java.svg"},text:{text:ce(v.name),fontSize:12}},data:{config:v.logicItem},_groups:[v.group]}))})})}return{Nodes:a[0].Nodes,Groups:r}}));case 2:case"end":return e.stop()}},o)})),de.apply(this,arguments)}var oe=t(21140),te=t.n(oe),z=t(63466),x=t.n(z),M=t(72107),ne=null;function T(o,r,n,e){var a,s,u=o.data.config,d=u.type,f=n.flatMap(function(A){return A.source.cell===o.id?r[A.target.cell]:[]}),v=o.attrs,g=new M.Du((a=o.id)!==null&&a!==void 0?a:"",d);if(g=i()(i()({},u),{},{id:o.id,name:v==null||(s=v.text)===null||s===void 0?void 0:s.text}),!(e.findIndex(function(A){return A.id===g.id})>-1)&&(e.push(g),f.length!==0))switch(d){default:if(f.length>1||g.type==="switch"){var B;console.log((B=o.data)===null||B===void 0?void 0:B.config),console.log(f),g.branches=[],f.forEach(function(A){var $,re,k,ue;console.log(($=A.data)===null||$===void 0?void 0:$.config),(re=g.branches)===null||re===void 0||re.push({when:(k=A.data)===null||k===void 0||(ue=k.config)===null||ue===void 0?void 0:ue.case,nextId:A.id}),T(r[A.id],r,n,e)})}else g.nextId=f[0].id,T(r[f[0].id],r,n,e);break}}function ve(o,r){var n=new M.Iz(o),e=[],a=[],s={},u=void 0;if(r.forEach(function(d){var f=d.id||"";if(d.shape==="edge")e.push(d);else{var v=d.attrs;s[f]=d,a.push(d),d.data.config.type==="start"&&(u=d)}}),!u){P.ZP.error("\u672A\u53D1\u73B0\u5F00\u59CB\u8282\u70B9\uFF0C\u8BF7\u914D\u7F6E\uFF01");return}return T(u,s,e,n.items),console.log("logic.items"),console.log(n.items),n}function S(o){var r=[],n=[];return o.items.forEach(function(e){var a={id:e.id,shape:e.type,size:{width:80,height:40},data:{config:e},attrs:{text:{text:e.name}}};if(r.push(a),e.branches&&e.branches.length>0)e.branches.forEach(function(u){var d={shape:"edge",source:{cell:e.id},target:{cell:u.nextId},labels:[{position:.5,attrs:{label:{text:u.when}}}]};n.push(d)});else if(e.nextId){var s={shape:"edge",source:{cell:e.id},target:{cell:e.nextId}};n.push(s)}}),{nodes:r,edges:n}}var Ee=function(){function o(){te()(this,o)}return x()(o,[{key:"graphToLogicItems",value:function(n,e){var a=ve(e==null?void 0:e.id,n==null?void 0:n.getCells());return a.visualConfig=n==null?void 0:n.toJSON(),i()(i()({},e),{},{visualConfig:a.visualConfig,items:a.items})}},{key:"logicToGraphJson",value:function(n){var e=S(n);return e}}]),o}(),at=50,Je=50,rt={body:{}},Wt={"wati-for-continu":{shape:"circle",ports:W.Tt,width:at,height:Je,attrs:{body:i()(i()({},rt.body),{},{fill:"white"}),text:{text:"\u4EA4\u4E92\u70B9"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],data:{config:{type:"wait-for-continue"}}},js:{shape:"ExtSharp",ports:W.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/logic/icons/code.svg"},text:{text:"js\u811A\u672C",fontSize:14}},data:{config:{type:"js"}}},java:{shape:"ExtSharp",ports:W.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/logic/icons/java.svg"},text:{text:"java\u65B9\u6CD5",fontSize:14}},data:{config:{type:"java"}}},switch:{shape:"ExtSharp",width:50,height:Je,ports:W.Tt,label:"switch",attrs:{image:{"xlink:href":"/logic/icons/switch.svg",width:45,x:1,y:2},text:{text:"switch",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}}}};function it(o){var r=o.createNode({shape:"circle",label:"start",width:50,height:50,attrs:{body:{}},ports:W.Hi,data:{config:{type:"start"}}});o.addNode(r)}function Gt(o,r){var n=LogicItemSharpMapping[r.type];if(n){n.data={config:r};var e=o.createNode(n);e.setAttrByPath("text/text",r.name),o.addNode(e)}}var st=t(2325),Fe=t(48364),ot=t(44095),Ne=t(3619),Ue=t(94990),ut=t(37635),lt=t.n(ut),ct=t(52510),ae=t.n(ct),dt=x()(function o(r){te()(this,o),ae()(this,"concept","EnvParam"),ae()(this,"name",void 0),ae()(this,"description",void 0),ae()(this,"typeAnnotation",void 0),ae()(this,"required",!1),ae()(this,"defaultValue",void 0),this.name=r}),j=function(){function o(){te()(this,o)}return x()(o,null,[{key:"valueToTypeAnnotaion",value:function(n){var e=this,a={concept:M.Ld.TypeAnnotation,typeKind:"primitive",typeName:"string",defaultValue:n};if(Array.isArray(n))a.typeName="array";else{var s=lt()(n);switch(s){case"boolean":a.typeKind="primitive",a.typeName="boolean";break;case"number":a.typeKind="primitive",a.typeName="number";break;case"string":a.typeKind="primitive",a.typeName="string";break;case"object":n==null?a.typeName="null":n instanceof Date?(a.typeKind="primitive",a.typeName="date"):n instanceof RegExp?(a.typeKind="primitive",a.typeName="regexp"):n instanceof Function?(a.typeKind="primitive",a.typeName="function"):(a.typeKind="anonymousStructure",a.typeName="object",a.properties=[],Object.keys(n).map(function(u){var d,f=n[u],v=e.valueToTypeAnnotaion(f),g=new M.X0(u);g.typeAnnotation=v,g.defaultValue=f,(d=a.properties)===null||d===void 0||d.push(g)}));break;default:a.typeKind="unknown",a.typeName=s;break}}return a}},{key:"typeAnnotaionToValue",value:function(n){var e,a,s=this,u;switch(n.typeName){case"array":u=(e=n.defaultValue)!==null&&e!==void 0?e:[];break;case"boolean":u=n.defaultValue?n.defaultValue=="true":!1;break;case"number":u=parseFloat(n.defaultValue);break;case"null":u=null;break;case"date":u=new Date(n.defaultValue);break;case"regexp":u=new RegExp(n.defaultValue);break;case"object":u={},(a=n.properties)===null||a===void 0||a.forEach(function(d){u[d.name]=s.typeAnnotaionToValue(d.typeAnnotation)});break;case"string":case"function":default:u=n.defaultValue;break}return u}},{key:"getParamArrayByJson",value:function(n){var e=[];return n&&Object.keys(n).forEach(function(a){var s=new M.dO(a);s.typeAnnotation=o.valueToTypeAnnotaion(n[a]),s.defaultValue=n[a],e.push(s)}),e}},{key:"getReturnArrayByJson",value:function(n){var e=[];return n&&Object.keys(n).forEach(function(a){var s=new M.z1(a);s.typeAnnotation=o.valueToTypeAnnotaion(n[a]),s.defaultValue=n[a],e.push(s)}),e}},{key:"getVariableArrayByJson",value:function(n){var e=[];return n&&Object.keys(n).forEach(function(a){var s=new M._w(a);s.typeAnnotation=o.valueToTypeAnnotaion(n[a]),s.defaultValue=n[a],e.push(s)}),e}},{key:"getEnvsArrayByJson",value:function(n){var e=[];return n&&Object.keys(n).forEach(function(a){var s=new dt(a);s.typeAnnotation=o.valueToTypeAnnotaion(n[a]),s.defaultValue=n[a],e.push(s)}),e}},{key:"getJsonByParams",value:function(n){var e=this,a={};return n==null||n.forEach(function(s){a[s.name]=s.typeAnnotation?e.typeAnnotaionToValue(s.typeAnnotation):s.defaultValue}),a}}]),o}(),h=t(33130),vt=function(r){var n,e=(0,p.useState)({}),a=E()(e,2),s=a[0],u=a[1];(0,p.useEffect)(function(){var f=r.values,v=f.params,g=f.variables,B=f.envs,A=f.returns,$=f.log;u({params:JSON.stringify(j.getJsonByParams(v)),variables:JSON.stringify(j.getJsonByParams(g)),returns:JSON.stringify(j.getJsonByParams(A)),envs:JSON.stringify(j.getJsonByParams(B)),log:$})},[r.values]);var d=(0,p.useCallback)(function(f){try{return JSON.parse(f),!0}catch(v){return!1}},[]);return(0,h.jsxs)("span",{children:[r.children,(0,h.jsx)(U.Z,{open:(n=r.open)!==null&&n!==void 0?n:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return r==null?void 0:r.setOpen(!1)},children:(0,h.jsx)(Ue.Z,{formId:"logic-setting",values:s,onSubmit:function(v){console.log("\u63D0\u4EA4\u53C2\u6570"),console.log(v);var g=!1;Object.keys(v).forEach(function(B){var A=v[B];if(!d(A)){var $=B==="params"?"\u5165\u53C2":B==="variables"?"\u5C40\u90E8\u53D8\u91CF":B==="returns"?"\u8FD4\u56DE\u53C2\u6570":"\u73AF\u5883\u53D8\u91CF";switch(B){case"params":return P.ZP.error("\u5165\u53C2json\u683C\u5F0F\u9519\u8BEF"),g=!0,!1;break;case"variables":return P.ZP.error("\u5C40\u90E8\u53D8\u91CFjson\u683C\u5F0F\u9519\u8BEF"),g=!0,!1;break;case"returns":return P.ZP.error("\u8FD4\u56DE\u53C2\u6570json\u683C\u5F0F\u9519\u8BEF"),g=!0,!1;break;case"ens":return P.ZP.error("\u73AF\u5883\u53D8\u91CFjson\u683C\u5F0F\u9519\u8BEF"),g=!0,!1;break;default:break}}}),g||(r!=null&&r.onSubmit&&r.onSubmit(v),r==null||r.setOpen(!1))}})})]})},ft=vt,ht=t(5726),gt=t.n(ht),pt=t(73529),mt=function(r){var n,e=(0,pt.cI)();(0,p.useEffect)(function(){var u=r.values.params;e.setValues({params:JSON.stringify(j.getJsonByParams(u))})},[r.values]);var a=(0,p.useCallback)(function(u){try{return JSON.parse(u),!0}catch(d){return!1}},[]);function s(u){var d=!1;Object.keys(u).forEach(function(f){var v=u[f];if(["params","headers"].indexOf(f)>-1&&!a(v)){var g=f==="params"?"\u5165\u53C2":"\u8BF7\u6C42\u5934";return P.ZP.error("".concat(g,"json\u683C\u5F0F\u9519\u8BEF")),d=!0,!1}}),d||(r!=null&&r.onSubmit&&r.onSubmit(u,u.debugType),r==null||r.setOpen(!1))}return(0,h.jsxs)("span",{children:[r.children,(0,h.jsx)(U.Z,{open:(n=r.open)!==null&&n!==void 0?n:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return r==null?void 0:r.setOpen(!1)},children:(0,h.jsx)(Ue.Z,{formId:"logic-debug-input",onSubmit:s})})]})},yt=mt,St=t(57475);function Pt(o,r,n,e,a,s){return Ce.apply(this,arguments)}function Ce(){return Ce=_()(b()().mark(function o(r,n,e,a,s,u){var d;return b()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:d="",v.t0=s,v.next=v.t0==="biz"?4:6;break;case 4:return a?d="/api/runtime/logic/v1/biz/".concat(r,"/").concat(a,"/").concat(e,"?debug=true"):d="/api/runtime/logic/v1/run-biz/".concat(r,"/").concat(e,"?debug=true"),v.abrupt("break",8);case 6:return d="/api/runtime/logic/v1/run-api/".concat(r,"?debug=true"),v.abrupt("break",8);case 8:return v.abrupt("return",(0,St.v_)(d,n,{headers:i()({"Content-Type":"application/json"},u)}));case 9:case"end":return v.stop()}},o)})),Ce.apply(this,arguments)}function zt(o,r){return xe.apply(this,arguments)}function xe(){return xe=_asyncToGenerator(_regeneratorRuntime().mark(function o(r,n){return _regeneratorRuntime().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",post("/api/form/logic_instance/query",{filters:[{dataIndex:"logicId",values:[r],type:"="},{dataIndex:"bizId",values:[n],type:"="}]}).then(function(s){var u=s.data.result.items[0];return u}));case 1:case"end":return a.stop()}},o)})),xe.apply(this,arguments)}function $t(o){return Te.apply(this,arguments)}function Te(){return Te=_asyncToGenerator(_regeneratorRuntime().mark(function o(r){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",get("/api/ide/logic-instance/".concat(r)).then(function(a){var s=a.data.data;return s}));case 1:case"end":return e.stop()}},o)})),Te.apply(this,arguments)}function Yt(o){return Ae.apply(this,arguments)}function Ae(){return Ae=_asyncToGenerator(_regeneratorRuntime().mark(function o(r){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",post("/api/form/logic/add",r).then(function(a){var s=a.data.result;return s}));case 1:case"end":return e.stop()}},o)})),Ae.apply(this,arguments)}function Xt(o){return be.apply(this,arguments)}function be(){return be=_asyncToGenerator(_regeneratorRuntime().mark(function o(r){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",del("/api/form/logic/delete/".concat(r)).then(function(a){return a.data.result}));case 1:case"end":return e.stop()}},o)})),be.apply(this,arguments)}function Ht(){return De.apply(this,arguments)}function De(){return De=_asyncToGenerator(_regeneratorRuntime().mark(function o(){var r,n,e=arguments;return _regeneratorRuntime().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return r=e.length>0&&e[0]!==void 0?e[0]:1,n=e.length>1&&e[1]!==void 0?e[1]:10,s.abrupt("return",post("/api/form/logic/query",{page:r,pageSize:n}).then(function(u){return u.data}));case 3:case"end":return s.stop()}},o)})),De.apply(this,arguments)}var we=t(44132),Et=t(32126),Ct=function(){var r=(0,p.useState)({}),n=E()(r,2),e=n[0],a=n[1],s=(0,p.useState)({}),u=E()(s,2),d=u[0],f=u[1],v=(0,p.useState)({}),g=E()(v,2),B=g[0],A=g[1],$=(0,p.useState)(!0),re=E()($,2),k=re[0],ue=re[1],Tt=(0,p.useState)(!1),Ze=E()(Tt,2),At=Ze[0],w=Ze[1],bt=(0,p.useState)("1"),Ke=E()(bt,2),_e=Ke[0],kt=Ke[1],Dt=(0,p.useState)(),Ve=E()(Dt,2),Oe=Ve[0],_t=Ve[1],Ot=(0,p.useState)([]),We=E()(Ot,2),Lt=We[0],Bt=We[1],Mt=(0,p.useState)([]),Ge=E()(Mt,2),It=Ge[0],Rt=Ge[1],jt=(0,p.useState)(!1),ze=E()(jt,2),$e=ze[0],Ye=ze[1],Jt=(0,p.useState)(!1),Xe=E()(Jt,2),He=Xe[0],Le=Xe[1],Ft=(0,p.useState)(new Map),ke=E()(Ft,2),fe=ke[0],Qe=ke[1],Nt=(0,se.UO)(),he=Nt.id,Ut=new Ee;function qe(c){window.document.title="["+c.name+"]:"+c.version}function et(){w(!0);var c=Ut.graphToLogicItems(Oe,e);c.version=tt(),a(c),nt(c),qe(c)}function tt(){return gt()(Date.now()).format("YYYYMMDDHHmmss")}function nt(c){(0,Fe.az)(he,c.version,JSON.stringify(c)).then(function(m){w(!1),console.log("save logic"),console.log(c),m.status==200?(P.ZP.success("\u4FDD\u5B58\u6210\u529F"),console.log("save logic success")):(P.ZP.error("\u4FDD\u5B58\u5931\u8D25\uFF1A"+m.statusText),console.error("save logic error"))}).catch(function(m){w(!1),console.log("err"),console.log(m),P.ZP.error("\u4FDD\u5B58\u5931\u8D25")})}(0,p.useEffect)(function(){f({jsTips:i()({},fe)})},[fe]);function wt(c){var m,y,Y,ie,J={};J._par=c.params,J._var=c.variables,Qe(i()(i()({},fe),J));var Me=j.getParamArrayByJson(JSON.parse((m=c.params)!==null&&m!==void 0?m:"{}")),X=j.getReturnArrayByJson(JSON.parse((y=c.returns)!==null&&y!==void 0?y:"{}")),Ie=j.getVariableArrayByJson(JSON.parse((Y=c.variables)!==null&&Y!==void 0?Y:"{}")),Vt=j.getEnvsArrayByJson(JSON.parse((ie=c.envs)!==null&&ie!==void 0?ie:"{}")),Re=i()(i()({},e),{},{params:Me,returns:X,variables:Ie,envs:Vt,log:c.log});Re.version=tt(),a(Re),nt(Re)}function Zt(c){return Be.apply(this,arguments)}function Be(){return Be=_()(b()().mark(function c(m){var y,Y;return b()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return y={},y._par=JSON.stringify(j.getJsonByParams(m.params)),y._var=JSON.stringify(j.getJsonByParams(m.variables)),J.next=5,(0,Et.U)();case 5:Y=J.sent,y._env=JSON.stringify(Y),y._lastRet="{}",y._last=JSON.stringify({success:!0,msg:""}),Qe(y),w(!1);case 11:case"end":return J.stop()}},c)})),Be.apply(this,arguments)}(0,p.useEffect)(function(){(0,ot.m)(D()(st.C.values())),w(!0),(0,Fe.qB)(he).then(function(c){var m=c.name,y=c.configJson;y.id=he,y.name=m,a(y),A(y==null?void 0:y.visualConfig),Zt(y),qe(y)}).catch(function(c){w(!1),console.log("err"),console.log(c)}),je().then(function(c){Rt(c.Groups),Bt(c.Nodes)})},[]);var Kt=(0,p.useCallback)(function(){return new H.bn.kS({attrs:{line:{targetMarker:"classic",stroke:_e=="1"?"#000000":"#FF9900"}},zIndex:0,data:{type:_e}})},[_e]);return(0,h.jsx)("div",{children:(0,h.jsx)(q.Z,{spinning:At,children:(0,h.jsx)(K.l,{editorCtx:d,panelData:{Nodes:D()(Lt),Groups:[{name:"ctrl",title:"\u903B\u8F91\u63A7\u5236",graphHeight:360}].concat(D()(It))},showLeft:k,graphIns:Oe,toolElements:[(0,h.jsx)(G.ZP,{type:"text",icon:k?(0,h.jsx)(l.Z,{}):(0,h.jsx)(O.Z,{}),onClick:function(){ue(!k)},style:{fontSize:"16px",width:64,height:64}}),(0,h.jsx)(G.ZP,{icon:(0,h.jsx)(C.Z,{}),type:"primary",onClick:function(){return et()},children:"\u4FDD\u5B58"}),(0,h.jsx)(ft,{open:$e,values:i()({},e),setOpen:function(){Ye(!$e)},onSubmit:wt,children:(0,h.jsx)(G.ZP,{onClick:function(){return Ye(!0)},icon:(0,h.jsx)(V.Z,{style:{color:"#1677ff"}}),children:"\u53C2\u6570"})}),(0,h.jsx)(yt,{open:He,setOpen:function(){return Le(!He)},values:{params:e==null?void 0:e.params},onSubmit:function(m,y){if(Le(!1),e){var Y=m.params,ie=m.bizId,J=m.headers,Me=m.bizStartCode;w(!0),Pt(he,JSON.parse(Y),ie,Me,y,JSON.parse(J)).then(function(X){X.data.code==0?(w(!1),U.Z.success({title:"\u6267\u884C\u6210\u529F",width:"1000px",closable:!0,content:(0,h.jsx)("div",{children:(0,h.jsx)(we.Z,{pageId:"debug-info",data:X.data})})})):(w(!1),U.Z.error({title:(0,h.jsx)("span",{children:X.data.msg}),width:"1200px",closable:!0,content:(0,h.jsx)("div",{children:(0,h.jsx)(we.Z,{pageId:"debug-info",data:X.data})})}))}).catch(function(X){w(!1);var Ie=X.response.data;U.Z.error({title:(0,h.jsx)("span",{children:Ie.msg}),width:"1200px",closable:!0})})}},children:(0,h.jsx)(G.ZP,{onClick:function(){Le(!0)},icon:(0,h.jsx)(L.Z,{style:{color:"#1677ff"}}),children:"\u8C03\u8BD5"})}),(0,h.jsx)(G.ZP,{icon:(0,h.jsx)(ge.Z,{style:{color:"#1677ff"}}),onClick:function(){(0,Ne.V)(Oe)},children:"\u5E03\u5C40"}),(0,h.jsxs)(ee.Z.Text,{strong:!0,style:{fontSize:"18px"},children:["[",e.name,"]"]}),(0,h.jsxs)(ee.Z.Text,{children:["\u7248\u672C:",e.version]})],graphJson:B,onGraphJsonEmpty:it,createEdge:Kt,edgeTools:["button-remove","vertices","segments"],onSave:function(){return et()},jsTipMap:fe,autoLayout:function(m){return(0,Ne.V)(m)},onGraphInsChange:function(m){return _t(m)}})})})},xt=Ct},32126:function(le,F,t){t.d(F,{U:function(){return Z}});var I=t(25359),b=t.n(I),R=t(49811),D=t.n(R),N=t(31837),_=t(57475);function Z(){return i.apply(this,arguments)}function i(){return i=D()(b()().mark(function Q(){return b()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return K.abrupt("return",(0,_.U2)("/api/runtime/env").then(function(P){return P.data.data}).then(function(P){return N.j.setModel(P.UI_CONFIG_MODEL),N.j.setEnv(JSON.stringify(P)),N.j.setApiUrlPrefix(P.API_GATEWAY_PREFIX),N.j.setReryApi(P.CUSTOM_RETRY_URL),P}));case 1:case"end":return K.stop()}},Q)})),i.apply(this,arguments)}}}]);
