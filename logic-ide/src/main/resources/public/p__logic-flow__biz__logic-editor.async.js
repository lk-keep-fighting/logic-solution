"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[883],{60341:function(b,m,t){t.d(m,{l:function(){return h.Z}});var h=t(93797)},65020:function(b,m,t){t.d(m,{n:function(){return Z}});var h=t(12490);function Z(p){var g=p.createNode({shape:"circle",label:"start",width:50,height:50,attrs:{body:{}},ports:h.Hi,data:{config:{type:"start"}}});p.addNode(g)}},2325:function(b,m,t){t.d(m,{C:function(){return h}});var h=new Map,Z=50,p=50;h.set("ExtSharp",{name:"ExtSharp",config:{width:100,height:p,attrs:{body:{rx:6,ry:6,stroke:"#5F95FF",strokeWidth:1,fill:"rgba(95,149,255,0.05)",refWidth:1,refHeight:1},image:{refX:2,refY:0},text:{refX:4,refY:20,fontSize:12,"text-anchor":"start"}},markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}})},91213:function(b,m,t){t.r(m),t.d(m,{default:function(){return Yt}});var h=t(93525),Z=t.n(h),p=t(57213),g=t.n(p),vt=t(54306),v=t.n(vt),dt=t(60341),B=t(43702),ct=t(52615),L=t(75904),F=t(46464),i=t(87363),ft=t(98306),gt=t(5671),St=t(14990),mt=t(22465),ht=t(72237),yt=t(93853),Ct=t(28110),xt=t(25359),Y=t.n(xt),jt=t(49811),pt=t.n(jt),Jt=t(58146);function Ot(){return M.apply(this,arguments)}function M(){return M=pt()(Y()().mark(function y(){return Y()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise(function(o,c){o((0,Jt.K)())}));case 1:case"end":return r.stop()}},y)})),M.apply(this,arguments)}var Ft=t(21140),Pt=t.n(Ft),Et=t(63466),Nt=t.n(Et),Dt=t(77357),Tt=function(){function y(){Pt()(this,y)}return Nt()(y,[{key:"graphToLogicDsl",value:function(r,o){var c=(0,Dt.nq)(o==null?void 0:o.id,r==null?void 0:r.getCells());return c.visualConfig=r==null?void 0:r.toJSON(),g()(g()({},o),c)}}]),y}(),Zt=t(65020),U=t(2325),W=t(48364),Bt=t(89147),Lt=t(3619),K=t(62835),d=t(94744),e=t(33130),bt=function(n){var r,o=(0,i.useState)({}),c=v()(o,2),P=c[0],l=c[1];(0,i.useEffect)(function(){var u=n.values,f=u.params,S=u.variables,C=u.envs,E=u.returns;l({params:JSON.stringify(d.y.getJsonByParams(f)),variables:JSON.stringify(d.y.getJsonByParams(S)),returns:JSON.stringify(d.y.getJsonByParams(E)),envs:JSON.stringify(d.y.getJsonByParams(C))})},[n.values]);var j=(0,i.useCallback)(function(u){try{return JSON.parse(u),!0}catch(f){return!1}},[]);return(0,e.jsxs)("span",{children:[n.children,(0,e.jsx)(F.Z,{open:(r=n.open)!==null&&r!==void 0?r:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return n==null?void 0:n.setOpen(!1)},children:(0,e.jsx)(K.Z,{formId:"logic-setting",values:P,onSubmit:function(f){console.log("\u63D0\u4EA4\u53C2\u6570"),console.log(f);var S=!1;Object.keys(f).forEach(function(C){var E=f[C];if(!j(E)){var A=C==="params"?"\u5165\u53C2":C==="variables"?"\u5C40\u90E8\u53D8\u91CF":C==="returns"?"\u8FD4\u56DE\u53C2\u6570":"\u73AF\u5883\u53D8\u91CF";return B.ZP.error("".concat(A,"json\u683C\u5F0F\u9519\u8BEF")),S=!0,!1}}),S||(n!=null&&n.onSubmit&&n.onSubmit(f),n==null||n.setOpen(!1))}})})]})},Mt=bt,At=t(5726),It=t.n(At),zt=t(85772),Gt=function(n){var r,o=(0,zt.cI)();(0,i.useEffect)(function(){var l=n.values.params;o.setValues({params:JSON.stringify(d.y.getJsonByParams(l))})},[n.values]);var c=(0,i.useCallback)(function(l){try{return JSON.parse(l),!0}catch(j){return!1}},[]);function P(l){var j=!1;Object.keys(l).forEach(function(u){var f=l[u];if(["params","headers"].indexOf(u)>-1&&!c(f)){var S=u==="params"?"\u5165\u53C2":"\u8BF7\u6C42\u5934";return B.ZP.error("".concat(S,"json\u683C\u5F0F\u9519\u8BEF")),j=!0,!1}}),j||(n!=null&&n.onSubmit&&n.onSubmit(l,l.debugType),n==null||n.setOpen(!1))}return(0,e.jsxs)("span",{children:[n.children,(0,e.jsx)(F.Z,{open:(r=n.open)!==null&&r!==void 0?r:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return n==null?void 0:n.setOpen(!1)},children:(0,e.jsx)(K.Z,{formId:"logic-debug-input",onSubmit:P})})]})},Rt=Gt,Ht=t(61719),V=t(11331),$t=function(){var n=(0,i.useState)({}),r=v()(n,2),o=r[0],c=r[1],P=(0,i.useState)({}),l=v()(P,2),j=l[0],u=l[1],f=(0,i.useState)({}),S=v()(f,2),C=S[0],E=S[1],A=(0,i.useState)(!0),X=v()(A,2),I=X[0],Ut=X[1],Wt=(0,i.useState)(!1),Q=v()(Wt,2),Kt=Q[0],J=Q[1],Vt=(0,i.useState)("1"),w=v()(Vt,2),z=w[0],la=w[1],Xt=(0,i.useState)(),k=v()(Xt,2),q=k[0],Qt=k[1],wt=(0,i.useState)([]),_=v()(wt,2),kt=_[0],qt=_[1],_t=(0,i.useState)(!1),tt=v()(_t,2),at=tt[0],nt=tt[1],ta=(0,i.useState)(!1),et=v()(ta,2),st=et[0],G=et[1],aa=(0,i.useState)(new Map),rt=v()(aa,2),na=rt[0],va=rt[1],ea=(0,ft.UO)(),ot=ea.id,sa=new Tt;function it(){J(!0);var a=sa.graphToLogicDsl(q,o);a.version=ut(),c(a),lt(a)}function ut(){return It()(Date.now()).format("YYYYMMDDHHmmss")}function lt(a){(0,W.az)(a.id,a.version,JSON.stringify(a)).then(function(s){J(!1),B.ZP.success("\u4FDD\u5B58\u6210\u529F"),console.log("save logic"),console.log(a)}).catch(function(s){J(!1),console.log("err"),console.log(s),B.ZP.error("\u4FDD\u5B58\u5931\u8D25")})}function ra(a){var s,N,D,T,O={};O._par=a.params,O._var=a.variables,O._env=a.envs,u({jsTips:g()({},O)});var R=d.y.getParamArrayByJson(JSON.parse((s=a.params)!==null&&s!==void 0?s:"{}")),x=d.y.getReturnArrayByJson(JSON.parse((N=a.returns)!==null&&N!==void 0?N:"{}")),H=d.y.getVariableArrayByJson(JSON.parse((D=a.variables)!==null&&D!==void 0?D:"{}")),ua=d.y.getEnvsArrayByJson(JSON.parse((T=a.envs)!==null&&T!==void 0?T:"{}")),$=g()(g()({},o),{},{params:R,returns:x,variables:H,envs:ua});$.version=ut(),c($),lt($)}function oa(a){var s={};s._par=JSON.stringify(d.y.getJsonByParams(a.params)),s._var=JSON.stringify(d.y.getJsonByParams(a.variables)),s._env=JSON.stringify(d.y.getJsonByParams(a.envs)),u({jsTips:g()({},s)}),J(!1)}(0,i.useEffect)(function(){(0,Bt.m)([U.C.get("ExtSharp")]),J(!0),(0,W.YH)(ot).then(function(a){var s=a;s.id=ot,c(s),E(s==null?void 0:s.visualConfig),oa(s)}).catch(function(a){J(!1),console.log("err"),console.log(a)}),Ot().then(function(a){qt(a.Nodes)})},[]);var ia=(0,i.useCallback)(function(){return new gt.bn.kS({attrs:{line:{targetMarker:"classic",stroke:z=="1"?"#000000":"#FF9900"}},zIndex:0,data:{type:z}})},[z]);return(0,e.jsx)("div",{children:(0,e.jsx)(ct.Z,{spinning:Kt,children:(0,e.jsx)(dt.l,{editorCtx:j,panelData:{Nodes:Z()(kt),Shapes:[U.C.get("ExtSharp")],Groups:[{name:"global",title:"\u5168\u5C40\u8282\u70B9",graphHeight:110},{name:"ctrl",title:"\u903B\u8F91\u63A7\u5236",graphHeight:220},{name:"biz",title:"\u4E1A\u52A1\u8C03\u7528",graphHeight:220}]},showLeft:I,graphIns:q,toolElements:[(0,e.jsx)(L.ZP,{type:"text",icon:I?(0,e.jsx)(St.Z,{}):(0,e.jsx)(mt.Z,{}),onClick:function(){Ut(!I)},style:{fontSize:"16px",width:64,height:64}}),(0,e.jsx)(L.ZP,{icon:(0,e.jsx)(ht.Z,{}),type:"primary",onClick:function(){return it()},children:"\u4FDD\u5B58"}),(0,e.jsx)(Mt,{open:at,values:g()({},o),setOpen:function(){nt(!at)},onSubmit:ra,children:(0,e.jsx)(L.ZP,{onClick:function(){return nt(!0)},icon:(0,e.jsx)(yt.Z,{}),children:"\u914D\u7F6E\u53C2\u6570"})}),(0,e.jsx)(Rt,{open:st,setOpen:function(){return G(!st)},values:{params:o==null?void 0:o.params},onSubmit:function(s,N){if(G(!1),o){var D=s.params,T=s.bizId,O=s.headers,R=s.bizStartCode;(0,Ht.L7)(o.id,JSON.parse(D),T,R,N,JSON.parse(O)).then(function(x){x.data.code==0?F.Z.success({title:"\u6267\u884C\u6210\u529F",width:"1000px",closable:!0,content:(0,e.jsx)("div",{children:(0,e.jsx)(V.Z,{pageId:"debug-info",data:x.data})})}):F.Z.error({title:(0,e.jsx)("span",{children:x.data.msg}),width:"1200px",closable:!0,content:(0,e.jsx)("div",{children:(0,e.jsx)(V.Z,{pageId:"debug-info",data:x.data})})})}).catch(function(x){var H=x.response.data;F.Z.error({title:(0,e.jsx)("span",{children:H.msg}),width:"1200px",closable:!0})})}},children:(0,e.jsx)(L.ZP,{type:"default",onClick:function(){G(!0)},icon:(0,e.jsx)(Ct.Z,{}),children:"\u8C03\u8BD5"})}),(0,e.jsxs)("span",{children:["\u5F53\u524D\u7248\u672C:",o.version]})],graphJson:C,onGraphJsonEmpty:Zt.n,createEdge:ia,edgeTools:["button-remove","vertices","segments"],onSave:function(){return it()},jsTipMap:na,autoLayout:function(s){return(0,Lt.V)(s)},onGraphInsChange:function(s){return Qt(s)}})})})},Yt=$t}}]);
