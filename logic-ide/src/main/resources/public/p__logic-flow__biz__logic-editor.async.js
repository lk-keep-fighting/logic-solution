"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[883],{98295:function(a_,U,e){e.r(U);var ne=e(25359),y=e.n(ne),se=e(93525),p=e.n(se),te=e(49811),ae=e.n(te),oe=e(57213),c=e.n(oe),re=e(54306),r=e.n(re),ue=e(60341),m=e(83217),le=e(72197),D=e(54145),f=e(51394),I=e(36267),a=e(87363),o_=e.n(a),ie=e(98306),de=e(5671),ce=e(14990),Ee=e(22465),ve=e(72237),me=e(93853),De=e(28110),ge=e(49228),Oe=e(79716),Pe=e(88090),pe=e(44174),fe=e(2325),g=e(48364),Me=e(21042),R=e(3619),Ce=e(7944),E=e(94744),Se=e(5726),he=e.n(Se),Be=e(79671),j=e(44132),Te=e(32126),s=e(33130),Le=function(){var Ae=(0,a.useState)({}),W=r()(Ae,2),i=W[0],M=W[1],xe=(0,a.useState)({}),K=r()(xe,2),Ue=K[0],ye=K[1],Ie=(0,a.useState)({}),b=r()(Ie,2),Re=b[0],je=b[1],We=(0,a.useState)(!0),Z=r()(We,2),C=Z[0],Ke=Z[1],be=(0,a.useState)(!1),J=r()(be,2),Ze=J[0],u=J[1],Je=(0,a.useState)("1"),F=r()(Je,2),S=F[0],u_=F[1],Fe=(0,a.useState)(),N=r()(Fe,2),h=N[0],Ne=N[1],Ge=(0,a.useState)([]),G=r()(Ge,2),ze=G[0],$e=G[1],He=(0,a.useState)([]),z=r()(He,2),Ye=z[0],Ve=z[1],we=(0,a.useState)(!1),$=r()(we,2),H=$[0],Y=$[1],Qe=(0,a.useState)(!1),V=r()(Qe,2),w=V[0],B=V[1],Xe=(0,a.useState)(new Map),Q=r()(Xe,2),O=Q[0],X=Q[1],ke=(0,ie.UO)(),P=ke.id,qe=new Pe.W;function k(_){window.document.title="["+_.name+"]:"+_.version}function q(){u(!0),(0,g.qB)(P).then(function(_){if(_.version!=i.version)u(!1),m.ZP.error("\u672C\u5730\u7248\u672C\u4E0E\u670D\u52A1\u5668[".concat(_.version,"]\u4E0D\u4E00\u81F4\uFF0C\u65E0\u6CD5\u4FDD\u5B58\uFF01\u8BF7\u6253\u5F00\u65B0\u8BBE\u8BA1\u9875\u624B\u52A8\u5408\u5E76\u903B\u8F91\uFF01"));else{var n=qe.graphToLogicItems(h,i);n.version=ee(),M(n),_e(n),k(n)}}).catch(function(_){u(!1),m.ZP.error("\u83B7\u53D6\u903B\u8F91\u5931\u8D25\uFF01"),console.log("err"),console.log(_)})}function ee(){return he()(Date.now()).format("YYYYMMDDHHmmss")}function _e(_){(0,g.az)(P,_.version,JSON.stringify(_)).then(function(n){u(!1),console.log("save logic"),console.log(_),n.status==200?(m.ZP.success("\u4FDD\u5B58\u6210\u529F"),console.log("save logic success")):(m.ZP.error("\u4FDD\u5B58\u5931\u8D25\uFF1A"+n.statusText),console.error("save logic error"))}).catch(function(n){u(!1),console.log("err"),console.log(n),m.ZP.error("\u4FDD\u5B58\u5931\u8D25")})}(0,a.useEffect)(function(){ye({jsTips:c()({},O)})},[O]);function e_(_){var n,o,t,v,l={};l._par=_.params,l._var=_.variables,X(c()(c()({},O),l));var L=E.y.getParamArrayByJson(JSON.parse((n=_.params)!==null&&n!==void 0?n:"{}")),d=E.y.getReturnArrayByJson(JSON.parse((o=_.returns)!==null&&o!==void 0?o:"{}")),A=E.y.getVariableArrayByJson(JSON.parse((t=_.variables)!==null&&t!==void 0?t:"{}")),t_=E.y.getEnvsArrayByJson(JSON.parse((v=_.envs)!==null&&v!==void 0?v:"{}")),x=c()(c()({},i),{},{params:L,returns:d,variables:A,envs:t_,log:_.log});x.version=ee(),M(x),_e(x)}function __(_){return T.apply(this,arguments)}function T(){return T=ae()(y()().mark(function _(n){var o,t;return y()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return o={},o._par=JSON.stringify(E.y.getJsonByParams(n.params)),o._var=JSON.stringify(E.y.getJsonByParams(n.variables)),l.next=5,Te.S.getEnvJson();case 5:t=l.sent,o._env=JSON.stringify(t),o._lastRet="{}",o._last=JSON.stringify({success:!0,msg:""}),X(o),u(!1);case 11:case"end":return l.stop()}},_)})),T.apply(this,arguments)}function n_(_){(0,g.qB)(_).then(function(n){var o=n.name,t=n.configJson;t.id=_,t.name=o,M(t),je(t==null?void 0:t.visualConfig),__(t),k(t)}).catch(function(n){u(!1),console.log("err"),console.log(n)})}(0,a.useEffect)(function(){(0,Me.m)(p()(fe.C.values())),u(!0),n_(P),(0,Oe.O)().then(function(_){Ve(_.Groups),$e(_.Nodes)})},[]);var s_=(0,a.useCallback)(function(){return new de.bn.kS({attrs:{line:{targetMarker:"classic",stroke:S=="1"?"#000000":"#FF9900"}},zIndex:0,data:{type:S}})},[S]);return(0,s.jsx)("div",{children:(0,s.jsx)(le.Z,{spinning:Ze,children:(0,s.jsx)(ue.l,{editorCtx:Ue,panelData:{Nodes:p()(ze),Groups:[{name:"ctrl",title:"\u903B\u8F91\u63A7\u5236",graphHeight:360}].concat(p()(Ye))},showLeft:C,graphIns:h,toolElements:[(0,s.jsx)(D.ZP,{type:"text",icon:C?(0,s.jsx)(ce.Z,{}):(0,s.jsx)(Ee.Z,{}),onClick:function(){Ke(!C)},style:{fontSize:"16px",width:64,height:64}}),(0,s.jsx)(D.ZP,{icon:(0,s.jsx)(ve.Z,{}),type:"primary",onClick:function(){return q()},children:"\u4FDD\u5B58"}),(0,s.jsx)(Ce.Z,{open:H,values:c()({},i),setOpen:function(){Y(!H)},onSubmit:e_,children:(0,s.jsx)(D.ZP,{onClick:function(){return Y(!0)},icon:(0,s.jsx)(me.Z,{style:{color:"#1677ff"}}),children:"\u53C2\u6570"})}),(0,s.jsx)(Be.Z,{open:w,setOpen:function(){return B(!w)},values:{params:i==null?void 0:i.params},onSubmit:function(n,o){if(B(!1),i){var t=n.params,v=n.bizId,l=n.headers,L=n.bizStartCode;u(!0),(0,g.L7)(P,JSON.parse(t),v,L,o,JSON.parse(l)).then(function(d){d.data.code==0?(u(!1),f.Z.success({title:"\u6267\u884C\u6210\u529F",width:"1000px",closable:!0,content:(0,s.jsx)("div",{children:(0,s.jsx)(j.Z,{pageId:"debug-info",data:d.data})})})):(u(!1),f.Z.error({title:(0,s.jsx)("span",{children:d.data.msg}),width:"1200px",closable:!0,content:(0,s.jsx)("div",{children:(0,s.jsx)(j.Z,{pageId:"debug-info",data:d.data})})}))}).catch(function(d){u(!1);var A=d.response.data;f.Z.error({title:(0,s.jsx)("span",{children:A.msg}),width:"1200px",closable:!0})})}},children:(0,s.jsx)(D.ZP,{onClick:function(){B(!0)},icon:(0,s.jsx)(De.Z,{style:{color:"#1677ff"}}),children:"\u8C03\u8BD5"})}),(0,s.jsx)(D.ZP,{icon:(0,s.jsx)(ge.Z,{style:{color:"#1677ff"}}),onClick:function(){(0,R.V)(h)},children:"\u5E03\u5C40"}),(0,s.jsxs)(I.Z.Text,{strong:!0,style:{fontSize:"18px"},children:["[",i.name,"]"]}),(0,s.jsxs)(I.Z.Text,{children:["\u7248\u672C:",i.version]})],graphJson:Re,onGraphJsonEmpty:pe.n,createEdge:s_,edgeTools:["button-remove","vertices","segments"],onSave:function(){return q()},jsTipMap:O,autoLayout:function(n){return(0,R.V)(n)},onGraphInsChange:function(n){return Ne(n)}})})})};U.default=Le}}]);
