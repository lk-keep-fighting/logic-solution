"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[883],{50111:function(En,U,t){t.r(U),t.d(U,{default:function(){return bt}});var St=t(90228),W=t.n(St),ht=t(15558),L=t.n(ht),mt=t(87999),pt=t.n(mt),Ct=t(26068),S=t.n(Ct),yt=t(48305),r=t.n(yt),xt=t(60860),h=t(63121),jt=t(82494),J=t(39765),Jt=t(87335),O=t(39710),P=t(77154),Ot=t(90171),Ft=t(42553),o=t(87363),Et=t(9413),Zt=t(91505),Tt=t(8674),Bt=t(16020),Dt=t(66952),Lt=t(1893),Pt=t(33226),Nt=t(25281),At=t(30098),Gt=t(72677),It=t(8678),Mt=t(72920),F=t(99511),zt=t(72233),N=t(83359),Rt=t(76262),m=t(20210),$t=t(16483),Ht=t.n($t),Vt=t(98496),K=t(68784),Yt=t(370),Ut=t(94391),a=t(62086),Wt=function(p){var E=p.onConfirm,i=p.onCancel,C=p.isOpen,A=(0,o.useState)(""),y=r()(A,2),Z=y[0],G=y[1],I=function(){try{E(Z)}catch(j){h.ZP.error(j.message)}};return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(O.Z,{title:"\u5BFC\u5165json\u751F\u6210\u6D41\u7A0B\u56FE",visible:C,cancelText:"\u53D6\u6D88",okText:"\u786E\u5B9A\u5BFC\u5165\u8986\u76D6",onOk:I,width:800,onCancel:function(){return i()},children:(0,a.jsx)(Ut.MLE,{width:"100%",height:500,value:Z,allowFullscreen:!0,language:"json",onChange:function(j){return G(j)},placeholder:"\u5728\u8FD9\u91CC\u7C98\u8D34json"})})})},Kt=Wt,Qt=t(74737),Xt=function(){var p=(0,o.useState)({}),E=r()(p,2),i=E[0],C=E[1],A=(0,o.useState)({}),y=r()(A,2),Z=y[0],G=y[1],I=(0,o.useState)({}),x=r()(I,2),j=x[0],Q=x[1],wt=(0,o.useState)(!0),X=r()(wt,2),M=X[0],qt=X[1],_t=(0,o.useState)(!1),b=r()(_t,2),tn=b[0],l=b[1],nn=(0,o.useState)("1"),k=r()(nn,2),z=k[0],Zn=k[1],en=(0,o.useState)(!1),w=r()(en,2),an=w[0],R=w[1],sn=(0,o.useState)(),q=r()(sn,2),T=q[0],on=q[1],rn=(0,o.useState)([]),_=r()(rn,2),un=_[0],ln=_[1],vn=(0,o.useState)([]),tt=r()(vn,2),cn=tt[0],dn=tt[1],fn=(0,o.useState)(!1),nt=r()(fn,2),et=nt[0],at=nt[1],gn=(0,o.useState)(!1),st=r()(gn,2),ot=st[0],$=st[1],Sn=(0,o.useState)(new Map),rt=r()(Sn,2),B=rt[0],ut=rt[1],hn=(0,o.useState)({}),it=r()(hn,2),mn=it[0],lt=it[1],pn=(0,Et.UO)(),D=pn.id,Cn=new Gt.W;function vt(n){window.document.title="["+n.name+"]:"+n.version}function ct(){l(!0),(0,F.qB)(D).then(function(n){if(n.version&&n.version!=i.version)l(!1),h.ZP.error("\u672C\u5730\u7248\u672C\u4E0E\u670D\u52A1\u5668[".concat(n.version,"]\u4E0D\u4E00\u81F4\uFF0C\u65E0\u6CD5\u4FDD\u5B58\uFF01\u8BF7\u6253\u5F00\u65B0\u8BBE\u8BA1\u9875\u624B\u52A8\u5408\u5E76\u903B\u8F91\uFF01"));else{var e=Cn.graphToLogicItems(T,i);e.version=dt(),C(e),ft(e),vt(e)}}).catch(function(n){l(!1),h.ZP.error("\u83B7\u53D6\u903B\u8F91\u5931\u8D25\uFF01"),console.log("err"),console.log(n)})}function dt(){return Ht()(Date.now()).format("YYYYMMDDHHmmss")}function ft(n){(0,F.az)(D,n.version,JSON.stringify(n)).then(function(e){l(!1),console.log("save logic"),console.log(n),e.status==200?(h.ZP.success("\u4FDD\u5B58\u6210\u529F"),console.log("save logic success")):(h.ZP.error("\u4FDD\u5B58\u5931\u8D25\uFF1A"+e.statusText),console.error("save logic error"))}).catch(function(e){l(!1),console.log("err"),console.log(e),h.ZP.error("\u4FDD\u5B58\u5931\u8D25")})}(0,o.useEffect)(function(){G({jsTips:S()({},B)})},[B]);function yn(n){var e,u,s,v,c,g={};g._par=n.params,g._var=n.variables,g._global=(e=n.variables.__global)!==null&&e!==void 0?e:"{}",ut(S()(S()({},B),g));var d=m.y.getParamArrayByJson(JSON.parse((u=n.params)!==null&&u!==void 0?u:"{}")),f=m.y.getReturnArrayByJson(JSON.parse((s=n.returns)!==null&&s!==void 0?s:"{}")),V=m.y.getVariableArrayByJson(JSON.parse((v=n.variables)!==null&&v!==void 0?v:"{}")),gt=m.y.getEnvsArrayByJson(JSON.parse((c=n.envs)!==null&&c!==void 0?c:"{}"));lt(gt);var Y=S()(S()({},i),{},{params:d,returns:f,variables:V,envs:gt,log:n.log});Y.version=dt(),C(Y),ft(Y)}function xn(n){return H.apply(this,arguments)}function H(){return H=pt()(W()().mark(function n(e){var u,s,v,c;return W()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return s={},s._par=JSON.stringify(m.y.getJsonByParams(e.params)),v=m.y.getJsonByParams(e.variables),s._var=JSON.stringify(v),s._global=JSON.stringify((u=v.__global)!==null&&u!==void 0?u:"{}"),d.next=7,Yt.S.getEnvJson();case 7:c=d.sent,lt(c),s._env=JSON.stringify(c),s._bizId='""',s._lastRet="{}",s._last=JSON.stringify({success:!0,msg:"",data:{}}),ut(s),l(!1);case 15:case"end":return d.stop()}},n)})),H.apply(this,arguments)}function jn(n){(0,F.qB)(n).then(function(e){var u=e.name,s=e.configJson;s.id=n,s.name=u,C(s),xn(s),Q(s==null?void 0:s.visualConfig),vt(s)}).catch(function(e){l(!1),console.log("err"),console.log(e)})}(0,o.useEffect)(function(){(0,zt.m)(L()(Mt.C.values())),l(!0),jn(D),(0,At.O)().then(function(n){dn(n.Groups),ln(n.Nodes)})},[]);var Jn=(0,o.useCallback)(function(){return new Zt.bn.kS({attrs:{line:{targetMarker:"classic",stroke:z=="1"?"#000000":"#FF9900"}},zIndex:0,data:{type:z}})},[z]),On=[{key:"imoport",label:"\u5BFC\u5165Json\u914D\u7F6E"}],Fn=function(e){R(!0)};return(0,a.jsx)("div",{children:(0,a.jsx)(jt.Z,{spinning:tn,children:(0,a.jsx)(xt.l,{editorCtx:Z,panelData:{Nodes:L()(un),Groups:[{name:"ctrl",title:"\u903B\u8F91\u63A7\u5236",graphHeight:360},{name:"assign",title:"\u53D8\u91CF\u8D4B\u503C",graphHeight:100}].concat(L()(cn))},showLeft:M,graphIns:T,toolElements:[(0,a.jsx)(J.ZP,{type:"text",icon:M?(0,a.jsx)(Tt.Z,{}):(0,a.jsx)(Bt.Z,{}),onClick:function(){qt(!M)},style:{fontSize:"16px",width:64,height:64}}),(0,a.jsxs)(Jt.Z.Button,{type:"primary",onClick:function(){return ct()},menu:{items:On,onClick:Fn},children:[(0,a.jsx)(Dt.Z,{}),"\u4FDD\u5B58"]}),(0,a.jsx)(Rt.Z,{open:et,values:S()({},i),setOpen:function(){at(!et)},onSubmit:yn,children:(0,a.jsx)(J.ZP,{onClick:function(){return at(!0)},icon:(0,a.jsx)(Lt.Z,{style:{color:"#1677ff"}}),children:"\u53C2\u6570"})}),(0,a.jsx)(Vt.Z,{open:ot,setOpen:function(){return $(!ot)},values:{params:i==null?void 0:i.params},onSubmit:function(e,u){if($(!1),i){var s=e.params,v=e.bizId,c=e.headers,g=e.bizStartCode,d=e.configModel;l(!0),(0,F.L7)(D,JSON.parse(s),v,g,u,JSON.parse(c),d).then(function(f){f.data.code==0?(l(!1),O.Z.success({title:"\u6267\u884C\u6210\u529F",width:"1000px",okText:"\u5173\u95ED",closable:!0,content:(0,a.jsx)("div",{children:(0,a.jsx)(K.Z,{pageId:"debug-info",data:f.data})})})):(l(!1),O.Z.error({title:(0,a.jsx)("span",{children:f.data.msg}),width:"1200px",okText:"\u5173\u95ED",closable:!0,content:(0,a.jsx)("div",{children:(0,a.jsx)(K.Z,{pageId:"debug-info",data:f.data})})}))}).catch(function(f){l(!1);var V=f.response.data;O.Z.error({title:(0,a.jsx)("span",{children:V.msg}),width:"1200px",closable:!0})})}},children:(0,a.jsx)(J.ZP,{onClick:function(){$(!0)},icon:(0,a.jsx)(Pt.Z,{style:{color:"#1677ff"}}),children:"\u8C03\u8BD5"})}),(0,a.jsx)(Kt,{onConfirm:function(e){R(!1);var u=(0,Qt.S8)(JSON.parse(e));Q(u),setTimeout(function(){(0,N.V)(T)},500)},onCancel:function(){return R(!1)},isOpen:an}),(0,a.jsx)(J.ZP,{icon:(0,a.jsx)(Nt.Z,{style:{color:"#1677ff"}}),onClick:function(){(0,N.V)(T)},children:"\u5E03\u5C40"}),(0,a.jsxs)(P.Z.Text,{strong:!0,style:{fontSize:"18px"},children:["[",i.name,"]"]}),(0,a.jsxs)(P.Z.Text,{children:["\u7248\u672C:",i.version]}),(0,a.jsx)(Ot.Z,{type:"vertical"}),(0,a.jsxs)(P.Z.Text,{children:["\u914D\u7F6E\u6A21\u5F0F\uFF1A",(0,a.jsx)(Ft.Z,{title:"online:\u4FDD\u5B58\u5373\u751F\u6548;offline:\u53D1\u5E03\u540E\u751F\u6548",children:mn.LOGIC_CONFIG_MODEL=="online"?"\u4FDD\u5B58\u5373\u751F\u6548":"\u53D1\u5E03\u540E\u751F\u6548"})]})],graphJson:j,onGraphJsonEmpty:It.n,createEdge:Jn,edgeTools:["button-remove","vertices","segments"],onSave:function(){return ct()},jsTipMap:B,autoLayout:function(e){return(0,N.V)(e)},onGraphInsChange:function(e){return on(e)}})})})},bt=Xt}}]);
