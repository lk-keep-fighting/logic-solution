"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[883],{60341:function(ce,F,t){t.d(F,{l:function(){return j.Z}});var j=t(93797)},72107:function(ce,F,t){t.d(F,{Ld:function(){return j},Iz:function(){return m},Du:function(){return w},dO:function(){return q},z1:function(){return ie},X0:function(){return U},_w:function(){return oe}});var j=function(l){return l.TypeAnnotation="TypeAnnotation",l.Structure="Structure",l.StructureProperty="StructureProperty",l.TypeParam="TypeParam",l.Variable="Variable",l.Logic="Logic",l.LogicItem="LogicItem",l}({}),I=function(l){return l.start="start",l.end="end",l.switch="switch",l["switch-case"]="switch-case",l["switch-def"]="switch-def",l["mqtt-pub"]="mqtt-pub",l["mqtt-sub"]="mqtt-sub",l["mqtt-unsub"]="mqtt-unsub",l["mqtt-client"]="mqtt-client",l["mqtt-server"]="mqtt-server",l["mqtt-broker"]="mqtt-broker",l.http="http",l.logic="logic",l.js="js",l.wait="wait",l}({}),X=t(63466),C=t.n(X),T=t(21140),A=t.n(T),H=t(52510),s=t.n(H),U=C()(function l(E){A()(this,l),s()(this,"concept",void 0),s()(this,"name",void 0),s()(this,"label",void 0),s()(this,"description",void 0),s()(this,"typeAnnotation",void 0),s()(this,"required",!1),s()(this,"defaultValue",void 0),this.concept=j.StructureProperty,this.name=E}),m=C()(function l(E){A()(this,l),s()(this,"concept",j.Logic),s()(this,"schemeVersion",void 0),s()(this,"version",void 0),s()(this,"id",void 0),s()(this,"name",void 0),s()(this,"label",void 0),s()(this,"description",void 0),s()(this,"triggerType",void 0),s()(this,"log",void 0),s()(this,"cron",void 0),s()(this,"typeParams",void 0),s()(this,"params",void 0),s()(this,"returns",void 0),s()(this,"variables",void 0),s()(this,"envs",void 0),s()(this,"items",[]),s()(this,"visualConfig",void 0),this.id=E,this.schemeVersion="0.1"}),w=C()(function l(E,b){var V=this;A()(this,l),s()(this,"concept","LogicItem"),s()(this,"id",void 0),s()(this,"name",void 0),s()(this,"type",void 0),s()(this,"label",void 0),s()(this,"description",void 0),s()(this,"params",void 0),s()(this,"returns",void 0),s()(this,"envs",void 0),s()(this,"afterReturnAdaptor",void 0),s()(this,"returnAccept",void 0),s()(this,"nextId",void 0),s()(this,"endId",void 0),s()(this,"condition",void 0),s()(this,"script",void 0),s()(this,"timeout",void 0),s()(this,"branches",void 0),s()(this,"url",void 0),s()(this,"method",void 0),s()(this,"headers",void 0),s()(this,"queryParams",void 0),s()(this,"tranScope",void 0),s()(this,"body",void 0),s()(this,"setEnv",function(x){V.envs=x}),this.type=b,this.id=E}),P=null,q=C()(function l(E){A()(this,l),s()(this,"concept","Param"),s()(this,"name",void 0),s()(this,"description",void 0),s()(this,"typeAnnotation",void 0),s()(this,"required",void 0),s()(this,"defaultValue",void 0),this.name=E}),K=t(58853),Z=t.n(K),se=t(38888),p=t.n(se),ie=function(l){Z()(b,l);var E=p()(b);function b(V){var x;return A()(this,b),x=E.call(this,V),x.concept="Return",x}return C()(b)}(q),oe=function(l){Z()(b,l);var E=p()(b);function b(V){var x;return A()(this,b),x=E.call(this,V),x.concept="Variable",x}return C()(b)}(q)},44132:function(ce,F,t){var j=t(57213),I=t.n(j),X=t(54306),C=t.n(X),T=t(70517),A=t(90010),H=t.n(A),s=t(23620),U=t(2069),m=t(87363),w=t.n(m),P=t(70256),q=t(33358),K=t(49500),Z=t(16123),se=t(78057),p=t(69078),ie=t(98896),oe=t(32126),l=t(31837),E=t(33130),b=function(x){var ye=(0,m.useState)({type:"page"}),de=C()(ye,2),_e=de[0],W=de[1],Se=(0,m.useState)(),ve=C()(Se,2),Pe=ve[0],Ee=ve[1],Ce=(0,m.useState)(),ee=C()(Ce,2),Fe=ee[0],fe=ee[1],ue="cxd",te="zh-CN";return(0,m.useEffect)(function(){(0,ie.m)(T.Z)},[]),(0,m.useEffect)(function(){x.pageId&&((0,P.UD)(x.pageId).then(function(O){W(O)}),(0,oe.U)().then(function(O){Ee(JSON.parse(l.j.getEnv()))}))},[x.pageId]),(0,E.jsxs)("div",{children:[(0,E.jsx)(U.qR,{theme:ue,position:"top-right",locale:te},"toast"),(0,E.jsx)(U.wx,{theme:ue,locale:te},"alert"),(0,s.sYA)(_e,{data:I()({envs:Pe},x.data)},{fetcher:function(L){var G=L.url,k=L.method,M=L.data,he=L.responseType,S=L.config,ge=L.headers;return S=S||{},S.withCredentials=!0,he&&(S.responseType=he),S.cancelExecutor&&(S.cancelToken=new T.Z.CancelToken(S.cancelExecutor)),S.headers=ge||{},S.headers.Authorization||(S.headers.Authorization="Bearer "+p.F.getTokenFormLocal()),k!=="post"&&k!=="put"&&k!=="patch"?(M&&(S.params=M),T.Z[k](G,S)):(M&&M instanceof FormData?(S.headers=S.headers||{},S.headers["Content-Type"]="multipart/form-data"):M&&typeof M!="string"&&!(M instanceof Blob)&&!(M instanceof ArrayBuffer)&&(M=JSON.stringify(M),S.headers=S.headers||{},S.headers["Content-Type"]="application/json"),T.Z[k](G,M,S))},isCancel:function(L){return T.Z.isCancel(L)},copy:function(L){H()(L),U.Am.success("\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u7C98\u8D34\u677F")},theme:ue,jumpTo:function(L,G){debugger;G.blank==!0?window.open(window.location.origin+window.location.pathname+"#"+L,"_blank"):window.location.hash=L}})]})};F.Z=b},8499:function(ce,F,t){t.r(F),t.d(F,{default:function(){return Ct}});var j=t(25359),I=t.n(j),X=t(93525),C=t.n(X),T=t(49811),A=t.n(T),H=t(57213),s=t.n(H),U=t(54306),m=t.n(U),w=t(60341),P=t(83217),q=t(72197),K=t(54145),Z=t(51394),se=t(36267),p=t(87363),ie=t(98306),oe=t(5671),l=t(14990),E=t(22465),b=t(72237),V=t(93853),x=t(28110),ye=t(49228),de=t(70517),_e=t(9364),W=t(12490),Se=t(42651),ve={buildGroup:function(r,n,e,a){var i=Number.parseInt(n/2),u=n%2==0;return{name:r,title:e,graphHeight:(u?i:i+1)*(a||70)+10}}},Pe=ve;function Ee(o){return o.length>7?"".concat(o.substring(0,7),`\r
`).concat(o.substring(7)):o}function Ce(){return ee.apply(this,arguments)}function ee(){return ee=A()(I()().mark(function o(){var r;return I()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],e.abrupt("return",Promise.all([(0,_e.K)(),de.Z.get("/api/ide/asset/v1/logic-item/readFromCode")]).then(function(a){if(console.log("getPanelData"),a[1].status==200){var i=a[1].data.data;Object.keys(i).forEach(function(u,d){var f=Pe.buildGroup(u,i[u].length,u);r.push(f),i[u].sort(function(v,g){return v.order?v.order.localeCompare(g.order):1}).forEach(function(v){a[0].Nodes.push(new Se.Z({shape:v.shape?v.shape:"ExtShape"+(d%3==0?"1":d%3==1?"2":"3"),ports:W.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/logic/icons/java.svg"},text:{text:Ee(v.name),fontSize:12}},data:{config:v.logicItem},_groups:[v.group]}))})})}return{Nodes:a[0].Nodes,Groups:r}}));case 2:case"end":return e.stop()}},o)})),ee.apply(this,arguments)}var Fe=t(21140),fe=t.n(Fe),ue=t(63466),te=t.n(ue),O=t(72107),L=null;function G(o,r,n,e){var a,i,u=o.data.config,d=u.type,f=n.flatMap(function(D){return D.source.cell===o.id?r[D.target.cell]:[]}),v=o.attrs,g=new O.Du((a=o.id)!==null&&a!==void 0?a:"",d);if(g=s()(s()({},u),{},{id:o.id,name:v==null||(i=v.text)===null||i===void 0?void 0:i.text}),!(e.findIndex(function(D){return D.id===g.id})>-1)&&(e.push(g),f.length!==0))switch(d){default:if(f.length>1||g.type==="switch"){var B;console.log((B=o.data)===null||B===void 0?void 0:B.config),console.log(f),g.branches=[],f.forEach(function(D){var z,ae,Q,le;console.log((z=D.data)===null||z===void 0?void 0:z.config),(ae=g.branches)===null||ae===void 0||ae.push({when:(Q=D.data)===null||Q===void 0||(le=Q.config)===null||le===void 0?void 0:le.case,nextId:D.id}),G(r[D.id],r,n,e)})}else g.nextId=f[0].id,G(r[f[0].id],r,n,e);break}}function k(o,r){var n=new O.Iz(o),e=[],a=[],i={},u=void 0;if(r.forEach(function(d){var f=d.id||"";if(d.shape==="edge")e.push(d);else{var v=d.attrs;i[f]=d,a.push(d),d.data.config.type==="start"&&(u=d)}}),!u){P.ZP.error("\u672A\u53D1\u73B0\u5F00\u59CB\u8282\u70B9\uFF0C\u8BF7\u914D\u7F6E\uFF01");return}return G(u,i,e,n.items),console.log("logic.items"),console.log(n.items),n}function M(o){var r=[],n=[];return o.items.forEach(function(e){var a={id:e.id,shape:e.type,size:{width:80,height:40},data:{config:e},attrs:{text:{text:e.name}}};if(r.push(a),e.branches&&e.branches.length>0)e.branches.forEach(function(u){var d={shape:"edge",source:{cell:e.id},target:{cell:u.nextId},labels:[{position:.5,attrs:{label:{text:u.when}}}]};n.push(d)});else if(e.nextId){var i={shape:"edge",source:{cell:e.id},target:{cell:e.nextId}};n.push(i)}}),{nodes:r,edges:n}}var he=function(){function o(){fe()(this,o)}return te()(o,[{key:"graphToLogicItems",value:function(n,e){var a=k(e==null?void 0:e.id,n==null?void 0:n.getCells());return a.visualConfig=n==null?void 0:n.toJSON(),s()(s()({},e),{},{visualConfig:a.visualConfig,items:a.items})}},{key:"logicToGraphJson",value:function(n){var e=M(n);return e}}]),o}(),S=50,ge=50,rt={body:{}},Wt={"wati-for-continu":{shape:"circle",ports:W.Tt,width:S,height:ge,attrs:{body:s()(s()({},rt.body),{},{fill:"white"}),text:{text:"\u4EA4\u4E92\u70B9"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],data:{config:{type:"wait-for-continue"}}},js:{shape:"ExtSharp",ports:W.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/logic/icons/code.svg"},text:{text:"js\u811A\u672C",fontSize:14}},data:{config:{type:"js"}}},java:{shape:"ExtSharp",ports:W.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/logic/icons/java.svg"},text:{text:"java\u65B9\u6CD5",fontSize:14}},data:{config:{type:"java"}}},switch:{shape:"ExtSharp",width:50,height:ge,ports:W.Tt,label:"switch",attrs:{image:{"xlink:href":"/logic/icons/switch.svg",width:45,x:1,y:2},text:{text:"switch",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}}}};function st(o){var r=o.createNode({shape:"circle",label:"start",width:50,height:50,attrs:{body:{}},ports:W.Hi,data:{config:{type:"start"}}});o.addNode(r)}function Gt(o,r){var n=LogicItemSharpMapping[r.type];if(n){n.data={config:r};var e=o.createNode(n);e.setAttrByPath("text/text",r.name),o.addNode(e)}}var it=t(2325),Ne=t(48364),ot=t(44095),Ue=t(3619),we=t(94990),ut=t(37635),lt=t.n(ut),ct=t(52510),ne=t.n(ct),dt=te()(function o(r){fe()(this,o),ne()(this,"concept","EnvParam"),ne()(this,"name",void 0),ne()(this,"description",void 0),ne()(this,"typeAnnotation",void 0),ne()(this,"required",!1),ne()(this,"defaultValue",void 0),this.name=r}),R=function(){function o(){fe()(this,o)}return te()(o,null,[{key:"valueToTypeAnnotaion",value:function(n){var e=this,a={concept:O.Ld.TypeAnnotation,typeKind:"primitive",typeName:"string",defaultValue:n};if(Array.isArray(n))a.typeName="array";else{var i=lt()(n);switch(i){case"boolean":a.typeKind="primitive",a.typeName="boolean";break;case"number":a.typeKind="primitive",a.typeName="number";break;case"string":a.typeKind="primitive",a.typeName="string";break;case"object":n==null?a.typeName="null":n instanceof Date?(a.typeKind="primitive",a.typeName="date"):n instanceof RegExp?(a.typeKind="primitive",a.typeName="regexp"):n instanceof Function?(a.typeKind="primitive",a.typeName="function"):(a.typeKind="anonymousStructure",a.typeName="object",a.properties=[],Object.keys(n).map(function(u){var d,f=n[u],v=e.valueToTypeAnnotaion(f),g=new O.X0(u);g.typeAnnotation=v,g.defaultValue=f,(d=a.properties)===null||d===void 0||d.push(g)}));break;default:a.typeKind="unknown",a.typeName=i;break}}return a}},{key:"typeAnnotaionToValue",value:function(n){var e,a,i=this,u;switch(n.typeName){case"array":u=(e=n.defaultValue)!==null&&e!==void 0?e:[];break;case"boolean":u=n.defaultValue?n.defaultValue=="true":!1;break;case"number":u=parseFloat(n.defaultValue);break;case"null":u=null;break;case"date":u=new Date(n.defaultValue);break;case"regexp":u=new RegExp(n.defaultValue);break;case"object":u={},(a=n.properties)===null||a===void 0||a.forEach(function(d){u[d.name]=i.typeAnnotaionToValue(d.typeAnnotation)});break;case"string":case"function":default:u=n.defaultValue;break}return u}},{key:"getParamArrayByJson",value:function(n){var e=[];return n&&Object.keys(n).forEach(function(a){var i=new O.dO(a);i.typeAnnotation=o.valueToTypeAnnotaion(n[a]),i.defaultValue=n[a],e.push(i)}),e}},{key:"getReturnArrayByJson",value:function(n){var e=[];return n&&Object.keys(n).forEach(function(a){var i=new O.z1(a);i.typeAnnotation=o.valueToTypeAnnotaion(n[a]),i.defaultValue=n[a],e.push(i)}),e}},{key:"getVariableArrayByJson",value:function(n){var e=[];return n&&Object.keys(n).forEach(function(a){var i=new O._w(a);i.typeAnnotation=o.valueToTypeAnnotaion(n[a]),i.defaultValue=n[a],e.push(i)}),e}},{key:"getEnvsArrayByJson",value:function(n){var e=[];return n&&Object.keys(n).forEach(function(a){var i=new dt(a);i.typeAnnotation=o.valueToTypeAnnotaion(n[a]),i.defaultValue=n[a],e.push(i)}),e}},{key:"getJsonByParams",value:function(n){var e=this,a={};return n==null||n.forEach(function(i){a[i.name]=i.typeAnnotation?e.typeAnnotaionToValue(i.typeAnnotation):i.defaultValue}),a}}]),o}(),h=t(33130),vt=function(r){var n,e=(0,p.useState)({}),a=m()(e,2),i=a[0],u=a[1];(0,p.useEffect)(function(){var f=r.values,v=f.params,g=f.variables,B=f.envs,D=f.returns,z=f.log;u({params:JSON.stringify(R.getJsonByParams(v)),variables:JSON.stringify(R.getJsonByParams(g)),returns:JSON.stringify(R.getJsonByParams(D)),envs:JSON.stringify(R.getJsonByParams(B)),log:z})},[r.values]);var d=(0,p.useCallback)(function(f){try{return JSON.parse(f),!0}catch(v){return!1}},[]);return(0,h.jsxs)("span",{children:[r.children,(0,h.jsx)(Z.Z,{open:(n=r.open)!==null&&n!==void 0?n:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return r==null?void 0:r.setOpen(!1)},children:(0,h.jsx)(we.Z,{formId:"logic-setting",values:i,onSubmit:function(v){console.log("\u63D0\u4EA4\u53C2\u6570"),console.log(v);var g=!1;Object.keys(v).forEach(function(B){var D=v[B];if(!d(D)){var z=B==="params"?"\u5165\u53C2":B==="variables"?"\u5C40\u90E8\u53D8\u91CF":B==="returns"?"\u8FD4\u56DE\u53C2\u6570":"\u73AF\u5883\u53D8\u91CF";switch(B){case"params":return P.ZP.error("\u5165\u53C2json\u683C\u5F0F\u9519\u8BEF"),g=!0,!1;break;case"variables":return P.ZP.error("\u5C40\u90E8\u53D8\u91CFjson\u683C\u5F0F\u9519\u8BEF"),g=!0,!1;break;case"returns":return P.ZP.error("\u8FD4\u56DE\u53C2\u6570json\u683C\u5F0F\u9519\u8BEF"),g=!0,!1;break;case"ens":return P.ZP.error("\u73AF\u5883\u53D8\u91CFjson\u683C\u5F0F\u9519\u8BEF"),g=!0,!1;break;default:break}}}),g||(r!=null&&r.onSubmit&&r.onSubmit(v),r==null||r.setOpen(!1))}})})]})},ft=vt,ht=t(5726),gt=t.n(ht),pt=t(73529),mt=function(r){var n,e=(0,pt.cI)();(0,p.useEffect)(function(){var u=r.values.params;e.setValues({params:JSON.stringify(R.getJsonByParams(u))})},[r.values]);var a=(0,p.useCallback)(function(u){try{return JSON.parse(u),!0}catch(d){return!1}},[]);function i(u){var d=!1;Object.keys(u).forEach(function(f){var v=u[f];if(["params","headers"].indexOf(f)>-1&&!a(v)){var g=f==="params"?"\u5165\u53C2":"\u8BF7\u6C42\u5934";return P.ZP.error("".concat(g,"json\u683C\u5F0F\u9519\u8BEF")),d=!0,!1}}),d||(r!=null&&r.onSubmit&&r.onSubmit(u,u.debugType),r==null||r.setOpen(!1))}return(0,h.jsxs)("span",{children:[r.children,(0,h.jsx)(Z.Z,{open:(n=r.open)!==null&&n!==void 0?n:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return r==null?void 0:r.setOpen(!1)},children:(0,h.jsx)(we.Z,{formId:"logic-debug-input",onSubmit:i})})]})},yt=mt,_t=t(57475);function St(o,r,n,e,a,i){return xe.apply(this,arguments)}function xe(){return xe=A()(I()().mark(function o(r,n,e,a,i,u){var d;return I()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:d="",v.t0=i,v.next=v.t0==="biz"?4:6;break;case 4:return a?d="/api/runtime/logic/v1/biz/".concat(r,"/").concat(a,"/").concat(e,"?debug=true"):d="/api/runtime/logic/v1/run-biz/".concat(r,"/").concat(e,"?debug=true"),v.abrupt("break",8);case 6:return d="/api/runtime/logic/v1/run-api/".concat(r,"?debug=true"),v.abrupt("break",8);case 8:return v.abrupt("return",(0,_t.v_)(d,n,{headers:s()({"Content-Type":"application/json"},u)}));case 9:case"end":return v.stop()}},o)})),xe.apply(this,arguments)}function zt(o,r){return be.apply(this,arguments)}function be(){return be=_asyncToGenerator(_regeneratorRuntime().mark(function o(r,n){return _regeneratorRuntime().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",post("/api/form/logic_instance/query",{filters:[{dataIndex:"logicId",values:[r],type:"="},{dataIndex:"bizId",values:[n],type:"="}]}).then(function(i){var u=i.data.result.items[0];return u}));case 1:case"end":return a.stop()}},o)})),be.apply(this,arguments)}function $t(o){return De.apply(this,arguments)}function De(){return De=_asyncToGenerator(_regeneratorRuntime().mark(function o(r){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",get("/api/ide/logic-instance/".concat(r)).then(function(a){var i=a.data.data;return i}));case 1:case"end":return e.stop()}},o)})),De.apply(this,arguments)}function Yt(o){return Te.apply(this,arguments)}function Te(){return Te=_asyncToGenerator(_regeneratorRuntime().mark(function o(r){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",post("/api/form/logic/add",r).then(function(a){var i=a.data.result;return i}));case 1:case"end":return e.stop()}},o)})),Te.apply(this,arguments)}function Xt(o){return Ae.apply(this,arguments)}function Ae(){return Ae=_asyncToGenerator(_regeneratorRuntime().mark(function o(r){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",del("/api/form/logic/delete/".concat(r)).then(function(a){return a.data.result}));case 1:case"end":return e.stop()}},o)})),Ae.apply(this,arguments)}function Ht(){return Oe.apply(this,arguments)}function Oe(){return Oe=_asyncToGenerator(_regeneratorRuntime().mark(function o(){var r,n,e=arguments;return _regeneratorRuntime().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return r=e.length>0&&e[0]!==void 0?e[0]:1,n=e.length>1&&e[1]!==void 0?e[1]:10,i.abrupt("return",post("/api/form/logic/query",{page:r,pageSize:n}).then(function(u){return u.data}));case 3:case"end":return i.stop()}},o)})),Oe.apply(this,arguments)}var Ze=t(44132),Pt=t(32126),Et=function(){var r=(0,p.useState)({}),n=m()(r,2),e=n[0],a=n[1],i=(0,p.useState)({}),u=m()(i,2),d=u[0],f=u[1],v=(0,p.useState)({}),g=m()(v,2),B=g[0],D=g[1],z=(0,p.useState)(!0),ae=m()(z,2),Q=ae[0],le=ae[1],xt=(0,p.useState)(!1),Ke=m()(xt,2),bt=Ke[0],N=Ke[1],Dt=(0,p.useState)("1"),Ve=m()(Dt,2),Le=Ve[0],kt=Ve[1],Tt=(0,p.useState)(),We=m()(Tt,2),Me=We[0],At=We[1],Ot=(0,p.useState)([]),Ge=m()(Ot,2),Lt=Ge[0],Mt=Ge[1],Bt=(0,p.useState)([]),ze=m()(Bt,2),It=ze[0],jt=ze[1],Rt=(0,p.useState)(!1),$e=m()(Rt,2),Ye=$e[0],Xe=$e[1],Jt=(0,p.useState)(!1),He=m()(Jt,2),ke=He[0],Be=He[1],Ft=(0,p.useState)(new Map),Qe=m()(Ft,2),pe=Qe[0],qe=Qe[1],Nt=(0,ie.UO)(),me=Nt.id,Ut=new he;function et(c){window.document.title="["+c.name+"]:"+c.version}function tt(){N(!0);var c=Ut.graphToLogicItems(Me,e);c.version=nt(),a(c),at(c),et(c)}function nt(){return gt()(Date.now()).format("YYYYMMDDHHmmss")}function at(c){(0,Ne.az)(me,c.version,JSON.stringify(c)).then(function(y){N(!1),console.log("save logic"),console.log(c),y.status==200?(P.ZP.success("\u4FDD\u5B58\u6210\u529F"),console.log("save logic success")):(P.ZP.error("\u4FDD\u5B58\u5931\u8D25\uFF1A"+y.statusText),console.error("save logic error"))}).catch(function(y){N(!1),console.log("err"),console.log(y),P.ZP.error("\u4FDD\u5B58\u5931\u8D25")})}(0,p.useEffect)(function(){f({jsTips:s()({},pe)})},[pe]);function wt(c){var y,_,$,re,J={};J._par=c.params,J._var=c.variables,qe(s()(s()({},pe),J));var je=R.getParamArrayByJson(JSON.parse((y=c.params)!==null&&y!==void 0?y:"{}")),Y=R.getReturnArrayByJson(JSON.parse((_=c.returns)!==null&&_!==void 0?_:"{}")),Re=R.getVariableArrayByJson(JSON.parse(($=c.variables)!==null&&$!==void 0?$:"{}")),Vt=R.getEnvsArrayByJson(JSON.parse((re=c.envs)!==null&&re!==void 0?re:"{}")),Je=s()(s()({},e),{},{params:je,returns:Y,variables:Re,envs:Vt,log:c.log});Je.version=nt(),a(Je),at(Je)}function Zt(c){return Ie.apply(this,arguments)}function Ie(){return Ie=A()(I()().mark(function c(y){var _,$;return I()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return _={},_._par=JSON.stringify(R.getJsonByParams(y.params)),_._var=JSON.stringify(R.getJsonByParams(y.variables)),J.next=5,(0,Pt.U)();case 5:$=J.sent,_._env=JSON.stringify($),_._lastRet="{}",_._last=JSON.stringify({success:!0,msg:""}),qe(_),N(!1);case 11:case"end":return J.stop()}},c)})),Ie.apply(this,arguments)}(0,p.useEffect)(function(){(0,ot.m)(C()(it.C.values())),N(!0),(0,Ne.qB)(me).then(function(c){var y=c.name,_=c.configJson;_.id=me,_.name=y,a(_),D(_==null?void 0:_.visualConfig),Zt(_),et(_)}).catch(function(c){N(!1),console.log("err"),console.log(c)}),Ce().then(function(c){jt(c.Groups),Mt(c.Nodes)})},[]);var Kt=(0,p.useCallback)(function(){return new oe.bn.kS({attrs:{line:{targetMarker:"classic",stroke:Le=="1"?"#000000":"#FF9900"}},zIndex:0,data:{type:Le}})},[Le]);return(0,h.jsx)("div",{children:(0,h.jsx)(q.Z,{spinning:bt,children:(0,h.jsx)(w.l,{editorCtx:d,panelData:{Nodes:C()(Lt),Groups:[{name:"ctrl",title:"\u903B\u8F91\u63A7\u5236",graphHeight:360}].concat(C()(It))},showLeft:Q,graphIns:Me,toolElements:[(0,h.jsx)(K.ZP,{type:"text",icon:Q?(0,h.jsx)(l.Z,{}):(0,h.jsx)(E.Z,{}),onClick:function(){le(!Q)},style:{fontSize:"16px",width:64,height:64}}),(0,h.jsx)(K.ZP,{icon:(0,h.jsx)(b.Z,{}),type:"primary",onClick:function(){return tt()},children:"\u4FDD\u5B58"}),(0,h.jsx)(ft,{open:Ye,values:s()({},e),setOpen:function(){Xe(!Ye)},onSubmit:wt,children:(0,h.jsx)(K.ZP,{onClick:function(){return Xe(!0)},icon:(0,h.jsx)(V.Z,{style:{color:"#1677ff"}}),children:"\u53C2\u6570"})}),(0,h.jsx)(yt,{open:ke,setOpen:function(){return Be(!ke)},values:{params:e==null?void 0:e.params},onSubmit:function(y,_){if(Be(!1),e){var $=y.params,re=y.bizId,J=y.headers,je=y.bizStartCode;N(!0),St(me,JSON.parse($),re,je,_,JSON.parse(J)).then(function(Y){Y.data.code==0?(N(!1),Z.Z.success({title:"\u6267\u884C\u6210\u529F",width:"1000px",closable:!0,content:(0,h.jsx)("div",{children:(0,h.jsx)(Ze.Z,{pageId:"debug-info",data:Y.data})})})):(N(!1),Z.Z.error({title:(0,h.jsx)("span",{children:Y.data.msg}),width:"1200px",closable:!0,content:(0,h.jsx)("div",{children:(0,h.jsx)(Ze.Z,{pageId:"debug-info",data:Y.data})})}))}).catch(function(Y){N(!1);var Re=Y.response.data;Z.Z.error({title:(0,h.jsx)("span",{children:Re.msg}),width:"1200px",closable:!0})})}},children:(0,h.jsx)(K.ZP,{onClick:function(){Be(!0)},icon:(0,h.jsx)(x.Z,{style:{color:"#1677ff"}}),children:"\u8C03\u8BD5"})}),(0,h.jsx)(K.ZP,{icon:(0,h.jsx)(ye.Z,{style:{color:"#1677ff"}}),onClick:function(){(0,Ue.V)(Me)},children:"\u5E03\u5C40"}),(0,h.jsxs)(se.Z.Text,{strong:!0,style:{fontSize:"18px"},children:["[",e.name,"]"]}),(0,h.jsxs)(se.Z.Text,{children:["\u7248\u672C:",e.version]})],graphJson:B,onGraphJsonEmpty:st,createEdge:Kt,edgeTools:["button-remove","vertices","segments"],onSave:function(){return tt()},jsTipMap:pe,autoLayout:function(y){return(0,Ue.V)(y)},onGraphInsChange:function(y){return At(y)}})})})},Ct=Et},32126:function(ce,F,t){t.d(F,{U:function(){return H}});var j=t(25359),I=t.n(j),X=t(49811),C=t.n(X),T=t(31837),A=t(57475);function H(){return s.apply(this,arguments)}function s(){return s=C()(I()().mark(function U(){return I()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.abrupt("return",(0,A.U2)("/api/runtime/env").then(function(P){return P.data.data}).then(function(P){return T.j.setModel(P.UI_CONFIG_MODEL),T.j.setEnv(JSON.stringify(P)),T.j.setApiUrlPrefix(P.API_GATEWAY_PREFIX),T.j.setReryApi(P.CUSTOM_RETRY_URL),P}));case 1:case"end":return w.stop()}},U)})),s.apply(this,arguments)}}}]);
