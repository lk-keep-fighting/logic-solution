"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[883],{86119:function(yn,H,t){t.r(H),t.d(H,{default:function(){return Yt}});var ct=t(25359),Y=t.n(ct),dt=t(93525),L=t.n(dt),ft=t(49811),gt=t.n(ft),St=t(57213),g=t.n(St),mt=t(54306),r=t.n(mt),ht=t(60341),S=t(83217),pt=t(72197),j=t(54145),Ct=t(70710),J=t(51394),U=t(36267),o=t(87363),yt=t(98306),xt=t(5671),jt=t(14990),Jt=t(22465),Ot=t(72237),Tt=t(93853),Zt=t(28110),Bt=t(49228),Et=t(79716),Ft=t(21558),Lt=t(65020),Pt=t(2325),O=t(48364),Dt=t(55515),P=t(3619),Nt=t(7944),m=t(94744),At=t(5726),Gt=t.n(At),It=t(79671),W=t(44132),Mt=t(32126),zt=t(2069),a=t(33130),Rt=function(h){var T=h.onConfirm,i=h.onCancel,p=h.isOpen,D=(0,o.useState)(""),C=r()(D,2),Z=C[0],N=C[1],A=function(){try{T(Z)}catch(x){S.ZP.error(x.message)}};return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(J.Z,{title:"\u5BFC\u5165json\u751F\u6210\u6D41\u7A0B\u56FE",visible:p,cancelText:"\u53D6\u6D88",okText:"\u786E\u5B9A\u5BFC\u5165\u8986\u76D6",onOk:A,width:800,onCancel:function(){return i()},children:(0,a.jsx)(zt.ML,{width:"100%",height:500,value:Z,allowFullscreen:!0,language:"json",onChange:function(x){return N(x)},placeholder:"\u5728\u8FD9\u91CC\u7C98\u8D34json"})})})},$t=Rt,Vt=t(77357),Ht=function(){var h=(0,o.useState)({}),T=r()(h,2),i=T[0],p=T[1],D=(0,o.useState)({}),C=r()(D,2),Z=C[0],N=C[1],A=(0,o.useState)({}),y=r()(A,2),x=y[0],K=y[1],Wt=(0,o.useState)(!0),Q=r()(Wt,2),G=Q[0],Kt=Q[1],Qt=(0,o.useState)(!1),X=r()(Qt,2),Xt=X[0],v=X[1],bt=(0,o.useState)("1"),b=r()(bt,2),I=b[0],xn=b[1],kt=(0,o.useState)(!1),k=r()(kt,2),wt=k[0],M=k[1],qt=(0,o.useState)(),w=r()(qt,2),B=w[0],_t=w[1],tn=(0,o.useState)([]),q=r()(tn,2),nn=q[0],en=q[1],an=(0,o.useState)([]),_=r()(an,2),sn=_[0],on=_[1],rn=(0,o.useState)(!1),tt=r()(rn,2),nt=tt[0],et=tt[1],un=(0,o.useState)(!1),at=r()(un,2),st=at[0],z=at[1],ln=(0,o.useState)(new Map),ot=r()(ln,2),E=ot[0],rt=ot[1],vn=(0,yt.UO)(),F=vn.id,cn=new Ft.W;function ut(n){window.document.title="["+n.name+"]:"+n.version}function lt(){v(!0),(0,O.qB)(F).then(function(n){if(n.version&&n.version!=i.version)v(!1),S.ZP.error("\u672C\u5730\u7248\u672C\u4E0E\u670D\u52A1\u5668[".concat(n.version,"]\u4E0D\u4E00\u81F4\uFF0C\u65E0\u6CD5\u4FDD\u5B58\uFF01\u8BF7\u6253\u5F00\u65B0\u8BBE\u8BA1\u9875\u624B\u52A8\u5408\u5E76\u903B\u8F91\uFF01"));else{var e=cn.graphToLogicItems(B,i);e.version=it(),p(e),vt(e),ut(e)}}).catch(function(n){v(!1),S.ZP.error("\u83B7\u53D6\u903B\u8F91\u5931\u8D25\uFF01"),console.log("err"),console.log(n)})}function it(){return Gt()(Date.now()).format("YYYYMMDDHHmmss")}function vt(n){(0,O.az)(F,n.version,JSON.stringify(n)).then(function(e){v(!1),console.log("save logic"),console.log(n),e.status==200?(S.ZP.success("\u4FDD\u5B58\u6210\u529F"),console.log("save logic success")):(S.ZP.error("\u4FDD\u5B58\u5931\u8D25\uFF1A"+e.statusText),console.error("save logic error"))}).catch(function(e){v(!1),console.log("err"),console.log(e),S.ZP.error("\u4FDD\u5B58\u5931\u8D25")})}(0,o.useEffect)(function(){N({jsTips:g()({},E)})},[E]);function dn(n){var e,l,s,c,d,f={};f._par=n.params,f._var=n.variables,f._global=(e=n.variables.__global)!==null&&e!==void 0?e:"{}",rt(g()(g()({},E),f));var u=m.y.getParamArrayByJson(JSON.parse((l=n.params)!==null&&l!==void 0?l:"{}")),$=m.y.getReturnArrayByJson(JSON.parse((s=n.returns)!==null&&s!==void 0?s:"{}")),pn=m.y.getVariableArrayByJson(JSON.parse((c=n.variables)!==null&&c!==void 0?c:"{}")),Cn=m.y.getEnvsArrayByJson(JSON.parse((d=n.envs)!==null&&d!==void 0?d:"{}")),V=g()(g()({},i),{},{params:u,returns:$,variables:pn,envs:Cn,log:n.log});V.version=it(),p(V),vt(V)}function fn(n){return R.apply(this,arguments)}function R(){return R=gt()(Y()().mark(function n(e){var l,s,c,d;return Y()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return s={},s._par=JSON.stringify(m.y.getJsonByParams(e.params)),c=m.y.getJsonByParams(e.variables),s._var=JSON.stringify(c),s._global=JSON.stringify((l=c.__global)!==null&&l!==void 0?l:"{}"),u.next=7,Mt.S.getEnvJson();case 7:d=u.sent,s._env=JSON.stringify(d),s._lastRet="{}",s._last=JSON.stringify({success:!0,msg:""}),rt(s),v(!1);case 13:case"end":return u.stop()}},n)})),R.apply(this,arguments)}function gn(n){(0,O.qB)(n).then(function(e){var l=e.name,s=e.configJson;s.id=n,s.name=l,p(s),K(s==null?void 0:s.visualConfig),fn(s),ut(s)}).catch(function(e){v(!1),console.log("err"),console.log(e)})}(0,o.useEffect)(function(){(0,Dt.m)(L()(Pt.C.values())),v(!0),gn(F),(0,Et.O)().then(function(n){on(n.Groups),en(n.Nodes)})},[]);var Sn=(0,o.useCallback)(function(){return new xt.bn.kS({attrs:{line:{targetMarker:"classic",stroke:I=="1"?"#000000":"#FF9900"}},zIndex:0,data:{type:I}})},[I]),mn=[{key:"imoport",label:"\u5BFC\u5165Json\u914D\u7F6E"}],hn=function(e){M(!0)};return(0,a.jsx)("div",{children:(0,a.jsx)(pt.Z,{spinning:Xt,children:(0,a.jsx)(ht.l,{editorCtx:Z,panelData:{Nodes:L()(nn),Groups:[{name:"ctrl",title:"\u903B\u8F91\u63A7\u5236",graphHeight:360}].concat(L()(sn))},showLeft:G,graphIns:B,toolElements:[(0,a.jsx)(j.ZP,{type:"text",icon:G?(0,a.jsx)(jt.Z,{}):(0,a.jsx)(Jt.Z,{}),onClick:function(){Kt(!G)},style:{fontSize:"16px",width:64,height:64}}),(0,a.jsxs)(Ct.Z.Button,{type:"primary",onClick:function(){return lt()},menu:{items:mn,onClick:hn},children:[(0,a.jsx)(Ot.Z,{}),"\u4FDD\u5B58"]}),(0,a.jsx)(Nt.Z,{open:nt,values:g()({},i),setOpen:function(){et(!nt)},onSubmit:dn,children:(0,a.jsx)(j.ZP,{onClick:function(){return et(!0)},icon:(0,a.jsx)(Tt.Z,{style:{color:"#1677ff"}}),children:"\u53C2\u6570"})}),(0,a.jsx)(It.Z,{open:st,setOpen:function(){return z(!st)},values:{params:i==null?void 0:i.params},onSubmit:function(e,l){if(z(!1),i){var s=e.params,c=e.bizId,d=e.headers,f=e.bizStartCode;v(!0),(0,O.L7)(F,JSON.parse(s),c,f,l,JSON.parse(d)).then(function(u){u.data.code==0?(v(!1),J.Z.success({title:"\u6267\u884C\u6210\u529F",width:"1000px",okText:"\u5173\u95ED",closable:!0,content:(0,a.jsx)("div",{children:(0,a.jsx)(W.Z,{pageId:"debug-info",data:u.data})})})):(v(!1),J.Z.error({title:(0,a.jsx)("span",{children:u.data.msg}),width:"1200px",okText:"\u5173\u95ED",closable:!0,content:(0,a.jsx)("div",{children:(0,a.jsx)(W.Z,{pageId:"debug-info",data:u.data})})}))}).catch(function(u){v(!1);var $=u.response.data;J.Z.error({title:(0,a.jsx)("span",{children:$.msg}),width:"1200px",closable:!0})})}},children:(0,a.jsx)(j.ZP,{onClick:function(){z(!0)},icon:(0,a.jsx)(Zt.Z,{style:{color:"#1677ff"}}),children:"\u8C03\u8BD5"})}),(0,a.jsx)($t,{onConfirm:function(e){M(!1);var l=(0,Vt.S8)(JSON.parse(e));K(l),setTimeout(function(){(0,P.V)(B)},500)},onCancel:function(){return M(!1)},isOpen:wt}),(0,a.jsx)(j.ZP,{icon:(0,a.jsx)(Bt.Z,{style:{color:"#1677ff"}}),onClick:function(){(0,P.V)(B)},children:"\u5E03\u5C40"}),(0,a.jsxs)(U.Z.Text,{strong:!0,style:{fontSize:"18px"},children:["[",i.name,"]"]}),(0,a.jsxs)(U.Z.Text,{children:["\u7248\u672C:",i.version]})],graphJson:x,onGraphJsonEmpty:Lt.n,createEdge:Sn,edgeTools:["button-remove","vertices","segments"],onSave:function(){return lt()},jsTipMap:E,autoLayout:function(e){return(0,P.V)(e)},onGraphInsChange:function(e){return _t(e)}})})})},Yt=Ht}}]);
