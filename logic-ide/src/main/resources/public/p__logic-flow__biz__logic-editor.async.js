"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[883],{60341:function(ie,M,t){t.d(M,{l:function(){return F.Z}});var F=t(93797)},2325:function(ie,M,t){t.d(M,{C:function(){return F}});var F=new Map,D=50,b=50;F.set("ExtSharp",{name:"ExtSharp",config:{width:100,height:b,attrs:{body:{rx:6,ry:6,stroke:"#5F95FF",strokeWidth:1,fill:"rgba(95,149,255,0.05)",refWidth:1,refHeight:1},image:{refX:2,refY:0},text:{refX:4,refY:20,fontSize:12,"text-anchor":"start"}},markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}})},44132:function(ie,M,t){var F=t(54306),D=t.n(F),b=t(70517),Q=t(90010),ae=t.n(Q),z=t(23620),U=t(2069),x=t(87363),de=t.n(x),P=t(70256),oe=t(33358),W=t(49500),k=t(16123),Z=t(69078),I=t(98896),S=t(33130),G=function(N){var se=(0,x.useState)({type:"page"}),w=D()(se,2),ue=w[0],H=w[1],_="cxd",K="zh-CN";return(0,x.useEffect)(function(){(0,I.m)(b.Z)},[]),(0,x.useEffect)(function(){N.pageId&&(0,P.UD)(N.pageId).then(function(u){H(u)})},[N.pageId]),(0,S.jsxs)("div",{children:[(0,S.jsx)(U.qR,{theme:_,position:"top-right",locale:K},"toast"),(0,S.jsx)(U.wx,{theme:_,locale:K},"alert"),(0,z.sYA)(ue,{data:N.data},{fetcher:function(i){var m=i.url,c=i.method,l=i.data,E=i.responseType,h=i.config,B=i.headers;return h=h||{},h.withCredentials=!0,E&&(h.responseType=E),h.cancelExecutor&&(h.cancelToken=new b.Z.CancelToken(h.cancelExecutor)),h.headers=B||{},h.headers.Authorization||(h.headers.Authorization="Bearer "+Z.F.getTokenFormLocal()),c!=="post"&&c!=="put"&&c!=="patch"?(l&&(h.params=l),b.Z[c](m,h)):(l&&l instanceof FormData?(h.headers=h.headers||{},h.headers["Content-Type"]="multipart/form-data"):l&&typeof l!="string"&&!(l instanceof Blob)&&!(l instanceof ArrayBuffer)&&(l=JSON.stringify(l),h.headers=h.headers||{},h.headers["Content-Type"]="application/json"),b.Z[c](m,l,h))},isCancel:function(i){return b.Z.isCancel(i)},copy:function(i){ae()(i),U.Am.success("\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u7C98\u8D34\u677F")},theme:_,jumpTo:function(i,m){debugger;m.blank==!0?window.open(window.location.origin+window.location.pathname+"#"+i,"_blank"):window.location.hash=i}})]})};M.Z=G},64435:function(ie,M,t){t.r(M),t.d(M,{default:function(){return ot}});var F=t(25359),D=t.n(F),b=t(93525),Q=t.n(b),ae=t(49811),z=t.n(ae),U=t(57213),x=t.n(U),de=t(54306),P=t.n(de),oe=t(60341),W=t(83217),k=t(72197),Z=t(54145),I=t(51394),S=t(87363),G=t(98306),fe=t(5671),N=t(14990),se=t(22465),w=t(72237),ue=t(93853),H=t(28110),_=t(58146);function K(){return u.apply(this,arguments)}function u(){return u=z()(D()().mark(function d(){return D()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(r,n){r((0,_.K)())}));case 1:case"end":return e.stop()}},d)})),u.apply(this,arguments)}var i=t(21140),m=t.n(i),c=t(63466),l=t.n(c),E=t(72107),h=null;function B(d,a,e,r){var n,o,s=d.data.config,g=s.type,p=e.flatMap(function(A){return A.source.cell===d.id?a[A.target.cell]:[]}),T=d.attrs,C=new E.Du((n=d.id)!==null&&n!==void 0?n:"",g);if(C=x()(x()({},s),{},{id:d.id,name:T==null||(o=T.text)===null||o===void 0?void 0:o.text}),!(r.findIndex(function(A){return A.id===C.id})>-1)&&(r.push(C),p.length!==0))switch(g){default:if(p.length>1||C.type==="switch"){var O;console.log((O=d.data)===null||O===void 0?void 0:O.config),console.log(p),C.branches=[],p.forEach(function(A){var Y,ee,X,re;console.log((Y=A.data)===null||Y===void 0?void 0:Y.config),(ee=C.branches)===null||ee===void 0||ee.push({when:(X=A.data)===null||X===void 0||(re=X.config)===null||re===void 0?void 0:re.case,nextId:A.id}),B(a[A.id],a,e,r)})}else C.nextId=p[0].id,B(a[p[0].id],a,e,r);break}}function Ee(d,a){var e=new E.Iz(d),r=[],n=[],o={},s=void 0;if(a.forEach(function(g){var p=g.id||"";if(g.shape==="edge")r.push(g);else{var T=g.attrs;o[p]=g,n.push(g),g.data.config.type==="start"&&(s=g)}}),!s){W.ZP.error("\u672A\u53D1\u73B0\u5F00\u59CB\u8282\u70B9\uFF0C\u8BF7\u914D\u7F6E\uFF01");return}return B(s,o,r,e.items),console.log("logic.items"),console.log(e.items),e}function j(d){var a=[];return d.items.forEach(function(e){var r={id:e.id,shape:e.type,size:{width:80,height:40},data:{config:e},attrs:{text:{text:e.name}}};if(a.push(r),e.branches&&e.branches.length>0)e.branches.forEach(function(o){var s={shape:"edge",source:{cell:e.id},target:{cell:o.nextId},labels:[{position:.5,attrs:{label:{text:o.when}}}]};a.push(s)});else if(e.nextId){var n={shape:"edge",source:{cell:e.id},target:{cell:e.nextId}};a.push(n)}}),a}var Ke=function(){function d(){m()(this,d)}return l()(d,[{key:"graphToLogicItems",value:function(e,r){var n=Ee(r==null?void 0:r.id,e==null?void 0:e.getCells());return n.visualConfig=e==null?void 0:e.toJSON(),x()(x()({},r),{},{visualConfig:n.visualConfig,items:n.items})}}]),d}(),Ve=t(12490);function $e(d){var a=d.createNode({shape:"circle",label:"start",width:50,height:50,attrs:{body:{}},ports:Ve.Hi,data:{config:{type:"start"}}});d.addNode(a)}var Ce=t(2325),Te=t(48364),ze=t(89147),Ue=t(3619),xe=t(94990),We=t(37635),Ge=t.n(We),He=t(52510),q=t.n(He),Ye=l()(function d(a){m()(this,d),q()(this,"concept","EnvParam"),q()(this,"name",void 0),q()(this,"description",void 0),q()(this,"typeAnnotation",void 0),q()(this,"required",!1),q()(this,"defaultValue",void 0),this.name=a}),J=function(){function d(){m()(this,d)}return l()(d,null,[{key:"valueToTypeAnnotaion",value:function(e){var r=this,n={concept:E.Ld.TypeAnnotation,typeKind:"primitive",typeName:"string",defaultValue:e};if(Array.isArray(e))n.typeName="array";else{var o=Ge()(e);switch(o){case"boolean":n.typeKind="primitive",n.typeName="boolean";break;case"number":n.typeKind="primitive",n.typeName="number";break;case"string":n.typeKind="primitive",n.typeName="string";break;case"object":e==null?n.typeName="null":e instanceof Date?(n.typeKind="primitive",n.typeName="date"):e instanceof RegExp?(n.typeKind="primitive",n.typeName="regexp"):e instanceof Function?(n.typeKind="primitive",n.typeName="function"):(n.typeKind="anonymousStructure",n.typeName="object",n.properties=[],Object.keys(e).map(function(s){var g,p=e[s],T=r.valueToTypeAnnotaion(p),C=new E.X0(s);C.typeAnnotation=T,C.defaultValue=p,(g=n.properties)===null||g===void 0||g.push(C)}));break;default:n.typeKind="unknown",n.typeName=o;break}}return n}},{key:"typeAnnotaionToValue",value:function(e){var r,n,o=this,s;switch(e.typeName){case"array":s=(r=e.defaultValue)!==null&&r!==void 0?r:[];break;case"boolean":s=e.defaultValue?e.defaultValue=="true":!1;break;case"number":s=parseFloat(e.defaultValue);break;case"null":s=null;break;case"date":s=new Date(e.defaultValue);break;case"regexp":s=new RegExp(e.defaultValue);break;case"object":s={},(n=e.properties)===null||n===void 0||n.forEach(function(g){s[g.name]=o.typeAnnotaionToValue(g.typeAnnotation)});break;case"string":case"function":default:s=e.defaultValue;break}return s}},{key:"getParamArrayByJson",value:function(e){var r=[];return e&&Object.keys(e).forEach(function(n){var o=new E.dO(n);o.typeAnnotation=d.valueToTypeAnnotaion(e[n]),o.defaultValue=e[n],r.push(o)}),r}},{key:"getReturnArrayByJson",value:function(e){var r=[];return e&&Object.keys(e).forEach(function(n){var o=new E.z1(n);o.typeAnnotation=d.valueToTypeAnnotaion(e[n]),o.defaultValue=e[n],r.push(o)}),r}},{key:"getVariableArrayByJson",value:function(e){var r=[];return e&&Object.keys(e).forEach(function(n){var o=new E._w(n);o.typeAnnotation=d.valueToTypeAnnotaion(e[n]),o.defaultValue=e[n],r.push(o)}),r}},{key:"getEnvsArrayByJson",value:function(e){var r=[];return e&&Object.keys(e).forEach(function(n){var o=new Ye(n);o.typeAnnotation=d.valueToTypeAnnotaion(e[n]),o.defaultValue=e[n],r.push(o)}),r}},{key:"getJsonByParams",value:function(e){var r=this,n={};return e==null||e.forEach(function(o){n[o.name]=o.typeAnnotation?r.typeAnnotaionToValue(o.typeAnnotation):o.defaultValue}),n}}]),d}(),v=t(33130),Xe=function(a){var e,r=(0,S.useState)({}),n=P()(r,2),o=n[0],s=n[1];(0,S.useEffect)(function(){var p=a.values,T=p.params,C=p.variables,O=p.envs,A=p.returns;s({params:JSON.stringify(J.getJsonByParams(T)),variables:JSON.stringify(J.getJsonByParams(C)),returns:JSON.stringify(J.getJsonByParams(A)),envs:JSON.stringify(J.getJsonByParams(O))})},[a.values]);var g=(0,S.useCallback)(function(p){try{return JSON.parse(p),!0}catch(T){return!1}},[]);return(0,v.jsxs)("span",{children:[a.children,(0,v.jsx)(I.Z,{open:(e=a.open)!==null&&e!==void 0?e:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return a==null?void 0:a.setOpen(!1)},children:(0,v.jsx)(xe.Z,{formId:"logic-setting",values:o,onSubmit:function(T){console.log("\u63D0\u4EA4\u53C2\u6570"),console.log(T);var C=!1;Object.keys(T).forEach(function(O){var A=T[O];if(!g(A)){var Y=O==="params"?"\u5165\u53C2":O==="variables"?"\u5C40\u90E8\u53D8\u91CF":O==="returns"?"\u8FD4\u56DE\u53C2\u6570":"\u73AF\u5883\u53D8\u91CF";return W.ZP.error("".concat(Y,"json\u683C\u5F0F\u9519\u8BEF")),C=!0,!1}}),C||(a!=null&&a.onSubmit&&a.onSubmit(T),a==null||a.setOpen(!1))}})})]})},Qe=Xe,ke=t(5726),_e=t.n(ke),qe=t(11455),et=function(a){var e,r=(0,qe.cI)();(0,S.useEffect)(function(){var s=a.values.params;r.setValues({params:JSON.stringify(J.getJsonByParams(s))})},[a.values]);var n=(0,S.useCallback)(function(s){try{return JSON.parse(s),!0}catch(g){return!1}},[]);function o(s){var g=!1;Object.keys(s).forEach(function(p){var T=s[p];if(["params","headers"].indexOf(p)>-1&&!n(T)){var C=p==="params"?"\u5165\u53C2":"\u8BF7\u6C42\u5934";return W.ZP.error("".concat(C,"json\u683C\u5F0F\u9519\u8BEF")),g=!0,!1}}),g||(a!=null&&a.onSubmit&&a.onSubmit(s,s.debugType),a==null||a.setOpen(!1))}return(0,v.jsxs)("span",{children:[a.children,(0,v.jsx)(I.Z,{open:(e=a.open)!==null&&e!==void 0?e:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return a==null?void 0:a.setOpen(!1)},children:(0,v.jsx)(xe.Z,{formId:"logic-debug-input",onSubmit:o})})]})},tt=et,nt=t(61719),Pe=t(44132),at=t(70517);function rt(){return ve.apply(this,arguments)}function ve(){return ve=z()(D()().mark(function d(){return D()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",at.Z.get("/api/runtime/env").then(function(r){return r.data.data}));case 1:case"end":return e.stop()}},d)})),ve.apply(this,arguments)}var it=function(){var a=(0,S.useState)({}),e=P()(a,2),r=e[0],n=e[1],o=(0,S.useState)({}),s=P()(o,2),g=s[0],p=s[1],T=(0,S.useState)({}),C=P()(T,2),O=C[0],A=C[1],Y=(0,S.useState)(!0),ee=P()(Y,2),X=ee[0],re=ee[1],st=(0,S.useState)(!1),Ae=P()(st,2),ut=Ae[0],te=Ae[1],lt=(0,S.useState)("1"),Oe=P()(lt,2),ge=Oe[0],Pt=Oe[1],ct=(0,S.useState)(),Le=P()(ct,2),De=Le[0],dt=Le[1],ft=(0,S.useState)([]),be=P()(ft,2),vt=be[0],gt=be[1],pt=(0,S.useState)(!1),Ie=P()(pt,2),Be=Ie[0],Je=Ie[1],ht=(0,S.useState)(!1),Re=P()(ht,2),Me=Re[0],pe=Re[1],mt=(0,S.useState)(new Map),Fe=P()(mt,2),le=Fe[0],Ne=Fe[1],yt=(0,G.UO)(),ce=yt.id,St=new Ke;function je(){te(!0);var f=St.graphToLogicItems(De,r);f.version=Ze(),n(f),we(f)}function Ze(){return _e()(Date.now()).format("YYYYMMDDHHmmss")}function we(f){(0,Te.az)(ce,f.version,JSON.stringify(f)).then(function(y){te(!1),W.ZP.success("\u4FDD\u5B58\u6210\u529F"),console.log("save logic"),console.log(f)}).catch(function(y){te(!1),console.log("err"),console.log(y),W.ZP.error("\u4FDD\u5B58\u5931\u8D25")})}(0,S.useEffect)(function(){p({jsTips:x()({},le)})},[le]);function Et(f){var y,L,V,ne,R={};R._par=f.params,R._var=f.variables,Ne(x()(x()({},le),R));var me=J.getParamArrayByJson(JSON.parse((y=f.params)!==null&&y!==void 0?y:"{}")),$=J.getReturnArrayByJson(JSON.parse((L=f.returns)!==null&&L!==void 0?L:"{}")),ye=J.getVariableArrayByJson(JSON.parse((V=f.variables)!==null&&V!==void 0?V:"{}")),xt=J.getEnvsArrayByJson(JSON.parse((ne=f.envs)!==null&&ne!==void 0?ne:"{}")),Se=x()(x()({},r),{},{params:me,returns:$,variables:ye,envs:xt});Se.version=Ze(),n(Se),we(Se)}function Ct(f){return he.apply(this,arguments)}function he(){return he=z()(D()().mark(function f(y){var L,V;return D()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return L={},L._par=JSON.stringify(J.getJsonByParams(y.params)),L._var=JSON.stringify(J.getJsonByParams(y.variables)),R.next=5,rt();case 5:V=R.sent,L._env=JSON.stringify(V),L._lastRet="{}",Ne(L),te(!1);case 10:case"end":return R.stop()}},f)})),he.apply(this,arguments)}(0,S.useEffect)(function(){(0,ze.m)([Ce.C.get("ExtSharp")]),te(!0),(0,Te.YH)(ce).then(function(f){var y=f;y.id=ce,n(y),A(y==null?void 0:y.visualConfig),Ct(y)}).catch(function(f){te(!1),console.log("err"),console.log(f)}),K().then(function(f){gt(f.Nodes)})},[]);var Tt=(0,S.useCallback)(function(){return new fe.bn.kS({attrs:{line:{targetMarker:"classic",stroke:ge=="1"?"#000000":"#FF9900"}},zIndex:0,data:{type:ge}})},[ge]);return(0,v.jsx)("div",{children:(0,v.jsx)(k.Z,{spinning:ut,children:(0,v.jsx)(oe.l,{editorCtx:g,panelData:{Nodes:Q()(vt),Shapes:[Ce.C.get("ExtSharp")],Groups:[{name:"global",title:"\u5168\u5C40\u8282\u70B9",graphHeight:110},{name:"ctrl",title:"\u903B\u8F91\u63A7\u5236",graphHeight:220},{name:"biz",title:"\u4E1A\u52A1\u8C03\u7528",graphHeight:220}]},showLeft:X,graphIns:De,toolElements:[(0,v.jsx)(Z.ZP,{type:"text",icon:X?(0,v.jsx)(N.Z,{}):(0,v.jsx)(se.Z,{}),onClick:function(){re(!X)},style:{fontSize:"16px",width:64,height:64}}),(0,v.jsx)(Z.ZP,{icon:(0,v.jsx)(w.Z,{}),type:"primary",onClick:function(){return je()},children:"\u4FDD\u5B58"}),(0,v.jsx)(Qe,{open:Be,values:x()({},r),setOpen:function(){Je(!Be)},onSubmit:Et,children:(0,v.jsx)(Z.ZP,{onClick:function(){return Je(!0)},icon:(0,v.jsx)(ue.Z,{}),children:"\u914D\u7F6E\u53C2\u6570"})}),(0,v.jsx)(tt,{open:Me,setOpen:function(){return pe(!Me)},values:{params:r==null?void 0:r.params},onSubmit:function(y,L){if(pe(!1),r){var V=y.params,ne=y.bizId,R=y.headers,me=y.bizStartCode;(0,nt.L7)(ce,JSON.parse(V),ne,me,L,JSON.parse(R)).then(function($){$.data.code==0?I.Z.success({title:"\u6267\u884C\u6210\u529F",width:"1000px",closable:!0,content:(0,v.jsx)("div",{children:(0,v.jsx)(Pe.Z,{pageId:"debug-info",data:$.data})})}):I.Z.error({title:(0,v.jsx)("span",{children:$.data.msg}),width:"1200px",closable:!0,content:(0,v.jsx)("div",{children:(0,v.jsx)(Pe.Z,{pageId:"debug-info",data:$.data})})})}).catch(function($){var ye=$.response.data;I.Z.error({title:(0,v.jsx)("span",{children:ye.msg}),width:"1200px",closable:!0})})}},children:(0,v.jsx)(Z.ZP,{type:"default",onClick:function(){pe(!0)},icon:(0,v.jsx)(H.Z,{}),children:"\u8C03\u8BD5"})}),(0,v.jsxs)("span",{children:["\u5F53\u524D\u7248\u672C:",r.version]})],graphJson:O,onGraphJsonEmpty:$e,createEdge:Tt,edgeTools:["button-remove","vertices","segments"],onSave:function(){return je()},jsTipMap:le,autoLayout:function(y){return(0,Ue.V)(y)},onGraphInsChange:function(y){return dt(y)}})})})},ot=it},61719:function(ie,M,t){t.d(M,{L7:function(){return Z}});var F=t(57213),D=t.n(F),b=t(25359),Q=t.n(b),ae=t(49811),z=t.n(ae),U=t(70517);function x(u,i){return axios.get(u,i)}function de(u,i,m){return axios.put(u,i,m)}function P(u,i){return axios.delete(u,i)}function oe(u,i,m){return U.Z.post(u,i,m)}function W(u,i){return k.apply(this,arguments)}function k(){return k=_asyncToGenerator(_regeneratorRuntime().mark(function u(i,m){return _regeneratorRuntime().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",post("/api/runtime/logic/v1/run-fn/".concat(i),m,{headers:{"Content-Type":"application/json"}}));case 1:case"end":return l.stop()}},u)})),k.apply(this,arguments)}function Z(u,i,m,c,l,E){return I.apply(this,arguments)}function I(){return I=z()(Q()().mark(function u(i,m,c,l,E,h){var B;return Q()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:B="",j.t0=E,j.next=j.t0==="biz"?4:6;break;case 4:return l?B="/api/runtime/logic/v1/biz/".concat(i,"/").concat(l,"/").concat(c,"?debug=true"):B="/api/runtime/logic/v1/run-biz/".concat(i,"/").concat(c,"?debug=true"),j.abrupt("break",8);case 6:return B="/api/runtime/logic/v1/run-api/".concat(i,"?debug=true"),j.abrupt("break",8);case 8:return j.abrupt("return",oe(B,m,{headers:D()({"Content-Type":"application/json"},h)}));case 9:case"end":return j.stop()}},u)})),I.apply(this,arguments)}function S(u,i){return G.apply(this,arguments)}function G(){return G=_asyncToGenerator(_regeneratorRuntime().mark(function u(i,m){return _regeneratorRuntime().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",axios.post("/api/form/logic_instance/query",{filters:[{dataIndex:"logicId",values:[i],type:"="},{dataIndex:"bizId",values:[m],type:"="}]}).then(function(E){var h=E.data.result.items[0];return h}));case 1:case"end":return l.stop()}},u)})),G.apply(this,arguments)}function fe(u){return N.apply(this,arguments)}function N(){return N=_asyncToGenerator(_regeneratorRuntime().mark(function u(i){return _regeneratorRuntime().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",axios.get("/api/ide/logic-instance/".concat(i)).then(function(l){var E=l.data.data;return E}));case 1:case"end":return c.stop()}},u)})),N.apply(this,arguments)}function se(u){return w.apply(this,arguments)}function w(){return w=_asyncToGenerator(_regeneratorRuntime().mark(function u(i){return _regeneratorRuntime().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",axios.post("/api/form/logic/add",i).then(function(l){var E=l.data.result;return E}));case 1:case"end":return c.stop()}},u)})),w.apply(this,arguments)}function ue(u){return H.apply(this,arguments)}function H(){return H=_asyncToGenerator(_regeneratorRuntime().mark(function u(i){return _regeneratorRuntime().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",axios.delete("/api/form/logic/delete/".concat(i)).then(function(l){return l.data.result}));case 1:case"end":return c.stop()}},u)})),H.apply(this,arguments)}function _(){return K.apply(this,arguments)}function K(){return K=_asyncToGenerator(_regeneratorRuntime().mark(function u(){var i,m,c=arguments;return _regeneratorRuntime().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return i=c.length>0&&c[0]!==void 0?c[0]:1,m=c.length>1&&c[1]!==void 0?c[1]:10,E.abrupt("return",axios.post("/api/form/logic/query",{page:i,pageSize:m}).then(function(h){return h.data}));case 3:case"end":return E.stop()}},u)})),K.apply(this,arguments)}}}]);
