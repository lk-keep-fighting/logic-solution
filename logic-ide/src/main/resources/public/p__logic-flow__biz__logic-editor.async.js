"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[883],{60341:function(B,C,t){t.d(C,{l:function(){return N.Z}});var N=t(93797)},2325:function(B,C,t){t.d(C,{C:function(){return N}});var N=new Map,m=50,u=50;N.set("ExtSharp",{name:"ExtSharp",config:{width:100,height:u,attrs:{body:{rx:6,ry:6,stroke:"#5F95FF",strokeWidth:1,fill:"rgba(95,149,255,0.05)",refWidth:1,refHeight:1},image:{refX:2,refY:0},text:{refX:4,refY:20,fontSize:12,"text-anchor":"start"}},markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}})},42651:function(B,C,t){t.d(C,{Z:function(){return c}});var N=t(21140),m=t.n(N),u=t(63466),p=t.n(u),r=t(52510),l=t.n(r),c=function(){function S(g){m()(this,S),l()(this,"_nodeConfig",void 0),l()(this,"_groups",void 0),this._nodeConfig=JSON.parse(JSON.stringify(g)),this._nodeConfig._groups&&(this._groups=this._nodeConfig._groups)}return p()(S,[{key:"getNodeConfig",value:function(){return this._nodeConfig}},{key:"getGroups",value:function(){return this._groups}},{key:"setLabel",value:function(o){this._nodeConfig.attrs&&(this._nodeConfig.attrs.text.text=o)}},{key:"setGroups",value:function(o){this._groups=o}},{key:"setConfigSchemel",value:function(o){this._nodeConfig.data?(this._nodeConfig.data.configSchema=o,this._nodeConfig.data.config={type:o}):this._nodeConfig.data={configSchema:o,config:{type:o}}}},{key:"setConfigData",value:function(o){this._nodeConfig.data?this._nodeConfig.data.config=o:this._nodeConfig.data={config:o}}}]),S}()},3619:function(B,C,t){t.d(C,{V:function(){return m}});var N=t(17600),m=function(r){var l=new N.Vq({type:"dagre",begin:[400,100],ranker:"network-simplex",rankdir:"TB",ranksep:20,nodeSize:50,align:"DL",controlPoints:!0}),c=r.getNodes(),S=r.getEdges(),g=l.layout({nodes:c,edges:S}),o=g.nodes,h=o===void 0?[]:o;c.forEach(function(e){var y=h.find(function(z){return z.id===e.id});y.x-=e.size().width/2,y.y-=e.size().height/2,e.position(y.x,y.y)})},u=function(r,l){debugger;var c=new DagreLayout({type:"dagre",begin:[400,100],ranker:"tight-tree",rankdir:"TB",ranksep:20,nodeSize:50,controlPoints:!0}),S=c.layout({nodes:r,edges:l}),g=S.nodes,o=g===void 0?[]:g;r.forEach(function(h){var e=o.find(function(y){return y.id===h.id});e.x-=h.size().width/2,e.y-=h.size().height/2,h.position(e.x,e.y)})}},59176:function(B,C,t){t.r(C),t.d(C,{default:function(){return Ut}});var N=t(93525),m=t.n(N),u=t(57213),p=t.n(u),r=t(54306),l=t.n(r),c=t(60341),S=t(83217),g=t(72197),o=t(54145),h=t(10502),e=t(87363),y=t(98306),z=t(5671),P=t(14990),f=t(22465),E=t(72237),_=t(93853),M=t(28110),L=t(25359),T=t.n(L),ot=t(49811),st=t.n(ot),K=t(58146);function W(){return X.apply(this,arguments)}function X(){return X=st()(T()().mark(function O(){return T()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",new Promise(function(v,b){v((0,K.K)())}));case 1:case"end":return d.stop()}},O)})),X.apply(this,arguments)}var Et=t(21140),Dt=t.n(Et),Pt=t(63466),Ot=t.n(Pt),wt=t(77357),Lt=function(){function O(){Dt()(this,O)}return Ot()(O,[{key:"graphToLogicItems",value:function(d,v){var b=(0,wt.nq)(v==null?void 0:v.id,d==null?void 0:d.getCells());return b.visualConfig=d==null?void 0:d.toJSON(),p()(p()({},v),{},{visualConfig:b.visualConfig,items:b.items})}}]),O}(),_t=t(12490);function Tt(O){var a=O.createNode({shape:"circle",label:"start",width:50,height:50,attrs:{body:{}},ports:_t.Hi,data:{config:{type:"start"}}});O.addNode(a)}var it=t(2325),rt=t(48364),Jt=t(89147),zt=t(3619),lt=t(62835),D=t(94744),s=t(33130),Zt=function(a){var d,v=(0,e.useState)({}),b=l()(v,2),R=b[0],j=b[1];(0,e.useEffect)(function(){var x=a.values,w=x.params,J=x.variables,Z=x.envs,Y=x.returns;j({params:JSON.stringify(D.y.getJsonByParams(w)),variables:JSON.stringify(D.y.getJsonByParams(J)),returns:JSON.stringify(D.y.getJsonByParams(Y)),envs:JSON.stringify(D.y.getJsonByParams(Z))})},[a.values]);var A=(0,e.useCallback)(function(x){try{return JSON.parse(x),!0}catch(w){return!1}},[]);return(0,s.jsxs)("span",{children:[a.children,(0,s.jsx)(h.Z,{open:(d=a.open)!==null&&d!==void 0?d:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return a==null?void 0:a.setOpen(!1)},children:(0,s.jsx)(lt.Z,{formId:"logic-setting",values:R,onSubmit:function(w){console.log("\u63D0\u4EA4\u53C2\u6570"),console.log(w);var J=!1;Object.keys(w).forEach(function(Z){var Y=w[Z];if(!A(Y)){var V=Z==="params"?"\u5165\u53C2":Z==="variables"?"\u5C40\u90E8\u53D8\u91CF":Z==="returns"?"\u8FD4\u56DE\u53C2\u6570":"\u73AF\u5883\u53D8\u91CF";return S.ZP.error("".concat(V,"json\u683C\u5F0F\u9519\u8BEF")),J=!0,!1}}),J||(a!=null&&a.onSubmit&&a.onSubmit(w),a==null||a.setOpen(!1))}})})]})},Ft=Zt,At=t(5726),Bt=t.n(At),Mt=t(24594),It=function(a){var d,v=(0,Mt.cI)();(0,e.useEffect)(function(){var j=a.values.params;v.setValues({params:JSON.stringify(D.y.getJsonByParams(j))})},[a.values]);var b=(0,e.useCallback)(function(j){try{return JSON.parse(j),!0}catch(A){return!1}},[]);function R(j){var A=!1;Object.keys(j).forEach(function(x){var w=j[x];if(["params","headers"].indexOf(x)>-1&&!b(w)){var J=x==="params"?"\u5165\u53C2":"\u8BF7\u6C42\u5934";return S.ZP.error("".concat(J,"json\u683C\u5F0F\u9519\u8BEF")),A=!0,!1}}),A||(a!=null&&a.onSubmit&&a.onSubmit(j,j.debugType),a==null||a.setOpen(!1))}return(0,s.jsxs)("span",{children:[a.children,(0,s.jsx)(h.Z,{open:(d=a.open)!==null&&d!==void 0?d:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return a==null?void 0:a.setOpen(!1)},children:(0,s.jsx)(lt.Z,{formId:"logic-debug-input",onSubmit:R})})]})},$t=It,Rt=t(61719),dt=t(11331),Yt=function(){var a=(0,e.useState)({}),d=l()(a,2),v=d[0],b=d[1],R=(0,e.useState)({}),j=l()(R,2),A=j[0],x=j[1],w=(0,e.useState)({}),J=l()(w,2),Z=J[0],Y=J[1],V=(0,e.useState)(!0),ut=l()(V,2),k=ut[0],Gt=ut[1],Ht=(0,e.useState)(!1),ct=l()(Ht,2),Wt=ct[0],I=ct[1],Kt=(0,e.useState)("1"),ft=l()(Kt,2),Q=ft[0],ue=ft[1],Xt=(0,e.useState)(),gt=l()(Xt,2),vt=gt[0],Vt=gt[1],kt=(0,e.useState)([]),ht=l()(kt,2),Qt=ht[0],qt=ht[1],te=(0,e.useState)(!1),mt=l()(te,2),pt=mt[0],yt=mt[1],ee=(0,e.useState)(!1),St=l()(ee,2),xt=St[0],q=St[1],ae=(0,e.useState)(new Map),Ct=l()(ae,2),ne=Ct[0],ce=Ct[1],oe=(0,y.UO)(),tt=oe.id,se=new Lt;function Nt(){I(!0);var n=se.graphToLogicItems(vt,v);n.version=jt(),b(n),bt(n)}function jt(){return Bt()(Date.now()).format("YYYYMMDDHHmmss")}function bt(n){(0,rt.az)(tt,n.version,JSON.stringify(n)).then(function(i){I(!1),S.ZP.success("\u4FDD\u5B58\u6210\u529F"),console.log("save logic"),console.log(n)}).catch(function(i){I(!1),console.log("err"),console.log(i),S.ZP.error("\u4FDD\u5B58\u5931\u8D25")})}function ie(n){var i,U,G,H,$={};$._par=n.params,$._var=n.variables,$._env=n.envs,x({jsTips:p()({},$)});var et=D.y.getParamArrayByJson(JSON.parse((i=n.params)!==null&&i!==void 0?i:"{}")),F=D.y.getReturnArrayByJson(JSON.parse((U=n.returns)!==null&&U!==void 0?U:"{}")),at=D.y.getVariableArrayByJson(JSON.parse((G=n.variables)!==null&&G!==void 0?G:"{}")),de=D.y.getEnvsArrayByJson(JSON.parse((H=n.envs)!==null&&H!==void 0?H:"{}")),nt=p()(p()({},v),{},{params:et,returns:F,variables:at,envs:de});nt.version=jt(),b(nt),bt(nt)}function re(n){var i={};i._par=JSON.stringify(D.y.getJsonByParams(n.params)),i._var=JSON.stringify(D.y.getJsonByParams(n.variables)),i._env=JSON.stringify(D.y.getJsonByParams(n.envs)),x({jsTips:p()({},i)}),I(!1)}(0,e.useEffect)(function(){(0,Jt.m)([it.C.get("ExtSharp")]),I(!0),(0,rt.YH)(tt).then(function(n){var i=n;i.id=tt,b(i),Y(i==null?void 0:i.visualConfig),re(i)}).catch(function(n){I(!1),console.log("err"),console.log(n)}),W().then(function(n){qt(n.Nodes)})},[]);var le=(0,e.useCallback)(function(){return new z.bn.kS({attrs:{line:{targetMarker:"classic",stroke:Q=="1"?"#000000":"#FF9900"}},zIndex:0,data:{type:Q}})},[Q]);return(0,s.jsx)("div",{children:(0,s.jsx)(g.Z,{spinning:Wt,children:(0,s.jsx)(c.l,{editorCtx:A,panelData:{Nodes:m()(Qt),Shapes:[it.C.get("ExtSharp")],Groups:[{name:"global",title:"\u5168\u5C40\u8282\u70B9",graphHeight:110},{name:"ctrl",title:"\u903B\u8F91\u63A7\u5236",graphHeight:220},{name:"biz",title:"\u4E1A\u52A1\u8C03\u7528",graphHeight:220}]},showLeft:k,graphIns:vt,toolElements:[(0,s.jsx)(o.ZP,{type:"text",icon:k?(0,s.jsx)(P.Z,{}):(0,s.jsx)(f.Z,{}),onClick:function(){Gt(!k)},style:{fontSize:"16px",width:64,height:64}}),(0,s.jsx)(o.ZP,{icon:(0,s.jsx)(E.Z,{}),type:"primary",onClick:function(){return Nt()},children:"\u4FDD\u5B58"}),(0,s.jsx)(Ft,{open:pt,values:p()({},v),setOpen:function(){yt(!pt)},onSubmit:ie,children:(0,s.jsx)(o.ZP,{onClick:function(){return yt(!0)},icon:(0,s.jsx)(_.Z,{}),children:"\u914D\u7F6E\u53C2\u6570"})}),(0,s.jsx)($t,{open:xt,setOpen:function(){return q(!xt)},values:{params:v==null?void 0:v.params},onSubmit:function(i,U){if(q(!1),v){var G=i.params,H=i.bizId,$=i.headers,et=i.bizStartCode;(0,Rt.L7)(v.id,JSON.parse(G),H,et,U,JSON.parse($)).then(function(F){F.data.code==0?h.Z.success({title:"\u6267\u884C\u6210\u529F",width:"1000px",closable:!0,content:(0,s.jsx)("div",{children:(0,s.jsx)(dt.Z,{pageId:"debug-info",data:F.data})})}):h.Z.error({title:(0,s.jsx)("span",{children:F.data.msg}),width:"1200px",closable:!0,content:(0,s.jsx)("div",{children:(0,s.jsx)(dt.Z,{pageId:"debug-info",data:F.data})})})}).catch(function(F){var at=F.response.data;h.Z.error({title:(0,s.jsx)("span",{children:at.msg}),width:"1200px",closable:!0})})}},children:(0,s.jsx)(o.ZP,{type:"default",onClick:function(){q(!0)},icon:(0,s.jsx)(M.Z,{}),children:"\u8C03\u8BD5"})}),(0,s.jsxs)("span",{children:["\u5F53\u524D\u7248\u672C:",v.version]})],graphJson:Z,onGraphJsonEmpty:Tt,createEdge:le,edgeTools:["button-remove","vertices","segments"],onSave:function(){return Nt()},jsTipMap:ne,autoLayout:function(i){return(0,zt.V)(i)},onGraphInsChange:function(i){return Vt(i)}})})})},Ut=Yt},89147:function(B,C,t){t.d(C,{m:function(){return z}});var N=t(5671),m=t(95812),u=t(53914),p={customNode:"customNode___zxYMy",input:"input___oBweR",switchNode:"switchNode___PXP4B"},r=t(33130),l=function(f){return(0,r.jsx)("div",{className:p.customNode,children:(0,r.jsx)(u.Z,{className:"input",value:f==null?void 0:f.data,width:80})})},c=t(371),S=function(f){return(0,r.jsx)("div",{className:styles.customNode,children:(0,r.jsx)(c.Z,{className:"input",value:f==null?void 0:f.data,width:80})})},g=t(57213),o=t.n(g),h=function(f){var E,_,M,L=f.node,T=(E=L.data.config)===null||E===void 0?void 0:E.name,ot=T||"case";return(0,r.jsxs)("div",{className:p.customNode,children:[(0,r.jsx)("span",{children:"case"}),(0,r.jsx)(u.Z,{addonAfter:T,className:"input",value:L==null||(_=L.data)===null||_===void 0||(M=_.config)===null||M===void 0?void 0:M.case,width:150,onChange:function(K){var W=L.data;L.setData(o()(o()({},W),{},{config:o()(o()({},W.config),{},{case:K.target.value})}))}})]})},e=function(f){var E,_=f.node;return(0,r.jsx)("div",{className:p.customNode,children:(0,r.jsx)(u.Z,{addonBefore:"switch",className:"input",value:(E=_.data)===null||E===void 0?void 0:E.config.condition,onChange:function(L){var T=_.data;_.setData(o()(o()({},T),{},{config:o()(o()({},T.config),{},{condition:L.target.value})}))},width:100})})},y=function(f){return(0,r.jsx)("div",{className:p.customNode,children:(0,r.jsx)("div",{style:{textAlign:"center",fontSize:"15px"},children:"default"})})};function z(P){P.forEach(function(f){console.log("\u6CE8\u518C\u65B0\u8282\u70B9:"+f.name),N.kJ.registerNode(f.name,f.config,!0)}),(0,m.z2)({shape:"string",component:l}),(0,m.z2)({shape:"num",component:S}),(0,m.z2)({shape:"switch",component:e}),(0,m.z2)({shape:"switch-case",component:h}),(0,m.z2)({shape:"switch-default",component:y})}},58146:function(B,C,t){t.d(C,{K:function(){return S}});var N=t(57213),m=t.n(N),u=t(12490),p=50,r=50,l=[{name:"ExtSharp",config:{width:100,height:r,attrs:{body:{rx:6,ry:6,stroke:"#5F95FF",strokeWidth:1,fill:"rgba(95,149,255,0.05)",refWidth:1,refHeight:1},image:{refX:2,refY:0},text:{refX:4,refY:20,fontSize:12,"text-anchor":"start"}},markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}}],c=t(42651);function S(g,o,h){var e=50,y=50,z={body:{}},P=[new c.Z({shape:"circle",width:e,height:y,attrs:{body:m()(m()({},z.body),{},{fill:"white"}),text:{text:"\u4EA4\u4E92\u70B9"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:u.Tt,data:{config:{type:"wait-for-continue"}},_groups:["global"]}),new c.Z({shape:"circle",label:"end",width:e,height:y,attrs:{body:m()(m()({},z.body),{},{fill:"#d9d9d9"}),text:{text:"end"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:u.Tt,data:{config:{type:"end"}},_groups:["global"]}),new c.Z({shape:"ExtSharp",attrs:{text:{text:"http\u8BF7\u6C42",fontSize:14},image:{"xlink:href":"/icons/http.svg",width:20,x:2,y:2}},data:{config:{type:"http",method:"POST"}},ports:u.Tt,_groups:["biz"]}),new c.Z({shape:"ExtSharp",ports:u.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/code.svg"},text:{text:"js\u811A\u672C",fontSize:14}},data:{config:{type:"js"}},_groups:["biz"]}),new c.Z({shape:"ExtSharp",ports:u.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/code.svg"},text:{text:"java\u65B9\u6CD5",fontSize:14}},data:{config:{type:"java"}},_groups:["biz"]}),new c.Z({shape:"ExtSharp",ports:u.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/CarbonSubflowLocal.svg"},text:{text:"\u590D\u7528\u903B\u8F91",fontSize:14}},data:{config:{type:"sub-logic"}},_groups:["biz"]}),new c.Z({shape:"ExtSharp",width:50,height:y,label:"switch",attrs:{image:{"xlink:href":"/icons/switch.svg",width:45,x:1,y:2},text:{text:"switch",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"switch"}},ports:u.Tt,_groups:["ctrl"]}),new c.Z({shape:"ExtSharp",width:e,height:y,attrs:{image:{"xlink:href":"/icons/text.svg",width:30,x:8,y:10},text:{text:"case",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"switch-case"}},ports:u.Tt,_groups:["ctrl"]}),new c.Z({shape:"ExtSharp",width:50,height:y,attrs:{image:{"xlink:href":"/icons/text.svg",width:30,x:8,y:10},text:{text:"default",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"switch-default"}},ports:u.Tt,_groups:["ctrl"]}),new c.Z({shape:"ExtSharp",width:e,height:y,attrs:{image:{"xlink:href":"/icons/delay.svg",width:30,x:8,y:10},text:{text:"\u7B49\u5F85",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"wait",timeout:"2000"}},ports:u.Tt,_groups:["ctrl"]})];g&&g.length>0&&Array.prototype.push.apply(P,g);var f=[{name:"global",title:"\u5168\u5C40\u8282\u70B9",graphHeight:110},{name:"ctrl",title:"\u903B\u8F91\u63A7\u5236",graphHeight:220},{name:"biz",title:"\u4E1A\u52A1\u8C03\u7528",graphHeight:220}];o&&o.length>0&&Array.prototype.push.apply(f,o);var E=l;return h&&h.length>0&&Array.prototype.push.apply(E,h),{Shapes:E,Nodes:P,Groups:f}}}}]);
