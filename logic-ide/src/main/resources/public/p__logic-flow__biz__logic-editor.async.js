"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[883],{60341:function(fe,Z,a){a.d(Z,{l:function(){return N.Z}});var N=a(93797)},72107:function(fe,Z,a){a.d(Z,{Ld:function(){return N},Iz:function(){return P},Du:function(){return oe},dO:function(){return X},z1:function(){return ne},X0:function(){return se},_w:function(){return ue}});var N=function(l){return l.TypeAnnotation="TypeAnnotation",l.Structure="Structure",l.StructureProperty="StructureProperty",l.TypeParam="TypeParam",l.Variable="Variable",l.Logic="Logic",l.LogicItem="LogicItem",l}({}),L=function(l){return l.start="start",l.end="end",l.switch="switch",l["switch-case"]="switch-case",l["switch-def"]="switch-def",l["mqtt-pub"]="mqtt-pub",l["mqtt-sub"]="mqtt-sub",l["mqtt-unsub"]="mqtt-unsub",l["mqtt-client"]="mqtt-client",l["mqtt-server"]="mqtt-server",l["mqtt-broker"]="mqtt-broker",l.http="http",l.logic="logic",l.js="js",l.wait="wait",l}({}),R=a(63466),B=a.n(R),te=a(21140),A=a.n(te),U=a(52510),i=a.n(U),se=B()(function l(E){A()(this,l),i()(this,"concept",void 0),i()(this,"name",void 0),i()(this,"label",void 0),i()(this,"description",void 0),i()(this,"typeAnnotation",void 0),i()(this,"required",!1),i()(this,"defaultValue",void 0),this.concept=N.StructureProperty,this.name=E}),P=B()(function l(E){A()(this,l),i()(this,"concept",N.Logic),i()(this,"schemeVersion",void 0),i()(this,"version",void 0),i()(this,"id",void 0),i()(this,"name",void 0),i()(this,"label",void 0),i()(this,"description",void 0),i()(this,"triggerType",void 0),i()(this,"log",void 0),i()(this,"cron",void 0),i()(this,"typeParams",void 0),i()(this,"params",void 0),i()(this,"returns",void 0),i()(this,"variables",void 0),i()(this,"envs",void 0),i()(this,"items",[]),i()(this,"visualConfig",void 0),this.id=E,this.schemeVersion="0.1"}),oe=B()(function l(E,x){var w=this;A()(this,l),i()(this,"concept","LogicItem"),i()(this,"id",void 0),i()(this,"name",void 0),i()(this,"type",void 0),i()(this,"label",void 0),i()(this,"description",void 0),i()(this,"params",void 0),i()(this,"returns",void 0),i()(this,"envs",void 0),i()(this,"afterReturnAdaptor",void 0),i()(this,"returnAccept",void 0),i()(this,"nextId",void 0),i()(this,"endId",void 0),i()(this,"condition",void 0),i()(this,"script",void 0),i()(this,"timeout",void 0),i()(this,"branches",void 0),i()(this,"url",void 0),i()(this,"method",void 0),i()(this,"headers",void 0),i()(this,"queryParams",void 0),i()(this,"tranScope",void 0),i()(this,"body",void 0),i()(this,"setEnv",function(b){w.envs=b}),this.type=x,this.id=E}),I=null,X=B()(function l(E){A()(this,l),i()(this,"concept","Param"),i()(this,"name",void 0),i()(this,"description",void 0),i()(this,"typeAnnotation",void 0),i()(this,"required",void 0),i()(this,"defaultValue",void 0),this.name=E}),V=a(58853),F=a.n(V),k=a(38888),p=a.n(k),ne=function(l){F()(x,l);var E=p()(x);function x(w){var b;return A()(this,x),b=E.call(this,w),b.concept="Return",b}return B()(x)}(X),ue=function(l){F()(x,l);var E=p()(x);function x(w){var b;return A()(this,x),b=E.call(this,w),b.concept="Variable",b}return B()(x)}(X)},44132:function(fe,Z,a){var N=a(54306),L=a.n(N),R=a(70517),B=a(90010),te=a.n(B),A=a(23620),U=a(2069),i=a(87363),se=a.n(i),P=a(70256),oe=a(33358),I=a(49500),X=a(16123),V=a(78057),F=a(69078),k=a(98896),p=a(33130),ne=function(l){var E=(0,i.useState)({type:"page"}),x=L()(E,2),w=x[0],b=x[1],ae="cxd",le="zh-CN";return(0,i.useEffect)(function(){(0,k.m)(R.Z)},[]),(0,i.useEffect)(function(){l.pageId&&(0,P.UD)(l.pageId).then(function($){b($)})},[l.pageId]),(0,p.jsxs)("div",{children:[(0,p.jsx)(U.qR,{theme:ae,position:"top-right",locale:le},"toast"),(0,p.jsx)(U.wx,{theme:ae,locale:le},"alert"),(0,A.sYA)(w,{data:l.data},{fetcher:function(C){var Q=C.url,W=C.method,D=C.data,ce=C.responseType,y=C.config,re=C.headers;return y=y||{},y.withCredentials=!0,ce&&(y.responseType=ce),y.cancelExecutor&&(y.cancelToken=new R.Z.CancelToken(y.cancelExecutor)),y.headers=re||{},y.headers.Authorization||(y.headers.Authorization="Bearer "+F.F.getTokenFormLocal()),W!=="post"&&W!=="put"&&W!=="patch"?(D&&(y.params=D),R.Z[W](Q,y)):(D&&D instanceof FormData?(y.headers=y.headers||{},y.headers["Content-Type"]="multipart/form-data"):D&&typeof D!="string"&&!(D instanceof Blob)&&!(D instanceof ArrayBuffer)&&(D=JSON.stringify(D),y.headers=y.headers||{},y.headers["Content-Type"]="application/json"),R.Z[W](Q,D,y))},isCancel:function(C){return R.Z.isCancel(C)},copy:function(C){te()(C),U.Am.success("\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u7C98\u8D34\u677F")},theme:ae,jumpTo:function(C,Q){debugger;Q.blank==!0?window.open(window.location.origin+window.location.pathname+"#"+C,"_blank"):window.location.hash=C}})]})};Z.Z=ne},95649:function(fe,Z,a){a.r(Z),a.d(Z,{default:function(){return Et}});var N=a(25359),L=a.n(N),R=a(93525),B=a.n(R),te=a(49811),A=a.n(te),U=a(57213),i=a.n(U),se=a(54306),P=a.n(se),oe=a(60341),I=a(83217),X=a(72197),V=a(54145),F=a(51394),k=a(36267),p=a(87363),ne=a(98306),ue=a(5671),l=a(14990),E=a(22465),x=a(72237),w=a(93853),b=a(28110),ae=a(49228),le=a(70517),$=a(9364),C=a(12490),Q=a(42651),W={buildGroup:function(r,e,t){var n=Number.parseInt(e/2),o=e%2==0;return{name:r,title:t,graphHeight:(o?n:n+1)*110}}},D=W;function ce(s){return s.length>7?"".concat(s.substring(0,7),`\r
`).concat(s.substring(7)):s}function y(){return re.apply(this,arguments)}function re(){return re=A()(L()().mark(function s(){var r;return L()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=[],t.abrupt("return",Promise.all([(0,$.K)(),le.Z.get("/api/ide/asset/v1/logic-item/readFromCode")]).then(function(n){if(console.log("getPanelData"),n[1].status==200){var o=n[1].data.data;Object.keys(o).forEach(function(u,d){var f=D.buildGroup(u,o[u].length,u);r.push(f),o[u].forEach(function(v){n[0].Nodes.push(new Q.Z({shape:"ExtShape"+(d%3==0?"1":d%3==1?"2":"3"),ports:C.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/java.svg"},text:{text:ce(v.name),fontSize:12}},data:{config:v.logicItem},_groups:[v.group]}))})})}return{Nodes:n[0].Nodes,Groups:r}}));case 2:case"end":return t.stop()}},s)})),re.apply(this,arguments)}var qe=a(21140),he=a.n(qe),et=a(63466),pe=a.n(et),Y=a(72107),Ut=null;function ge(s,r,e,t){var n,o,u=s.data.config,d=u.type,f=e.flatMap(function(T){return T.source.cell===s.id?r[T.target.cell]:[]}),v=s.attrs,g=new Y.Du((n=s.id)!==null&&n!==void 0?n:"",d);if(g=i()(i()({},u),{},{id:s.id,name:v==null||(o=v.text)===null||o===void 0?void 0:o.text}),!(t.findIndex(function(T){return T.id===g.id})>-1)&&(t.push(g),f.length!==0))switch(d){default:if(f.length>1||g.type==="switch"){var O;console.log((O=s.data)===null||O===void 0?void 0:O.config),console.log(f),g.branches=[],f.forEach(function(T){var z,q,H,ie;console.log((z=T.data)===null||z===void 0?void 0:z.config),(q=g.branches)===null||q===void 0||q.push({when:(H=T.data)===null||H===void 0||(ie=H.config)===null||ie===void 0?void 0:ie.case,nextId:T.id}),ge(r[T.id],r,e,t)})}else g.nextId=f[0].id,ge(r[f[0].id],r,e,t);break}}function tt(s,r){var e=new Y.Iz(s),t=[],n=[],o={},u=void 0;if(r.forEach(function(d){var f=d.id||"";if(d.shape==="edge")t.push(d);else{var v=d.attrs;o[f]=d,n.push(d),d.data.config.type==="start"&&(u=d)}}),!u){I.ZP.error("\u672A\u53D1\u73B0\u5F00\u59CB\u8282\u70B9\uFF0C\u8BF7\u914D\u7F6E\uFF01");return}return ge(u,o,t,e.items),console.log("logic.items"),console.log(e.items),e}function nt(s){var r=[],e=[];return s.items.forEach(function(t){var n={id:t.id,shape:t.type,size:{width:80,height:40},data:{config:t},attrs:{text:{text:t.name}}};if(r.push(n),t.branches&&t.branches.length>0)t.branches.forEach(function(u){var d={shape:"edge",source:{cell:t.id},target:{cell:u.nextId},labels:[{position:.5,attrs:{label:{text:u.when}}}]};e.push(d)});else if(t.nextId){var o={shape:"edge",source:{cell:t.id},target:{cell:t.nextId}};e.push(o)}}),{nodes:r,edges:e}}var at=function(){function s(){he()(this,s)}return pe()(s,[{key:"graphToLogicItems",value:function(e,t){var n=tt(t==null?void 0:t.id,e==null?void 0:e.getCells());return n.visualConfig=e==null?void 0:e.toJSON(),i()(i()({},t),{},{visualConfig:n.visualConfig,items:n.items})}},{key:"logicToGraphJson",value:function(e){var t=nt(e);return t}}]),s}(),rt=50,Ie=50,it={body:{}},$t={"wati-for-continu":{shape:"circle",ports:C.Tt,width:rt,height:Ie,attrs:{body:i()(i()({},it.body),{},{fill:"white"}),text:{text:"\u4EA4\u4E92\u70B9"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],data:{config:{type:"wait-for-continue"}}},js:{shape:"ExtSharp",ports:C.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/code.svg"},text:{text:"js\u811A\u672C",fontSize:14}},data:{config:{type:"js"}}},java:{shape:"ExtSharp",ports:C.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/java.svg"},text:{text:"java\u65B9\u6CD5",fontSize:14}},data:{config:{type:"java"}}},switch:{shape:"ExtSharp",width:50,height:Ie,ports:C.Tt,label:"switch",attrs:{image:{"xlink:href":"/icons/switch.svg",width:45,x:1,y:2},text:{text:"switch",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}}}};function st(s){var r=s.createNode({shape:"circle",label:"start",width:50,height:50,attrs:{body:{}},ports:C.Hi,data:{config:{type:"start"}}});s.addNode(r)}function Wt(s,r){var e=LogicItemSharpMapping[r.type];if(e){e.data={config:r};var t=s.createNode(e);t.setAttrByPath("text/text",r.name),s.addNode(t)}}var ot=a(2325),je=a(48364),ut=a(89147),Je=a(3619),Fe=a(94990),lt=a(37635),ct=a.n(lt),dt=a(52510),_=a.n(dt),vt=pe()(function s(r){he()(this,s),_()(this,"concept","EnvParam"),_()(this,"name",void 0),_()(this,"description",void 0),_()(this,"typeAnnotation",void 0),_()(this,"required",!1),_()(this,"defaultValue",void 0),this.name=r}),j=function(){function s(){he()(this,s)}return pe()(s,null,[{key:"valueToTypeAnnotaion",value:function(e){var t=this,n={concept:Y.Ld.TypeAnnotation,typeKind:"primitive",typeName:"string",defaultValue:e};if(Array.isArray(e))n.typeName="array";else{var o=ct()(e);switch(o){case"boolean":n.typeKind="primitive",n.typeName="boolean";break;case"number":n.typeKind="primitive",n.typeName="number";break;case"string":n.typeKind="primitive",n.typeName="string";break;case"object":e==null?n.typeName="null":e instanceof Date?(n.typeKind="primitive",n.typeName="date"):e instanceof RegExp?(n.typeKind="primitive",n.typeName="regexp"):e instanceof Function?(n.typeKind="primitive",n.typeName="function"):(n.typeKind="anonymousStructure",n.typeName="object",n.properties=[],Object.keys(e).map(function(u){var d,f=e[u],v=t.valueToTypeAnnotaion(f),g=new Y.X0(u);g.typeAnnotation=v,g.defaultValue=f,(d=n.properties)===null||d===void 0||d.push(g)}));break;default:n.typeKind="unknown",n.typeName=o;break}}return n}},{key:"typeAnnotaionToValue",value:function(e){var t,n,o=this,u;switch(e.typeName){case"array":u=(t=e.defaultValue)!==null&&t!==void 0?t:[];break;case"boolean":u=e.defaultValue?e.defaultValue=="true":!1;break;case"number":u=parseFloat(e.defaultValue);break;case"null":u=null;break;case"date":u=new Date(e.defaultValue);break;case"regexp":u=new RegExp(e.defaultValue);break;case"object":u={},(n=e.properties)===null||n===void 0||n.forEach(function(d){u[d.name]=o.typeAnnotaionToValue(d.typeAnnotation)});break;case"string":case"function":default:u=e.defaultValue;break}return u}},{key:"getParamArrayByJson",value:function(e){var t=[];return e&&Object.keys(e).forEach(function(n){var o=new Y.dO(n);o.typeAnnotation=s.valueToTypeAnnotaion(e[n]),o.defaultValue=e[n],t.push(o)}),t}},{key:"getReturnArrayByJson",value:function(e){var t=[];return e&&Object.keys(e).forEach(function(n){var o=new Y.z1(n);o.typeAnnotation=s.valueToTypeAnnotaion(e[n]),o.defaultValue=e[n],t.push(o)}),t}},{key:"getVariableArrayByJson",value:function(e){var t=[];return e&&Object.keys(e).forEach(function(n){var o=new Y._w(n);o.typeAnnotation=s.valueToTypeAnnotaion(e[n]),o.defaultValue=e[n],t.push(o)}),t}},{key:"getEnvsArrayByJson",value:function(e){var t=[];return e&&Object.keys(e).forEach(function(n){var o=new vt(n);o.typeAnnotation=s.valueToTypeAnnotaion(e[n]),o.defaultValue=e[n],t.push(o)}),t}},{key:"getJsonByParams",value:function(e){var t=this,n={};return e==null||e.forEach(function(o){n[o.name]=o.typeAnnotation?t.typeAnnotaionToValue(o.typeAnnotation):o.defaultValue}),n}}]),s}(),h=a(33130),ft=function(r){var e,t=(0,p.useState)({}),n=P()(t,2),o=n[0],u=n[1];(0,p.useEffect)(function(){var f=r.values,v=f.params,g=f.variables,O=f.envs,T=f.returns,z=f.log;u({params:JSON.stringify(j.getJsonByParams(v)),variables:JSON.stringify(j.getJsonByParams(g)),returns:JSON.stringify(j.getJsonByParams(T)),envs:JSON.stringify(j.getJsonByParams(O)),log:z})},[r.values]);var d=(0,p.useCallback)(function(f){try{return JSON.parse(f),!0}catch(v){return!1}},[]);return(0,h.jsxs)("span",{children:[r.children,(0,h.jsx)(F.Z,{open:(e=r.open)!==null&&e!==void 0?e:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return r==null?void 0:r.setOpen(!1)},children:(0,h.jsx)(Fe.Z,{formId:"logic-setting",values:o,onSubmit:function(v){console.log("\u63D0\u4EA4\u53C2\u6570"),console.log(v);var g=!1;Object.keys(v).forEach(function(O){var T=v[O];if(!d(T)){var z=O==="params"?"\u5165\u53C2":O==="variables"?"\u5C40\u90E8\u53D8\u91CF":O==="returns"?"\u8FD4\u56DE\u53C2\u6570":"\u73AF\u5883\u53D8\u91CF";switch(O){case"params":return I.ZP.error("\u5165\u53C2json\u683C\u5F0F\u9519\u8BEF"),g=!0,!1;break;case"variables":return I.ZP.error("\u5C40\u90E8\u53D8\u91CFjson\u683C\u5F0F\u9519\u8BEF"),g=!0,!1;break;case"returns":return I.ZP.error("\u8FD4\u56DE\u53C2\u6570json\u683C\u5F0F\u9519\u8BEF"),g=!0,!1;break;case"ens":return I.ZP.error("\u73AF\u5883\u53D8\u91CFjson\u683C\u5F0F\u9519\u8BEF"),g=!0,!1;break;default:break}}}),g||(r!=null&&r.onSubmit&&r.onSubmit(v),r==null||r.setOpen(!1))}})})]})},ht=ft,pt=a(5726),gt=a.n(pt),mt=a(11455),yt=function(r){var e,t=(0,mt.cI)();(0,p.useEffect)(function(){var u=r.values.params;t.setValues({params:JSON.stringify(j.getJsonByParams(u))})},[r.values]);var n=(0,p.useCallback)(function(u){try{return JSON.parse(u),!0}catch(d){return!1}},[]);function o(u){var d=!1;Object.keys(u).forEach(function(f){var v=u[f];if(["params","headers"].indexOf(f)>-1&&!n(v)){var g=f==="params"?"\u5165\u53C2":"\u8BF7\u6C42\u5934";return I.ZP.error("".concat(g,"json\u683C\u5F0F\u9519\u8BEF")),d=!0,!1}}),d||(r!=null&&r.onSubmit&&r.onSubmit(u,u.debugType),r==null||r.setOpen(!1))}return(0,h.jsxs)("span",{children:[r.children,(0,h.jsx)(F.Z,{open:(e=r.open)!==null&&e!==void 0?e:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return r==null?void 0:r.setOpen(!1)},children:(0,h.jsx)(Fe.Z,{formId:"logic-debug-input",onSubmit:o})})]})},St=yt,Me=a(57475);function Ct(s,r,e,t,n,o){return me.apply(this,arguments)}function me(){return me=A()(L()().mark(function s(r,e,t,n,o,u){var d;return L()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:d="",v.t0=o,v.next=v.t0==="biz"?4:6;break;case 4:return n?d="/api/runtime/logic/v1/biz/".concat(r,"/").concat(n,"/").concat(t,"?debug=true"):d="/api/runtime/logic/v1/run-biz/".concat(r,"/").concat(t,"?debug=true"),v.abrupt("break",8);case 6:return d="/api/runtime/logic/v1/run-api/".concat(r,"?debug=true"),v.abrupt("break",8);case 8:return v.abrupt("return",(0,Me.v_)(d,e,{headers:i()({"Content-Type":"application/json"},u)}));case 9:case"end":return v.stop()}},s)})),me.apply(this,arguments)}function Yt(s,r){return ye.apply(this,arguments)}function ye(){return ye=_asyncToGenerator(_regeneratorRuntime().mark(function s(r,e){return _regeneratorRuntime().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",post("/api/form/logic_instance/query",{filters:[{dataIndex:"logicId",values:[r],type:"="},{dataIndex:"bizId",values:[e],type:"="}]}).then(function(o){var u=o.data.result.items[0];return u}));case 1:case"end":return n.stop()}},s)})),ye.apply(this,arguments)}function Ht(s){return Se.apply(this,arguments)}function Se(){return Se=_asyncToGenerator(_regeneratorRuntime().mark(function s(r){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",get("/api/ide/logic-instance/".concat(r)).then(function(n){var o=n.data.data;return o}));case 1:case"end":return t.stop()}},s)})),Se.apply(this,arguments)}function Xt(s){return Ce.apply(this,arguments)}function Ce(){return Ce=_asyncToGenerator(_regeneratorRuntime().mark(function s(r){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",post("/api/form/logic/add",r).then(function(n){var o=n.data.result;return o}));case 1:case"end":return t.stop()}},s)})),Ce.apply(this,arguments)}function kt(s){return Pe.apply(this,arguments)}function Pe(){return Pe=_asyncToGenerator(_regeneratorRuntime().mark(function s(r){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",del("/api/form/logic/delete/".concat(r)).then(function(n){return n.data.result}));case 1:case"end":return t.stop()}},s)})),Pe.apply(this,arguments)}function Qt(){return xe.apply(this,arguments)}function xe(){return xe=_asyncToGenerator(_regeneratorRuntime().mark(function s(){var r,e,t=arguments;return _regeneratorRuntime().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return r=t.length>0&&t[0]!==void 0?t[0]:1,e=t.length>1&&t[1]!==void 0?t[1]:10,o.abrupt("return",post("/api/form/logic/query",{page:r,pageSize:e}).then(function(u){return u.data}));case 3:case"end":return o.stop()}},s)})),xe.apply(this,arguments)}var Ne=a(44132);function Pt(){return Ee.apply(this,arguments)}function Ee(){return Ee=A()(L()().mark(function s(){return L()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,Me.U2)("/api/runtime/env").then(function(t){return t.data.data}));case 1:case"end":return e.stop()}},s)})),Ee.apply(this,arguments)}var xt=function(){var r=(0,p.useState)({}),e=P()(r,2),t=e[0],n=e[1],o=(0,p.useState)({}),u=P()(o,2),d=u[0],f=u[1],v=(0,p.useState)({}),g=P()(v,2),O=g[0],T=g[1],z=(0,p.useState)(!0),q=P()(z,2),H=q[0],ie=q[1],Tt=(0,p.useState)(!1),Re=P()(Tt,2),At=Re[0],M=Re[1],bt=(0,p.useState)("1"),we=P()(bt,2),Te=we[0],_t=we[1],Dt=(0,p.useState)(),Ze=P()(Dt,2),Ae=Ze[0],Ot=Ze[1],Bt=(0,p.useState)([]),Ve=P()(Bt,2),Lt=Ve[0],It=Ve[1],jt=(0,p.useState)([]),ze=P()(jt,2),Jt=ze[0],Ft=ze[1],Mt=(0,p.useState)(!1),Ke=P()(Mt,2),Ge=Ke[0],Ue=Ke[1],Nt=(0,p.useState)(!1),$e=P()(Nt,2),We=$e[0],be=$e[1],Rt=(0,p.useState)(new Map),Ye=P()(Rt,2),de=Ye[0],He=Ye[1],wt=(0,ne.UO)(),ve=wt.id,Zt=new at;function Xe(c){window.document.title="["+c.name+"]:"+c.version}function ke(){M(!0);var c=Zt.graphToLogicItems(Ae,t);c.version=Qe(),n(c),_e(c),Xe(c)}function Qe(){return gt()(Date.now()).format("YYYYMMDDHHmmss")}function _e(c){(0,je.az)(ve,c.version,JSON.stringify(c)).then(function(m){M(!1),console.log("save logic"),console.log(c),m.status==200?(I.ZP.success("\u4FDD\u5B58\u6210\u529F"),console.log("save logic success")):(I.ZP.error("\u4FDD\u5B58\u5931\u8D25\uFF1A"+m.statusText),console.error("save logic error"))}).catch(function(m){M(!1),console.log("err"),console.log(m),I.ZP.error("\u4FDD\u5B58\u5931\u8D25")})}(0,p.useEffect)(function(){f({jsTips:i()({},de)})},[de]);function Vt(c){var m,S,K,ee,J={};J._par=c.params,J._var=c.variables,He(i()(i()({},de),J));var Oe=j.getParamArrayByJson(JSON.parse((m=c.params)!==null&&m!==void 0?m:"{}")),G=j.getReturnArrayByJson(JSON.parse((S=c.returns)!==null&&S!==void 0?S:"{}")),Be=j.getVariableArrayByJson(JSON.parse((K=c.variables)!==null&&K!==void 0?K:"{}")),Gt=j.getEnvsArrayByJson(JSON.parse((ee=c.envs)!==null&&ee!==void 0?ee:"{}")),Le=i()(i()({},t),{},{params:Oe,returns:G,variables:Be,envs:Gt,log:c.log});Le.version=Qe(),n(Le),_e(Le)}function zt(c){return De.apply(this,arguments)}function De(){return De=A()(L()().mark(function c(m){var S,K;return L()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return S={},S._par=JSON.stringify(j.getJsonByParams(m.params)),S._var=JSON.stringify(j.getJsonByParams(m.variables)),J.next=5,Pt();case 5:K=J.sent,S._env=JSON.stringify(K),S._lastRet="{}",He(S),M(!1);case 10:case"end":return J.stop()}},c)})),De.apply(this,arguments)}(0,p.useEffect)(function(){(0,ut.m)(B()(ot.C.values())),M(!0),(0,je.qB)(ve).then(function(c){var m=c.name,S=c.configJson;S.id=ve,S.name=m,n(S),T(S==null?void 0:S.visualConfig),zt(S),Xe(S)}).catch(function(c){M(!1),console.log("err"),console.log(c)}),y().then(function(c){Ft(c.Groups),It(c.Nodes)})},[]);var Kt=(0,p.useCallback)(function(){return new ue.bn.kS({attrs:{line:{targetMarker:"classic",stroke:Te=="1"?"#000000":"#FF9900"}},zIndex:0,data:{type:Te}})},[Te]);return(0,h.jsx)("div",{children:(0,h.jsx)(X.Z,{spinning:At,children:(0,h.jsx)(oe.l,{editorCtx:d,panelData:{Nodes:B()(Lt),Groups:[{name:"ctrl",title:"\u903B\u8F91\u63A7\u5236",graphHeight:450}].concat(B()(Jt))},showLeft:H,graphIns:Ae,toolElements:[(0,h.jsx)(V.ZP,{type:"text",icon:H?(0,h.jsx)(l.Z,{}):(0,h.jsx)(E.Z,{}),onClick:function(){ie(!H)},style:{fontSize:"16px",width:64,height:64}}),(0,h.jsx)(V.ZP,{icon:(0,h.jsx)(x.Z,{}),type:"primary",onClick:function(){return ke()},children:"\u4FDD\u5B58"}),(0,h.jsx)(ht,{open:Ge,values:i()({},t),setOpen:function(){Ue(!Ge)},onSubmit:Vt,children:(0,h.jsx)(V.ZP,{onClick:function(){return Ue(!0)},icon:(0,h.jsx)(w.Z,{style:{color:"#1677ff"}}),children:"\u53C2\u6570"})}),(0,h.jsx)(St,{open:We,setOpen:function(){return be(!We)},values:{params:t==null?void 0:t.params},onSubmit:function(m,S){if(be(!1),t){var K=m.params,ee=m.bizId,J=m.headers,Oe=m.bizStartCode;M(!0),Ct(ve,JSON.parse(K),ee,Oe,S,JSON.parse(J)).then(function(G){G.data.code==0?(M(!1),F.Z.success({title:"\u6267\u884C\u6210\u529F",width:"1000px",closable:!0,content:(0,h.jsx)("div",{children:(0,h.jsx)(Ne.Z,{pageId:"debug-info",data:G.data})})})):(M(!1),F.Z.error({title:(0,h.jsx)("span",{children:G.data.msg}),width:"1200px",closable:!0,content:(0,h.jsx)("div",{children:(0,h.jsx)(Ne.Z,{pageId:"debug-info",data:G.data})})}))}).catch(function(G){M(!1);var Be=G.response.data;F.Z.error({title:(0,h.jsx)("span",{children:Be.msg}),width:"1200px",closable:!0})})}},children:(0,h.jsx)(V.ZP,{onClick:function(){be(!0)},icon:(0,h.jsx)(b.Z,{style:{color:"#1677ff"}}),children:"\u8C03\u8BD5"})}),(0,h.jsx)(V.ZP,{icon:(0,h.jsx)(ae.Z,{style:{color:"#1677ff"}}),onClick:function(){(0,Je.V)(Ae)},children:"\u5E03\u5C40"}),(0,h.jsxs)(k.Z.Text,{strong:!0,style:{fontSize:"18px"},children:["[",t.name,"]"]}),(0,h.jsxs)(k.Z.Text,{children:["\u7248\u672C:",t.version]})],graphJson:O,onGraphJsonEmpty:st,createEdge:Kt,edgeTools:["button-remove","vertices","segments"],onSave:function(){return ke()},jsTipMap:de,autoLayout:function(m){return(0,Je.V)(m)},onGraphInsChange:function(m){return Ot(m)}})})})},Et=xt}}]);
