"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[883],{60341:function(H,x,t){t.d(x,{l:function(){return j.Z}});var j=t(93797)},2325:function(H,x,t){t.d(x,{C:function(){return j}});var j=new Map,$=50,B=50;j.set("ExtSharp",{name:"ExtSharp",config:{width:100,height:B,attrs:{body:{rx:6,ry:6,stroke:"#5F95FF",strokeWidth:1,fill:"rgba(95,149,255,0.05)",refWidth:1,refHeight:1},image:{refX:2,refY:0},text:{refX:4,refY:20,fontSize:12,"text-anchor":"start"}},markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}})},59176:function(H,x,t){t.r(x),t.d(x,{default:function(){return Ut}});var j=t(93525),$=t.n(j),B=t(57213),y=t.n(B),vt=t(54306),v=t.n(vt),dt=t(60341),Z=t(83217),ct=t(72197),T=t(54145),O=t(10502),i=t(87363),ft=t(98306),gt=t(5671),St=t(14990),ht=t(22465),mt=t(72237),yt=t(93853),Ct=t(28110),xt=t(25359),Y=t.n(xt),jt=t(49811),pt=t.n(jt),Jt=t(58146);function Ot(){return L.apply(this,arguments)}function L(){return L=pt()(Y()().mark(function f(){return Y()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise(function(o,c){o((0,Jt.K)())}));case 1:case"end":return r.stop()}},f)})),L.apply(this,arguments)}var Ft=t(21140),Pt=t.n(Ft),Et=t(63466),Nt=t.n(Et),Dt=t(77357),Zt=function(){function f(){Pt()(this,f)}return Nt()(f,[{key:"graphToLogicDsl",value:function(r,o){var c=(0,Dt.nq)(o==null?void 0:o.id,r==null?void 0:r.getCells());return c.visualConfig=r==null?void 0:r.toJSON(),y()(y()({},o),c)}}]),f}(),Tt=t(12490);function Bt(f){var e=f.createNode({shape:"circle",label:"start",width:50,height:50,attrs:{body:{}},ports:Tt.Hi,data:{config:{type:"start"}}});f.addNode(e)}var U=t(2325),W=t(48364),Lt=t(89147),bt=t(3619),K=t(62835),d=t(94744),n=t(33130),zt=function(e){var r,o=(0,i.useState)({}),c=v()(o,2),F=c[0],l=c[1];(0,i.useEffect)(function(){var u=e.values,g=u.params,S=u.variables,h=u.envs,P=u.returns;l({params:JSON.stringify(d.y.getJsonByParams(g)),variables:JSON.stringify(d.y.getJsonByParams(S)),returns:JSON.stringify(d.y.getJsonByParams(P)),envs:JSON.stringify(d.y.getJsonByParams(h))})},[e.values]);var C=(0,i.useCallback)(function(u){try{return JSON.parse(u),!0}catch(g){return!1}},[]);return(0,n.jsxs)("span",{children:[e.children,(0,n.jsx)(O.Z,{open:(r=e.open)!==null&&r!==void 0?r:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return e==null?void 0:e.setOpen(!1)},children:(0,n.jsx)(K.Z,{formId:"logic-setting",values:F,onSubmit:function(g){console.log("\u63D0\u4EA4\u53C2\u6570"),console.log(g);var S=!1;Object.keys(g).forEach(function(h){var P=g[h];if(!C(P)){var b=h==="params"?"\u5165\u53C2":h==="variables"?"\u5C40\u90E8\u53D8\u91CF":h==="returns"?"\u8FD4\u56DE\u53C2\u6570":"\u73AF\u5883\u53D8\u91CF";return Z.ZP.error("".concat(b,"json\u683C\u5F0F\u9519\u8BEF")),S=!0,!1}}),S||(e!=null&&e.onSubmit&&e.onSubmit(g),e==null||e.setOpen(!1))}})})]})},At=zt,It=t(5726),Mt=t.n(It),Gt=t(24594),Rt=function(e){var r,o=(0,Gt.cI)();(0,i.useEffect)(function(){var l=e.values.params;o.setValues({params:JSON.stringify(d.y.getJsonByParams(l))})},[e.values]);var c=(0,i.useCallback)(function(l){try{return JSON.parse(l),!0}catch(C){return!1}},[]);function F(l){var C=!1;Object.keys(l).forEach(function(u){var g=l[u];if(["params","headers"].indexOf(u)>-1&&!c(g)){var S=u==="params"?"\u5165\u53C2":"\u8BF7\u6C42\u5934";return Z.ZP.error("".concat(S,"json\u683C\u5F0F\u9519\u8BEF")),C=!0,!1}}),C||(e!=null&&e.onSubmit&&e.onSubmit(l,l.debugType),e==null||e.setOpen(!1))}return(0,n.jsxs)("span",{children:[e.children,(0,n.jsx)(O.Z,{open:(r=e.open)!==null&&r!==void 0?r:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return e==null?void 0:e.setOpen(!1)},children:(0,n.jsx)(K.Z,{formId:"logic-debug-input",onSubmit:F})})]})},Ht=Rt,$t=t(61719),V=t(11331),Yt=function(){var e=(0,i.useState)({}),r=v()(e,2),o=r[0],c=r[1],F=(0,i.useState)({}),l=v()(F,2),C=l[0],u=l[1],g=(0,i.useState)({}),S=v()(g,2),h=S[0],P=S[1],b=(0,i.useState)(!0),X=v()(b,2),z=X[0],Wt=X[1],Kt=(0,i.useState)(!1),Q=v()(Kt,2),Vt=Q[0],p=Q[1],Xt=(0,i.useState)("1"),w=v()(Xt,2),A=w[0],va=w[1],Qt=(0,i.useState)(),k=v()(Qt,2),q=k[0],wt=k[1],kt=(0,i.useState)([]),_=v()(kt,2),qt=_[0],_t=_[1],ta=(0,i.useState)(!1),tt=v()(ta,2),at=tt[0],et=tt[1],aa=(0,i.useState)(!1),nt=v()(aa,2),st=nt[0],I=nt[1],ea=(0,i.useState)(new Map),rt=v()(ea,2),na=rt[0],da=rt[1],sa=(0,ft.UO)(),ot=sa.id,ra=new Zt;function it(){p(!0);var a=ra.graphToLogicDsl(q,o);a.version=ut(),c(a),lt(a)}function ut(){return Mt()(Date.now()).format("YYYYMMDDHHmmss")}function lt(a){(0,W.az)(a.id,a.version,JSON.stringify(a)).then(function(s){p(!1),Z.ZP.success("\u4FDD\u5B58\u6210\u529F"),console.log("save logic"),console.log(a)}).catch(function(s){p(!1),console.log("err"),console.log(s),Z.ZP.error("\u4FDD\u5B58\u5931\u8D25")})}function oa(a){var s,E,N,D,J={};J._par=a.params,J._var=a.variables,J._env=a.envs,u({jsTips:y()({},J)});var M=d.y.getParamArrayByJson(JSON.parse((s=a.params)!==null&&s!==void 0?s:"{}")),m=d.y.getReturnArrayByJson(JSON.parse((E=a.returns)!==null&&E!==void 0?E:"{}")),G=d.y.getVariableArrayByJson(JSON.parse((N=a.variables)!==null&&N!==void 0?N:"{}")),la=d.y.getEnvsArrayByJson(JSON.parse((D=a.envs)!==null&&D!==void 0?D:"{}")),R=y()(y()({},o),{},{params:M,returns:m,variables:G,envs:la});R.version=ut(),c(R),lt(R)}function ia(a){var s={};s._par=JSON.stringify(d.y.getJsonByParams(a.params)),s._var=JSON.stringify(d.y.getJsonByParams(a.variables)),s._env=JSON.stringify(d.y.getJsonByParams(a.envs)),u({jsTips:y()({},s)}),p(!1)}(0,i.useEffect)(function(){(0,Lt.m)([U.C.get("ExtSharp")]),p(!0),(0,W.YH)(ot).then(function(a){var s=a;s.id=ot,c(s),P(s==null?void 0:s.visualConfig),ia(s)}).catch(function(a){p(!1),console.log("err"),console.log(a)}),Ot().then(function(a){_t(a.Nodes)})},[]);var ua=(0,i.useCallback)(function(){return new gt.bn.kS({attrs:{line:{targetMarker:"classic",stroke:A=="1"?"#000000":"#FF9900"}},zIndex:0,data:{type:A}})},[A]);return(0,n.jsx)("div",{children:(0,n.jsx)(ct.Z,{spinning:Vt,children:(0,n.jsx)(dt.l,{editorCtx:C,panelData:{Nodes:$()(qt),Shapes:[U.C.get("ExtSharp")],Groups:[{name:"global",title:"\u5168\u5C40\u8282\u70B9",graphHeight:110},{name:"ctrl",title:"\u903B\u8F91\u63A7\u5236",graphHeight:220},{name:"biz",title:"\u4E1A\u52A1\u8C03\u7528",graphHeight:220}]},showLeft:z,graphIns:q,toolElements:[(0,n.jsx)(T.ZP,{type:"text",icon:z?(0,n.jsx)(St.Z,{}):(0,n.jsx)(ht.Z,{}),onClick:function(){Wt(!z)},style:{fontSize:"16px",width:64,height:64}}),(0,n.jsx)(T.ZP,{icon:(0,n.jsx)(mt.Z,{}),type:"primary",onClick:function(){return it()},children:"\u4FDD\u5B58"}),(0,n.jsx)(At,{open:at,values:y()({},o),setOpen:function(){et(!at)},onSubmit:oa,children:(0,n.jsx)(T.ZP,{onClick:function(){return et(!0)},icon:(0,n.jsx)(yt.Z,{}),children:"\u914D\u7F6E\u53C2\u6570"})}),(0,n.jsx)(Ht,{open:st,setOpen:function(){return I(!st)},values:{params:o==null?void 0:o.params},onSubmit:function(s,E){if(I(!1),o){var N=s.params,D=s.bizId,J=s.headers,M=s.bizStartCode;(0,$t.L7)(o.id,JSON.parse(N),D,M,E,JSON.parse(J)).then(function(m){m.data.code==0?O.Z.success({title:"\u6267\u884C\u6210\u529F",width:"1000px",closable:!0,content:(0,n.jsx)("div",{children:(0,n.jsx)(V.Z,{pageId:"debug-info",data:m.data})})}):O.Z.error({title:(0,n.jsx)("span",{children:m.data.msg}),width:"1200px",closable:!0,content:(0,n.jsx)("div",{children:(0,n.jsx)(V.Z,{pageId:"debug-info",data:m.data})})})}).catch(function(m){var G=m.response.data;O.Z.error({title:(0,n.jsx)("span",{children:G.msg}),width:"1200px",closable:!0})})}},children:(0,n.jsx)(T.ZP,{type:"default",onClick:function(){I(!0)},icon:(0,n.jsx)(Ct.Z,{}),children:"\u8C03\u8BD5"})}),(0,n.jsxs)("span",{children:["\u5F53\u524D\u7248\u672C:",o.version]})],graphJson:h,onGraphJsonEmpty:Bt,createEdge:ua,edgeTools:["button-remove","vertices","segments"],onSave:function(){return it()},jsTipMap:na,autoLayout:function(s){return(0,bt.V)(s)},onGraphInsChange:function(s){return wt(s)}})})})},Ut=Yt}}]);
