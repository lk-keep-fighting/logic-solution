"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[883],{86119:function(Cn,H,t){t.r(H),t.d(H,{default:function(){return Yt}});var ct=t(25359),Y=t.n(ct),dt=t(93525),F=t.n(dt),ft=t(49811),gt=t.n(ft),St=t(57213),d=t.n(St),mt=t(54306),u=t.n(mt),ht=t(60341),f=t(83217),pt=t(72197),x=t(54145),Ct=t(70710),j=t(51394),U=t(36267),s=t(87363),yt=t(98306),xt=t(5671),jt=t(14990),Jt=t(22465),Ot=t(72237),Zt=t(93853),Tt=t(28110),Bt=t(49228),Et=t(79716),Ft=t(21558),Lt=t(44174),Pt=t(2325),J=t(48364),Dt=t(38821),L=t(3619),Nt=t(7944),g=t(94744),At=t(5726),Gt=t.n(At),It=t(79671),W=t(44132),Mt=t(32126),zt=t(2069),a=t(33130),Rt=function(m){var O=m.onConfirm,i=m.onCancel,h=m.isOpen,P=(0,s.useState)(""),p=u()(P,2),Z=p[0],D=p[1],N=function(){try{O(Z)}catch(y){f.ZP.error(y.message)}};return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(j.Z,{title:"\u5BFC\u5165json\u751F\u6210\u6D41\u7A0B\u56FE",visible:h,cancelText:"\u53D6\u6D88",okText:"\u786E\u5B9A\u5BFC\u5165\u8986\u76D6",onOk:N,width:800,onCancel:function(){return i()},children:(0,a.jsx)(zt.ML,{width:"100%",height:500,value:Z,allowFullscreen:!0,language:"json",onChange:function(y){return D(y)},placeholder:"\u5728\u8FD9\u91CC\u7C98\u8D34json"})})})},Vt=Rt,$t=t(77357),Ht=function(){var m=(0,s.useState)({}),O=u()(m,2),i=O[0],h=O[1],P=(0,s.useState)({}),p=u()(P,2),Z=p[0],D=p[1],N=(0,s.useState)({}),C=u()(N,2),y=C[0],K=C[1],Wt=(0,s.useState)(!0),Q=u()(Wt,2),A=Q[0],Kt=Q[1],Qt=(0,s.useState)(!1),X=u()(Qt,2),Xt=X[0],l=X[1],bt=(0,s.useState)("1"),b=u()(bt,2),G=b[0],yn=b[1],kt=(0,s.useState)(!1),k=u()(kt,2),wt=k[0],I=k[1],qt=(0,s.useState)(),w=u()(qt,2),T=w[0],_t=w[1],tn=(0,s.useState)([]),q=u()(tn,2),nn=q[0],en=q[1],an=(0,s.useState)([]),_=u()(an,2),sn=_[0],on=_[1],rn=(0,s.useState)(!1),tt=u()(rn,2),nt=tt[0],et=tt[1],un=(0,s.useState)(!1),at=u()(un,2),st=at[0],M=at[1],ln=(0,s.useState)(new Map),ot=u()(ln,2),B=ot[0],rt=ot[1],vn=(0,yt.UO)(),E=vn.id,cn=new Ft.W;function ut(n){window.document.title="["+n.name+"]:"+n.version}function it(){l(!0),(0,J.qB)(E).then(function(n){if(n.version!=i.version)l(!1),f.ZP.error("\u672C\u5730\u7248\u672C\u4E0E\u670D\u52A1\u5668[".concat(n.version,"]\u4E0D\u4E00\u81F4\uFF0C\u65E0\u6CD5\u4FDD\u5B58\uFF01\u8BF7\u6253\u5F00\u65B0\u8BBE\u8BA1\u9875\u624B\u52A8\u5408\u5E76\u903B\u8F91\uFF01"));else{var e=cn.graphToLogicItems(T,i);e.version=lt(),h(e),vt(e),ut(e)}}).catch(function(n){l(!1),f.ZP.error("\u83B7\u53D6\u903B\u8F91\u5931\u8D25\uFF01"),console.log("err"),console.log(n)})}function lt(){return Gt()(Date.now()).format("YYYYMMDDHHmmss")}function vt(n){(0,J.az)(E,n.version,JSON.stringify(n)).then(function(e){l(!1),console.log("save logic"),console.log(n),e.status==200?(f.ZP.success("\u4FDD\u5B58\u6210\u529F"),console.log("save logic success")):(f.ZP.error("\u4FDD\u5B58\u5931\u8D25\uFF1A"+e.statusText),console.error("save logic error"))}).catch(function(e){l(!1),console.log("err"),console.log(e),f.ZP.error("\u4FDD\u5B58\u5931\u8D25")})}(0,s.useEffect)(function(){D({jsTips:d()({},B)})},[B]);function dn(n){var e,o,r,S,v={};v._par=n.params,v._var=n.variables,rt(d()(d()({},B),v));var R=g.y.getParamArrayByJson(JSON.parse((e=n.params)!==null&&e!==void 0?e:"{}")),c=g.y.getReturnArrayByJson(JSON.parse((o=n.returns)!==null&&o!==void 0?o:"{}")),V=g.y.getVariableArrayByJson(JSON.parse((r=n.variables)!==null&&r!==void 0?r:"{}")),pn=g.y.getEnvsArrayByJson(JSON.parse((S=n.envs)!==null&&S!==void 0?S:"{}")),$=d()(d()({},i),{},{params:R,returns:c,variables:V,envs:pn,log:n.log});$.version=lt(),h($),vt($)}function fn(n){return z.apply(this,arguments)}function z(){return z=gt()(Y()().mark(function n(e){var o,r;return Y()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return o={},o._par=JSON.stringify(g.y.getJsonByParams(e.params)),o._var=JSON.stringify(g.y.getJsonByParams(e.variables)),v.next=5,Mt.S.getEnvJson();case 5:r=v.sent,o._env=JSON.stringify(r),o._lastRet="{}",o._last=JSON.stringify({success:!0,msg:""}),rt(o),l(!1);case 11:case"end":return v.stop()}},n)})),z.apply(this,arguments)}function gn(n){(0,J.qB)(n).then(function(e){var o=e.name,r=e.configJson;r.id=n,r.name=o,h(r),K(r==null?void 0:r.visualConfig),fn(r),ut(r)}).catch(function(e){l(!1),console.log("err"),console.log(e)})}(0,s.useEffect)(function(){(0,Dt.m)(F()(Pt.C.values())),l(!0),gn(E),(0,Et.O)().then(function(n){on(n.Groups),en(n.Nodes)})},[]);var Sn=(0,s.useCallback)(function(){return new xt.bn.kS({attrs:{line:{targetMarker:"classic",stroke:G=="1"?"#000000":"#FF9900"}},zIndex:0,data:{type:G}})},[G]),mn=[{key:"imoport",label:"\u5BFC\u5165Json\u914D\u7F6E"}],hn=function(e){I(!0)};return(0,a.jsx)("div",{children:(0,a.jsx)(pt.Z,{spinning:Xt,children:(0,a.jsx)(ht.l,{editorCtx:Z,panelData:{Nodes:F()(nn),Groups:[{name:"ctrl",title:"\u903B\u8F91\u63A7\u5236",graphHeight:360}].concat(F()(sn))},showLeft:A,graphIns:T,toolElements:[(0,a.jsx)(x.ZP,{type:"text",icon:A?(0,a.jsx)(jt.Z,{}):(0,a.jsx)(Jt.Z,{}),onClick:function(){Kt(!A)},style:{fontSize:"16px",width:64,height:64}}),(0,a.jsxs)(Ct.Z.Button,{type:"primary",onClick:function(){return it()},menu:{items:mn,onClick:hn},children:[(0,a.jsx)(Ot.Z,{}),"\u4FDD\u5B58"]}),(0,a.jsx)(Nt.Z,{open:nt,values:d()({},i),setOpen:function(){et(!nt)},onSubmit:dn,children:(0,a.jsx)(x.ZP,{onClick:function(){return et(!0)},icon:(0,a.jsx)(Zt.Z,{style:{color:"#1677ff"}}),children:"\u53C2\u6570"})}),(0,a.jsx)(It.Z,{open:st,setOpen:function(){return M(!st)},values:{params:i==null?void 0:i.params},onSubmit:function(e,o){if(M(!1),i){var r=e.params,S=e.bizId,v=e.headers,R=e.bizStartCode;l(!0),(0,J.L7)(E,JSON.parse(r),S,R,o,JSON.parse(v)).then(function(c){c.data.code==0?(l(!1),j.Z.success({title:"\u6267\u884C\u6210\u529F",width:"1000px",closable:!0,content:(0,a.jsx)("div",{children:(0,a.jsx)(W.Z,{pageId:"debug-info",data:c.data})})})):(l(!1),j.Z.error({title:(0,a.jsx)("span",{children:c.data.msg}),width:"1200px",closable:!0,content:(0,a.jsx)("div",{children:(0,a.jsx)(W.Z,{pageId:"debug-info",data:c.data})})}))}).catch(function(c){l(!1);var V=c.response.data;j.Z.error({title:(0,a.jsx)("span",{children:V.msg}),width:"1200px",closable:!0})})}},children:(0,a.jsx)(x.ZP,{onClick:function(){M(!0)},icon:(0,a.jsx)(Tt.Z,{style:{color:"#1677ff"}}),children:"\u8C03\u8BD5"})}),(0,a.jsx)(Vt,{onConfirm:function(e){I(!1);var o=(0,$t.S8)(JSON.parse(e));K(o),setTimeout(function(){(0,L.V)(T)},500)},onCancel:function(){return I(!1)},isOpen:wt}),(0,a.jsx)(x.ZP,{icon:(0,a.jsx)(Bt.Z,{style:{color:"#1677ff"}}),onClick:function(){(0,L.V)(T)},children:"\u5E03\u5C40"}),(0,a.jsxs)(U.Z.Text,{strong:!0,style:{fontSize:"18px"},children:["[",i.name,"]"]}),(0,a.jsxs)(U.Z.Text,{children:["\u7248\u672C:",i.version]})],graphJson:y,onGraphJsonEmpty:Lt.n,createEdge:Sn,edgeTools:["button-remove","vertices","segments"],onSave:function(){return it()},jsTipMap:B,autoLayout:function(e){return(0,L.V)(e)},onGraphInsChange:function(e){return _t(e)}})})})},Yt=Ht}}]);
