"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[883],{50111:function(On,Y,t){t.r(Y),t.d(Y,{default:function(){return Qt}});var gt=t(90228),U=t.n(gt),St=t(15558),D=t.n(St),ht=t(87999),mt=t.n(ht),pt=t(26068),g=t.n(pt),Ct=t(48305),r=t.n(Ct),yt=t(60860),S=t(63121),xt=t(82494),j=t(39765),jt=t(87335),J=t(39710),L=t(77154),Jt=t(42553),o=t(87363),Et=t(9413),Ot=t(91505),Ft=t(8674),Tt=t(16020),Zt=t(66952),Bt=t(1893),Dt=t(33226),Lt=t(25281),At=t(30098),Pt=t(72677),Nt=t(8678),Gt=t(72920),E=t(99511),It=t(72233),A=t(83359),Mt=t(76262),h=t(20210),zt=t(16483),Rt=t.n(zt),$t=t(98496),W=t(68784),Ht=t(370),Vt=t(94391),a=t(62086),Yt=function(m){var O=m.onConfirm,i=m.onCancel,p=m.isOpen,P=(0,o.useState)(""),C=r()(P,2),F=C[0],N=C[1],G=function(){try{O(F)}catch(x){S.ZP.error(x.message)}};return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(J.Z,{title:"\u5BFC\u5165json\u751F\u6210\u6D41\u7A0B\u56FE",visible:p,cancelText:"\u53D6\u6D88",okText:"\u786E\u5B9A\u5BFC\u5165\u8986\u76D6",onOk:G,width:800,onCancel:function(){return i()},children:(0,a.jsx)(Vt.MLE,{width:"100%",height:500,value:F,allowFullscreen:!0,language:"json",onChange:function(x){return N(x)},placeholder:"\u5728\u8FD9\u91CC\u7C98\u8D34json"})})})},Ut=Yt,Wt=t(74737),Kt=function(){var m=(0,o.useState)({}),O=r()(m,2),i=O[0],p=O[1],P=(0,o.useState)({}),C=r()(P,2),F=C[0],N=C[1],G=(0,o.useState)({}),y=r()(G,2),x=y[0],K=y[1],bt=(0,o.useState)(!0),Q=r()(bt,2),I=Q[0],kt=Q[1],wt=(0,o.useState)(!1),X=r()(wt,2),qt=X[0],v=X[1],_t=(0,o.useState)("1"),b=r()(_t,2),M=b[0],Fn=b[1],tn=(0,o.useState)(!1),k=r()(tn,2),nn=k[0],z=k[1],en=(0,o.useState)(),w=r()(en,2),T=w[0],an=w[1],sn=(0,o.useState)([]),q=r()(sn,2),on=q[0],rn=q[1],un=(0,o.useState)([]),_=r()(un,2),ln=_[0],vn=_[1],cn=(0,o.useState)(!1),tt=r()(cn,2),nt=tt[0],et=tt[1],dn=(0,o.useState)(!1),at=r()(dn,2),st=at[0],R=at[1],fn=(0,o.useState)(new Map),ot=r()(fn,2),Z=ot[0],rt=ot[1],gn=(0,o.useState)({}),ut=r()(gn,2),Sn=ut[0],lt=ut[1],hn=(0,Et.UO)(),B=hn.id,mn=new Pt.W;function it(n){window.document.title="["+n.name+"]:"+n.version}function vt(){v(!0),(0,E.qB)(B).then(function(n){if(n.version&&n.version!=i.version)v(!1),S.ZP.error("\u672C\u5730\u7248\u672C\u4E0E\u670D\u52A1\u5668[".concat(n.version,"]\u4E0D\u4E00\u81F4\uFF0C\u65E0\u6CD5\u4FDD\u5B58\uFF01\u8BF7\u6253\u5F00\u65B0\u8BBE\u8BA1\u9875\u624B\u52A8\u5408\u5E76\u903B\u8F91\uFF01"));else{var e=mn.graphToLogicItems(T,i);e.version=ct(),p(e),dt(e),it(e)}}).catch(function(n){v(!1),S.ZP.error("\u83B7\u53D6\u903B\u8F91\u5931\u8D25\uFF01"),console.log("err"),console.log(n)})}function ct(){return Rt()(Date.now()).format("YYYYMMDDHHmmss")}function dt(n){(0,E.az)(B,n.version,JSON.stringify(n)).then(function(e){v(!1),console.log("save logic"),console.log(n),e.status==200?(S.ZP.success("\u4FDD\u5B58\u6210\u529F"),console.log("save logic success")):(S.ZP.error("\u4FDD\u5B58\u5931\u8D25\uFF1A"+e.statusText),console.error("save logic error"))}).catch(function(e){v(!1),console.log("err"),console.log(e),S.ZP.error("\u4FDD\u5B58\u5931\u8D25")})}(0,o.useEffect)(function(){N({jsTips:g()({},Z)})},[Z]);function pn(n){var e,l,s,c,d,f={};f._par=n.params,f._var=n.variables,f._global=(e=n.variables.__global)!==null&&e!==void 0?e:"{}",rt(g()(g()({},Z),f));var u=h.y.getParamArrayByJson(JSON.parse((l=n.params)!==null&&l!==void 0?l:"{}")),H=h.y.getReturnArrayByJson(JSON.parse((s=n.returns)!==null&&s!==void 0?s:"{}")),En=h.y.getVariableArrayByJson(JSON.parse((c=n.variables)!==null&&c!==void 0?c:"{}")),ft=h.y.getEnvsArrayByJson(JSON.parse((d=n.envs)!==null&&d!==void 0?d:"{}"));lt(ft);var V=g()(g()({},i),{},{params:u,returns:H,variables:En,envs:ft,log:n.log});V.version=ct(),p(V),dt(V)}function Cn(n){return $.apply(this,arguments)}function $(){return $=mt()(U()().mark(function n(e){var l,s,c,d;return U()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return s={},s._par=JSON.stringify(h.y.getJsonByParams(e.params)),c=h.y.getJsonByParams(e.variables),s._var=JSON.stringify(c),s._global=JSON.stringify((l=c.__global)!==null&&l!==void 0?l:"{}"),u.next=7,Ht.S.getEnvJson();case 7:d=u.sent,lt(d),s._env=JSON.stringify(d),s._bizId='""',s._lastRet="{}",s._last=JSON.stringify({success:!0,msg:""}),rt(s),v(!1);case 15:case"end":return u.stop()}},n)})),$.apply(this,arguments)}function yn(n){(0,E.qB)(n).then(function(e){var l=e.name,s=e.configJson;s.id=n,s.name=l,p(s),Cn(s),K(s==null?void 0:s.visualConfig),it(s)}).catch(function(e){v(!1),console.log("err"),console.log(e)})}(0,o.useEffect)(function(){(0,It.m)(D()(Gt.C.values())),v(!0),yn(B),(0,At.O)().then(function(n){vn(n.Groups),rn(n.Nodes)})},[]);var xn=(0,o.useCallback)(function(){return new Ot.bn.kS({attrs:{line:{targetMarker:"classic",stroke:M=="1"?"#000000":"#FF9900"}},zIndex:0,data:{type:M}})},[M]),jn=[{key:"imoport",label:"\u5BFC\u5165Json\u914D\u7F6E"}],Jn=function(e){z(!0)};return(0,a.jsx)("div",{children:(0,a.jsx)(xt.Z,{spinning:qt,children:(0,a.jsx)(yt.l,{editorCtx:F,panelData:{Nodes:D()(on),Groups:[{name:"ctrl",title:"\u903B\u8F91\u63A7\u5236",graphHeight:360},{name:"assign",title:"\u53D8\u91CF\u8D4B\u503C",graphHeight:100}].concat(D()(ln))},showLeft:I,graphIns:T,toolElements:[(0,a.jsx)(j.ZP,{type:"text",icon:I?(0,a.jsx)(Ft.Z,{}):(0,a.jsx)(Tt.Z,{}),onClick:function(){kt(!I)},style:{fontSize:"16px",width:64,height:64}}),(0,a.jsxs)(jt.Z.Button,{type:"primary",onClick:function(){return vt()},menu:{items:jn,onClick:Jn},children:[(0,a.jsx)(Zt.Z,{}),"\u4FDD\u5B58"]}),(0,a.jsx)(Mt.Z,{open:nt,values:g()({},i),setOpen:function(){et(!nt)},onSubmit:pn,children:(0,a.jsx)(j.ZP,{onClick:function(){return et(!0)},icon:(0,a.jsx)(Bt.Z,{style:{color:"#1677ff"}}),children:"\u53C2\u6570"})}),(0,a.jsx)($t.Z,{open:st,setOpen:function(){return R(!st)},values:{params:i==null?void 0:i.params},onSubmit:function(e,l){if(R(!1),i){var s=e.params,c=e.bizId,d=e.headers,f=e.bizStartCode;v(!0),(0,E.L7)(B,JSON.parse(s),c,f,l,JSON.parse(d)).then(function(u){u.data.code==0?(v(!1),J.Z.success({title:"\u6267\u884C\u6210\u529F",width:"1000px",okText:"\u5173\u95ED",closable:!0,content:(0,a.jsx)("div",{children:(0,a.jsx)(W.Z,{pageId:"debug-info",data:u.data})})})):(v(!1),J.Z.error({title:(0,a.jsx)("span",{children:u.data.msg}),width:"1200px",okText:"\u5173\u95ED",closable:!0,content:(0,a.jsx)("div",{children:(0,a.jsx)(W.Z,{pageId:"debug-info",data:u.data})})}))}).catch(function(u){v(!1);var H=u.response.data;J.Z.error({title:(0,a.jsx)("span",{children:H.msg}),width:"1200px",closable:!0})})}},children:(0,a.jsx)(j.ZP,{onClick:function(){R(!0)},icon:(0,a.jsx)(Dt.Z,{style:{color:"#1677ff"}}),children:"\u8C03\u8BD5"})}),(0,a.jsx)(Ut,{onConfirm:function(e){z(!1);var l=(0,Wt.S8)(JSON.parse(e));K(l),setTimeout(function(){(0,A.V)(T)},500)},onCancel:function(){return z(!1)},isOpen:nn}),(0,a.jsx)(j.ZP,{icon:(0,a.jsx)(Lt.Z,{style:{color:"#1677ff"}}),onClick:function(){(0,A.V)(T)},children:"\u5E03\u5C40"}),(0,a.jsxs)(L.Z.Text,{strong:!0,style:{fontSize:"18px"},children:["[",i.name,"]"]}),(0,a.jsxs)(L.Z.Text,{children:["\u7248\u672C:",i.version]}),(0,a.jsxs)(L.Z.Text,{children:["\u914D\u7F6E\u6A21\u5F0F\uFF1A",(0,a.jsx)(Jt.Z,{title:"online:\u914D\u7F6E\u5B58\u50A8\u5728\u6570\u636E\u5E93;offline:\u5B58\u50A8\u5728\u6587\u4EF6",children:Sn.LOGIC_CONFIG_MODEL})]})],graphJson:x,onGraphJsonEmpty:Nt.n,createEdge:xn,edgeTools:["button-remove","vertices","segments"],onSave:function(){return vt()},jsTipMap:Z,autoLayout:function(e){return(0,A.V)(e)},onGraphInsChange:function(e){return an(e)}})})})},Qt=Kt}}]);
