"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[7172],{55104:function(H,C,e){var O=e(54306),l=e.n(O),P=e(70517),v=e(90010),j=e.n(v),y=e(23620),g=e(2069),a=e(87363),s=e.n(a),A=e(57456),I=e(33358),b=e(49500),L=e(16123),N=e(99273),h=e(93797),M=e(33130),V=function(p){var U=(0,a.useContext)(h.E),R=(0,a.useState)(p==null?void 0:p.config),w=l()(R,2),J=w[0],Z=w[1],m=(0,a.useState)(p==null?void 0:p.values),de=l()(m,2),ge=de[0],he=de[1],B=U==null?void 0:U.jsTips,Ee=(0,a.useState)(),ue=l()(Ee,2),z=ue[0],ce=ue[1];function _e(i,r,u){i==="formSubmited"?(console.log("\u5185\u90E8\u8868\u5355\u63D0\u4EA4\u4E86",u),p.onSubmit(u)):console.log("\u5185\u90E8\u8868\u5355\u89E6\u53D1\u4E86Broadcast",u)}(0,a.useEffect)(function(){if(p.config&&p.config.body){var i,r=p.config.body[0];(i=r.body)===null||i===void 0||i.forEach(function(D){console.log("deal editor autotip"),d(D)});var u=z==null?void 0:z.getComponentByName("page1.form1");u==null||u.props.store.clear(),Z(p.config)}},[p.config]),(0,a.useEffect)(function(){var i=z==null?void 0:z.getComponentByName("page1.form1");i==null||i.props.store.clear(),i==null||i.props.store.setValues(p.values)},[J]),(0,a.useEffect)(function(){var i=z==null?void 0:z.getComponentByName("page1.form1");i==null||i.props.store.clear(),i==null||i.props.store.setValues(p.values),he(p.values)},[p.values]);var ye=(0,a.useState)(),fe=l()(ye,2),T=fe[0],t=fe[1];function d(i){i.type=="editor"&&i.language=="javascript"?i.editorDidMount=function(r,u){return t(u),B&&Object.keys(B).forEach(function(D){var c=(0,A.k)(D,JSON.parse(B[D]));u==null||u.languages.typescript.javascriptDefaults.addExtraLib(c,"".concat(D,".ts"))}),function(){try{var D,c;console.log("effect dispose"),r==null||r.dispose(),r==null||(D=r.current)===null||D===void 0||D.dispose(),u==null||(c=u.current)===null||c===void 0||c.dispose()}catch(F){console.error("error in findEditorItem"),console.error(F)}}}:i.body&&i.body.forEach(function(r){d(r)})}return(0,a.useEffect)(function(){B&&Object.keys(B).forEach(function(i){var r=(0,A.k)(i,JSON.parse(B[i]));T==null||T.languages.typescript.javascriptDefaults.addExtraLib(r,"".concat(i,".ts"))})},[B]),(0,M.jsxs)("div",{children:[(0,M.jsx)(g.qR,{theme:"cxd",position:"top-right",locale:"zh-CN"},"toast"),(0,M.jsx)(g.wx,{theme:"cxd",locale:"zh-CN"},"alert"),(0,y.sYA)(J,{onBroadcast:_e,data:ge,scopeRef:function(r){return ce(r)}},{fetcher:function(r){var u=r.url,D=r.method,c=r.data,F=r.responseType,_=r.config,k=r.headers;return _=_||{},_.withCredentials=!0,F&&(_.responseType=F),_.cancelExecutor&&(_.cancelToken=new P.Z.CancelToken(_.cancelExecutor)),_.headers=k||{},_.headers.Authorization||(_.headers.Authorization="Bearer "+N.F.getTokenFormLocal()),D!=="post"&&D!=="put"&&D!=="patch"?(c&&(_.params=c),P.Z[D](u,_)):(c&&c instanceof FormData?(_.headers=_.headers||{},_.headers["Content-Type"]="multipart/form-data"):c&&typeof c!="string"&&!(c instanceof Blob)&&!(c instanceof ArrayBuffer)&&(c=JSON.stringify(c),_.headers=_.headers||{},_.headers["Content-Type"]="application/json"),P.Z[D](u,c,_))},isCancel:function(r){return P.Z.isCancel(r)},copy:function(r){j()(r),g.Am.success("\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u7C98\u8D34\u677F")},theme:"cxd",jumpTo:function(r,u){debugger;u.blank==!0?window.open(window.location.origin+window.location.pathname+"#"+r,"_blank"):window.location.hash=r}})]})};C.Z=s().memo(V)},62835:function(H,C,e){var O=e(57213),l=e.n(O),P=e(54306),v=e.n(P),j=e(87363),y=e.n(j),g=e(70256),a=e(55104),s=e(33130),A=function(b){var L=(0,j.useState)({type:"page"}),N=v()(L,2),h=N[0],M=N[1];return(0,j.useEffect)(function(){if(b.formId){var V=b.isStatic?b.formId+"-static":b.formId;(0,g.CD)(V).then(function($){M($)})}},[b.formId]),(0,s.jsx)("div",{children:(0,s.jsx)(a.Z,l()(l()({},b),{},{config:h}))})};C.Z=A},93797:function(H,C,e){e.d(C,{E:function(){return ce},Z:function(){return fe}});var O=e(93525),l=e.n(O),P=e(54306),v=e.n(P),j=e(63466),y=e(21140),g=e(52510),a=e(87363),s=e.n(a),A=e(5671),I=e(9722),b=e(17696),L=e(19227),N=e(75476),h=e(1167),M=e(22046),V=e(22150),$=e(11250),p=e(89357),U=e(83217),R=e(23360),w=e(4283),J=e(54145),Z=e(34957),m=e(33130);function de(T){return(0,m.jsxs)("div",{style:{margin:0,height:"95vh",overflowY:"scroll"},children:[(0,m.jsx)(Z.Z,{isStatic:T.isStatic,editNode:T.editNode,jsTipMap:T.jsTipMap,onSubmit:T.onSubmit}),T!=null&&T.isCollapsed?"":(0,m.jsx)(J.ZP,{type:"text",style:{position:"absolute",top:10,right:15,fontSize:20,textAlign:"center"},onClick:function(){T==null||T.onClose()},children:"x"})]})}var ge=de,he=e(9976),B=e(12490),Ee=function(t,d){var i,r,u,D,c=d.getData(),F=d.getPosition(),_=t.getNodes(),k;if(["ExtSharp","polygon"].indexOf(d.shape)>-1&&c!=null&&c.config&&c.config.type)switch(c.config.type){case"switch":var te=200,Y=t.addNode({shape:"switch",position:F,width:te,height:50,ports:B.Tt,data:d.data,attrs:{body:{stroke:"#8f8f8f",strokeWidth:1,fill:"#fff",rx:6,ry:6}}});t.removeNode(d);var ne=t.addNode({shape:"switch-case",position:{y:F.y+100,x:F.x-te/2},width:120,height:50,ports:B.Tt,data:{config:{type:"switch-case"}}}),oe=t.addNode({shape:"switch-default",position:{y:F.y+100,x:F.x+te},width:120,height:50,ports:B.Tt,data:{config:{type:"switch-default"}}}),be=t.addEdge({source:Y,sourcePort:(i=Y.ports.items.find(function(x){return x.group=="bottom"}))===null||i===void 0?void 0:i.id,target:ne,targetPort:(r=ne.ports.items.find(function(x){return x.group=="top"}))===null||r===void 0?void 0:r.id,zIndex:0}),Pe=t.addEdge({source:Y,sourcePort:(u=Y.ports.items.find(function(x){return x.group=="bottom"}))===null||u===void 0?void 0:u.id,target:oe,targetPort:(D=oe.ports.items.find(function(x){return x.group=="top"}))===null||D===void 0?void 0:D.id,zIndex:0});k=Y;break;case"switch-case":var ae=t.createNode({shape:"switch-case",position:d.position(),width:120,height:50,ports:B.Tt,data:d.data});t.removeNode(d),t.addNode(ae),k=ae;break;case"string":var ie=t.createNode({shape:"string",position:d.position(),width:100,height:50,ports:B.Tt,data:d.data});t.removeNode(d),t.addNode(ie),k=ie;break;case"num":var De=t.createNode({shape:"num",position:d.position(),width:100,height:50,ports:B.Tt,data:d.data});t.removeNode(d),t.addNode(De),k=De;break;case"assignment":var ve=t.createNode({shape:"assignment",position:d.position(),width:220,height:50,ports:B.Tt,data:d.data});t.removeNode(d),t.addNode(ve),k=ve;break;default:break}if(["\u5DE5\u5E8F\u7EC4"].indexOf(d.getAttrByPath("text/text"))>-1&&(d.zIndex=-1),console.log("node:added"),k&&_.length==1){var q,Q,se,re,ee;t.addEdge({source:_[0],sourcePort:(q=_[0].ports.items.find(function(x){return x.group=="bottom"}))===null||q===void 0?void 0:q.id,target:k,targetPort:(Q=k)===null||Q===void 0||(se=Q.ports)===null||se===void 0||(re=se.items)===null||re===void 0||(ee=re.find(function(x){return x.group=="top"}))===null||ee===void 0?void 0:ee.id,zIndex:0})}},ue=e(71731),z=null,ce=s().createContext({}),_e=function(t,d){for(var i=0,r=t.length;i<r;i+=1)t[i].style.visibility=d?"visible":"hidden"},ye=function(t){var d,i,r=(0,a.useState)(),u=v()(r,2),D=u[0],c=u[1],F=(0,a.useState)(!t.showLeft),_=v()(F,2),k=_[0],te=_[1],Y=(0,a.useState)(!t.showRight),ne=v()(Y,2),oe=ne[0],be=ne[1],Pe=(0,a.useState)(t.panelData),ae=v()(Pe,2),ie=ae[0],De=ae[1],ve=(0,a.useState)(),q=v()(ve,2),Q=q[0],se=q[1],re=(0,a.useState)(),ee=v()(re,2),x=ee[0],Ce=ee[1],Oe=(0,a.useState)(),pe=v()(Oe,2),Me=pe[0],je=pe[1],Ae=(0,a.useState)(t.graphIns),Se=v()(Ae,2),X=Se[0],Ie=Se[1],Re=(0,a.useState)(),Te=v()(Re,2),xe=Te[0],Be=Te[1];(0,a.useEffect)(function(){try{var S;if((S=t.panelData)!==null&&S!==void 0&&S.Shapes){var n;(n=t.panelData)===null||n===void 0||n.Shapes.forEach(function(W){console.log("\u56FE\u5185\u90E8\u6CE8\u518C\u65B0\u8282\u70B9:"+W.name),A.kJ.registerNode(W.name,W.config,!0)})}}catch(W){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(W)}},[(d=t.panelData)===null||d===void 0?void 0:d.Shapes]),(0,a.useEffect)(function(){X&&(X.options.connecting.createEdge=t.createEdge)},[t.createEdge]),(0,a.useEffect)(function(){x&&Le(x)},[x]),(0,a.useEffect)(function(){if(X&&t.graphJson)try{X.fromJSON(t.graphJson),X.centerContent()}catch(S){U.ZP.error("\u56FE\u6570\u636E\u6709\u8BEF\uFF0C\u5DF2\u5FFD\u7565"),console.error(S),console.log(t.graphJson)}},[t.graphJson]),(0,a.useEffect)(function(){te(!(t!=null&&t.showLeft))},[t.showLeft]);function Le(S){if(console.log("initGraph"),!!S){var n=t.graphIns;if(n||(n=new A.kJ({container:S,embedding:{enabled:!0,findParent:function(f){var E=f.node,K=E.getBBox();return this.getNodes().filter(function(G){var me=G.getData();if(me&&me.parent){var Ke=G.getBBox();return K.isIntersectWithRect(Ke)}return!1})}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:t.createEdge,validateConnection:function(f){var E=f.targetMagnet;return!!E}},background:{color:"#F2F7FA"},grid:!0})),n.use(new h.H({enabled:!0,sharp:!0})).use(new b.A({enabled:!0})).use(new N.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new V.T({enabled:!0})).use(new L.N).use(new I.T).use(new $.D).use(new ue.w({resizing:{enabled:!0,minWidth:50,maxWidth:0,minHeight:50,maxHeight:0,orthogonal:!1,restrict:!1,preserveAspectRatio:!1}})).use(new p.a({container:Me})),n.on("edge:dblclick",function(o){var f=o.cell}),n.on("edge:change:router",function(o){console.log("edge:change:router")}),n.on("edge:mouseenter",function(o){var f=o.cell;t.edgeTools&&t.edgeTools.forEach(function(E){switch(E){case"edge-editor":break;case"button-remove":f.addTools([{name:"button-remove",args:{attrs:{fill:"#fff",stroke:"#fff",r:10,cursor:"pointer"}}}]);break;case"segments":f.addTools(["segments"]);break;case"vertices":f.addTools(["vertices"]);break;default:break}})}),n.on("edge:mouseleave",function(o){var f=o.cell;f.removeTools()}),n.on("node:mouseenter",function(o){var f,E,K=o.cell;((f=K.data)===null||f===void 0||(E=f.config)===null||E===void 0?void 0:E.type)!="start"&&K.addTools([{name:"button-remove",args:{x:"100%",y:0,offset:{x:-10,y:10}}}]);var G=x==null?void 0:x.querySelectorAll(".x6-port-body");_e(G,!0)}),n.on("node:mouseleave",function(o){var f=o.cell;f.removeTools();var E=x==null?void 0:x.querySelectorAll(".x6-port-body");_e(E,!1)}),n.on("node:click",function(o){var f=o.e,E=o.x,K=o.y,G=o.node,me=o.view;G.removeTools(),c(G)}),n.on("node:added",function(o){var f=o.node,E=o.index,K=o.options;Ee(n,f)}),n.on("node:dblclick",function(o){var f=o.e,E=o.x,K=o.y,G=o.node,me=o.view;be(!1),c(G)}),n.bindKey(["meta+c","ctrl+c"],function(){var o=n.getSelectedCells();return o.length&&n.copy(o),!1}),n.bindKey(["meta+x","ctrl+x"],function(){var o=n.getSelectedCells();return o.length&&n.cut(o),!1}),n.bindKey(["meta+v","ctrl+v"],function(){if(!n.isClipboardEmpty()){var o=n.paste({offset:32});n.cleanSelection(),n.select(o)}return!1}),n.bindKey(["meta+z","ctrl+z"],function(){return n.canUndo()&&n.undo(),!1}),n.bindKey(["meta+shift+z","ctrl+shift+z"],function(){return n.canRedo()&&n.redo(),!1}),n.bindKey("backspace",function(){var o=n.getSelectedCells();o.length&&(o.find(function(f){var E;return f.data?["start"].indexOf((E=f.data.config)===null||E===void 0?void 0:E.type)>-1:!1})?U.ZP.error("\u7981\u6B62\u5220\u9664\u5F00\u59CB\u8282\u70B9\uFF01"):n.removeCells(o))}),n.on("blank:dblclick",function(o){var f=o.e,E=o.x,K=o.y;console.log("blank:dbclick",E,K),t.autoLayout&&t.autoLayout(n)}),n.bindKey(["ctrl+1","meta+1"],function(){var o=n.zoom();o<1.5&&n.zoom(.1)}),n.bindKey(["ctrl+2","meta+2"],function(){var o=n.zoom();o>.5&&n.zoom(-.1)}),Ie(n),ie){var W=ie.Groups,le=new M.t({title:"\u5C55\u5F00/\u6536\u8D77",target:n,search:function(f,E){var K=f.getAttrByPath("text/text");return(K==null?void 0:K.indexOf(E))!==-1},notFoundText:"\u672A\u627E\u5230",collapsable:!0,stencilGraphWidth:250,groups:W,layoutOptions:{rowHeight:100}});Q==null||Q.appendChild(le.container),Be(le)}return t.graphJson&&Object.keys(t.graphJson).length>0?n.fromJSON(t.graphJson):t.onGraphJsonEmpty&&t.onGraphJsonEmpty(n),t.onGraphInsChange&&t.onGraphInsChange(n),n.centerContent(),n}}(0,a.useEffect)(function(){var S;if(xe&&(S=t.panelData)!==null&&S!==void 0&&S.Nodes){var n={};t.panelData.Nodes.forEach(function(W){var le=X.createNode(W.getNodeConfig());t.panelData.Groups.forEach(function(o){W.getGroups().includes(o.name)&&(n[o.name]?n[o.name].push(le):n[o.name]=[le])})}),Object.keys(n).forEach(function(W){xe.load(l()(n[W]),W)})}},[xe,(i=t.panelData)===null||i===void 0?void 0:i.Nodes]);function Ue(){t.onSave&&t.onSave(X)}var We=(0,a.useMemo)(function(){if(t.toolElements){var S;return(0,m.jsx)(R.Z.Header,{style:{padding:0,backgroundColor:"white"},children:(0,m.jsx)(w.Z,{direction:"horizontal",children:(S=t.toolElements)===null||S===void 0?void 0:S.map(function(n){return n})})})}else return(0,m.jsx)("span",{})},[t.toolElements]);return(0,m.jsx)(ce.Provider,{value:t.editorCtx,children:(0,m.jsxs)(R.Z,{style:{height:"100vh",width:"100%",margin:0},children:[(0,m.jsx)(R.Z.Sider,{theme:"light",collapsed:k,collapsedWidth:0,width:250,ref:function(n){return se(n)}}),(0,m.jsxs)(R.Z,{style:{height:"100vh"},children:[We,(0,m.jsxs)(R.Z.Content,{className:"app-content",children:[(0,m.jsx)(he.Z,{ref:function(n){return Ce(n)}}),(0,m.jsx)("div",{className:"app-minimap",ref:function(n){return je(n)}})]})]}),(0,m.jsx)(R.Z.Sider,{theme:"light",collapsed:oe,collapsedWidth:0,width:600,children:(0,m.jsx)(ge,{isStatic:t.isStatic,editNode:D,onSubmit:Ue,jsTipMap:t.jsTipMap,onClose:function(){be(!0)},isCollapsed:oe})})]})})},fe=ye},9976:function(H,C,e){e.d(C,{Z:function(){return v}});var O=e(87363),l=e(33130),P=(0,O.forwardRef)(function(j,y){return(0,l.jsx)("div",{className:"drag-graph",ref:y})}),v=P},34957:function(H,C,e){var O=e(57213),l=e.n(O),P=e(54306),v=e.n(P),j=e(62835),y=e(87363),g=e.n(y),a=e(33130);C.Z=function(s){var A,I=(0,y.useState)(""),b=v()(I,2),L=b[0],N=b[1],h=(0,y.useState)({}),M=v()(h,2),V=M[0],$=M[1],p=function(R){var w,J,Z;(w=s.editNode)===null||w===void 0||w.setAttrByPath("text/text",R.name);var m=(J=s.editNode)===null||J===void 0?void 0:J.data.config;s.editNode&&(console.log("update graph data",R),s.editNode.setData(l()(l()({},s.editNode.data),{},{config:l()(l()({},m),R)}),{overwrite:!0})),console.log("submit---props.editNode.data.config"),console.log((Z=s.editNode)===null||Z===void 0?void 0:Z.data.config),s==null||s.onSubmit()};return(0,y.useEffect)(function(){if(s.editNode&&s.editNode.data){var U=s.editNode.data.config||{};N(s.editNode.data.configSchema||U.type)}},[s.editNode]),(0,y.useEffect)(function(){var U;if((U=s.editNode)!==null&&U!==void 0&&U.data){var R,w,J=((R=s.editNode)===null||R===void 0?void 0:R.data.config)||{},Z=l()({},J),m=(w=s.editNode)===null||w===void 0?void 0:w.attrs;m&&m.text&&m.text.text&&(Z.name=m.text.text),$(Z)}},[(A=s.editNode)===null||A===void 0?void 0:A.data]),(0,a.jsx)(j.Z,{isStatic:s.isStatic,formId:L,values:l()({},V),onSubmit:p,jsTipMap:s.jsTipMap})}},12490:function(H,C,e){e.d(C,{Hi:function(){return P},Tt:function(){return O}});var O={groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]},l={groups:{right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1}},items:[{group:"right"}]},P={groups:{bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1}},items:[{group:"bottom"}]}},57456:function(H,C,e){e.d(C,{k:function(){return v}});var O=e(37635),l=e.n(O),P=function j(y){if(y=y==null)return y;var g="{";return Object.keys(y).forEach(function(a){var s=y[a];g+="".concat(a,":"),Array.isArray(s)?g+="[],":l()(s)=="object"?g+=j(s)+",":typeof s=="string"?g+="'".concat(s,"',"):g+="".concat(s,",")}),g+="}",g},v=function(y,g){var a="";g&&(Object.keys(g).forEach(function(A){var I=g[A];a+="".concat(A,":"),Array.isArray(I)?a+="[],":l()(I)=="object"?a+=P(I)+",":typeof I=="string"?a+="'".concat(I,"',"):a+="".concat(I,",")}),a=a.substring(0,a.length-1));var s="const ".concat(y,"={").concat(a,"}");return s}},70256:function(H,C,e){e.d(C,{CD:function(){return a},UD:function(){return y},n4:function(){return A}});var O=e(25359),l=e.n(O),P=e(49811),v=e.n(P),j=e(70517);function y(b){return g.apply(this,arguments)}function g(){return g=v()(l()().mark(function b(L){return l()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,j.Z.get("/setting/pages/".concat(L,".json"));case 2:return h.abrupt("return",h.sent.data);case 3:case"end":return h.stop()}},b)})),g.apply(this,arguments)}function a(b){return s.apply(this,arguments)}function s(){return s=v()(l()().mark(function b(L){return l()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,j.Z.get("/setting/forms/".concat(L,".json"));case 2:return h.abrupt("return",h.sent.data);case 3:case"end":return h.stop()}},b)})),s.apply(this,arguments)}function A(b,L){return I.apply(this,arguments)}function I(){return I=v()(l()().mark(function b(L,N){return l()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,j.Z.get("/setting/".concat(L,"s/").concat(N,".json"));case 2:return M.abrupt("return",M.sent.data);case 3:case"end":return M.stop()}},b)})),I.apply(this,arguments)}},99273:function(H,C,e){e.d(C,{F:function(){return O}});var O={getTokenFormLocal:function(){return localStorage.getItem("token")},setTokenToLocal:function(P){return localStorage.setItem("token",P)}}}}]);
