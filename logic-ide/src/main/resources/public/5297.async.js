"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[5297],{65297:function(U,R,w){w.r(R),w.d(R,{PageRenderer:function(){return Q},PageRendererBase:function(){return k},default:function(){return T}});var i=w(15767),F=w(87363),v=w.n(F),u=w(42977),S=w(94391),I=w(6663),T=function(C){(0,i.ZT)(l,C);function l(e){var t=C.call(this,e)||this;return(0,u.Ius)(t,["handleAction","handleChange","handleBulkChange","handleQuery","handleDialogConfirm","handleDialogClose","handleDrawerConfirm","handleDrawerClose","handleClick","reload","silentReload","initInterval"]),t.style=document.createElement("style"),t.style.setAttribute("data-page",""),document.getElementsByTagName("head")[0].appendChild(t.style),t.updateStyle(),t.varStyle=document.createElement("style"),t.varStyle.setAttribute("data-vars",""),document.getElementsByTagName("head")[0].appendChild(t.varStyle),t.updateVarStyle(),t}return l.prototype.updateStyle=function(){this.props.css||this.props.mobileCSS?this.style.innerHTML=`
      `.concat(this.buildCSS(this.props.css),`

      @media (max-width: 768px) {
        `).concat(this.buildCSS(this.props.mobileCSS),`
      }
      `):this.style.innerHTML=""},l.prototype.buildCSS=function(e){if(!e)return"";var t="";for(var n in e){var a=e[n],r="";for(var s in a){var d="",h=a[s];if(typeof h=="string")r+="  ".concat(s,": ").concat(h,`;
`);else{for(var o in h)d+=" ".concat(o,":").concat(h[o],";");r+="  ".concat(s," {").concat(d,`}
`)}}t+=`
      `.concat(n,` {
        `).concat(r,`
      }
      `)}return t},l.prototype.updateVarStyle=function(){var e=this.props.cssVars,t="";if(e){for(var n in e)if(n.startsWith("--")){if(n.indexOf(":")!==-1)continue;var a=e[n];if(typeof a=="string"&&(a.indexOf("expression(")!==-1||a.indexOf(";")!==-1))continue;t+="".concat(n,": ").concat(a,`; 
`)}this.varStyle.innerHTML=`
      :root {
        `.concat(t,`
      }
      `)}},l.prototype.componentDidMount=function(){return(0,i.mG)(this,void 0,void 0,function(){var e,t,n,a,r,s,d,h,o,p;return(0,i.Jh)(this,function(c){switch(c.label){case 0:return e=this.props,t=e.initApi,n=e.initFetch,a=e.initFetchOn,r=e.store,s=e.messages,d=e.data,h=e.dispatchEvent,o=e.env,this.mounted=!0,[4,h("init",d,this)];case 1:return p=c.sent(),o!=null&&o.tracker&&o.tracker({eventType:"pageLoaded"},this.props),p!=null&&p.prevented||!(0,I.fh)(r)?[2]:((0,u.X1t)(t,r.data,n,a)&&r.fetchInitData(t,r.data,{successMessage:s&&s.fetchSuccess,errorMessage:s&&s.fetchFailed}).then(this.initInterval),[2])}})})},l.prototype.componentDidUpdate=function(e){var t=this.props,n=t.store,a=t.initApi;if(t.initFetchOn&&t.initFetch&&!e.initFetch||t.initFetch!==!1&&(0,u.rMT)(e.initApi,a,e.data,t.data)){var r=t.messages;(0,u.X1t)(a,n.data)&&n.fetchData(a,n.data,{successMessage:r&&r.fetchSuccess,errorMessage:r&&r.fetchFailed}).then(this.initInterval)}(JSON.stringify(t.css)!==JSON.stringify(e.css)||JSON.stringify(t.mobileCSS)!==JSON.stringify(e.mobileCSS))&&this.updateStyle(),JSON.stringify(t.cssVars)!==JSON.stringify(e.cssVars)&&this.updateVarStyle(),(0,u.RjM)(e.defaultData,t.defaultData)&&n.reInitData(t.defaultData)},l.prototype.componentWillUnmount=function(){var e,t;this.mounted=!1,clearTimeout(this.timer),this.style&&((e=this.style.parentNode)===null||e===void 0||e.removeChild(this.style)),this.varStyle&&((t=this.varStyle.parentNode)===null||t===void 0||t.removeChild(this.varStyle))},l.prototype.reloadTarget=function(e,t){},l.prototype.handleAction=function(e,t,n,a,r){var s=this;a===void 0&&(a=!1);var d=this.props,h=d.env,o=d.store,p=d.messages,c=d.onAction;return t.actionType==="dialog"?(o.setCurrentAction(t,this.props.resolveDefinitions),new Promise(function(f){o.openDialog(n,void 0,function(g,y){var m;(m=t.callback)===null||m===void 0||m.call(t,g,y),f({confirmed:g,value:y})},r||s.context)})):t.actionType==="drawer"?(o.setCurrentAction(t,this.props.resolveDefinitions),new Promise(function(f){o.openDrawer(n,void 0,function(g,y){var m;(m=t.callback)===null||m===void 0||m.call(t,g,y),f({confirmed:g,value:y})},r)})):t.actionType==="ajax"?(o.setCurrentAction(t,this.props.resolveDefinitions),(0,u.X1t)(t.api,n)?o.saveRemote(t.api,n,{successMessage:t.messages&&t.messages.success||p&&p.saveSuccess,errorMessage:t.messages&&t.messages.failed||p&&p.saveSuccess}).then(function(){return(0,i.mG)(s,void 0,void 0,function(){var f;return(0,i.Jh)(this,function(g){switch(g.label){case 0:return t.feedback&&(0,u.pn4)(t.feedback,o.data)?[4,this.openFeedback(t.feedback,o.data)]:[3,2];case 1:g.sent(),g.label=2;case 2:return f=t.redirect&&(0,u.hXT)(t.redirect,o.data),f&&h.jumpTo(f,t,o.data),t.reload&&this.reloadTarget((0,u.u22)(t.reload,o.data),o.data),[2]}})})}).catch(function(f){if(a||t.countDown)throw f}):void 0):c(e,t,n,a,r||this.context)},l.prototype.handleQuery=function(e){if(this.props.initApi){if(e!=null&&e.hasOwnProperty("orderBy")&&!(0,u.rMT)(this.props.initApi,this.props.initApi,this.props.store.data,(0,u.nW9)(this.props.store.data,e)))return!1;this.receive(e);return}return this.props.onQuery?this.props.onQuery(e):!1},l.prototype.handleDialogConfirm=function(e,t){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];var r=this.props.store;t.mergeData&&e.length===1&&e[0]&&r.updateData(e[0]);var s=r.action.dialog;s&&s.onConfirm&&s.onConfirm.apply(s,(0,i.ev)([e,t],(0,i.CR)(n),!1))===!1||r.closeDialog(!0,e)},l.prototype.handleDialogClose=function(e){e===void 0&&(e=!1);var t=this.props.store;t.closeDialog(e)},l.prototype.handleDrawerConfirm=function(e,t){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];var r=this.props.store;t.mergeData&&e.length===1&&e[0]&&r.updateData(e[0]);var s=r.action.dialog;s&&s.onConfirm&&s.onConfirm.apply(s,(0,i.ev)([e,t],(0,i.CR)(n),!1))===!1||r.closeDrawer(!0,e)},l.prototype.handleDrawerClose=function(){var e=this.props.store;e.closeDrawer(!1)},l.prototype.handleClick=function(e){var t,n=e.target,a=this.props.env,r=n.tagName==="A"&&n.hasAttribute("data-link")?n.getAttribute("data-link"):(t=n.closest("a[data-link]"))===null||t===void 0?void 0:t.getAttribute("data-link");a&&r&&(a.jumpTo(r,void 0,this.props.data),e.preventDefault())},l.prototype.handleResizeMouseDown=function(e){var t=e.nativeEvent.which==3;t||(this.codeWrap=e.currentTarget.parentElement,document.addEventListener("mousemove",this.handleResizeMouseMove),document.addEventListener("mouseup",this.handleResizeMouseUp),this.startX=e.clientX,this.startWidth=this.codeWrap.offsetWidth)},l.prototype.handleResizeMouseMove=function(e){var t=this.props,n=t.asideMinWidth,a=n===void 0?160:n,r=t.asideMaxWidth,s=r===void 0?350:r,d=t.asidePosition,h=e.clientX-this.startX,o=d==="right"?this.startWidth-h:this.startWidth+h,p=Math.min(Math.max(o,a),s);this.codeWrap.style.cssText+="width: ".concat(p,"px")},l.prototype.handleResizeMouseUp=function(){document.removeEventListener("mousemove",this.handleResizeMouseMove),document.removeEventListener("mouseup",this.handleResizeMouseUp)},l.prototype.openFeedback=function(e,t){var n=this;return new Promise(function(a){var r=n.props.store;r.setCurrentAction({type:"button",actionType:"dialog",dialog:e},n.props.resolveDefinitions),r.openDialog(t,void 0,function(s){a(s)},n.context)})},l.prototype.reload=function(e,t,n,a,r){return(0,i.mG)(this,void 0,void 0,function(){var s,d,h,o;return(0,i.Jh)(this,function(p){switch(p.label){case 0:return t?[2,this.receive(t,void 0,r)]:(s=this.props,d=s.store,h=s.initApi,clearTimeout(this.timer),(0,u.X1t)(h,d.data)?[4,d.fetchData(h,d.data,{silent:a})]:[3,2]);case 1:o=p.sent(),this.initInterval(o),p.label=2;case 2:return[2,d.data]}})})},l.prototype.receive=function(e,t,n){var a=this.props.store;a.updateData(e,void 0,n),this.reload()},l.prototype.silentReload=function(e,t){this.reload(t,void 0,void 0,!0)},l.prototype.initInterval=function(e){var t,n=this.props,a=n.interval,r=n.silentPolling,s=n.stopAutoRefreshWhen,d=n.data,h=n.dispatchEvent,o=n.store;return h("inited",(0,u.nW9)(d,(0,i.pi)((0,i.pi)({},e==null?void 0:e.data),{responseData:e!=null&&e.ok?(t=e==null?void 0:e.data)!==null&&t!==void 0?t:{}:e,responseStatus:(e==null?void 0:e.status)===void 0?o!=null&&o.error?1:0:e==null?void 0:e.status,responseMsg:(e==null?void 0:e.msg)||(o==null?void 0:o.msg)}))),e!=null&&e.ok&&a&&this.mounted&&(!s||!(0,u.fz_)(s,d))&&(this.timer=setTimeout(r?this.silentReload:this.reload,Math.max(a,1e3))),e},l.prototype.handleRefresh=function(){return(0,i.mG)(this,void 0,void 0,function(){var e,t,n,a;return(0,i.Jh)(this,function(r){switch(r.label){case 0:return e=this.props,t=e.dispatchEvent,n=e.data,[4,t("pullRefresh",n)];case 1:return a=r.sent(),a!=null&&a.prevented?[2]:(this.reload(),[2])}})})},l.prototype.handleChange=function(e,t,n,a){var r=this.props,s=r.store,d=r.onChange;typeof t=="string"&&t&&s.changeValue(t,e,a),d==null||d.apply(null,arguments)},l.prototype.handleBulkChange=function(e){var t,n;(n=(t=this.props.store)===null||t===void 0?void 0:t.updateData)===null||n===void 0||n.call(t,e)},l.prototype.renderHeader=function(){var e=this.props,t=e.title,n=e.subTitle,a=e.remark,r=e.remarkPlacement,s=e.headerClassName,d=e.toolbarClassName,h=e.toolbar,o=e.render,p=e.store,c=e.initApi,f=e.popOverContainer,g=e.env,y=e.classnames,m=e.regions,O=e.translate,D=e.id,A=e.themeCss,N={onAction:this.handleAction,onQuery:c?this.handleQuery:void 0,onChange:this.handleChange,onBulkChange:this.handleBulkChange,pageLoading:p.loading},M,b;return(Array.isArray(m)?~m.indexOf("header"):t||n)&&(M=v().createElement("div",{className:y("Page-header",s,(0,u.GwQ)((0,i.pi)((0,i.pi)({},this.props),{name:"headerControlClassName",id:D,themeCss:A})))},t?v().createElement("h2",{className:y("Page-title",(0,u.GwQ)((0,i.pi)((0,i.pi)({},this.props),{name:"titleControlClassName",id:D,themeCss:A})))},o("title",t,N),a?o("remark",{type:"remark",tooltip:a,placement:r||"bottom",container:f||g.getModalContainer}):null):null,n&&v().createElement("small",{className:y("Page-subTitle")},o("subTitle",n,N)))),(Array.isArray(m)?~m.indexOf("toolbar"):h)&&(b=v().createElement("div",{className:y("Page-toolbar",d,(0,u.GwQ)((0,i.pi)((0,i.pi)({},this.props),{name:"toolbarControlClassName",id:D,themeCss:A})))},o("toolbar",h||"",N))),M&&b?v().createElement("div",{className:y("Page-headerRow")},M,b):M||b},l.prototype.renderContent=function(e){var t=this.props,n=t.store,a=t.body,r=t.bodyClassName,s=t.render,d=t.classnames,h=t.showErrorMsg,o=t.regions,p=t.translate,c=t.loadingConfig,f=t.initApi,g=t.id,y=t.env,m=t.themeCss;return v().createElement("div",{className:d("Page-content")},v().createElement("div",{className:d("Page-main")},this.renderHeader(),v().createElement("div",{className:d("Page-body",r,(0,u.GwQ)((0,i.pi)((0,i.pi)({},this.props),{name:"bodyControlClassName",id:g,themeCss:m}))),role:"page-body"},v().createElement(S.$jN,{size:"lg",overlay:!0,key:"info",show:n.loading,loadingConfig:c}),!y.forceSilenceInsideError&&n.error&&h!==!1?v().createElement(S.Vp1,{level:"danger",showCloseButton:!0,onClose:n.clearMessage},n.msg):null,(Array.isArray(o)?~o.indexOf("body"):a)?s("body",a||"",e):null)))},l.prototype.render=function(){var e=this.props,t=e.className,n=e.store,a=e.body,r=e.bodyClassName,s=e.render,d=e.aside,h=e.asideClassName,o=e.classnames,p=e.showErrorMsg,c=e.initApi,f=e.regions,g=e.style,y=e.data,m=e.asideResizor,O=e.asideSticky,D=e.pullRefresh,A=e.mobileUI,N=e.translate,M=e.loadingConfig,b=e.id,x=e.wrapperCustomStyle,L=e.env,P=e.themeCss,W=e.asidePosition,_={onAction:this.handleAction,onQuery:c?this.handleQuery:void 0,onChange:this.handleChange,onBulkChange:this.handleBulkChange,pageLoading:n.loading},E=Array.isArray(f)?~f.indexOf("aside"):d&&(!Array.isArray(d)||d.length),z=(0,u.uBL)(g,y),B=this.renderContent(_);return v().createElement("div",{className:o("Page",E?"Page--withSidebar":"",E&&O?"Page--asideSticky":"",E&&W?"Page--".concat(W,"Aside"):"",t,(0,u.GwQ)((0,i.pi)({name:"baseControlClassName",id:b,themeCss:P},this.props)),(0,u.GwQ)((0,i.pi)({name:"wrapperCustomStyle",id:b,themeCss:x},this.props))),onClick:this.handleClick,style:z},E?v().createElement("div",{className:o("Page-aside",m?"relative":"Page-aside--withWidth",h,(0,u.GwQ)((0,i.pi)((0,i.pi)({},this.props),{name:"asideControlClassName",id:b,themeCss:P})))},s("aside",d||"",(0,i.pi)((0,i.pi)({},_),typeof d=="string"?{inline:!1,className:"Page-asideTplWrapper"}:null)),m?v().createElement("div",{onMouseDown:this.handleResizeMouseDown,className:o("Page-asideResizor")}):null):null,A&&D&&!D.disabled?v().createElement(S.I8I,(0,i.pi)({},D,{translate:N,onRefresh:this.handleRefresh}),B):B,s("dialog",(0,i.pi)((0,i.pi)({},n.action&&n.action.dialog),{type:"dialog"}),{key:"dialog",data:n.dialogData,onConfirm:this.handleDialogConfirm,onClose:this.handleDialogClose,show:n.dialogOpen,onAction:this.handleAction,onQuery:c?this.handleQuery:void 0}),s("drawer",(0,i.pi)((0,i.pi)({},n.action&&n.action.drawer),{type:"drawer"}),{key:"drawer",data:n.drawerData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,show:n.drawerOpen,onAction:this.handleAction,onQuery:c?this.handleQuery:void 0}),v().createElement(u.cWM,(0,i.pi)({},this.props,{config:{wrapperCustomStyle:x,id:b,themeCss:P,classNames:[{key:"baseControlClassName",weights:{default:{important:!0},hover:{important:!0},active:{important:!0}}},{key:"bodyControlClassName"},{key:"headerControlClassName"},{key:"titleControlClassName"},{key:"toolbarControlClassName"},{key:"asideControlClassName"}]},env:L})))},l.defaultProps={asideClassName:"",bodyClassName:"",headerClassName:"",initFetch:!0,toolbarClassName:"",messages:{},asideSticky:!0,asidePosition:"left",pullRefresh:{disabled:!0}},l.propsList=["title","subTitle","initApi","initFetchOn","initFetch","headerClassName","bodyClassName","asideClassName","toolbarClassName","toolbar","body","aside","messages","style","showErrorMsg"],(0,i.gn)([u.NjZ,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Object]),(0,i.w6)("design:returntype",void 0)],l.prototype,"handleResizeMouseDown",null),(0,i.gn)([u.NjZ,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[MouseEvent]),(0,i.w6)("design:returntype",void 0)],l.prototype,"handleResizeMouseMove",null),(0,i.gn)([u.NjZ,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[]),(0,i.w6)("design:returntype",void 0)],l.prototype,"handleResizeMouseUp",null),(0,i.gn)([u.NjZ,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[]),(0,i.w6)("design:returntype",Promise)],l.prototype,"handleRefresh",null),l}(v().Component),k=function(C){(0,i.ZT)(l,C);function l(e,t){var n=C.call(this,e)||this,a=t;return a.registerComponent(n),n}return l.prototype.componentWillUnmount=function(){var e=this.context;e.unRegisterComponent(this),C.prototype.componentWillUnmount.call(this)},l.prototype.reloadTarget=function(e,t){var n=this.context;n.reload(e,t)},l.prototype.handleAction=function(e,t,n,a,r){return a===void 0&&(a=!1),(0,i.mG)(this,void 0,void 0,function(){var s,d;return(0,i.Jh)(this,function(h){switch(h.label){case 0:return s=r||this.context,t.actionType!=="reload"?[3,1]:(t.target&&s.reload(t.target,n),[3,4]);case 1:return t.target?(t.target.split(",").forEach(function(o){var p=s.getComponentByName(o);p&&p.doAction&&p.doAction((0,i.pi)((0,i.pi)({},t),{target:void 0}),n)}),[3,4]):[3,2];case 2:return[4,C.prototype.handleAction.call(this,e,t,n,a,r)];case 3:return d=h.sent(),t.reload&&~["url","link","jump"].indexOf(t.actionType)&&s.reload(t.reload,n),[2,d];case 4:return[2]}})})},l.prototype.handleDialogConfirm=function(e,t){for(var n,a,r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];var d=this.props.store,h=d.action,o=(n=t.reload)!==null&&n!==void 0?n:h.reload,p=d.getDialogScoped()||this.context;C.prototype.handleDialogConfirm.apply(this,(0,i.ev)([e,t],(0,i.CR)(r),!1)),o?p.reload(o,d.data):(p==null?void 0:p.component)!==this&&(!((a=p.component)===null||a===void 0)&&a.reload)?p.component.reload():this.context.getComponents().filter(function(c){return c.props.type==="crud"}).forEach(function(c){return c.reload&&c.reload()})},l.prototype.handleDrawerConfirm=function(e,t){for(var n=this,a,r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];var d=this.props.store,h=d.action,o=(a=t.reload)!==null&&a!==void 0?a:h.reload,p=d.getDrawerScoped()||this.context;C.prototype.handleDrawerConfirm.call(this,e,t),setTimeout(function(){var c;o?p.reload(o,d.data):p.component!==n&&(!((c=p==null?void 0:p.component)===null||c===void 0)&&c.reload)?p.component.reload():n.context.getComponents().filter(function(f){return f.props.type==="crud"}).forEach(function(f){return f.reload&&f.reload()})},300)},l.prototype.setData=function(e,t){return this.props.store.updateData(e,void 0,t)},l.prototype.getData=function(){var e=this.props.store;return e.data},l.contextType=u.ZHe,l}(T),Q=function(C){(0,i.ZT)(l,C);function l(){return C!==null&&C.apply(this,arguments)||this}return l=(0,i.gn)([(0,u.Thl)({type:"page",storeType:u.Y5f.name,isolateScope:!0})],l),l}(k)}}]);
