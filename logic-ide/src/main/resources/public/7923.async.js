"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[7923],{19435:function(ue,A,n){n.d(A,{O:function(){return w},A:function(){return F.Z}});var F=n(47533),c=n(54306),h=n.n(c),L=n(8049),b=n(14990),R=n(22465),O=n(5671),G=n(17696),I=n(19227),Y=n(75476),j=n(1167),$=n(22150),_=n(40767),E=n(95812),x=n(58856),M=n(22983),D=n(39092),N=n(75904),Z=n(18725),i=n(87363),B=n.n(i),U=n(10486),T=n(14232),a=n(37555),s=n(59998),f=n(72107),t=n(23620),e=n(33130),u=B().createContext({logic:new f.Iz("")}),m=function(g){var J,de=(0,i.useState)(),H=h()(de,2),o=H[0],ce=H[1],ge=(0,i.useState)(),V=h()(ge,2),S=V[0],fe=V[1],ve=(0,i.useState)(!1),Q=h()(ve,2),Be=Q[0],Te=Q[1],he=(0,i.useState)(!0),X=h()(he,2),P=X[0],W=X[1],me=(0,i.useState)(),q=h()(me,2),z=q[0],ee=q[1],pe=(0,i.useState)(),ne=h()(pe,2),p=ne[0],ye=ne[1],xe=(0,i.useState)(),te=h()(xe,2),K=te[0],Le=te[1],be=(0,i.useState)(),oe=h()(be,2),we=oe[0],re=oe[1],_e=(0,i.useState)(),ae=h()(_e,2),Se=ae[0],Ce=ae[1],ie=(0,i.useRef)(),se=function(y){var d=y.node;re(d);var r=p==null?void 0:p.itemLogs.find(function(v){return v.config.id==d.id});ee(r)};(0,i.useEffect)(function(){K&&(o==null||o.centerCell(K))},[K,o]),(0,i.useEffect)(function(){console.log("play curItemLog",z)},[z]),(0,i.useEffect)(function(){var l=o==null?void 0:o.getNodes().find(function(y){return y.id==g.nextId});l==null||l.attr("body/fill","red"),Le(l)},[g.nextId]),(0,i.useEffect)(function(){var l;o==null||(l=o.getNodes().find(function(y){return y.id==g.nextId}))===null||l===void 0||l.attr("body/fill","red")},[o]),(0,i.useEffect)(function(){g.config&&fe(g.config)},[g.config]),(0,i.useEffect)(function(){var l,y;console.log("props.debugLogs",g.debugLogs),((l=g.debugLogs)===null||l===void 0?void 0:l.length)>0&&setInterval(Ie,2e3);var d=[];g&&((y=g.debugLogs)===null||y===void 0||y.forEach(function(r){var v,C;d.push({children:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("span",{style:{cursor:"pointer",fontWeight:r.id==(p==null?void 0:p.id)?"bolder":"normal",color:r.id==(p==null?void 0:p.id)?"#52c41a":"black"},onClick:function(){ye(r),console.log(r),o==null||o.fromJSON(S==null?void 0:S.visualConfig);var le;r.itemLogs.forEach(function(Ee){var k=o==null?void 0:o.getNodes().find(function(De){return De.id==Ee.config.id});console.log("fill node"),console.log(k),k&&(k.addTools({name:"boundary",args:{attrs:{stroke:"#9254de",strokeWidth:2,fillOpacity:.2}}}),le=k)}),o==null||o.centerCell(le),ee({}),re({})},children:[(0,e.jsx)("p",{children:(v=r.itemLogs[0])===null||v===void 0?void 0:v.config.name}),((C=g.logicIns)===null||C===void 0?void 0:C.version)==r.version?(0,e.jsx)("p",{}):(0,e.jsx)("p",{children:(0,e.jsxs)(_.Z,{children:[(0,e.jsx)(E.Z.Paragraph,{style:{color:"red"},children:"\u7248\u672C\u53F7:"}),(0,e.jsxs)(E.Z.Paragraph,{copyable:{tooltips:["\u70B9\u51FB\u590D\u5236","\u590D\u5236\u6210\u529F!"],text:r.version},children:[r.version,(0,e.jsx)(E.Z.Link,{style:{margin:"5px"},href:"#/assets/logic/i/".concat(r.logicId,"/view/").concat(r.version),target:"_blank",children:(0,e.jsx)(L.Z,{})})]})]})}),(0,e.jsxs)("p",{children:["\u4E1A\u52A1\u6807\u8BC6\uFF1A",r.bizId]}),(0,e.jsx)("p",{children:r.serverTime}),(0,e.jsx)("p",{children:r.message})]})}),color:r.success?"green":"red"})})),Ce(d)},[g.debugLogs,g.logicIns,o,p]),(0,i.useEffect)(function(){if(S){try{var l=(0,U.K)(),y=l.Shapes;(0,T.m)(y)}catch(r){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(r)}var d=new O.kJ({container:ie.current,embedding:{enabled:!0,validate:function(v){return v.child.setData({hoverNode:v.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new O.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(v){var C=v.targetMagnet;return!!C}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}},background:{color:"#F2F7FA"},grid:!0});d.use(new j.H({enabled:!0,sharp:!0})).use(new G.A({enabled:!0})).use(new Y.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new $.T({enabled:!0})).use(new I.N),d.on("edge:dblclick",function(){}),d.on("edge:mouseenter",function(){}),d.on("edge:mouseleave",function(){}),d.on("node:moved",function(){}),d.on("node:mouseenter",function(){}),d.on("node:mouseleave",function(){}),d.on("node:added",function(){}),d.on("node:dblclick",function(r){var v=r.node;W(!1)}),d.on("blank:dblclick",function(r){var v=r.x,C=r.y}),d.fromJSON(S.visualConfig),(0,s.V)(d),ce(d)}},[S]),(0,i.useEffect)(function(){o==null||o.off("node:click",se),o==null||o.on("node:click",se)},[p]);var Ie=function(){},je=[{key:"1",label:"\u65E5\u5FD7",children:(0,e.jsx)(t.gcu,{src:z})}];return(0,e.jsxs)(x.Z,{style:{margin:0,height:"100vh"},children:[(0,e.jsxs)(x.Z.Sider,{theme:"light",collapsedWidth:0,width:300,style:{overflow:"auto",height:"100vh",position:"fixed",left:0,top:0,bottom:0,borderRight:"0.5px solid"},children:[(0,e.jsx)(M.Z,{children:"\u72B6\u6001\u53D8\u66F4\u8BB0\u5F55"}),(0,e.jsx)(D.Z,{style:{height:"100%"},items:Se})]}),(0,e.jsxs)(x.Z,{style:{marginLeft:300},children:[(0,e.jsxs)(x.Z.Header,{style:{backgroundColor:"white",padding:0},children:[(0,e.jsxs)(_.Z,{direction:"horizontal",style:{},children:[(0,e.jsx)(M.Z,{type:"vertical"}),(J=g.btns)===null||J===void 0?void 0:J.map(function(l){return l})]}),(0,e.jsx)(N.ZP,{type:"text",icon:P?(0,e.jsx)(b.Z,{}):(0,e.jsx)(R.Z,{}),onClick:function(){W(!P)},style:{float:"right",right:"16px",fontSize:"16px",width:64,height:64}})]}),(0,e.jsx)(x.Z.Content,{className:"app-content",children:(0,e.jsx)(a.Z,{ref:ie})})]}),(0,e.jsxs)(x.Z.Sider,{theme:"light",collapsed:P,collapsedWidth:0,style:{overflow:"scroll"},title:"ddd",width:500,children:[(0,e.jsx)(N.ZP,{type:"text",onClick:function(){W(!P)},style:{float:"right",fontSize:"16px",width:64,height:64},children:"x"}),(0,e.jsx)(Z.Z,{items:je,defaultActiveKey:"1"})]})]})},w=m},48364:function(ue,A,n){n.d(A,{Uh:function(){return U},YH:function(){return $},az:function(){return E},b9:function(){return i},gC:function(){return N},m9:function(){return M}});var F=n(25359),c=n.n(F),h=n(49811),L=n.n(h),b=n(70517),R=n(5726),O=n.n(R);function G(a){return I.apply(this,arguments)}function I(){return I=_asyncToGenerator(_regeneratorRuntime().mark(function a(s){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",axios.post("/api/ide/pub/logic/dev-to-test".concat(s)));case 1:case"end":return t.stop()}},a)})),I.apply(this,arguments)}function Y(a){return j.apply(this,arguments)}function j(){return j=_asyncToGenerator(_regeneratorRuntime().mark(function a(s){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",axios.get("/api/ide/logic/".concat(s)));case 1:case"end":return t.stop()}},a)})),j.apply(this,arguments)}function $(a){return _.apply(this,arguments)}function _(){return _=L()(c()().mark(function a(s){return c()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",b.Z.get("/api/ide/logic/".concat(s,"/config")).then(function(e){var u;return(u=e.data)===null||u===void 0?void 0:u.data}));case 1:case"end":return t.stop()}},a)})),_.apply(this,arguments)}function E(a,s,f){return x.apply(this,arguments)}function x(){return x=L()(c()().mark(function a(s,f,t){return c()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",b.Z.put("/api/ide/logic/edit/".concat(s),{version:f,configJson:t,updateTime:O()().format("YYYY-MM-DD HH:mm:ss")}));case 1:case"end":return u.stop()}},a)})),x.apply(this,arguments)}function M(a){return D.apply(this,arguments)}function D(){return D=L()(c()().mark(function a(s){return c()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",b.Z.get("/api/ide/logic-instance/".concat(s)).then(function(e){var u=e.data.data;return u}));case 1:case"end":return t.stop()}},a)})),D.apply(this,arguments)}function N(a){return Z.apply(this,arguments)}function Z(){return Z=L()(c()().mark(function a(s){return c()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",b.Z.post("/api/ide/logic-logs",{filters:[{dataIndex:"logicId",values:[s.logicId],type:"="},{dataIndex:"bizId",values:[s.bizId],type:"="}],pageSize:1e3,orderBy:[{dataIndex:"id",desc:!0}]}).then(function(e){var u=e.data.data.records;return u&&u.map(function(m){m.itemLogs&&(m.itemLogs=JSON.parse(m.itemLogs))}),u}));case 1:case"end":return t.stop()}},a)})),Z.apply(this,arguments)}function i(a,s){return B.apply(this,arguments)}function B(){return B=L()(c()().mark(function a(s,f){return c()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",b.Z.post("/api/ide/logic-baks",{filters:[{dataIndex:"id",values:[s],type:"="},{dataIndex:"version",values:[f],type:"="}]}).then(function(u){var m=u.data.data.records[0].configJson,w=JSON.parse(m);return w}));case 1:case"end":return e.stop()}},a)})),B.apply(this,arguments)}function U(a,s){return T.apply(this,arguments)}function T(){return T=L()(c()().mark(function a(s,f){return c()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",b.Z.post("/api/ide/logic-baks",{filters:[{dataIndex:"id",values:[s],type:"="},{dataIndex:"version",values:[f],type:"="}]}).then(function(u){var m=u.data.data.records[0],w=m.configJson;return m.configJson=JSON.parse(w),m}));case 1:case"end":return e.stop()}},a)})),T.apply(this,arguments)}}}]);
