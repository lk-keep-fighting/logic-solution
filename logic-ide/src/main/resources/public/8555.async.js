"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[8555],{60341:function(B,O,e){e.d(O,{l:function(){return h.Z}});var h=e(93797)},44174:function(B,O,e){e.d(O,{n:function(){return T}});var h=e(12490),_=e(57213),A=e.n(_),g=50,p=50,E={body:{}},y={"wati-for-continu":{shape:"circle",ports:h.Tt,width:g,height:p,attrs:{body:A()(A()({},E.body),{},{fill:"white"}),text:{text:"\u4EA4\u4E92\u70B9"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],data:{config:{type:"wait-for-continue"}}},js:{shape:"ExtSharp",ports:h.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/logic/icons/code.svg"},text:{text:"js\u811A\u672C",fontSize:14}},data:{config:{type:"js"}}},java:{shape:"ExtSharp",ports:h.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/logic/icons/java.svg"},text:{text:"java\u65B9\u6CD5",fontSize:14}},data:{config:{type:"java"}}},switch:{shape:"ExtSharp",width:50,height:p,ports:h.Tt,label:"switch",attrs:{image:{"xlink:href":"/logic/icons/switch.svg",width:45,x:1,y:2},text:{text:"switch",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}}}};function T(m){var d=m.createNode({shape:"start",width:50,height:50,ports:h.Hi,data:{config:{type:"start",name:"\u5F00\u59CB"}}});m.addNode(d)}function f(m,d){var s=LogicItemSharpMapping[d.type];if(s){s.data={config:d};var v=m.createNode(s);v.setAttrByPath("text/text",d.name),m.addNode(v)}}},94744:function(B,O,e){e.d(O,{y:function(){return d}});var h=e(37635),_=e.n(h),A=e(21140),g=e.n(A),p=e(63466),E=e.n(p),y=e(72107),T=e(52510),f=e.n(T),m=E()(function s(v){g()(this,s),f()(this,"concept","EnvParam"),f()(this,"name",void 0),f()(this,"description",void 0),f()(this,"typeAnnotation",void 0),f()(this,"required",!1),f()(this,"defaultValue",void 0),this.name=v}),d=function(){function s(){g()(this,s)}return E()(s,null,[{key:"valueToTypeAnnotaion",value:function(a){var r=this,n={concept:y.Ld.TypeAnnotation,typeKind:"primitive",typeName:"string",defaultValue:a};if(Array.isArray(a))n.typeName="array";else{var t=_()(a);switch(t){case"boolean":n.typeKind="primitive",n.typeName="boolean";break;case"number":n.typeKind="primitive",n.typeName="number";break;case"string":n.typeKind="primitive",n.typeName="string";break;case"object":a==null?n.typeName="null":a instanceof Date?(n.typeKind="primitive",n.typeName="date"):a instanceof RegExp?(n.typeKind="primitive",n.typeName="regexp"):a instanceof Function?(n.typeKind="primitive",n.typeName="function"):(n.typeKind="anonymousStructure",n.typeName="object",n.properties=[],Object.keys(a).map(function(o){var u,c=a[o],i=r.valueToTypeAnnotaion(c),l=new y.X0(o);l.typeAnnotation=i,l.defaultValue=c,(u=n.properties)===null||u===void 0||u.push(l)}));break;default:n.typeKind="unknown",n.typeName=t;break}}return n}},{key:"typeAnnotaionToValue",value:function(a){var r,n,t=this,o;switch(a.typeName){case"array":o=(r=a.defaultValue)!==null&&r!==void 0?r:[];break;case"boolean":o=a.defaultValue?a.defaultValue=="true":!1;break;case"number":o=parseFloat(a.defaultValue);break;case"null":o=null;break;case"date":o=new Date(a.defaultValue);break;case"regexp":o=new RegExp(a.defaultValue);break;case"object":o={},(n=a.properties)===null||n===void 0||n.forEach(function(u){o[u.name]=t.typeAnnotaionToValue(u.typeAnnotation)});break;case"string":case"function":default:o=a.defaultValue;break}return o}},{key:"getParamArrayByJson",value:function(a){var r=[];return a&&Object.keys(a).forEach(function(n){var t=new y.dO(n);t.typeAnnotation=s.valueToTypeAnnotaion(a[n]),t.defaultValue=a[n],r.push(t)}),r}},{key:"getReturnArrayByJson",value:function(a){var r=[];return a&&Object.keys(a).forEach(function(n){var t=new y.z1(n);t.typeAnnotation=s.valueToTypeAnnotaion(a[n]),t.defaultValue=a[n],r.push(t)}),r}},{key:"getVariableArrayByJson",value:function(a){var r=[];return a&&Object.keys(a).forEach(function(n){var t=new y._w(n);t.typeAnnotation=s.valueToTypeAnnotaion(a[n]),t.defaultValue=a[n],r.push(t)}),r}},{key:"getEnvsArrayByJson",value:function(a){var r=[];return a&&Object.keys(a).forEach(function(n){var t=new m(n);t.typeAnnotation=s.valueToTypeAnnotaion(a[n]),t.defaultValue=a[n],r.push(t)}),r}},{key:"getJsonByParams",value:function(a){var r=this,n={};return a==null||a.forEach(function(t){n[t.name]=t.typeAnnotation?r.typeAnnotaionToValue(t.typeAnnotation):t.defaultValue}),n}}]),s}()},44132:function(B,O,e){var h=e(57213),_=e.n(h),A=e(54306),g=e.n(A),p=e(70517),E=e(90010),y=e.n(E),T=e(23620),f=e(2069),m=e(87363),d=e.n(m),s=e(12472),v=e(33358),a=e(49500),r=e(16123),n=e(78057),t=e(69078),o=e(98896),u=e(31837),c=e(32126),i=e(33130),l=function(M){var P=(0,m.useState)({type:"page"}),x=g()(P,2),b=x[0],F=x[1],j=(0,m.useState)(),U=g()(j,2),N=U[0],w=U[1],J=(0,m.useState)(),S=g()(J,2),Z=S[0],G=S[1],L="cxd",z="zh-CN";return(0,m.useEffect)(function(){(0,o.m)(p.Z)},[]),(0,m.useEffect)(function(){M.pageId&&((0,s.UD)(M.pageId).then(function(K){F(K)}),c.S.getEnvJson().then(function(K){w(JSON.parse(u.j.getEnv()))}))},[M.pageId]),(0,i.jsxs)("div",{children:[(0,i.jsx)(f.qR,{theme:L,position:"top-right",locale:z},"toast"),(0,i.jsx)(f.wx,{theme:L,locale:z},"alert"),(0,T.sYA)(b,{data:_()({envs:N},M.data)},{fetcher:function(R){var W=R.url,V=R.method,I=R.data,Y=R.responseType,C=R.config,X=R.headers;return M.data&&M.data.runtime&&(W="/api/ide/papi/".concat(M.data.runtime).concat(W)),C=C||{},C.withCredentials=!0,Y&&(C.responseType=Y),C.cancelExecutor&&(C.cancelToken=new p.Z.CancelToken(C.cancelExecutor)),C.headers=X||{},C.headers.Authorization||(C.headers.Authorization="Bearer "+t.F.getTokenFormLocal()),V!=="post"&&V!=="put"&&V!=="patch"?(I&&(C.params=I),p.Z[V](W,C)):(I&&I instanceof FormData?(C.headers=C.headers||{},C.headers["Content-Type"]="multipart/form-data"):I&&typeof I!="string"&&!(I instanceof Blob)&&!(I instanceof ArrayBuffer)&&(I=JSON.stringify(I),C.headers=C.headers||{},C.headers["Content-Type"]="application/json"),p.Z[V](W,I,C))},isCancel:function(R){return p.Z.isCancel(R)},copy:function(R){y()(R),f.Am.success("\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u7C98\u8D34\u677F")},theme:L,jumpTo:function(R,W){debugger;W.blank==!0?window.open(window.location.origin+window.location.pathname+"#"+R,"_blank"):window.location.hash=R}})]})};O.Z=l},7944:function(B,O,e){var h=e(54306),_=e.n(h),A=e(94990),g=e(94744),p=e(51394),E=e(83217),y=e(87363),T=e.n(y),f=e(33130),m=function(s){var v,a=(0,y.useState)({}),r=_()(a,2),n=r[0],t=r[1];(0,y.useEffect)(function(){var u=s.values,c=u.params,i=u.variables,l=u.envs,D=u.returns,M=u.log;t({params:JSON.stringify(g.y.getJsonByParams(c)),variables:JSON.stringify(g.y.getJsonByParams(i)),returns:JSON.stringify(g.y.getJsonByParams(D)),envs:JSON.stringify(g.y.getJsonByParams(l)),log:M})},[s.values]);var o=(0,y.useCallback)(function(u){try{return JSON.parse(u),!0}catch(c){return!1}},[]);return(0,f.jsxs)("span",{children:[s.children,(0,f.jsx)(p.Z,{open:(v=s.open)!==null&&v!==void 0?v:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return s==null?void 0:s.setOpen(!1)},children:(0,f.jsx)(A.Z,{formId:"logic-setting",values:n,onSubmit:function(c){console.log("\u63D0\u4EA4\u53C2\u6570"),console.log(c);var i=!1;Object.keys(c).forEach(function(l){var D=c[l];if(!o(D)){var M=l==="params"?"\u5165\u53C2":l==="variables"?"\u5C40\u90E8\u53D8\u91CF":l==="returns"?"\u8FD4\u56DE\u53C2\u6570":"\u73AF\u5883\u53D8\u91CF";switch(l){case"params":return E.ZP.error("\u5165\u53C2json\u683C\u5F0F\u9519\u8BEF"),i=!0,!1;break;case"variables":return E.ZP.error("\u5C40\u90E8\u53D8\u91CFjson\u683C\u5F0F\u9519\u8BEF"),i=!0,!1;break;case"returns":return E.ZP.error("\u8FD4\u56DE\u53C2\u6570json\u683C\u5F0F\u9519\u8BEF"),i=!0,!1;break;case"ens":return E.ZP.error("\u73AF\u5883\u53D8\u91CFjson\u683C\u5F0F\u9519\u8BEF"),i=!0,!1;break;default:break}}}),i||(s!=null&&s.onSubmit&&s.onSubmit(c),s==null||s.setOpen(!1))}})})]})};O.Z=m},79671:function(B,O,e){var h=e(94990),_=e(94744),A=e(83217),g=e(51394),p=e(98848),E=e(87363),y=e.n(E),T=e(33130),f=function(d){var s,v=(0,p.cI)();(0,E.useEffect)(function(){var n=d.values.params;v.setValues({params:JSON.stringify(_.y.getJsonByParams(n))})},[d.values]);var a=(0,E.useCallback)(function(n){try{return JSON.parse(n),!0}catch(t){return!1}},[]);function r(n){var t=!1;Object.keys(n).forEach(function(o){var u=n[o];if(["params","headers"].indexOf(o)>-1&&!a(u)){var c=o==="params"?"\u5165\u53C2":"\u8BF7\u6C42\u5934";return A.ZP.error("".concat(c,"json\u683C\u5F0F\u9519\u8BEF")),t=!0,!1}}),t||(d!=null&&d.onSubmit&&d.onSubmit(n,n.debugType),d==null||d.setOpen(!1))}return(0,T.jsxs)("span",{children:[d.children,(0,T.jsx)(g.Z,{open:(s=d.open)!==null&&s!==void 0?s:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return d==null?void 0:d.setOpen(!1)},children:(0,T.jsx)(h.Z,{formId:"logic-debug-input",onSubmit:r})})]})};O.Z=f},88090:function(B,O,e){e.d(O,{W:function(){return a}});var h=e(57213),_=e.n(h),A=e(21140),g=e.n(A),p=e(63466),E=e.n(p),y=e(83217),T=e(72107),f=e(12490),m=null;function d(r,n,t,o){var u,c,i=r.data.config,l=i.type,D=t.flatMap(function(b){return b.source.cell===r.id?n[b.target.cell]:[]}),M=r.attrs,P=new T.Du((u=r.id)!==null&&u!==void 0?u:"",l);if(P=_()(_()({},i),{},{id:r.id,name:M==null||(c=M.text)===null||c===void 0?void 0:c.text}),!(o.findIndex(function(b){return b.id===P.id})>-1)&&(o.push(P),D.length!==0))switch(l){default:if(D.length>1||P.type==="switch"){var x;console.log((x=r.data)===null||x===void 0?void 0:x.config),console.log(D),P.branches=[],D.forEach(function(b){var F,j;if(console.log((F=b.data)===null||F===void 0?void 0:F.config),((j=b.data)===null||j===void 0?void 0:j.config.type)==="switch-cases"){var U,N,w;(U=b.data)===null||U===void 0||(N=U.config)===null||N===void 0||(w=N.cases)===null||w===void 0||w.forEach(function(G){var L;(L=P.branches)===null||L===void 0||L.push({when:G,nextId:b.id})})}else{var J,S,Z;(J=P.branches)===null||J===void 0||J.push({when:(S=b.data)===null||S===void 0||(Z=S.config)===null||Z===void 0?void 0:Z.case,nextId:b.id})}d(n[b.id],n,t,o)})}else P.nextId=D[0].id,d(n[D[0].id],n,t,o);break}}function s(r,n){var t=new T.Iz(r),o=[],u=[],c={},i=void 0;if(n.forEach(function(l){var D=l.id||"";l.shape==="edge"?o.push(l):(c[D]=l,u.push(l),l.data.config.type==="start"&&(i=l))}),!i){y.ZP.error("\u672A\u53D1\u73B0\u5F00\u59CB\u8282\u70B9\uFF0C\u8BF7\u914D\u7F6E\uFF01");return}return d(i,c,o,t.items),console.log("logic.items"),console.log(t.items),t}function v(r){var n;if(!(r!=null&&(n=r.items)!==null&&n!==void 0&&n.length))return{nodes:[],edges:[]};var t=function(l){switch(console.log("type"),console.log(l),l){case"http":case"js":case"java":case"sub-logic":return{size:{width:100,height:50}};case"switch":return{size:{width:200,height:50}};case"switch-case":case"switch-default":case"switch-cases":return{size:{width:120,height:50}};default:return{size:{width:50,height:50}}}},o={shape:"edge"},u=r.items.map(function(i){return _()(_()({},t(i.type)),{},{id:i.id,ports:_()(_()({},f.Tt),{},{items:f.Tt.items.map(function(l){return _()(_()({},l),{},{id:"".concat(i.id,"-").concat(l.group)})})}),shape:i.type,data:{config:i}})}),c=r.items.flatMap(function(i){var l;return(l=i.branches)!==null&&l!==void 0&&l.length?i.branches.map(function(D){return _()(_()({},o),{},{source:{cell:i.id,port:i.id+"-bottom"},target:{cell:D.nextId,port:D.nextId+"-top"}})}):i.nextId?[_()(_()({},o),{},{source:{cell:i.id,port:i.id+"-bottom"},target:{cell:i.nextId,port:i.nextId+"-top"}})]:[]});return{nodes:u,edges:c}}var a=function(){function r(){g()(this,r)}return E()(r,[{key:"graphToLogicItems",value:function(t,o){var u=s(o==null?void 0:o.id,t==null?void 0:t.getCells());return u.visualConfig=t==null?void 0:t.toJSON(),_()(_()({},o),{},{visualConfig:u.visualConfig,items:u.items})}},{key:"logicToGraphJson",value:function(t){var o=v(t);return o}}]),r}()},79716:function(B,O,e){e.d(O,{O:function(){return s}});var h=e(25359),_=e.n(h),A=e(49811),g=e.n(A),p=e(70517),E=e(9364),y=e(12490),T=e(42651),f={buildGroup:function(r,n,t,o){var u=Number.parseInt(n/2),c=n%2==0;return{name:r,title:t,graphHeight:(c?u:u+1)*(o||70)+10}}},m=f;function d(a){return a.length>7?"".concat(a.substring(0,7),`\r
`).concat(a.substring(7)):a}function s(a){return v.apply(this,arguments)}function v(){return v=g()(_()().mark(function a(r){var n,t;return _()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return n=[],t="/api/ide/asset/v1/logic-item/readFromCode",r&&(t="/api/ide/papi/".concat(r,"/api/ide/asset/v1/logic-item/readFromCode")),u.abrupt("return",Promise.all([(0,E.K)(),p.Z.get(t)]).then(function(c){if(console.log("getPanelData"),c[1].status==200){var i=c[1].data.data;Object.keys(i).forEach(function(l,D){var M=m.buildGroup(l,i[l].length,l);n.push(M),i[l].sort(function(P,x){return P.order?P.order.localeCompare(x.order):1}).forEach(function(P){c[0].Nodes.push(new T.Z({shape:P.shape?P.shape:"ExtShape"+(D%3==0?"1":D%3==1?"2":"3"),ports:y.Tt,width:100,height:50,text:P.name,data:{config:P.logicItem},_groups:[P.group]}))})})}return{Nodes:c[0].Nodes,Groups:n}}));case 4:case"end":return u.stop()}},a)})),v.apply(this,arguments)}},32126:function(B,O,e){e.d(O,{S:function(){return d}});var h=e(25359),_=e.n(h),A=e(49811),g=e.n(A),p=e(21140),E=e.n(p),y=e(63466),T=e.n(y),f=e(31837),m=e(57475),d=function(){function s(){E()(this,s)}return T()(s,null,[{key:"getEnvJson",value:function(){var v=g()(_()().mark(function r(){return _()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,m.U2)("/api/runtime/env").then(function(o){return o.data.data}).then(function(o){return f.j.setModel(o.UI_CONFIG_MODEL),f.j.setEnv(JSON.stringify(o)),f.j.setApiUrlPrefix(o.API_GATEWAY_PREFIX),f.j.setReryApi(o.CUSTOM_RETRY_URL),f.j.setReryApi(o.CUSTOM_RETRY_URL),o}));case 1:case"end":return t.stop()}},r)}));function a(){return v.apply(this,arguments)}return a}()},{key:"getRemoteRuntimeConfig",value:function(){var v=g()(_()().mark(function r(){return _()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,m.v_)("/api/ide/remote-runtimes").then(function(o){return o.data}).then(function(o){return console.log("remote runtimes:",o.data),f.j.setRemoteRuntimes(JSON.stringify(o.data)),o}));case 1:case"end":return t.stop()}},r)}));function a(){return v.apply(this,arguments)}return a}()}]),s}()}}]);
