"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[8555],{60341:function(x,C,e){e.d(C,{l:function(){return h.Z}});var h=e(93797)},44174:function(x,C,e){e.d(C,{n:function(){return O}});var h=e(12490),c=e(57213),A=e.n(c),g=50,y=50,E={body:{}},D={"wati-for-continu":{shape:"circle",ports:h.Tt,width:g,height:y,attrs:{body:A()(A()({},E.body),{},{fill:"white"}),text:{text:"\u4EA4\u4E92\u70B9"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],data:{config:{type:"wait-for-continue"}}},js:{shape:"ExtSharp",ports:h.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/logic/icons/code.svg"},text:{text:"js\u811A\u672C",fontSize:14}},data:{config:{type:"js"}}},java:{shape:"ExtSharp",ports:h.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/logic/icons/java.svg"},text:{text:"java\u65B9\u6CD5",fontSize:14}},data:{config:{type:"java"}}},switch:{shape:"ExtSharp",width:50,height:y,ports:h.Tt,label:"switch",attrs:{image:{"xlink:href":"/logic/icons/switch.svg",width:45,x:1,y:2},text:{text:"switch",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}}}};function O(m){var d=m.createNode({shape:"start",width:50,height:50,ports:h.Hi,data:{config:{type:"start",name:"\u5F00\u59CB"}}});m.addNode(d)}function v(m,d){var s=LogicItemSharpMapping[d.type];if(s){s.data={config:d};var f=m.createNode(s);f.setAttrByPath("text/text",d.name),m.addNode(f)}}},94744:function(x,C,e){e.d(C,{y:function(){return d}});var h=e(37635),c=e.n(h),A=e(21140),g=e.n(A),y=e(63466),E=e.n(y),D=e(72107),O=e(52510),v=e.n(O),m=E()(function s(f){g()(this,s),v()(this,"concept","EnvParam"),v()(this,"name",void 0),v()(this,"description",void 0),v()(this,"typeAnnotation",void 0),v()(this,"required",!1),v()(this,"defaultValue",void 0),this.name=f}),d=function(){function s(){g()(this,s)}return E()(s,null,[{key:"valueToTypeAnnotaion",value:function(t){var o=this,n={concept:D.Ld.TypeAnnotation,typeKind:"primitive",typeName:"string",defaultValue:t};if(Array.isArray(t))n.typeName="array";else{var a=c()(t);switch(a){case"boolean":n.typeKind="primitive",n.typeName="boolean";break;case"number":n.typeKind="primitive",n.typeName="number";break;case"string":n.typeKind="primitive",n.typeName="string";break;case"object":t==null?n.typeName="null":t instanceof Date?(n.typeKind="primitive",n.typeName="date"):t instanceof RegExp?(n.typeKind="primitive",n.typeName="regexp"):t instanceof Function?(n.typeKind="primitive",n.typeName="function"):(n.typeKind="anonymousStructure",n.typeName="object",n.properties=[],Object.keys(t).map(function(r){var u,i=t[r],l=o.valueToTypeAnnotaion(i),_=new D.X0(r);_.typeAnnotation=l,_.defaultValue=i,(u=n.properties)===null||u===void 0||u.push(_)}));break;default:n.typeKind="unknown",n.typeName=a;break}}return n}},{key:"typeAnnotaionToValue",value:function(t){var o,n,a=this,r;switch(t.typeName){case"array":r=(o=t.defaultValue)!==null&&o!==void 0?o:[];break;case"boolean":r=t.defaultValue?t.defaultValue=="true":!1;break;case"number":r=parseFloat(t.defaultValue);break;case"null":r=null;break;case"date":r=new Date(t.defaultValue);break;case"regexp":r=new RegExp(t.defaultValue);break;case"object":r={},(n=t.properties)===null||n===void 0||n.forEach(function(u){r[u.name]=a.typeAnnotaionToValue(u.typeAnnotation)});break;case"string":case"function":default:r=t.defaultValue;break}return r}},{key:"getParamArrayByJson",value:function(t){var o=[];return t&&Object.keys(t).forEach(function(n){var a=new D.dO(n);a.typeAnnotation=s.valueToTypeAnnotaion(t[n]),a.defaultValue=t[n],o.push(a)}),o}},{key:"getReturnArrayByJson",value:function(t){var o=[];return t&&Object.keys(t).forEach(function(n){var a=new D.z1(n);a.typeAnnotation=s.valueToTypeAnnotaion(t[n]),a.defaultValue=t[n],o.push(a)}),o}},{key:"getVariableArrayByJson",value:function(t){var o=[];return t&&Object.keys(t).forEach(function(n){var a=new D._w(n);a.typeAnnotation=s.valueToTypeAnnotaion(t[n]),a.defaultValue=t[n],o.push(a)}),o}},{key:"getEnvsArrayByJson",value:function(t){var o=[];return t&&Object.keys(t).forEach(function(n){var a=new m(n);a.typeAnnotation=s.valueToTypeAnnotaion(t[n]),a.defaultValue=t[n],o.push(a)}),o}},{key:"getJsonByParams",value:function(t){var o=this,n={};return t==null||t.forEach(function(a){n[a.name]=a.typeAnnotation?o.typeAnnotaionToValue(a.typeAnnotation):a.defaultValue}),n}}]),s}()},44132:function(x,C,e){var h=e(57213),c=e.n(h),A=e(54306),g=e.n(A),y=e(70517),E=e(90010),D=e.n(E),O=e(23620),v=e(2069),m=e(87363),d=e.n(m),s=e(12472),f=e(33358),t=e(49500),o=e(16123),n=e(78057),a=e(69078),r=e(98896),u=e(31837),i=e(32126),l=e(33130),_=function(p){var T=(0,m.useState)({type:"page"}),M=g()(T,2),K=M[0],F=M[1],W=(0,m.useState)(),I=g()(W,2),j=I[0],N=I[1],w=(0,m.useState)(),L=g()(w,2),G=L[0],V=L[1],Z="cxd",z="zh-CN";return(0,m.useEffect)(function(){(0,r.m)(y.Z)},[]),(0,m.useEffect)(function(){p.pageId&&((0,s.UD)(p.pageId).then(function(U){F(U)}),i.S.getEnvJson().then(function(U){N(JSON.parse(u.j.getEnv()))}))},[p.pageId]),(0,l.jsxs)("div",{children:[(0,l.jsx)(v.qR,{theme:Z,position:"top-right",locale:z},"toast"),(0,l.jsx)(v.wx,{theme:Z,locale:z},"alert"),(0,O.sYA)(K,{data:c()({envs:j},p.data)},{fetcher:function(b){var S=b.url,J=b.method,B=b.data,Y=b.responseType,P=b.config,X=b.headers;return p.data&&p.data.runtime&&(S="/api/ide/papi/".concat(p.data.runtime).concat(S)),P=P||{},P.withCredentials=!0,Y&&(P.responseType=Y),P.cancelExecutor&&(P.cancelToken=new y.Z.CancelToken(P.cancelExecutor)),P.headers=X||{},P.headers.Authorization||(P.headers.Authorization="Bearer "+a.F.getTokenFormLocal()),J!=="post"&&J!=="put"&&J!=="patch"?(B&&(P.params=B),y.Z[J](S,P)):(B&&B instanceof FormData?(P.headers=P.headers||{},P.headers["Content-Type"]="multipart/form-data"):B&&typeof B!="string"&&!(B instanceof Blob)&&!(B instanceof ArrayBuffer)&&(B=JSON.stringify(B),P.headers=P.headers||{},P.headers["Content-Type"]="application/json"),y.Z[J](S,B,P))},isCancel:function(b){return y.Z.isCancel(b)},copy:function(b){D()(b),v.Am.success("\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u7C98\u8D34\u677F")},theme:Z,jumpTo:function(b,S){debugger;S.blank==!0?window.open(window.location.origin+window.location.pathname+"#"+b,"_blank"):window.location.hash=b}})]})};C.Z=_},7944:function(x,C,e){var h=e(54306),c=e.n(h),A=e(94990),g=e(94744),y=e(51394),E=e(83217),D=e(87363),O=e.n(D),v=e(33130),m=function(s){var f,t=(0,D.useState)({}),o=c()(t,2),n=o[0],a=o[1];(0,D.useEffect)(function(){var u=s.values,i=u.params,l=u.variables,_=u.envs,R=u.returns,p=u.log;a({params:JSON.stringify(g.y.getJsonByParams(i)),variables:JSON.stringify(g.y.getJsonByParams(l)),returns:JSON.stringify(g.y.getJsonByParams(R)),envs:JSON.stringify(g.y.getJsonByParams(_)),log:p})},[s.values]);var r=(0,D.useCallback)(function(u){try{return JSON.parse(u),!0}catch(i){return!1}},[]);return(0,v.jsxs)("span",{children:[s.children,(0,v.jsx)(y.Z,{open:(f=s.open)!==null&&f!==void 0?f:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return s==null?void 0:s.setOpen(!1)},children:(0,v.jsx)(A.Z,{formId:"logic-setting",values:n,onSubmit:function(i){console.log("\u63D0\u4EA4\u53C2\u6570"),console.log(i);var l=!1;Object.keys(i).forEach(function(_){var R=i[_];if(!r(R)){var p=_==="params"?"\u5165\u53C2":_==="variables"?"\u5C40\u90E8\u53D8\u91CF":_==="returns"?"\u8FD4\u56DE\u53C2\u6570":"\u73AF\u5883\u53D8\u91CF";switch(_){case"params":return E.ZP.error("\u5165\u53C2json\u683C\u5F0F\u9519\u8BEF"),l=!0,!1;break;case"variables":return E.ZP.error("\u5C40\u90E8\u53D8\u91CFjson\u683C\u5F0F\u9519\u8BEF"),l=!0,!1;break;case"returns":return E.ZP.error("\u8FD4\u56DE\u53C2\u6570json\u683C\u5F0F\u9519\u8BEF"),l=!0,!1;break;case"ens":return E.ZP.error("\u73AF\u5883\u53D8\u91CFjson\u683C\u5F0F\u9519\u8BEF"),l=!0,!1;break;default:break}}}),l||(s!=null&&s.onSubmit&&s.onSubmit(i),s==null||s.setOpen(!1))}})})]})};C.Z=m},79671:function(x,C,e){var h=e(94990),c=e(94744),A=e(83217),g=e(51394),y=e(98848),E=e(87363),D=e.n(E),O=e(33130),v=function(d){var s,f=(0,y.cI)();(0,E.useEffect)(function(){var n=d.values.params;f.setValues({params:JSON.stringify(c.y.getJsonByParams(n))})},[d.values]);var t=(0,E.useCallback)(function(n){try{return JSON.parse(n),!0}catch(a){return!1}},[]);function o(n){var a=!1;Object.keys(n).forEach(function(r){var u=n[r];if(["params","headers"].indexOf(r)>-1&&!t(u)){var i=r==="params"?"\u5165\u53C2":"\u8BF7\u6C42\u5934";return A.ZP.error("".concat(i,"json\u683C\u5F0F\u9519\u8BEF")),a=!0,!1}}),a||(d!=null&&d.onSubmit&&d.onSubmit(n,n.debugType),d==null||d.setOpen(!1))}return(0,O.jsxs)("span",{children:[d.children,(0,O.jsx)(g.Z,{open:(s=d.open)!==null&&s!==void 0?s:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return d==null?void 0:d.setOpen(!1)},children:(0,O.jsx)(h.Z,{formId:"logic-debug-input",onSubmit:o})})]})};C.Z=v},88090:function(x,C,e){e.d(C,{W:function(){return f}});var h=e(57213),c=e.n(h),A=e(21140),g=e.n(A),y=e(63466),E=e.n(y),D=e(83217),O=e(72107),v=null;function m(t,o,n,a){var r,u,i=t.data.config,l=i.type,_=n.flatMap(function(M){return M.source.cell===t.id?o[M.target.cell]:[]}),R=t.attrs,p=new O.Du((r=t.id)!==null&&r!==void 0?r:"",l);if(p=c()(c()({},i),{},{id:t.id,name:R==null||(u=R.text)===null||u===void 0?void 0:u.text}),!(a.findIndex(function(M){return M.id===p.id})>-1)&&(a.push(p),_.length!==0))switch(l){default:if(_.length>1||p.type==="switch"){var T;console.log((T=t.data)===null||T===void 0?void 0:T.config),console.log(_),p.branches=[],_.forEach(function(M){var K,F;if(console.log((K=M.data)===null||K===void 0?void 0:K.config),((F=M.data)===null||F===void 0?void 0:F.config.type)==="switch-cases"){var W,I,j;(W=M.data)===null||W===void 0||(I=W.config)===null||I===void 0||(j=I.cases)===null||j===void 0||j.forEach(function(G){var V;(V=p.branches)===null||V===void 0||V.push({when:G,nextId:M.id})})}else{var N,w,L;(N=p.branches)===null||N===void 0||N.push({when:(w=M.data)===null||w===void 0||(L=w.config)===null||L===void 0?void 0:L.case,nextId:M.id})}m(o[M.id],o,n,a)})}else p.nextId=_[0].id,m(o[_[0].id],o,n,a);break}}function d(t,o){var n=new O.Iz(t),a=[],r=[],u={},i=void 0;if(o.forEach(function(l){var _=l.id||"";l.shape==="edge"?a.push(l):(u[_]=l,r.push(l),l.data.config.type==="start"&&(i=l))}),!i){D.ZP.error("\u672A\u53D1\u73B0\u5F00\u59CB\u8282\u70B9\uFF0C\u8BF7\u914D\u7F6E\uFF01");return}return m(i,u,a,n.items),console.log("logic.items"),console.log(n.items),n}function s(t){var o;if(!(t!=null&&(o=t.items)!==null&&o!==void 0&&o.length))return{nodes:[],edges:[]};var n={size:{width:80,height:40},shape:"flow-node"},a={shape:"edge",connector:{name:"rounded"},router:{name:"er"}},r=t.items.map(function(i){return c()(c()({},n),{},{id:i.id,shape:i.type,data:{config:i},attrs:{text:{text:i.name},body:{stroke:"#5F95FF",strokeWidth:1,fill:"#ffffff"}}})}),u=t.items.flatMap(function(i){var l;return(l=i.branches)!==null&&l!==void 0&&l.length?i.branches.map(function(_){return c()(c()({},a),{},{source:{cell:i.id},target:{cell:_.nextId},labels:_.when?[{position:.5,attrs:{label:{text:_.when}}}]:void 0})}):i.nextId?[c()(c()({},a),{},{source:{cell:i.id},target:{cell:i.nextId}})]:[]});return{nodes:r,edges:u}}var f=function(){function t(){g()(this,t)}return E()(t,[{key:"graphToLogicItems",value:function(n,a){var r=d(a==null?void 0:a.id,n==null?void 0:n.getCells());return r.visualConfig=n==null?void 0:n.toJSON(),c()(c()({},a),{},{visualConfig:r.visualConfig,items:r.items})}},{key:"logicToGraphJson",value:function(n){var a=s(n);return a}}]),t}()},79716:function(x,C,e){e.d(C,{O:function(){return s}});var h=e(25359),c=e.n(h),A=e(49811),g=e.n(A),y=e(70517),E=e(9364),D=e(12490),O=e(42651),v={buildGroup:function(o,n,a,r){var u=Number.parseInt(n/2),i=n%2==0;return{name:o,title:a,graphHeight:(i?u:u+1)*(r||70)+10}}},m=v;function d(t){return t.length>7?"".concat(t.substring(0,7),`\r
`).concat(t.substring(7)):t}function s(t){return f.apply(this,arguments)}function f(){return f=g()(c()().mark(function t(o){var n,a;return c()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return n=[],a="/api/ide/asset/v1/logic-item/readFromCode",o&&(a="/api/ide/papi/".concat(o,"/api/ide/asset/v1/logic-item/readFromCode")),u.abrupt("return",Promise.all([(0,E.K)(),y.Z.get(a)]).then(function(i){if(console.log("getPanelData"),i[1].status==200){var l=i[1].data.data;Object.keys(l).forEach(function(_,R){var p=m.buildGroup(_,l[_].length,_);n.push(p),l[_].sort(function(T,M){return T.order?T.order.localeCompare(M.order):1}).forEach(function(T){i[0].Nodes.push(new O.Z({shape:T.shape?T.shape:"ExtShape"+(R%3==0?"1":R%3==1?"2":"3"),ports:D.Tt,width:100,height:50,text:T.name,data:{config:T.logicItem},_groups:[T.group]}))})})}return{Nodes:i[0].Nodes,Groups:n}}));case 4:case"end":return u.stop()}},t)})),f.apply(this,arguments)}},32126:function(x,C,e){e.d(C,{S:function(){return d}});var h=e(25359),c=e.n(h),A=e(49811),g=e.n(A),y=e(21140),E=e.n(y),D=e(63466),O=e.n(D),v=e(31837),m=e(57475),d=function(){function s(){E()(this,s)}return O()(s,null,[{key:"getEnvJson",value:function(){var f=g()(c()().mark(function o(){return c()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,m.U2)("/api/runtime/env").then(function(r){return r.data.data}).then(function(r){return v.j.setModel(r.UI_CONFIG_MODEL),v.j.setEnv(JSON.stringify(r)),v.j.setApiUrlPrefix(r.API_GATEWAY_PREFIX),v.j.setReryApi(r.CUSTOM_RETRY_URL),v.j.setReryApi(r.CUSTOM_RETRY_URL),r}));case 1:case"end":return a.stop()}},o)}));function t(){return f.apply(this,arguments)}return t}()},{key:"getRemoteRuntimeConfig",value:function(){var f=g()(c()().mark(function o(){return c()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,m.v_)("/api/ide/remote-runtimes").then(function(r){return r.data}).then(function(r){return console.log("remote runtimes:",r.data),v.j.setRemoteRuntimes(JSON.stringify(r.data)),r}));case 1:case"end":return a.stop()}},o)}));function t(){return f.apply(this,arguments)}return t}()}]),s}()}}]);
