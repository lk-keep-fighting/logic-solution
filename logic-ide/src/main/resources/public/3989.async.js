"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[3989],{83989:function(ue,Q,k){k.r(Q),k.d(Q,{TableControlRenderer:function(){return de},default:function(){return ee}});var n=k(15767),ne=k(87363),R=k.n(ne),h=k(42977),_=k(94391),ie=k(59245),Z=k.n(ie),ae=k(33170),Y=k.n(ae),re=k(66292),se=k.n(re),oe=k(11333),le=k.n(oe),D="__isPlaceholder",ee=function(W){(0,n.ZT)(P,W);function P(e){var t=W.call(this,e)||this;t.entityId=1,t.subForms={},t.subFormItems={},t.rowPrinstine=[],t.editting={},t.toDispose=[],t.lazyEmitValue=se()(t.emitValue.bind(t),50,{trailing:!0,leading:!1}),t.emittedValue=null;var a=e.addHook,i=Array.isArray(e.value)?e.value.concat():[];return t.state=(0,n.pi)({columns:t.buildColumns(e),editIndex:"",items:i},t.transformState(i)),t.entries=new h.arw,t.buildItemProps=t.buildItemProps.bind(t),t.confirmEdit=t.confirmEdit.bind(t),t.cancelEdit=t.cancelEdit.bind(t),t.handleSaveTableOrder=t.handleSaveTableOrder.bind(t),t.handleTableSave=t.handleTableSave.bind(t),t.handleRadioChange=t.handleRadioChange.bind(t),t.getEntryId=t.getEntryId.bind(t),t.subFormRef=t.subFormRef.bind(t),t.subFormItemRef=t.subFormItemRef.bind(t),t.handlePageChange=t.handlePageChange.bind(t),t.handleTableQuery=t.handleTableQuery.bind(t),t.emitValue=t.emitValue.bind(t),t.tableRef=t.tableRef.bind(t),t.flush=t.flush.bind(t),t.filterItemIndex=t.filterItemIndex.bind(t),a&&t.toDispose.push(a(t.flush,"flush")),t}return P.prototype.componentDidUpdate=function(e,t){var a=this.props,i=null;if(e.disabled!==a.disabled||e.static!==a.static||a.$schema.disabled!==e.$schema.disabled||a.$schema.static!==e.$schema.static){var r=this.state.items.filter(function(l){return!l.hasOwnProperty(D)});i=(0,n.pi)((0,n.pi)((0,n.pi)((0,n.pi)({},i),{items:r}),this.transformState(r)),{editIndex:"",columns:this.buildColumns(a)})}if(a.columns!==e.columns&&(i=(0,n.pi)((0,n.pi)({},i),{columns:this.buildColumns(a)})),a.value!==e.value&&a.value!==this.emittedValue){var r=Array.isArray(a.value)?a.value.concat():[];i=(0,n.pi)((0,n.pi)((0,n.pi)((0,n.pi)({},i),{items:r}),this.transformState(r)),{editIndex:""})}i&&this.setState(i)},P.prototype.componentWillUnmount=function(){this.entries.dispose(),this.lazyEmitValue.cancel(),this.toDispose.forEach(function(e){return e()}),this.toDispose=[]},P.prototype.transformState=function(e,t,a){var i=this.props,r=i.perPage,l=i.matchFunc,s=(0,n.pi)((0,n.pi)({},this.state),t),d=s.query,c=s.page,p=d!=null?d:{},g=p.orderBy,b=p.orderDir,u=(0,n._T)(p,["orderBy","orderDir"]),v=Object.keys(u);v.length&&(e=(0,h.Oab)(e,{query:u,columns:this.state.columns,matchFunc:typeof l=="string"&&l?(0,h.PqP)(l,"items","itemsRaw","options"):typeof l=="function"?l:void 0})),g&&(e=(0,h.qrZ)(e.concat(),g,typeof b=="string"&&/desc/i.test(b)?-1:1));var I=e.length;if(c=Math.min(c!=null?c:1,typeof r=="number"?Math.max(1,Math.ceil(I/r)):1),a){var m=e.indexOf(a);~m&&(c=Math.ceil((m+1)/r))}return typeof r=="number"&&r&&e.length>r&&(e=e.slice((c-1)*r,c*r)),{filteredItems:e,page:c,total:I}},P.prototype.flush=function(){return(0,n.mG)(this,void 0,void 0,function(){var e,t,a=this;return(0,n.Jh)(this,function(i){switch(i.label){case 0:return e=[],Object.keys(this.subForms).forEach(function(r){return a.subForms[r]&&e.push(a.subForms[r])}),[4,Promise.all(e.map(function(r){return r.flush()}))];case 1:return i.sent(),t=[],Object.keys(this.subFormItems).forEach(function(r){return a.subFormItems[r]&&t.push(a.subFormItems[r])}),[4,Promise.all(t.map(function(r){var l,s;return(s=(l=r.props).onFlushChange)===null||s===void 0?void 0:s.call(l)}))];case 2:return i.sent(),[4,this.lazyEmitValue.flush()];case 3:return i.sent(),[2]}})})},P.prototype.resolveVariableProps=function(e,t){var a={minLength:0,maxLength:1/0},i=e[t];if(!i)return a[t];if(typeof i=="string")if((0,h.SSQ)(i)){var r=(0,h.OgC)(i,e.data,"| raw");i=typeof r=="number"&&r>=0?r:a[t]}else{var l=parseInt(i,10);i=isNaN(l)?a[t]:l}return i},P.prototype.subFormRef=function(e,t,a){this.subForms["".concat(t,"-").concat(a)]=e},P.prototype.subFormItemRef=function(e,t,a){this.subFormItems["".concat(t,"-").concat(a)]=e},P.prototype.validate=function(){return(0,n.mG)(this,void 0,void 0,function(){var e,t,a,i,r,l,s,d,c,p,g,b,u,v=this;return(0,n.Jh)(this,function(I){switch(I.label){case 0:return e=this.props,t=e.value,a=e.translate,i=e.columns,r=this.resolveVariableProps(this.props,"minLength"),l=this.resolveVariableProps(this.props,"maxLength"),this.state.editIndex?[2,a("Table.editing")]:r&&(!Array.isArray(t)||t.length<r)?[2,a("Combo.minLength",{minLength:r})]:[3,1];case 1:return l&&Array.isArray(t)&&t.length>l?[2,a("Combo.maxLength",{maxLength:l})]:[3,2];case 2:return s=[],Object.keys(this.subForms).forEach(function(m){return v.subForms[m]&&s.push(v.subForms[m])}),s.length?[4,Promise.all(s.map(function(m){return m.validate()}))]:[3,4];case 3:if(d=I.sent(),c=~d.indexOf(!1)?a("Form.validateFailed"):"",p="",!c&&Array.isArray(i)&&Array.isArray(t)&&i.some(function(m){if(m.unique&&m.name){var y=[];return t.some(function(o){var C=(0,h.E04)(o,m.name);return~y.indexOf(C)?(p="".concat(m.label||m.name),!0):(y.push(C),!1)})}return!1})&&(c=a("InputTable.uniqueError",{label:p})),c)return[2,c];I.label=4;case 4:return g=[],Object.keys(this.subFormItems).forEach(function(m){return v.subFormItems[m]&&g.push(v.subFormItems[m])}),[4,Promise.all(g.map(function(m){return m.props.onValidate()}))];case 5:return b=I.sent(),u=~b.indexOf(!1)?a("Form.validateFailed"):"",[2,u]}})})},P.prototype.emitValue=function(e){return(0,n.mG)(this,void 0,void 0,function(){var t,a,i;return(0,n.Jh)(this,function(r){switch(r.label){case 0:return t=e!=null?e:this.state.items.filter(function(l){return!l.hasOwnProperty(D)}),a=this.props.onChange,[4,this.dispatchEvent("change")];case 1:return i=r.sent(),i||(this.emittedValue=t,a==null||a(t)),[2,i]}})})},P.prototype.doAction=function(e,t){for(var a,i,r=[],l=2;l<arguments.length;l++)r[l-2]=arguments[l];return(0,n.mG)(this,void 0,void 0,function(){var s,d,c,p,g,b,u,v,I,m,y,o,C,f,E,x,O,M=this;return(0,n.Jh)(this,function(F){switch(F.label){case 0:return s=this.props,d=s.onAction,c=s.valueField,p=s.env,g=s.needConfirm,b=s.addable,u=s.addApi,v=s.translate,I=s.onChange,m=e.actionType,m!=="add"?[3,6]:b===!1?[2]:(y=this.state.items.concat(),u||e.payload?(o=null,(0,h.X1t)(u,t)?[4,p.fetcher(u,t)]:[3,2]):[3,4]);case 1:return C=F.sent(),C&&!C.ok?(!(u!=null&&u.silent)&&p.notify("error",(i=(a=u==null?void 0:u.messages)===null||a===void 0?void 0:a.failed)!==null&&i!==void 0?i:C.msg||v("fetchFailed")),[2]):(C&&C.ok&&(o=C.data),[3,3]);case 2:o=(0,h.buJ)(e.payload,t),F.label=3;case 3:return o=Array.isArray(o)?o:[o],o.forEach(function(w){(!c||!Y()(y,function(A){return A[c]==w[c]}))&&(y.push(w),g!==!1&&Reflect.set(w,D,!0))}),this.setState((0,n.pi)({items:y},this.transformState(y)),function(){o.length===1&&g!==!1?M.startEdit("".concat(y.length-1),!0):I==null||I(y)}),[2];case 4:return[2,this.addItem("".concat(y.length-1),!1)];case 5:return[3,7];case 6:if(m==="remove"||m==="delete"){if(c){if(!e.payload)return[2,p.alert(v("Table.playload"))]}else return[2,p.alert(v("Table.valueField"))];return f=this.state.items.concat(),E=(0,h.buJ)(e.payload,t),E=Array.isArray(E)?E:[E],E.forEach(function(w){var A=(0,h.L$8)(f,function(B){return B[c]==w[c]});A!=null&&A.length&&(f=(0,h.o5f)(f,A,1))}),this.setState((0,n.pi)({items:f},this.transformState(f)),function(){I==null||I(f)}),[2]}else m==="initDrag"?(x=this.table).doAction.apply(x,(0,n.ev)([e,t],(0,n.CR)(r),!1)):m==="cancelDrag"&&(O=this.table).doAction.apply(O,(0,n.ev)([e,t],(0,n.CR)(r),!1));F.label=7;case 7:return[2,d&&d.apply(void 0,(0,n.ev)([e,t],(0,n.CR)(r),!1))]}})})},P.prototype.copyItem=function(e){return(0,n.mG)(this,void 0,void 0,function(){var t,a,i,r,l,s,d,c,p,g,b,u,v,I,m,y,o=this;return(0,n.Jh)(this,function(C){return t=this.props,a=t.needConfirm,i=t.data,r=t.copyData,l=r===void 0?{"&":"$$"}:r,s=this.state.items.concat(),d=e.split(".").map(function(f){return parseInt(f,10)}),c=d.concat(),c[c.length-1]+=1,p=s,g=(0,h.IMU)(s,d),b=(0,h.buJ)(l,(0,h.nW9)(i,g)),a===!1?s=(0,h.o5f)(s,c,0,b):s=(0,h.o5f)(s,c,0,(0,n.pi)((0,n.pi)({},b),(y={},y[D]=!0,y))),this.reUseRowId(s,p,c),u=s[c[0]],v=(0,n.pi)((0,n.pi)({},this.transformState(s)),{items:s}),v.filteredItems.includes(u)||(I=s[d[0]],m=v.filteredItems.findIndex(function(f){return f===I}),v.filteredItems.splice(m+1,0,u)),this.setState(v,function(){return(0,n.mG)(o,void 0,void 0,function(){var f;return(0,n.Jh)(this,function(E){switch(E.label){case 0:return[4,this.dispatchEvent("add",{index:c[c.length-1],indexPath:c.join("."),item:b})];case 1:return f=E.sent(),f?[2]:(a===!1?this.emitValue():this.startEdit(c.join("."),!0),[2])}})})}),[2]})})},P.prototype.addItem=function(e,t,a){return t===void 0&&(t=!0),(0,n.mG)(this,void 0,void 0,function(){var i,r,l,s,d,c,p,g,b,u,v,I,m,y,o,C,f=this;return(0,n.Jh)(this,function(E){return e=e||"".concat(this.state.items.length-1),i=this.props,r=i.needConfirm,l=i.scaffold,s=i.columns,d=i.data,c=i.perPage,p=this.state.items.concat(),g=(C={},C[D]=!0,C),Array.isArray(s)&&s.forEach(function(x){if(typeof x.value!="undefined"&&typeof x.name=="string")if("type"in x&&(x.type==="input-date"||x.type==="input-datetime"||x.type==="input-time"||x.type==="input-month"||x.type==="input-quarter"||x.type==="input-year")){if(!(typeof x.value=="string"&&x.value.trim()==="")){var O=(0,h.kXI)(x.value,d,x.format||"X");(0,h.NI0)(g,x.name,(x.utc?le().utc(O):O).format(x.format||"X"))}}else(0,h.UTL)(x.value)||(0,h.NI0)(g,x.name,x.value)}),g=(0,n.pi)((0,n.pi)({},g),l),r===!1&&Reflect.deleteProperty(g,D),b=e.split(".").map(function(x){return parseInt(x,10)}),u=b.concat(),u[u.length-1]+=1,v=p,p=(0,h.o5f)(p,u,0,g),this.reUseRowId(p,v,u),I=p[u[0]],m=(0,n.pi)((0,n.pi)({items:p},this.transformState(p,void 0,I)),r===!1?{}:{editIndex:u.join("."),isCreateMode:!0,columns:this.buildColumns(this.props,!0,"".concat(e))}),m.filteredItems.includes(I)||(y=p[b[0]],o=m.filteredItems.findIndex(function(x){return x===y}),m.filteredItems.splice(o+1,0,I)),this.setState(m,function(){return(0,n.mG)(f,void 0,void 0,function(){return(0,n.Jh)(this,function(x){switch(x.label){case 0:return t?[4,this.dispatchEvent("add",{index:u[u.length-1],indexPath:u.join("."),item:g})]:[3,2];case 1:x.sent(),x.label=2;case 2:return r===!1&&this.emitValue(),a==null||a(),[2]}})})}),[2,!1]})})},P.prototype.subAddItem=function(e,t,a){return t===void 0&&(t=!0),(0,n.mG)(this,void 0,void 0,function(){return(0,n.Jh)(this,function(i){return[2,this.addItem(e+".-1",t,function(){a==null||a.setExpanded(!0)})]})})},P.prototype.editItem=function(e){return(0,n.mG)(this,void 0,void 0,function(){var t,a,i,r;return(0,n.Jh)(this,function(l){switch(l.label){case 0:return t=this.state.items,a=e.split(".").map(function(s){return parseInt(s,10)}),i=(0,h.IMU)(t,a),[4,this.dispatchEvent("edit",{index:a[a.length-1],indexPath:a.join("."),item:i})];case 1:return r=l.sent(),!r&&this.startEdit(e,!0),[2]}})})},P.prototype.dispatchEvent=function(e,t){return t===void 0&&(t={}),(0,n.mG)(this,void 0,void 0,function(){var a,i,r,l,s;return(0,n.Jh)(this,function(d){switch(d.label){case 0:return a=this.props.dispatchEvent,i=this.state,r=i.items,l=i.rowIndex,[4,a(e,(0,h.vXk)(this.props,(0,n.pi)({value:(0,n.ev)([],(0,n.CR)(r),!1),rowIndex:l},t)))];case 1:return s=d.sent(),[2,!!(s!=null&&s.prevented)]}})})},P.prototype.startEdit=function(e,t){t===void 0&&(t=!1),this.setState({editIndex:e,isCreateMode:t,columns:this.buildColumns(this.props,t,e)})},P.prototype.confirmEdit=function(){var e,t,a;return(0,n.mG)(this,void 0,void 0,function(){var i,r,l,s,d,c,p,g,b,u,v,I,m,y,o,C,f,E,x,O,M=this;return(0,n.Jh)(this,function(F){switch(F.label){case 0:return i=this.props,r=i.addApi,l=i.updateApi,s=i.data,d=i.env,c=i.translate,p=[],Object.keys(this.subForms).forEach(function(w){return M.subForms[w]&&p.push(M.subForms[w])}),p.forEach(function(w){return w.flush()}),g=[],Object.keys(this.subFormItems).forEach(function(w){return M.subFormItems[w]&&g.push(M.subFormItems[w])}),g.forEach(function(w){var A,B;return(B=(A=w.props).onFlushChange)===null||B===void 0?void 0:B.call(A)}),b=p,[4,Promise.all(b.map(function(w){return w.validate()}).concat(g.map(function(w){return w.props.onValidate()})))];case 1:return u=F.sent(),~u.indexOf(!1)?[2]:(v=this.state.items.concat(),I=this.state.editIndex.split(".").map(function(w){return parseInt(w,10)}),m=(0,n.pi)({},(0,h.IMU)(v,I)),y=m.hasOwnProperty(D),o=y?"addConfirm":"editConfirm",[4,this.dispatchEvent(o,{index:I[I.length-1],indexPath:I.join("."),item:m})]);case 2:return C=F.sent(),C?[2]:(f=null,E=void 0,y&&(0,h.X1t)(r,(0,h.nW9)(s,m))?[4,d.fetcher(r,(0,h.nW9)(s,m))]:[3,4]);case 3:return f=F.sent(),E=(e=r==null?void 0:r.messages)===null||e===void 0?void 0:e.failed,[3,6];case 4:return!y&&(0,h.X1t)(l,(0,h.nW9)(s,m))?[4,d.fetcher(l,(0,h.nW9)(s,m))]:[3,6];case 5:f=F.sent(),E=(t=l==null?void 0:l.messages)===null||t===void 0?void 0:t.failed,F.label=6;case 6:return f&&!f.ok?(!(!((a=y?r:l)===null||a===void 0)&&a.silent)&&d.notify("error",E!=null?E:f.msg||c("saveFailed")),x=y?"addFail":"editFail",this.dispatchEvent(x,{index:I[I.length-1],indexPath:I.join("."),item:m,error:f}),[2]):(f&&f.ok&&(m=(0,n.pi)((0,n.pi)({},(y?r:l).replaceData?{}:m),f.data)),Reflect.deleteProperty(m,D),O=v,v=(0,h.o5f)(v,I,1,m),this.reUseRowId(v,O,I),this.setState((0,n.pi)((0,n.pi)({editIndex:"",items:v},this.transformState(v)),{columns:this.buildColumns(this.props)}),function(){return(0,n.mG)(M,void 0,void 0,function(){var w,A;return(0,n.Jh)(this,function(B){switch(B.label){case 0:return[4,this.emitValue()];case 1:return w=B.sent(),w?[2]:(A=y?"addSuccess":"editSuccess",this.dispatchEvent(A,{index:I[I.length-1],indexPath:I.join("."),item:m}),[2])}})})}),[2])}})})},P.prototype.cancelEdit=function(){var e=this.state.items.concat(),t=this.state.lastModifiedRow,a=this.state.editIndex.split(".").map(function(s){return parseInt(s,10)}),i=(0,n.pi)({},(0,h.IMU)(e,a)),r=i.hasOwnProperty(D),l=e;r?e=(0,h.o5f)(e,a,1):t&&~(t==null?void 0:t.index)&&(0,h.Kn2)(t==null?void 0:t.data)&&(e=(0,h.o5f)(e,a,1,(0,n.pi)((0,n.pi)({},i),t.data))),this.reUseRowId(e,l,a),this.setState((0,n.pi)((0,n.pi)({editIndex:"",items:e},this.transformState(e)),{columns:this.buildColumns(this.props),lastModifiedRow:void 0}),this.emitValue)},P.prototype.removeItem=function(e){var t,a;return(0,n.mG)(this,void 0,void 0,function(){var i,r,l,s,d,c,p,g,b,u,v,I,m,y,o,C,f=this;return(0,n.Jh)(this,function(E){switch(E.label){case 0:return i=this.props,r=i.value,l=i.onChange,s=i.deleteApi,d=i.deleteConfirmText,c=i.env,p=i.data,g=i.translate,b=Array.isArray(r)?r.concat():[],u=e.split(".").map(function(x){return parseInt(x,10)}),v=(0,h.IMU)(b,u),v?[4,this.dispatchEvent("delete",{index:u[u.length-1],indexPath:u.join("."),item:v})]:[2];case 1:return I=E.sent(),I?[2]:(m=(0,h.nW9)(p,v),(0,h.X1t)(s,m)?[4,c.confirm(d?(0,h.hXT)(d,m):g("deleteConfirm"))]:[3,4]);case 2:return y=E.sent(),y?[4,c.fetcher(s,m)]:[2];case 3:if(o=E.sent(),!o.ok)return!(s!=null&&s.silent)&&c.notify("error",(a=(t=s==null?void 0:s.messages)===null||t===void 0?void 0:t.failed)!==null&&a!==void 0?a:g("deleteFailed")),this.dispatchEvent("deleteFail",{index:u[u.length-1],indexPath:u.join("."),item:v,error:o}),[2];E.label=4;case 4:return this.removeEntry(v),C=b,b=(0,h.o5f)(b,u,1),this.reUseRowId(b,C,u),this.setState((0,n.pi)({items:b},this.transformState(b)),function(){return(0,n.mG)(f,void 0,void 0,function(){var x;return(0,n.Jh)(this,function(O){switch(O.label){case 0:return[4,this.emitValue(b)];case 1:return x=O.sent(),x?[2]:(this.dispatchEvent("deleteSuccess",{value:b,index:u[u.length-1],indexPath:u.join("."),item:v}),[2])}})})}),[2]}})})},P.prototype.convertToRawPath=function(e,t){var a=(0,n.pi)((0,n.pi)({},this.state),t),i=a.filteredItems,r=a.items,l="".concat(e).split(".").map(function(d){return parseInt(d,10)}),s=i[l[0]];return l[0]=r.findIndex(function(d){return d===s}),l[0]===-1?e:l.join(".")},P.prototype.reUseRowId=function(e,t,a){for(var i=t,r=e,l=0,s=a.length;l<s;l++){var d=a[l];if(!(i!=null&&i[d])||!(r!=null&&r[d]))break;this.entries.set(r[d],this.entries.get(i[d])||this.entityId++),this.entries.delete(i[d]),r=r[d].children,i=i[d].children}},P.prototype.buildItemProps=function(e,t){var a={},i=this.resolveVariableProps(this.props,"minLength"),r=this.resolveVariableProps(this.props,"maxLength");return a.inputTableCanAddItem=r?r>this.state.items.length:!0,a.inputTableCanRemoveItem=i?i<this.state.items.length:!0,this.props.needConfirm===!1?(a.quickEditEnabled=!0,a):(!this.props.static&&!this.props.editable&&!this.props.addable&&!this.state.isCreateMode||(a.quickEditEnabled=this.state.editIndex===this.convertToRawPath(e.path),this.props.enableStaticTransform&&this.props.needConfirm!==!1&&(a.static=!a.quickEditEnabled)),a)},P.prototype.buildColumns=function(e,t,a){var i=this;t===void 0&&(t=!1);var r=this.props,l=r.env,s=r.mobileUI,d=r.testIdBuilder,c=Array.isArray(e.columns)?e.columns.concat():[],p=this.props.classPrefix,g=this.props.translate,b=this.props.needConfirm,u=this.props.static,v=this.props.disabled,I=[];if(!u&&e.addable&&e.showTableAddBtn!==!1&&I.push({children:function(o){var C=o.key,f=o.rowIndexPath,E=o.inputTableCanAddItem;return i.state.editIndex&&b!==!1||!E?null:R().createElement(_.zxk,{classPrefix:p,size:"sm",key:C,level:"link",tooltip:g("Table.addRow"),tooltipContainer:e.popOverContainer||l.getModalContainer,disabled:v,onClick:i.addItem.bind(i,i.convertToRawPath(f),void 0,void 0),testIdBuilder:d==null?void 0:d.getChild("addRow-".concat(i.convertToRawPath(f)))},e.addBtnIcon?R().createElement(_.JO$,{cx:e.classnames,icon:e.addBtnIcon,className:"icon"}):null,e.addBtnLabel?R().createElement("span",null,e.addBtnLabel):null)}}),!u&&e.childrenAddable&&e.showTableAddBtn!==!1&&I.push({children:function(o){var C=o.key,f=o.rowIndexPath,E=o.row;return i.state.editIndex&&b!==!1?null:R().createElement(_.zxk,{classPrefix:p,size:"sm",key:C,level:"link",tooltip:g("Table.subAddRow"),tooltipContainer:e.popOverContainer||l.getModalContainer,disabled:v,onClick:i.subAddItem.bind(i,i.convertToRawPath(f),void 0,E),testIdBuilder:d==null?void 0:d.getChild("subAddRow-".concat(i.convertToRawPath(f)))},e.subAddBtnIcon?R().createElement(_.JO$,{cx:e.classnames,icon:e.subAddBtnIcon,className:"icon"}):null,e.subAddBtnLabel?R().createElement("span",null,e.subAddBtnLabel):null)}}),!u&&e.copyable&&e.showCopyBtn!==!1&&I.push({children:function(o){var C=o.key,f=o.rowIndexPath;return i.state.editIndex&&b!==!1?null:R().createElement(_.zxk,{classPrefix:p,size:"sm",key:C,level:"link",tooltip:g("Table.copyRow"),tooltipContainer:e.popOverContainer||l.getModalContainer,disabled:v,onClick:i.copyItem.bind(i,i.convertToRawPath(f),void 0),testIdBuilder:d==null?void 0:d.getChild("copyRow-".concat(i.convertToRawPath(f)))},e.copyBtnIcon?R().createElement(_.JO$,{cx:e.classnames,icon:e.copyBtnIcon,className:"icon"}):null,e.copyBtnLabel?R().createElement("span",null,e.copyBtnLabel):null)}}),e.needConfirm===!1?c=c.map(function(o){var C=o.quickEdit;return C===!1?Z()(o,["quickEdit"]):(0,n.pi)((0,n.pi)({},o),o.type==="operation"?{}:{quickEdit:(0,n.pi)((0,n.pi)((0,n.pi)({},i.columnToQuickEdit(o)),C),{visibleOn:"",hiddenOn:"",visible:!0,hidden:!1,saveImmediately:!0,mode:"inline",disabled:v,static:u||o.static})})}):u!==!0&&(e.addable||e.editable||t)?(c=c.map(function(o,C){var f=!t&&o.hasOwnProperty("quickEditOnUpdate")?o.quickEditOnUpdate:o.quickEdit,E=(0,h.SL$)(o==null?void 0:o.type);return(0,n.pi)({},f===!1?Z()(o,["quickEdit"]):(0,n.pi)((0,n.pi)({},o),{quickEdit:(0,n.pi)((0,n.pi)((0,n.pi)({},i.columnToQuickEdit(o)),f),{visibleOn:"",hiddenOn:"",visible:!0,hidden:!1,isQuickEditFormMode:!!(E!=null&&E.isFormItem),saveImmediately:!0,mode:"inline",disabled:v})}))}),!u&&e.editable&&I.push({children:function(o){var C=o.key,f=o.rowIndexPath,E=o.data;return i.state.editIndex||E&&E.hasOwnProperty(D)?null:R().createElement(_.zxk,{classPrefix:p,size:"sm",key:C,level:"link",tooltip:g("Table.editRow"),tooltipContainer:e.popOverContainer||l.getModalContainer,disabled:v,onClick:function(){return i.editItem(i.convertToRawPath(f))},testIdBuilder:d==null?void 0:d.getChild("editRow-".concat(i.convertToRawPath(f)))},typeof e.updateBtnIcon!="undefined"?e.updateBtnIcon?R().createElement(_.JO$,{cx:e.classnames,icon:e.updateBtnIcon,className:"icon"}):null:e.editBtnIcon?R().createElement(_.JO$,{cx:e.classnames,icon:e.editBtnIcon,className:"icon"}):null,e.updateBtnLabel||e.editBtnLabel?R().createElement("span",null,e.updateBtnLabel||e.editBtnLabel):null)}}),!u&&I.push({children:function(o){var C=o.key,f=o.rowIndexPath;return i.state.editIndex===i.convertToRawPath(f)?R().createElement(_.zxk,{classPrefix:p,size:"sm",key:C,level:"link",tooltip:g("save"),tooltipContainer:e.popOverContainer||l.getModalContainer,onClick:i.confirmEdit,testIdBuilder:d==null?void 0:d.getChild("confirmRow-".concat(i.convertToRawPath(f)))},e.confirmBtnIcon?R().createElement(_.JO$,{cx:e.classnames,icon:e.confirmBtnIcon,className:"icon"}):null,e.confirmBtnLabel?R().createElement("span",null,e.confirmBtnLabel):null):null}}),!u&&I.push({children:function(o){var C=o.key,f=o.rowIndexPath;return i.state.editIndex===i.convertToRawPath(f)?R().createElement(_.zxk,{classPrefix:p,size:"sm",key:C,level:"link",tooltip:g("cancel"),tooltipContainer:e.popOverContainer||l.getModalContainer,onClick:i.cancelEdit,testIdBuilder:d==null?void 0:d.getChild("cancelRow-".concat(i.convertToRawPath(f)))},e.cancelBtnIcon?R().createElement(_.JO$,{cx:e.classnames,icon:e.cancelBtnIcon,className:"icon"}):null,e.cancelBtnLabel?R().createElement("span",null,e.cancelBtnLabel):null):null}})):c=c.map(function(o){var C=(0,h.SL$)(o==null?void 0:o.type);return C!=null&&C.isFormItem?(0,n.pi)((0,n.pi)({},o),{quickEdit:(0,n.pi)((0,n.pi)({},o),{visibleOn:"",hiddenOn:"",visible:!0,hidden:!1,isFormMode:!0})}):o}),!u&&e.removable&&I.push({children:function(o){var C=o.key,f=o.rowIndexPath,E=o.data,x=o.inputTableCanRemoveItem;return(i.state.editIndex||E&&E.hasOwnProperty(D))&&b!==!1||!x?null:R().createElement(_.zxk,{classPrefix:p,size:"sm",key:C,level:"link",tooltip:g("Table.deleteRow"),tooltipContainer:e.popOverContainer||l.getModalContainer,disabled:v,onClick:i.removeItem.bind(i,i.convertToRawPath(f)),testIdBuilder:d==null?void 0:d.getChild("delRow-".concat(i.convertToRawPath(f)))},e.deleteBtnIcon?R().createElement(_.JO$,{cx:e.classnames,icon:e.deleteBtnIcon,className:"icon"}):null,e.deleteBtnLabel?R().createElement("span",null,e.deleteBtnLabel):null)}}),I.length){var m=c.findIndex(function(o){return o.type==="operation"}),y=c[m];m===-1?(y={type:"operation",buttons:[],label:g("Table.operation"),className:"v-middle nowrap",fixed:s?"":"right",width:150,innerClassName:"m-n"},c.push(y)):(y=(0,n.pi)({},y),c.splice(m,1,y)),y.buttons=Array.isArray(y.buttons)?y.buttons.concat():[],y.buttons.unshift.apply(y.buttons,I),y.hasOwnProperty("quickEdit")&&delete y.quickEdit}return c},P.prototype.columnToQuickEdit=function(e){var t,a={type:"input-text"};return!((t=(0,h.SL$)(e==null?void 0:e.type))===null||t===void 0)&&t.isFormItem||~["group"].indexOf(e.type)?(0,n.pi)((0,n.pi)({},e),{label:""}):a},P.prototype.handleTableSave=function(e,t,a){var i=this,r;this.setState(function(l,s){var d={},c=l.editIndex,p=l.lastModifiedRow,g=l.items.concat();if(Array.isArray(e))a.forEach(function(f,E){f=i.convertToRawPath(f,l);var x=f.split(".").map(function(M){return parseInt(M,10)}),O=(0,n.pi)({},(0,h.IMU)(e,x));g=(0,h.o5f)(g,x,1,O)});else{if(a=i.convertToRawPath(a,l),c&&a===c){var b=c.split(".").map(function(f){return parseInt(f,10)}),u=l.items.concat(),v=(0,h.IMU)(u,b);if(!v)return d;var I=(0,n.pi)({},e),m=u;return u=(0,h.o5f)(u,b,1,I),i.reUseRowId(u,m,b),Object.assign(d,(0,n.pi)({items:u,filteredItems:l.filteredItems.map(function(f){return f===v?I:f}),rowIndex:c},(p==null?void 0:p.index)===c?{}:{lastModifiedRow:v.hasOwnProperty(D)?void 0:{index:c,data:(0,n.pi)({},v)}})),d}var y=a.split(".").map(function(f){return parseInt(f,10)}),o=(0,n.pi)({},e),C=g;g=(0,h.o5f)(g,y,1,o),i.reUseRowId(g,C,y)}return Object.assign(d,(0,n.pi)({items:g,rowIndex:a},i.transformState(g,l))),r=i.lazyEmitValue,d},function(){r&&r()})},P.prototype.handleRadioChange=function(e,t){var a=this,i=t.name,r=t.row,l=t.trueValue,s=l===void 0?!0:l,d=t.falseValue,c=d===void 0?!1:d,p;return this.setState(function(g,b){var u=r.path,v=(0,h.GyU)(g.items,function(I,m,y,o,C){var f;return(0,n.pi)((0,n.pi)({},I),(f={},f[i]=u===C.join(".")?s:c,f))});return p=g.editIndex==r.path?void 0:a.lazyEmitValue,(0,n.pi)({items:v},a.transformState(v))},function(){p==null||p()}),!1},P.prototype.handleSaveTableOrder=function(e,t){var a=this.props.onChange;a(t.map(function(i){return(0,n.pi)({},i)}))},P.prototype.handlePageChange=function(e){this.setState((0,n.pi)({},this.transformState(this.state.items,{page:e})))},P.prototype.handleTableQuery=function(e){e=(0,n.pi)((0,n.pi)({},this.state.query),e),this.setState((0,n.pi)({query:e},this.transformState(this.state.items,{query:e})))},P.prototype.handlePristineChange=function(e,t){var a=this,i=this.props.needConfirm,r=t.split(".").map(function(l){return parseInt(l,10)});this.setState(function(l){var s=l.items.concat(),d=(0,h.IMU)(s,r),c=(0,n.pi)((0,n.pi)({},d),e),p=s;return s=(0,h.o5f)(s,r,1,c),a.reUseRowId(s,p,r),(0,n.pi)({items:s},a.transformState(s))},function(){i===!1&&a.emitValue()})},P.prototype.removeEntry=function(e){this.entries.has(e)&&this.entries.delete(e)},P.prototype.getEntryId=function(e){return this.entries.has(e)||this.entries.set(e,this.entityId++),String(this.entries.get(e))},P.prototype.tableRef=function(e){for(;e&&e.getWrappedInstance;)e=e.getWrappedInstance();this.table=e},P.prototype.computedAddBtnDisabled=function(){var e=this.props.disabled;return e||!!this.state.editIndex},P.prototype.filterItemIndex=function(e){return this.convertToRawPath(e)},P.prototype.render=function(){var e=this,t=this.props,a=t.className,i=t.style,r=t.value,l=t.disabled,s=t.render,d=t.placeholder,c=t.draggable,p=t.addable,g=t.columnsTogglable,b=t.combineNum,u=t.combineFromIndex,v=t.translate,I=t.canAccessSuperData,m=t.expandConfig,y=t.affixRow,o=t.prefixRow,C=t.formInited,f=t.perPage,E=t.classnames,x=t.rowClassName,O=t.rowClassNameExpr,M=t.affixHeader,F=M===void 0?!1:M,w=t.autoFillHeight,A=w===void 0?!1:w,B=t.tableContentClassName,J=t.static,N=t.showFooterAddBtn,z=t.footerAddBtn,q=t.toolbarClassName,L=t.onEvent,U=t.testIdBuilder,$=t.showIndex,K=this.resolveVariableProps(this.props,"maxLength");if(C===!1)return null;var S=this.state.query,T=this.state.filteredItems,V=this.state.items,H=typeof f=="number",j=this.state.page||1,G=!J&&p&&N!==!1&&(!K||K>this.state.items.length);return R().createElement("div",{className:E("InputTable",a)},s("body",{type:"table",placeholder:v(d),columns:this.state.columns,affixHeader:F,prefixRow:o,affixRow:y,autoFillHeight:A,tableContentClassName:B,onEvent:L,showIndex:$},{ref:this.tableRef,value:void 0,saveImmediately:!0,disabled:l,draggable:c&&!this.state.editIndex,items:T,getEntryId:this.getEntryId,reUseRow:"match",onSave:this.handleTableSave,onRadioChange:this.handleRadioChange,onSaveOrder:this.handleSaveTableOrder,buildItemProps:this.buildItemProps,quickEditFormRef:this.subFormRef,quickEditFormItemRef:this.subFormItemRef,columnsTogglable:g,combineNum:b,combineFromIndex:u,expandConfig:m,canAccessSuperData:I,rowClassName:x,rowClassNameExpr:O,onPristineChange:this.handlePristineChange,testIdBuilder:U==null?void 0:U.getChild("table"),onQuery:this.handleTableQuery,query:S,orderBy:S==null?void 0:S.orderBy,orderDir:S==null?void 0:S.orderDir,filterItemIndex:this.filterItemIndex}),G||H?R().createElement("div",{className:E("InputTable-toolbar",q)},G?s("button",(0,n.pi)({type:"button",level:"primary",size:"sm",label:v("Table.add"),icon:"fa fa-plus",disabledTip:v("Table.addButtonDisabledTip")},z||{}),{disabled:this.computedAddBtnDisabled(),onClick:function(){return e.addItem()},testIdBuilder:U==null?void 0:U.getChild("add")}):null,H?s("pager",{type:"pagination"},{activePage:j,perPage:f,total:this.state.total,onPageChange:this.handlePageChange,className:"InputTable-pager",testIdBuilder:U==null?void 0:U.getChild("page"),disabled:!!this.state.editIndex}):null):null)},P.defaultProps={placeholder:"placeholder.empty",scaffold:{},addBtnIcon:"plus",subAddBtnIcon:"sub-plus",copyBtnIcon:"copy",editBtnIcon:"pencil",deleteBtnIcon:"minus",confirmBtnIcon:"check",cancelBtnIcon:"close",valueField:"",minLength:0,maxLength:1/0,showFooterAddBtn:!0,showTableAddBtn:!0},P.propsList=["onChange","name","columns","label","scaffold","showTableAddBtn","addable","removable","copyable","editable","addApi","updateApi","deleteApi","needConfirm","canAccessSuperData","formStore","footerActions","toolbarClassName"],(0,n.gn)([h.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object,String]),(0,n.w6)("design:returntype",void 0)],P.prototype,"handlePristineChange",null),P}(R().Component),de=function(W){(0,n.ZT)(P,W);function P(){return W!==null&&W.apply(this,arguments)||this}return P.prototype.setData=function(e,t,a,i){return(0,n.mG)(this,void 0,void 0,function(){var r,l,s,d,c,p=this;return(0,n.Jh)(this,function(g){switch(g.label){case 0:return a===void 0?[3,1]:(r=(0,n.ev)([],(0,n.CR)(this.state.items),!1),l=String(a).split(","),l.forEach(function(b){var u=b.split(".").map(function(I){return parseInt(I,10)}),v=r;r=(0,h.o5f)(r,u,1,t?e:(0,n.pi)((0,n.pi)({},(0,h.IMU)(r,u)),e)),p.reUseRowId(r,v,u)}),this.setState((0,n.pi)({items:r},this.transformState(r)),function(){p.emitValue()}),[3,4]);case 1:return i===void 0?[3,3]:(s=(0,n.ev)([],(0,n.CR)(this.state.items),!1),d=[],(0,h.P8h)(s,function(b,u,v,I,m){return d.unshift(function(){return(0,n.mG)(p,void 0,void 0,function(){var y,o;return(0,n.Jh)(this,function(C){switch(C.label){case 0:return[4,(0,h.Cjz)(i,b)];case 1:return y=C.sent(),y&&(o=s,s=(0,h.o5f)(s,(0,n.ev)((0,n.ev)([],(0,n.CR)(m),!1),[u],!1),1,t?e:(0,n.pi)((0,n.pi)({},(0,h.IMU)(s,(0,n.ev)((0,n.ev)([],(0,n.CR)(m),!1),[u],!1))),e)),this.reUseRowId(s,o,(0,n.ev)((0,n.ev)([],(0,n.CR)(m),!1),[u],!1))),[2]}})})}),!0}),[4,Promise.all(d.map(function(b){return b()}))]);case 2:return g.sent(),this.setState((0,n.pi)({items:s},this.transformState(s)),function(){p.emitValue()}),[3,4];case 3:c=(0,n.ev)([],(0,n.CR)(e),!1),this.setState((0,n.pi)({items:c},this.transformState(c)),function(){p.emitValue()}),g.label=4;case 4:return[2]}})})},P.prototype.doAction=function(e,t,a,i){var r,l,s,d,c,p,g;return a===void 0&&(a=!1),(0,n.mG)(this,void 0,void 0,function(){var b,u,v,I,m,y,o,C,f,E,x,O,M,F,w,A,B,L,J,N,z,q,L,U,$,K=this;return(0,n.Jh)(this,function(S){switch(S.label){case 0:return b=this.props,u=b.valueField,v=b.env,I=b.needConfirm,m=b.addable,y=b.addApi,o=b.deleteApi,C=b.resetValue,f=b.translate,E=b.onChange,x=b.formStore,O=b.store,M=b.name,F=e.actionType,w=((r=this.props.store)===null||r===void 0?void 0:r.data)||{},F!=="addItem"?[3,6]:(A=this.state.items.concat(),y||i?(B=null,(0,h.X1t)(y,w)?[4,v.fetcher(y,w)]:[3,2]):[3,4]);case 1:return L=S.sent(),L&&!L.ok?(!(y!=null&&y.silent)&&v.notify("error",(s=(l=y==null?void 0:y.messages)===null||l===void 0?void 0:l.failed)!==null&&s!==void 0?s:L.msg||f("fetchFailed")),[2]):(L&&L.ok&&(B=L.data),[3,3]);case 2:B=i.item,S.label=3;case 3:return B=(Array.isArray(B)?B:[B]).filter(function(T){return!u||!Y()(A,function(V){return V[u]==T[u]})}),J=[],typeof i.index=="string"&&/^\d+(\.\d+)*$/.test(i.index)?J=i.index.split(".").map(function(T){return parseInt(T,10)}):typeof i.index=="number"&&(J=[i.index]),J.length?A=h.o5f.apply(void 0,(0,n.ev)([A,J,0],(0,n.CR)(B),!1)):A.push.apply(A,(0,n.ev)([],(0,n.CR)(B),!1)),this.setState((0,n.pi)({items:A},this.transformState(A)),function(){if(B.length===1&&I!==!1){var T=J.concat();T[T.length-1]+=1,K.startEdit(T.join("."),!0)}else E==null||E(A)}),[2];case 4:return[2,this.addItem("".concat(A.length-1),!1)];case 5:return[3,13];case 6:return F!=="deleteItem"?[3,12]:(N=(0,n.ev)([],(0,n.CR)(this.state.items),!1),z=[],(i==null?void 0:i.index)===void 0?[3,7]:(String(i.index).split(",").map(function(T){return T.split(".").map(function(V){return parseInt(V,10)})}).sort(function(T,V){for(var H=Math.max(T.length,V.length),j=0;j<H;j++){var G=T[j]||0,X=V[j]||0;if(G!==X)return X-G}return 0}).forEach(function(T){z.push((0,h.IMU)(N,T)),N=(0,h.o5f)(N,T,1)}),[3,9]));case 7:return(i==null?void 0:i.condition)===void 0?[3,9]:(q=[],(0,h.P8h)(N,function(T,V,H,j,G){return q.unshift(function(){return(0,n.mG)(K,void 0,void 0,function(){var X;return(0,n.Jh)(this,function(te){switch(te.label){case 0:return[4,(0,h.Cjz)(i==null?void 0:i.condition,T)];case 1:return X=te.sent(),X&&(z.push(T),N=(0,h.o5f)(N,(0,n.ev)((0,n.ev)([],(0,n.CR)(G),!1),[V],!1),1)),[2]}})})}),!0}),[4,q.reduce(function(T,V){return T.then(V)},Promise.resolve())]);case 8:S.sent(),S.label=9;case 9:return(0,h.X1t)(o,(0,h.nW9)(w,{deletedItems:z}))?[4,v.fetcher(o,(0,h.nW9)(w,{deletedItems:z}))]:[3,11];case 10:if(L=S.sent(),L&&!L.ok)return!(o!=null&&o.silent)&&v.notify("error",(c=(d=o==null?void 0:o.messages)===null||d===void 0?void 0:d.failed)!==null&&c!==void 0?c:L.msg||f("fetchFailed")),[2];S.label=11;case 11:return this.setState((0,n.pi)({items:N},this.transformState(N)),function(){E==null||E(N)}),[2];case 12:if(F==="clear")return this.setState({items:[]},function(){E==null||E([])}),[2];if(F==="reset")return U=(g=(0,h.E04)((p=x==null?void 0:x.pristine)!==null&&p!==void 0?p:O==null?void 0:O.pristine,M))!==null&&g!==void 0?g:C,$=Array.isArray(U)?U:[],this.setState((0,n.pi)({items:$},this.transformState($)),function(){E==null||E($)}),[2];S.label=13;case 13:return[2,W.prototype.doAction.call(this,e,t,a,w)]}})})},P=(0,n.gn)([(0,h.xJW)({type:"input-table"})],P),P}(ee)}}]);
