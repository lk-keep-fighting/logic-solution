"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[8289],{88289:function(M,w,f){f.r(w),f.d(w,{OfficeViewerRenderer:function(){return C},default:function(){return W}});var a=f(15767),x=f(87363),p=f.n(x),m=f(42977),T=f(94391),W=function(E){(0,a.ZT)(s,E);function s(t){var e=E.call(this,t)||this;return e.rootElement=p().createRef(),e.state={loading:!1},e}return s.prototype.componentDidMount=function(){var t;!((t=this.rootElement)===null||t===void 0)&&t.current&&this.renderWord()},s.prototype.componentDidUpdate=function(t){var e=this,r,i;if(!this.state.loading){var n=this.props;(0,m.rMT)(t.src,n.src,t.data,n.data)&&this.fetchWord().then(function(){e.renderWord()}),n.name&&t.data[n.name]!==n.data[n.name]&&this.renderWord(),(JSON.stringify(t.wordOptions)!==JSON.stringify(n.wordOptions)||t.display!==n.display)&&this.renderWord(),!((r=n.wordOptions)===null||r===void 0)&&r.enableVar&&(n.trackExpression&&(0,m.hXT)(n.trackExpression,n.data)!==(0,m.hXT)(t.trackExpression,t.data)?this.renderWord():(i=this.office)===null||i===void 0||i.updateVariable())}},s.prototype.doAction=function(t,e,r,i){var n,c,o=t==null?void 0:t.actionType;o==="saveAs"&&((n=this.office)===null||n===void 0||n.download((i==null?void 0:i.name)||this.fileName)),o==="print"&&((c=this.office)===null||c===void 0||c.print())},s.prototype.evalVar=function(t,e){var r=this.props.data;return(0,m.OgC)("${"+t+"}",(0,m.nW9)(e,r),"| raw")},s.prototype.renderWord=function(){return(0,a.mG)(this,void 0,void 0,function(){var t,e,r;return(0,a.Jh)(this,function(i){switch(i.label){case 0:return t=this.props,e=t.src,r=t.name,e?this.document?[3,2]:[4,this.fetchWord()]:[3,4];case 1:i.sent(),i.label=2;case 2:return[4,this.renderRemoteWord()];case 3:return i.sent(),[3,5];case 4:r&&this.renderFormFile(),i.label=5;case 5:return[2]}})})},s.prototype.fetchWord=function(){var t;return(0,a.mG)(this,void 0,void 0,function(){var e,r,i,n,c,o,l,h,v;return(0,a.Jh)(this,function(d){switch(d.label){case 0:if(e=this.props,r=e.env,i=e.src,n=e.data,c=e.translate,l=i?(0,m.OgC)(i,n,"| raw"):void 0,typeof l=="string"?(o=l,this.fileName=o.split("/").pop()):typeof l=="object"&&typeof l.value=="string"&&(o=l.value,this.fileName=l.name||o.split("/").pop()),!o)return console.warn("file src is empty"),[2];this.finalSrc=o,this.setState({loading:!0}),d.label=1;case 1:return d.trys.push([1,3,4,5]),[4,r.fetcher(o,n,{responseType:"arraybuffer"})];case 2:return h=d.sent(),this.document=h.data,[3,5];case 3:return v=d.sent(),!((t=this.rootElement)===null||t===void 0)&&t.current&&(this.rootElement.current.innerHTML=c("loadingFailed")+" url:"+o),[3,5];case 4:return this.setState({loading:!1}),[7];case 5:return[2]}})})},s.prototype.initOffice=function(t,e){return(0,a.mG)(this,void 0,void 0,function(){var r,i,n,c,o,l,h,v,d;return(0,a.Jh)(this,function(u){switch(u.label){case 0:return r=this.props,i=r.wordOptions,n=r.excelOptions,c=r.env,o=r.src,l=r.data,h=r.translate,v=t.createOfficeViewer,[4,v(e||this.document,{},this.finalSrc)];case 1:return d=u.sent(),d instanceof t.Word?(d.updateOptions((0,a.pi)((0,a.pi)({},i),{data:l,evalVar:this.evalVar.bind(this)})),[3,4]):[3,2];case 2:return d instanceof t.Excel?(d.updateOptions((0,a.pi)((0,a.pi)({},n),{data:l,evalVar:this.evalVar.bind(this)})),[4,d.loadExcel()]):[3,4];case 3:u.sent(),u.label=4;case 4:return[2,d]}})})},s.prototype.renderRemoteWord=function(){return(0,a.mG)(this,void 0,void 0,function(){var t,e,r,i,n,c,o,l,h=this;return(0,a.Jh)(this,function(v){return t=this.props,e=t.wordOptions,r=t.excelOptions,i=t.env,n=t.src,c=t.data,o=t.display,l=t.translate,this.document?(f.e(6142).then(f.bind(f,6142)).then(function(d){return(0,a.mG)(h,void 0,void 0,function(){var u,y,O;return(0,a.Jh)(this,function(g){switch(g.label){case 0:return[4,this.initOffice(d)];case 1:return u=g.sent(),o!==!1?u.render((y=this.rootElement)===null||y===void 0?void 0:y.current):o===!1&&(!((O=this.rootElement)===null||O===void 0)&&O.current)&&(this.rootElement.current.innerHTML=""),this.office=u,this.setState({loading:!1}),[2]}})})}),[2]):[2]})})},s.prototype.renderFormFile=function(){var t=this;this.setState({loading:!0});var e=this.props,r=e.wordOptions,i=e.name,n=e.data,c=e.display,o=n[i];if(o instanceof File){var l=new FileReader;l.onload=function(h){var v=l.result;f.e(6142).then(f.bind(f,6142)).then(function(d){return(0,a.mG)(t,void 0,void 0,function(){var u,y,O;return(0,a.Jh)(this,function(g){switch(g.label){case 0:return[4,this.initOffice(d,v)];case 1:return u=g.sent(),c!==!1?u.render((y=this.rootElement)===null||y===void 0?void 0:y.current):c===!1&&(!((O=this.rootElement)===null||O===void 0)&&O.current)&&(this.rootElement.current.innerHTML=""),this.office=u,this.setState({loading:!1}),[2]}})})})},l.readAsArrayBuffer(o)}else this.setState({loading:!1})},s.prototype.render=function(){var t=this.props,e=t.classnames,r=t.translate,i=t.className,n=t.loading,c=n===void 0?!1:n,o=t.src,l=t.name,h=t.display,v=t.loadingConfig;return p().createElement("div",null,h!==!1&&!o&&!l&&p().createElement("svg",{width:"100%",height:"100",xmlns:"http://www.w3.org/2000/svg"},p().createElement("rect",{x:"0",y:"0",width:"100%",height:"100",style:{fill:"#F7F7F9"}}),p().createElement("text",{x:"50%",y:"50%",fontSize:"18",textAnchor:"middle",alignmentBaseline:"middle",fontFamily:"monospace, sans-serif",fill:"#555555"},"office viewer")),p().createElement("div",{ref:this.rootElement,className:e("office-viewer",i)}),p().createElement(T.$jN,{overlay:!0,key:"info",show:c&&this.state.loading,loadingConfig:v}))},s}(p().Component),C=function(E){(0,a.ZT)(s,E);function s(t,e){var r=E.call(this,t)||this,i=e;return i.registerComponent(r),r}return s.prototype.componentWillUnmount=function(){var t;(t=E.prototype.componentWillUnmount)===null||t===void 0||t.call(this);var e=this.context;e.unRegisterComponent(this)},s.contextType=m.ZHe,s=(0,a.gn)([(0,m.Thl)({type:"office-viewer"}),(0,a.w6)("design:paramtypes",[Object,Object])],s),s}(W)}}]);
