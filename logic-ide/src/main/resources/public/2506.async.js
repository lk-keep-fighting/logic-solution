"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[2506],{56709:function(Z,R,w){w.r(R),w.d(R,{DialogRenderer:function(){return I},default:function(){return z}});var s=w(15767),_=w(87363),m=w.n(_),f=w(42977),N=w(94391),L=w(23293),F=w(61533),X=w.n(F),k=w(6663),z=function(O){(0,s.ZT)(i,O);function i(t){var e=O.call(this,t)||this;e.isDead=!1,e.$$id=(0,f.M8z)(),t.store.setEntered(!!t.show),e.handleSelfClose=e.handleSelfClose.bind(e),e.handleAction=e.handleAction.bind(e),e.handleActionSensor=e.handleActionSensor.bind(e),e.handleDialogConfirm=e.handleDialogConfirm.bind(e),e.handleDialogClose=e.handleDialogClose.bind(e),e.handleDrawerConfirm=e.handleDrawerConfirm.bind(e),e.handleDrawerClose=e.handleDrawerClose.bind(e),e.handleEntered=e.handleEntered.bind(e),e.handleExited=e.handleExited.bind(e),e.handleFormInit=e.handleFormInit.bind(e),e.handleFormSaved=e.handleFormSaved.bind(e),e.handleFormChange=e.handleFormChange.bind(e),e.handleChildFinished=e.handleChildFinished.bind(e);var o=t.store;return e.reaction=(0,L.U5)(function(){return"".concat(o.loading).concat(o.error)},function(){return e.forceUpdate()}),e}return i.prototype.componentWillUnmount=function(){this.reaction&&this.reaction(),this.isDead=!0},i.prototype.buildActions=function(){var t=this.props,e=t.actions,o=t.confirm,n=t.translate,r=t.testIdBuilder;if(typeof e!="undefined")return e;var a=[];return a.push({type:"button",testIdBuilder:r==null?void 0:r.getChild("cancel"),actionType:"cancel",label:n("cancel")}),o&&a.push({type:"button",testIdBuilder:r==null?void 0:r.getChild("confirm"),actionType:"confirm",label:n("confirm"),primary:!0}),a},i.prototype.handleSelfClose=function(t,e){return(0,s.mG)(this,void 0,void 0,function(){var o,n,r,a,d;return(0,s.Jh)(this,function(c){switch(c.label){case 0:return o=this.props,n=o.onClose,r=o.store,a=o.dispatchEvent,[4,a("cancel",this.props.data)];case 1:return d=c.sent(),d!=null&&d.prevented?[2]:d!=null&&d.pendingPromise.length?[4,d.allDone()]:[3,3];case 2:c.sent(),c.label=3;case 3:return r.updateMessage(),n(e),[2]}})})},i.prototype.handleActionSensor=function(t){var e=this,o=this.props.store,n=o.busying;o.markBusying(!0),o.updateMessage(),t.then(function(){o.markBusying(n)}).catch(function(r){e.isDead||(o.updateMessage(r.message,!0),o.markBusying(n))})},i.prototype.handleAction=function(t,e,o){var n=this.props,r=n.store,a=n.onAction;e.type==="reset"?r.reset():e.actionType==="cancel"?this.handleSelfClose():a&&a(t,e,o)},i.prototype.handleDialogConfirm=function(t,e){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];var r=this.props.store;e.mergeData&&t.length===1&&t[0]&&r.updateData(t[0]);var a=r.action.dialog;a&&a.onConfirm&&a.onConfirm.apply(a,(0,s.ev)([t,e],(0,s.CR)(o),!1))===!1||r.closeDialog(!0,t)},i.prototype.handleDialogClose=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=this.props.store,n=o.action,r=n.dialog;r.onClose&&r.onClose.apply(r,(0,s.ev)([],(0,s.CR)(t),!1))===!1||o.closeDialog(t[1])},i.prototype.handleDrawerConfirm=function(t,e){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];var r=this.props.store;e.mergeData&&t.length===1&&t[0]&&r.updateData(t[0]);var a=r.action.drawer;a&&a.onConfirm&&a.onConfirm.apply(a,(0,s.ev)([t,e],(0,s.CR)(o),!1))===!1||r.closeDrawer(!0,t)},i.prototype.handleDrawerClose=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=this.props.store,n=o.action,r=n.drawer;r.onClose&&r.onClose.apply(r,(0,s.ev)([],(0,s.CR)(t),!1))===!1||o.closeDrawer.apply(o,(0,s.ev)([],(0,s.CR)(t),!1))},i.prototype.handleEntered=function(){var t=this.props,e=t.lazySchema,o=t.store;o.setEntered(!0),o.markBusying(!1),typeof e=="function"&&o.setSchema(e(this.props));var n=document.activeElement;if(n){var r=(0,F.findDOMNode)(this);r&&!r.contains(n)&&n.blur()}},i.prototype.handleExited=function(){var t=this.props,e=t.lazySchema,o=t.store,n=t.statusStore;n&&(0,k.fh)(n)&&n.resetAll(),(0,k.fh)(o)&&(o.reset(),o.clearMessage(),o.markBusying(!1),o.setEntered(!1),typeof e=="function"&&o.setSchema(""))},i.prototype.handleFormInit=function(t){var e=this.props.store;e.setFormData(t)},i.prototype.handleFormChange=function(t,e){var o=this.props.store;if(typeof e=="string"){o.changeValue(e,t);return}o.setFormData(t)},i.prototype.handleFormSaved=function(t,e){var o=this.props.store;o.setFormData((0,s.pi)((0,s.pi)({},t),e))},i.prototype.handleChildFinished=function(t,e){},i.prototype.openFeedback=function(t,e){var o=this;return new Promise(function(n){var r=o.props.store;r.setCurrentAction({type:"button",actionType:"dialog",dialog:t},o.props.resolveDefinitions),r.openDialog(e,void 0,function(a){n(a)},o.context)})},i.prototype.getPopOverContainer=function(){return(0,F.findDOMNode)(this).querySelector(".".concat(this.props.classPrefix,"Modal-content"))},i.prototype.renderBody=function(t,e){var o=this,n=this.props,r=n.render,a=n.store;if(Array.isArray(t))return t.map(function(l,u){return o.renderBody(l,u)});var d={key:e,disabled:t&&t.disabled||a.loading,onAction:this.handleAction,onFinished:this.handleChildFinished,popOverContainer:this.getPopOverContainer,onChange:this.handleFormChange,onInit:this.handleFormInit,onSaved:this.handleFormSaved,onActionSensor:this.handleActionSensor,btnDisabled:a.loading,syncLocation:!1};if(!t.type)return r("body".concat(e?"/".concat(e):""),t,d);var c=t;return c.type==="form"&&(c=(0,s.pi)({mode:"horizontal",wrapWithPanel:!1,submitText:null},c)),r("body".concat(e?"/".concat(e):""),c,d)},i.prototype.renderFooter=function(){var t=this,e=this.buildActions(),o=this.props.hideActions;if(!e||!e.length||o)return null;var n=this.props,r=n.store,a=n.render,d=n.env,c=n.classnames,l=n.showErrorMsg,u=n.showLoading,h=n.show,g=n.dialogFooterClassName;return m().createElement("div",{className:c("Modal-footer",g)},u!==!1&&r.loading||l!==!1&&r.error?m().createElement("div",{className:c("Dialog-info"),key:"info"},u!==!1?m().createElement(N.$jN,{size:"sm",key:"info",show:r.loading}):null,!d.forceSilenceInsideError&&r.error&&l!==!1?m().createElement("span",{className:c("Dialog-error")},r.msg):null):null,e.map(function(p,E){return a("action/".concat(E),p,{data:r.formData,onAction:t.handleAction,onActionSensor:void 0,btnDisabled:r.loading,key:E,disabled:p.disabled||r.loading||!h})}))},i.prototype.render=function(){var t=this.props.store,e=(0,s.pi)((0,s.pi)({},this.props),t.schema),o=e.className,n=e.style,r=e.size,a=e.height,d=e.width,c=e.closeOnEsc,l=e.closeOnOutside,u=e.title,h=e.render,g=e.header,p=e.body,E=e.bodyClassName,x=e.headerClassName,T=e.show,b=e.lazyRender,B=e.lazySchema,P=e.wrapperComponent,C=e.showCloseButton,y=e.env,v=e.classnames,S=e.classPrefix,D=e.translate,W=e.loadingConfig,U=e.overlay,$=e.dialogType,G=e.cancelText,H=e.confirmText,K=e.confirmBtnLevel,j=e.cancelBtnLevel,V=e.popOverContainer,Y=e.inDesign,A=e.themeCss,M=e.id,Q=(0,s._T)(e,["className","style","size","height","width","closeOnEsc","closeOnOutside","title","render","header","body","bodyClassName","headerClassName","show","lazyRender","lazySchema","wrapperComponent","showCloseButton","env","classnames","classPrefix","translate","loadingConfig","overlay","dialogType","cancelText","confirmText","confirmBtnLevel","cancelBtnLevel","popOverContainer","inDesign","themeCss","id"]),J=P||N.u_l;return m().createElement(J,(0,s.pi)({},Q,{classPrefix:S,className:v(o),style:n,size:r,height:a,width:d,modalClassName:(0,f.GwQ)((0,s.pi)((0,s.pi)({},this.props),{name:"dialogClassName",id:M,themeCss:A})),modalMaskClassName:(0,f.GwQ)((0,s.pi)((0,s.pi)({},this.props),{name:"dialogMaskClassName",id:M,themeCss:A})),backdrop:"static",onHide:this.handleSelfClose,keyboard:c&&!t.loading,closeOnEsc:c,closeOnOutside:!t.dialogOpen&&l,show:T,onEntered:this.handleEntered,onExited:this.handleExited,container:y==null?void 0:y.getModalContainer,enforceFocus:!1,disabled:t.loading,overlay:U,dialogType:$,cancelText:G,confirmText:H,confirmBtnLevel:K,cancelBtnLevel:j}),u&&typeof u=="string"?m().createElement("div",{className:v("Modal-header",x,(0,f.GwQ)((0,s.pi)((0,s.pi)({},this.props),{name:"dialogHeaderClassName",id:M,themeCss:A})))},C!==!1&&!t.loading?m().createElement("a",{"data-tooltip":D("Dialog.close"),"data-position":"left",onClick:this.handleSelfClose,className:v("Modal-close")},m().createElement(N.JO$,{icon:"close",className:"icon",iconContent:"Dialog-close"})):null,m().createElement("div",{className:v("Modal-title",(0,f.GwQ)((0,s.pi)((0,s.pi)({},this.props),{name:"dialogTitleClassName",id:M,themeCss:A})))},(0,f.hXT)(D(u),t.formData))):u?m().createElement("div",{className:v("Modal-header",x,(0,f.GwQ)((0,s.pi)((0,s.pi)({},this.props),{name:"dialogHeaderClassName",id:M,themeCss:A})))},C!==!1&&!t.loading?m().createElement("a",{"data-tooltip":D("Dialog.close"),onClick:this.handleSelfClose,className:v("Modal-close")},m().createElement(N.JO$,{icon:"close",className:"icon",iconContent:"Dialog-close"})):null,h("title",u,{data:t.formData,onAction:this.handleAction,onActionSensor:void 0,btnDisabled:t.loading})):C!==!1&&!t.loading?m().createElement("a",{"data-tooltip":D("Dialog.close"),onClick:this.handleSelfClose,className:v("Modal-close")},m().createElement(N.JO$,{icon:"close",className:"icon",iconContent:"Dialog-close"})):null,g?h("header",g,{data:t.formData,onAction:this.handleAction,onActionSensor:void 0,btnDisabled:t.loading}):null,!t.entered&&b||B&&!p?m().createElement("div",{className:v("Modal-body",E,(0,f.GwQ)((0,s.pi)((0,s.pi)({},this.props),{name:"dialogBodyClassName",id:M,themeCss:A}))),role:"dialog-body"},m().createElement(N.$jN,{overlay:!0,show:!0,size:"lg",loadingConfig:W})):p?m().createElement("div",{className:v("Modal-body",E,(0,f.GwQ)((0,s.pi)((0,s.pi)({},this.props),{name:"dialogBodyClassName",id:M,themeCss:A}))),role:"dialog-body"},this.renderBody(p,"body"),m().createElement(f.cWM,(0,s.pi)({},this.props,{config:{themeCss:A,classNames:[{key:"dialogClassName"},{key:"dialogMaskClassName"},{key:"dialogHeaderClassName"},{key:"dialogTitleClassName"},{key:"dialogBodyClassName"},{key:"dialogFooterClassName"}],id:M},env:y}))):null,p?this.renderFooter():null,p?h("drawer",(0,s.pi)((0,s.pi)({},t.action&&t.action.drawer),{type:"drawer"}),{key:"drawer",data:t.drawerData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,show:t.drawerOpen,onAction:this.handleAction}):null,p?h("dialog",(0,s.pi)((0,s.pi)({},t.action&&t.action.dialog),{type:"dialog"}),{key:"dialog",data:t.dialogData,onConfirm:this.handleDialogConfirm,onClose:this.handleDialogClose,show:t.dialogOpen,onAction:this.handleAction}):null)},i.propsList=["title","size","closeOnEsc","closeOnOutside","children","bodyClassName","headerClassName","confirm","onClose","onConfirm","show","body","showCloseButton","showErrorMsg","actions","popOverContainer","overlay","draggable"],i.defaultProps={title:"Dialog.title",bodyClassName:"",confirm:!0,show:!1,lazyRender:!1,showCloseButton:!0,wrapperComponent:N.u_l,closeOnEsc:!1,closeOnOutside:!1,showErrorMsg:!0},(0,s.gn)([f.NjZ,(0,s.w6)("design:type",Function),(0,s.w6)("design:paramtypes",[]),(0,s.w6)("design:returntype",void 0)],i.prototype,"getPopOverContainer",null),i}(m().Component),I=function(O){(0,s.ZT)(i,O);function i(t,e){var o=O.call(this,t)||this,n=e;return n.registerComponent(o),o}return i.prototype.componentWillUnmount=function(){var t=this.context;t.unRegisterComponent(this),O.prototype.componentWillUnmount.call(this),clearTimeout(this.clearErrorTimer)},i.prototype.tryChildrenToHandle=function(t,e,o){var n=this,r=this.context,a=[],d=this.props,c=d.onConfirm,l=d.store;if(t.target&&a.push.apply(a,(0,s.ev)([],(0,s.CR)(t.target.split(",").map(function(p){return r.getComponentByName(p)}).filter(function(p){return p&&p.doAction})),!1)),(t==null?void 0:t.isolateScope)!==!0&&!a.length)for(var u=r.getComponents().filter(function(p){return!~["drawer","dialog"].indexOf(p.props.type)}),h=u.concat();h.length;){var g=h.pop();if(~["crud","form","wizard"].indexOf(g.props.type)){a.push(g);break}else{if(~["drawer","dialog"].indexOf(g.props.type))continue;~["page","service"].indexOf(g.props.type)&&h.unshift.apply(h,g.context.getComponents())}}return a.length?(l.markBusying(!0),l.updateMessage(),Promise.all(a.map(function(p){return p.doAction((0,s.pi)((0,s.pi)({},t),{from:n.$$id}),e,!0)})).then(function(p){(t.type==="submit"||t.actionType==="submit"||t.actionType==="confirm")&&t.close!==!1&&!a.some(function(E){return E.props.closeDialogOnSubmit===!1})?c&&c(p,o||t,e,a):t.close&&(t.close===!0?n.handleSelfClose():n.closeTarget(t.close)),l.markBusying(!1)}).catch(function(p){n.isDead||(l.updateMessage(p.message,!0),l.markBusying(!1),clearTimeout(n.clearErrorTimer),n.clearErrorTimer=setTimeout(function(){n.isDead||l.updateMessage("")},3e3))}),!0):!1},i.prototype.doAction=function(t,e,o){this.handleAction(void 0,t,e)},i.prototype.handleAction=function(t,e,o,n,r,a){return n===void 0&&(n=!1),(0,s.mG)(this,void 0,void 0,function(){var d,c,l,u,h,g,p,E,x,T,b,B,P=this;return(0,s.Jh)(this,function(C){switch(C.label){case 0:return d=this.props,c=d.onAction,l=d.store,u=d.onConfirm,h=d.env,g=d.dispatchEvent,p=d.onClose,E=d.show,e.from===this.$$id||!E?[2,c?c(t,e,o,n,r||this.context):!1]:a!=null&&a.pendingPromise.length?[4,a.allDone()]:[3,2];case 1:C.sent(),C.label=2;case 2:return x=this.context,e.type!=="reset"?[3,3]:(l.setCurrentAction(e,this.props.resolveDefinitions),l.reset(),[3,19]);case 3:return e.actionType==="close"||e.actionType==="cancel"?[4,g("cancel",(0,f.nW9)(this.props.data,o))]:[3,7];case 4:return T=C.sent(),T!=null&&T.prevented?[2]:T!=null&&T.pendingPromise.length?[4,T.allDone()]:[3,6];case 5:C.sent(),C.label=6;case 6:return l.setCurrentAction(e,this.props.resolveDefinitions),l.updateMessage(),p(),e.close&&(e.close===!0?this.handleSelfClose():this.closeTarget(e.close)),[3,19];case 7:return e.actionType!=="confirm"?[3,11]:[4,g("confirm",(0,f.nW9)(this.props.data,o))];case 8:return b=C.sent(),b!=null&&b.prevented?[2]:b!=null&&b.pendingPromise.length?[4,b.allDone()]:[3,10];case 9:C.sent(),C.label=10;case 10:return l.setCurrentAction(e,this.props.resolveDefinitions),B=this.tryChildrenToHandle((0,s.pi)((0,s.pi)({},e),{actionType:"submit"}),o,e),B||(l.updateMessage(),e.close!==!1&&p(!0)),[3,19];case 11:return e.actionType==="next"||e.actionType==="prev"?(l.setCurrentAction(e,this.props.resolveDefinitions),e.type==="submit"?this.tryChildrenToHandle((0,s.pi)((0,s.pi)({},e),{actionType:"submit",close:!0}),o,e)||this.handleSelfClose(void 0,!0):u([o],e,o,[]),[3,19]):[3,12];case 12:return e.actionType!=="dialog"?[3,13]:(l.setCurrentAction(e,this.props.resolveDefinitions),[2,new Promise(function(y){l.openDialog(o,void 0,function(v,S){var D;(D=e.callback)===null||D===void 0||D.call(e,v,S),y({confirmed:v,value:S})},r||P.context)})]);case 13:return e.actionType!=="drawer"?[3,14]:(l.setCurrentAction(e,this.props.resolveDefinitions),[2,new Promise(function(y){l.openDrawer(o,void 0,function(v,S){var D;(D=e.callback)===null||D===void 0||D.call(e,v,S),y({confirmed:v,value:S})})})]);case 14:return e.actionType!=="reload"?[3,15]:(l.setCurrentAction(e,this.props.resolveDefinitions),e.target&&x.reload(e.target,o),(e.close||e.type==="submit")&&(this.handleSelfClose(void 0,e.type==="submit"),e.close&&typeof e.close=="string"&&this.closeTarget(e.close)),[3,19]);case 15:return!e.from&&this.tryChildrenToHandle(e,o)?[3,19]:[3,16];case 16:return e.actionType!=="ajax"?[3,17]:(l.setCurrentAction(e,this.props.resolveDefinitions),[2,l.saveRemote(e.api,o,{successMessage:e.messages&&e.messages.success,errorMessage:e.messages&&e.messages.failed}).then(function(){return(0,s.mG)(P,void 0,void 0,function(){var y;return(0,s.Jh)(this,function(v){switch(v.label){case 0:return e.feedback&&(0,f.pn4)(e.feedback,l.data)?[4,this.openFeedback(e.feedback,l.data)]:[3,2];case 1:v.sent(),v.label=2;case 2:return y=e.redirect&&(0,f.hXT)(e.redirect,l.data),y&&h.jumpTo(y,e,l.data),e.reload&&this.reloadTarget((0,f.u22)(e.reload,l.data),l.data),e.close&&(e.close===!0?this.handleSelfClose():this.closeTarget(e.close)),[2]}})})}).catch(function(y){if(n||e.countDown)throw y})]);case 17:return c?[4,c(t,(0,s.pi)((0,s.pi)({},e),{close:!1}),o,n,r||this.context)]:[3,19];case 18:C.sent(),e.close&&(e.close===!0?this.handleSelfClose():this.closeTarget(e.close)),C.label=19;case 19:return[2]}})})},i.prototype.handleChildFinished=function(t,e){if(!(e&&e.from===this.$$id||e.close===!1)){var o=this.context,n=o.getComponents().filter(function(d){return!~["drawer","dialog","action","button","submit","reset"].indexOf(d.props.type)}),r=this.props.onConfirm,a=this.props.onClose;n.length===1&&(n[0].props.type==="form"||n[0].props.type==="wizard")&&(e.close===!0||n[0].props.closeDialogOnSubmit!==!1)?r&&r([t],e,{},n):e.close===!0&&a()}},i.prototype.handleDialogConfirm=function(t,e){for(var o,n,r=[],a=2;a<arguments.length;a++)r[a-2]=arguments[a];O.prototype.handleDialogConfirm.apply(this,(0,s.ev)([t,e],(0,s.CR)(r),!1));var d=this.props.store,c=d.getDialogScoped()||this.context,l=d.action,u=(o=e.reload)!==null&&o!==void 0?o:l.reload;u?c.reload(u,d.data):c.component!==this&&(!((n=c.component)===null||n===void 0)&&n.reload)?c.component.reload():this.context.getComponents().filter(function(h){return h.props.type==="crud"}).forEach(function(h){return h.reload&&h.reload()})},i.prototype.handleDrawerConfirm=function(t,e){for(var o=this,n,r=[],a=2;a<arguments.length;a++)r[a-2]=arguments[a];O.prototype.handleDrawerConfirm.call(this,t,e);var d=this.props.store,c=d.getDialogScoped()||this.context,l=d.action,u=(n=e.reload)!==null&&n!==void 0?n:l.reload;setTimeout(function(){var h;u?c.reload(u,d.data):c.component!==o&&(!((h=c.component)===null||h===void 0)&&h.reload)?c.component.reload():o.context.getComponents().filter(function(g){return g.props.type==="crud"}).forEach(function(g){return g.reload&&g.reload()})},300)},i.prototype.reloadTarget=function(t,e){var o=this.context;o.reload(t,e)},i.prototype.closeTarget=function(t){var e=this.context;e.close(t)},i.prototype.setData=function(t,e){return this.props.store.updateData(t,void 0,e)},i.prototype.getData=function(){var t=this.props.store;return t.data},i.contextType=f.ZHe,i=(0,s.gn)([(0,f.Thl)({type:"dialog",storeType:f.vqG.name,storeExtendsData:!1,isolateScope:!0,shouldSyncSuperStore:function(t,e,o){return!!((t.dialogOpen||e.show)&&(e.show!==o.show||(0,f.RjM)(o.data,e.data)))}}),(0,s.w6)("design:paramtypes",[Object,Object])],i),i}(z)}}]);
