"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[5530],{25530:function(w,O,d){d.r(O),d.d(O,{SubFormControlRenderer:function(){return J},default:function(){return M}});var a=d(15767),F=d(87363),l=d.n(F),f=d(42977),L=d(84875),B=d.n(L),R=d(59245),x=d.n(R),W=d(19334),U=d.n(W),y=d(94391),K=d(65861),N=d(61533),G=d.n(N),_,P=function(g){return g&&(_=_||document.createElement("div"),_.innerHTML=g,_.innerText)},M=function(g){(0,a.ZT)(o,g);function o(t){var e=g.call(this,t)||this;return e.state={},e.id=(0,f.M8z)(),e.addItem=e.addItem.bind(e),e.removeItem=e.removeItem.bind(e),e.editSingle=e.editSingle.bind(e),e.open=e.open.bind(e),e.close=e.close.bind(e),e.dragTipRef=e.dragTipRef.bind(e),e.handleDialogConfirm=e.handleDialogConfirm.bind(e),e}return o.prototype.addItem=function(){this.setState({dialogData:(0,f.nW9)(this.props.data,this.props.scaffold||{}),dialogCtx:{mode:"add"}})},o.prototype.removeItem=function(t){t.stopPropagation(),t.preventDefault();var e=parseInt(t.currentTarget.getAttribute("data-index"),10),r=this.props.value;Array.isArray(r)&&(r=r.concat(),r.splice(e,1),this.props.onChange(r))},o.prototype.editSingle=function(){var t=this.props.value;t?this.setState({dialogData:(0,f.nW9)(this.props.data,this.props.value),dialogCtx:{mode:"edit"}}):this.addItem()},o.prototype.open=function(t){var e=parseInt(t.currentTarget.getAttribute("data-index"),10),r=this.props.value;!Array.isArray(r)||!r[e]||(this.tempValue=r[e],this.setState({dialogData:(0,f.nW9)(this.props.data,r[e]),dialogCtx:{mode:"edit",index:e}}))},o.prototype.close=function(){this.setState({dialogData:void 0,dialogCtx:void 0})},o.prototype.handleDialogConfirm=function(t){var e=this.props,r=e.multiple,u=e.onChange,n=e.value,i=this.state.dialogCtx;if(r){var s=Array.isArray(n)?n.concat():[];(i==null?void 0:i.mode)==="add"?s.push((0,a.pi)({},t[0])):s[i.index]=(0,a.pi)((0,a.pi)({},s[i.index]),t[0]),u(s)}else u((0,a.pi)((0,a.pi)({},n),t[0]));this.close()},o.prototype.handlePopupConfirm=function(){var t=this.tempValue,e=this.props,r=e.multiple,u=e.onChange,n=e.value,i=this.state.dialogCtx;if(r){var s=Array.isArray(n)?n.concat():[];(i==null?void 0:i.mode)==="add"?s.push((0,a.pi)({},t)):s[i.index]=(0,a.pi)((0,a.pi)({},s[i.index]),t),u(s)}else u((0,a.pi)((0,a.pi)({},n),t));this.close()},o.prototype.dragTipRef=function(t){!this.dragTip&&t?this.initDragging():this.dragTip&&!t&&this.destroyDragging(),this.dragTip=t},o.prototype.initDragging=function(){var t=this,e=this.props.classPrefix,r=this.props.submitOnChange,u=(0,N.findDOMNode)(this);this.sortable=new K.ZP(u.querySelector(".".concat(e,"SubForm-values")),{group:"SubForm-".concat(this.id),animation:150,handle:".".concat(e,"SubForm-valueDragBar"),ghostClass:"".concat(e,"SubForm-value--dragging"),onEnd:function(n){if(n.newIndex!==n.oldIndex){var i=n.to;n.oldIndex<i.childNodes.length-1?i.insertBefore(n.item,i.childNodes[n.oldIndex>n.newIndex?n.oldIndex+1:n.oldIndex]):i.appendChild(n.item);var s=t.props.value;if(Array.isArray(s)){var p=s.concat();p.splice(n.newIndex,0,p.splice(n.oldIndex,1)[0]),t.props.onChange(p,r,!0)}}}})},o.prototype.destroyDragging=function(){this.sortable&&this.sortable.destroy()},o.prototype.buildDialogSchema=function(){var t=this.props.form,e=["title","actions","name","size","closeOnEsc","closeOnOutside","showErrorMsg","showCloseButton","bodyClassName","type"];return(0,a.pi)((0,a.pi)({},U()(t,e)),{type:"dialog",body:(0,a.pi)((0,a.pi)({type:"form",canAccessSuperData:!1},x()(t,e)),{inheritData:!1})})},o.prototype.buildFormSchema=function(){var t=this.props.form,e=["title","actions","name","size","closeOnEsc","closeOnOutside","showErrorMsg","showCloseButton","bodyClassName","type"];return(0,a.pi)((0,a.pi)({type:"form",canAccessSuperData:!1},x()(t,e)),{inheritData:!1})},o.prototype.renderMultipe=function(){var t=this,e=this.props,r=e.addButtonClassName,u=e.itemClassName,n=e.itemsClassName,i=e.disabled,s=e.maxLength,p=e.labelField,v=e.defaultLabel,m=e.value,b=e.btnLabel,C=e.render,E=e.data,c=e.translate,h=e.classnames,$=e.placeholder,A=e.draggable,z=e.draggableTip,Z=e.addable,j=e.removable,T=e.minLength,H=e.addButtonText,D=e.testIdBuilder;return l().createElement(l().Fragment,null,Array.isArray(m)&&m.length?l().createElement("div",{className:h("SubForm-values",n),key:"values"},m.map(function(S,I){return l().createElement("div",(0,a.pi)({className:h("SubForm-value",{"is-disabled":i},u),key:I},D==null?void 0:D.getChild("item-".concat(I)).getTestId()),A&&m.length>1?l().createElement("a",{className:h("SubForm-valueDragBar")},l().createElement(y.JO$,{icon:"drag-bar",className:h("icon")})):null,l().createElement("span",{className:h("SubForm-valueLabel")},b&&C("label",{type:"tpl",tpl:c(b)},{data:(0,f.nW9)(E,S)}),!b&&(S&&p&&S[p]&&P(S[p])||c(v))),l().createElement("a",{"data-index":I,onClick:t.open,className:h("SubForm-valueEdit")},l().createElement(y.JO$,{icon:"pencil",className:"icon"})),!i&&j!==!1&&(!T||m.length>T)?l().createElement("a",{"data-index":I,className:h("SubForm-valueDel"),onClick:t.removeItem},l().createElement(y.JO$,{icon:"close",className:"icon"})):null)})):l().createElement("div",{className:h("SubForm-placeholder"),key:"placeholder"},c($||"placeholder.empty")),l().createElement("div",{key:"toolbar",className:h("SubForm-toolbar")},Z!==!1?l().createElement("button",(0,a.pi)({type:"button",onClick:this.addItem,className:h("Button SubForm-addBtn",r),disabled:i||!!(s&&Array.isArray(m)&&m.length>=s)},D==null?void 0:D.getChild("add-button").getTestId()),l().createElement(y.JO$,{icon:"plus",className:"icon"}),l().createElement("span",null,c(H||"SubForm.add"))):null,A&&Array.isArray(m)&&m.length>1?l().createElement("span",{className:h("Combo-dragableTip"),ref:this.dragTipRef},Array.isArray(m)&&m.length>1?c(z):""):null))},o.prototype.renderSingle=function(){var t=this.props,e=t.classnames,r=t.itemsClassName,u=t.itemClassName,n=t.disabled,i=t.value,s=t.labelField,p=t.defaultLabel,v=t.btnLabel,m=t.render,b=t.data,C=t.translate,E=t.testIdBuilder,c=E==null?void 0:E.getChild("edit-single");return l().createElement("div",{className:e("SubForm-values",r),key:"values"},l().createElement("div",(0,a.pi)({className:e("SubForm-value",{"is-disabled":n},u),onClick:this.editSingle,"data-tooltip":C("SubForm.editDetail"),"data-position":"bottom"},c==null?void 0:c.getTestId()),l().createElement("span",{className:e("SubForm-valueLabel")},v&&m("label",{type:"tpl",tpl:C(v)},{data:(0,f.nW9)(b,i)}),!v&&(i&&s&&i[s]&&P(i[s])||C(p))),l().createElement("a",(0,a.pi)({className:e("SubForm-valueEdit")},c==null?void 0:c.getChild("icon").getTestId()),l().createElement(y.JO$,{icon:"pencil",className:"icon"}))))},o.prototype.render=function(){var t=this,e=this.props,r=e.multiple,u=e.classPrefix,n=e.className,i=e.style,s=e.render,p=e.mobileUI,v=e.env,m=e.popOverContainer,b=this.state.dialogData,C=this.state.dialogCtx;return l().createElement("div",{className:B()("".concat(u,"SubFormControl"),n)},r?this.renderMultipe():this.renderSingle(),p?l().createElement(y.N4A,{isShow:!!C,showConfirm:!0,onConfirm:this.handlePopupConfirm,onHide:this.close,container:p?v==null?void 0:v.getModalContainer:m||v.getModalContainer},l().createElement("div",{className:"flex-1 pl-10 pr-10"},s("form",this.buildFormSchema(),{data:b,formStore:void 0,wrapWithPanel:!1,onChange:function(E){t.tempValue=E}}))):s("modal",this.buildDialogSchema(),{show:!!C,onClose:this.close,onConfirm:this.handleDialogConfirm,data:b,formStore:void 0}))},o.defaultProps={minLength:0,maxLength:0,multiple:!1,btnClassName:"",addButtonClassName:"",itemClassName:"",labelField:"label",defaultLabel:"SubForm.button",placeholder:"placeholder.empty"},o.propsList=["form","formStore"],(0,a.gn)([f.NjZ,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[]),(0,a.w6)("design:returntype",void 0)],o.prototype,"handlePopupConfirm",null),o}(l().PureComponent),J=function(g){(0,a.ZT)(o,g);function o(){return g!==null&&g.apply(this,arguments)||this}return o=(0,a.gn)([(0,f.xJW)({type:"input-sub-form",sizeMutable:!1,strictMode:!1})],o),o}(M)}}]);
