"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[4599],{64599:function(F,_,c){c.r(_),c.d(_,{MappingField:function(){return E},MappingFieldRenderer:function(){return D},Store:function(){return g}});var f=c(15767),S=c(87363),h=c.n(S),i=c(42977),A=c(94391),y=c(6663),v,g=i.kDS.named("MappingStore").props({fetching:!1,errorMsg:"",valueField:"value",map:y.V5.frozen({})}).actions(function(o){var u=(0,y.ls)(function(e,a,t){var r,n,s;return(0,f.Jh)(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,3,4]),o.fetching=!0,[4,e.fetcher(a,t)];case 1:if(r=l.sent(),r.ok)n=(0,i.Mpd)(r.data),o.setMap(Array.isArray(n.options)?n.options:Array.isArray(n.items)?n.items:Array.isArray(n.records)?n.records:n);else throw new Error(r.msg||"fetch error");return[3,4];case 2:return s=l.sent(),o.errorMsg=s.message,[3,4];case 3:return o.fetching=!1,[7];case 4:return[2]}})});return{load:u,setMap:function(e){Array.isArray(e)&&(e=e.reduce(function(a,t){if(t==null)return a;if((0,i.Kn2)(t)){var r=Object.keys(t);r.length===1||r.length==2&&r.includes("$$id")?(r=r.filter(function(n){return n!=="$$id"}),a[r[0]]=t[r[0]]):r.length>1&&(a[t[o.valueField]]=t)}return a},{})),(0,i.Kn2)(e)&&(o.map=(0,f.pi)({},e))}}}),E=(0,A.JtN)(function(o){return g.create({id:(0,i.M8z)(),storeType:g.name},o.env)})((v=function(o){(0,f.ZT)(u,o);function u(e){var a=o.call(this,e)||this;return e.store.syncProps(e,void 0,["valueField","map"]),a}return u.prototype.componentDidMount=function(){this.reload()},u.prototype.componentDidUpdate=function(e){var a=this.props,t=this.props,r=t.store,n=t.source,s=t.data;if(r.syncProps(a,e,n?["valueField"]:["valueField","map"]),(0,i.SSQ)(n)){var l=(0,i.OgC)(e.source,e.data,"| raw"),p=(0,i.OgC)(n,s,"| raw");l!==p&&r.setMap(p)}else(0,i.rMT)(e.source,a.source,e.data,a.data)&&this.reload()},u.prototype.reload=function(){var e,a=this.props,t=a.source,r=a.data,n=a.env,s=this.props.store;if((0,i.SSQ)(t))s.setMap((0,i.OgC)(t,r,"| raw"));else if((0,i.X1t)(t,r)){var l=(0,i._6r)(t,"get");l.cache=(e=l.cache)!==null&&e!==void 0?e:30*1e3,s.load(n,l,r)}},u.prototype.renderSingleValue=function(e,a,t){var r,n=this.props,s=n.className,l=n.style,p=n.placeholder,M=n.classnames,d=n.store,V=h().createElement("span",{className:"text-muted"},p),m=d.map,O=void 0;e=typeof e=="string"?e.trim():e;var C=t?l:void 0;return typeof e!="undefined"&&m&&(O=(r=this.renderValue(m,e))!==null&&r!==void 0?r:e===!0&&m[1]?m[1]:e===!1&&m[0]?m[0]:m["*"])!==void 0&&(V=this.renderViewValue(O,e)),h().createElement("span",{key:"map-".concat(a),className:M("MappingField",s),style:C},V)},u.prototype.renderViewValue=function(e,a){var t=this.props,r=t.render,n=t.itemSchema,s=t.renderViewValue,l=t.data,p=t.labelField,M=t.name;if(s)return s(e,a);if(!n){var d=e;return(0,i.Kn2)(e)&&(p===void 0||p===""?e.hasOwnProperty("type")?d=(0,f.pi)({name:M},d):d=e.label:d=e[p||"label"]),(0,i.Kn2)(d)&&d.type==="tag"&&!(0,i.Kn2)(d.label)&&d.label!=null?r("mapping-tag",d,{value:null}):r("tpl",d)}return r("mappingItemSchema",n,(0,f.pi)({data:(0,i.nW9)(l,(0,i.Kn2)(e)?e:{item:e})},(n==null?void 0:n.type)==="tag"?{value:null}:{}))},u.prototype.renderValue=function(e,a){var t=this.props.renderValue;return t?t(e,a):e[a]},u.prototype.render=function(){var e=this,a=this.props,t=a.style,r=a.defaultValue,n=a.data,s=(0,i.v8S)(this.props);return r&&(0,i.SSQ)(r)&&r===s&&(s=(0,i.OgC)(r,n,"| raw")),Array.isArray(s)?h().createElement("span",{style:t},s.map(function(l,p){return e.renderSingleValue(l,p)})):this.renderSingleValue(s,0,!0)},u}(h().Component),v.defaultProps={placeholder:"-",map:{"*":"\u901A\u914D\u503C"}},v)),D=function(o){(0,f.ZT)(u,o);function u(){return o!==null&&o.apply(this,arguments)||this}return u.prototype.render=function(){return h().createElement(E,(0,f.pi)({},this.props))},u=(0,f.gn)([(0,i.Thl)({type:"mapping",alias:["map"],name:"mapping"})],u),u}(h().Component)}}]);
