"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[3352],{94261:function(Ve,j,p){p.r(j),p.d(j,{TreeControlRenderer:function(){return ee},default:function(){return U}});var n=p(15767),G=p(87363),f=p.n(G),J=p(59245),Q=p.n(J),X=p(66292),$=p.n(X),z=p(84875),R=p.n(z),M=p(8427),L=p(94391),Y=p(79911),l=p(42977),q=p(45581),U=function(w){(0,n.ZT)(a,w);function a(e){var t=this,i;return t=w.call(this,e)||this,t.rootRef=f().createRef(),t.state={keyword:"",filteredOptions:(i=t.props.options)!==null&&i!==void 0?i:[],allowSearch:!1,virtualListHeight:0,treeHeight:0},t.handleSearch=$()(t.handleSearch.bind(t),250,{trailing:!0,leading:!1}),t}return a.prototype.componentDidMount=function(){var e=this,t,i=(t=this.rootRef.current)===null||t===void 0?void 0:t.parentElement;this.handleHeight(),this.unSensor=(0,l.Adl)(i,function(){e.handleHeight()},!1,"height")},a.prototype.handleHeight=function(){var e;if(this.props.heightAuto)this.setState({treeHeight:0});else{var t=(e=this.rootRef.current)===null||e===void 0?void 0:e.parentElement,i=this.treeRef.root.current,o=t.offsetHeight-(0,l.Tf8)(t,i);this.setState({treeHeight:o})}},a.prototype.componentDidUpdate=function(e){var t=this.props,i=this.state.keyword;if(e.options!==t.options||e.searchable!==t.searchable){var o=t.options,r=t.searchable;this.setState({filteredOptions:r&&i?this.filterOptions(o,i):o})}(0,l.aGv)(["label","searchable","creatable","hideRoot","themeCss","wrapperCustomStyle","heightAuto"],e,t)&&this.handleHeight()},a.prototype.componentWillUnmount=function(){this.unSensor&&(this.unSensor(),delete this.unSensor)},a.prototype.reload=function(e,t){var i=this.props.reloadOptions;i&&i(e,t)},a.prototype.doAction=function(e,t,i){var o,r,d,s,h,u,c,m,v,_,y,O=e==null?void 0:e.actionType,C=this.props,b=C.resetValue,g=C.onChange,E=C.formStore,F=C.store,T=C.name;if(O==="clear")g==null||g("");else if(O==="reset"){var A=(r=(0,l.E04)((o=E==null?void 0:E.pristine)!==null&&o!==void 0?o:F==null?void 0:F.pristine,T))!==null&&r!==void 0?r:b;g==null||g(A!=null?A:"")}else e.actionType==="expand"?this.treeRef.syncUnFolded(this.props,(d=e.args)===null||d===void 0?void 0:d.openLevel):e.actionType==="collapse"?this.treeRef.syncUnFolded(this.props,((s=e.args)===null||s===void 0?void 0:s.closeLevel)||0):e.actionType==="add"?this.addItemFromAction((h=e.args)===null||h===void 0?void 0:h.item,(u=e.args)===null||u===void 0?void 0:u.parentValue):e.actionType==="edit"?this.editItemFromAction((c=e.args)===null||c===void 0?void 0:c.item,(m=e.args)===null||m===void 0?void 0:m.originValue):e.actionType==="delete"?this.deleteItemFromAction((v=e.args)===null||v===void 0?void 0:v.value):e.actionType==="reload"?this.reload():O==="search"&&(this.setState({allowSearch:!!(!((_=e.args)===null||_===void 0)&&_.keyword)}),this.handleSearch((y=e.args)===null||y===void 0?void 0:y.keyword))},a.prototype.resolveOption=function(e,t){var i=this;return(0,l.hEs)(e,function(o){var r=i.props.valueField||"value",d=(0,l.rIu)(o,r)?o[r]:"";return d===t})},a.prototype.addItemFromAction=function(e,t){var i=this.props,o=i.onAdd,r=i.options,d=i.valueField,s=(0,l.L$8)(r,function(h){var u=d||"value",c=(0,l.rIu)(h,u)?h[u]:"";return c===t})||[];o&&o(s.concat(0),e,!0)},a.prototype.editItemFromAction=function(e,t){var i=this.props,o=i.onEdit,r=i.options,d=this.resolveOption(r,t);o&&d&&o((0,n.pi)((0,n.pi)({},e),{originValue:t}),d,!0)},a.prototype.deleteItemFromAction=function(e){var t=this.props,i=t.onDelete,o=t.options,r=this.resolveOption(o,e);i&&r&&i(r)},a.prototype.filterOptions=function(e,t){var i=this,o=this.props,r=o.labelField,d=o.valueField;return e.map(function(s){if(s=(0,n.pi)({},s),s.visible=!!(0,M.Lu)([s],t,{keys:[r||"label",d||"value"],threshold:M.Lu.rankings.CONTAINS}).length,!s.visible&&s.children){s.children=i.filterOptions(s.children,t);var h=s.children.filter(function(u){return u.visible}).length;s.visible=!!h}return s.visible&&(s.collapsed=!1),s})},a.prototype.handleChange=function(e){return(0,n.mG)(this,void 0,void 0,function(){var t,i,o,r,d,s,h,u,c,m,v,_,y,O,C,b,g,E;return(0,n.Jh)(this,function(F){switch(F.label){case 0:return t=this.props,i=t.onChange,o=t.searchable,r=t.options,d=t.dispatchEvent,s=t.multiple,h=t.delimiter,u=t.valueField,c=t.selectedOptions,m=t.joinValues,v=t.extractValue,_=this.state,y=_.filteredOptions,O=_.allowSearch,C=o||O?y:r,b=(0,Y.G0)(e,{multiple:s,delimiter:h,valueField:u,options:y}),g=s?null:b[0],s&&(o||O)&&c.length&&(c.forEach(function(T){var A=(0,l.hEs)(y,function(N){return N[u||"value"]===T[u||"value"]});A||b.push(T)}),e=b.map(function(T){return v||m?T[u||"value"]:T}),m&&(e=e.join(h||","))),[4,d("change",(0,l.vXk)(this.props,{value:e,item:g,items:C,selectedItems:b}))];case 1:return E=F.sent(),E!=null&&E.prevented?[2]:(i&&i(e),[2])}})})},a.prototype.handleNodeClick=function(e){return(0,n.mG)(this,void 0,void 0,function(){var t,i,o,r;return(0,n.Jh)(this,function(d){switch(d.label){case 0:return t=this.props,i=t.dispatchEvent,o=t.data,[4,i("itemClick",(0,l.nW9)(o,{item:e}))];case 1:return r=d.sent(),r!=null&&r.prevented?[2]:[2]}})})},a.prototype.handleSearch=function(e){return(0,n.mG)(this,void 0,void 0,function(){var t,i,o,r,d,s,h,u,c,m;return(0,n.Jh)(this,function(v){switch(v.label){case 0:if(t=this.props,i=t.searchApi,o=t.options,r=t.env,d=t.data,s=t.translate,h=[],!(0,l.X1t)(i))return[3,5];v.label=1;case 1:return v.trys.push([1,3,,4]),[4,r.fetcher(i,(0,l.nW9)(d,{term:e}))];case 2:if(u=v.sent(),!u.ok)throw new Error(s(u.msg||"networkError"));if(c=u.data.options||u.data.items||u.data,!Array.isArray(c))throw new Error(s("Tree.invalidArray"));return h=c,[3,4];case 3:return m=v.sent(),r.isCancel(m)||!i.silent&&r.notify("error",m.message),[3,4];case 4:return[3,6];case 5:e&&(h=this.filterOptions(o,e)),v.label=6;case 6:return this.setState({keyword:e,filteredOptions:e?h:o}),[2]}})})},a.prototype.domRef=function(e){this.treeRef=e},a.prototype.validate=function(){var e=this.props,t=e.value,i=e.minLength,o=e.maxLength,r=e.delimiter,d=Array.isArray(t)?t:(t?String(t):"").split(r||",");if(i&&d.length<i)return"\u5DF2\u9009\u62E9\u6570\u91CF\u4F4E\u4E8E\u8BBE\u5B9A\u7684\u6700\u5C0F\u4E2A\u6570".concat(i,"\uFF0C\u8BF7\u9009\u62E9\u66F4\u591A\u7684\u9009\u9879\u3002");if(o&&d.length>o)return"\u5DF2\u9009\u62E9\u6570\u91CF\u8D85\u51FA\u8BBE\u5B9A\u7684\u6700\u5927\u4E2A\u6570".concat(o,"\uFF0C\u8BF7\u53D6\u6D88\u9009\u62E9\u8D85\u51FA\u7684\u9009\u9879\u3002")},a.prototype.renderOptionItem=function(e,t){var i=this.props,o=i.menuTpl,r=i.render,d=i.data;return r("option/".concat(t.index),o,{data:(0,l.nW9)((0,l.nW9)(d,(0,n.pi)({},t)),e)})},a.prototype.renderItemActions=function(e,t){var i=this.props,o=i.itemActions,r=i.data,d=i.render;return d("action/".concat(t.index),o||"",{data:(0,l.nW9)((0,l.nW9)(r,(0,n.pi)({},t)),e)})},a.prototype.renderSearch=function(){var e=this.props,t=e.classPrefix,i=e.searchConfig,o=e.mobileUI,r=e.testIdBuilder;return f().createElement(L.Rj2,(0,n.pi)({className:R()("".concat(t,"TreeControl-searchbox"),i==null?void 0:i.className,{"is-sticky":i==null?void 0:i.sticky}),mini:!1,clearable:!0},Q()(i,"className","sticky"),{onSearch:this.handleSearch,mobileUI:o,testIdBuilder:r==null?void 0:r.getChild("search")}))},a.prototype.render=function(){var e=this.props,t=e.className,i=e.treeContainerClassName,o=e.classPrefix,r=e.value,d=e.enableNodePath,s=e.pathSeparator,h=s===void 0?"/":s,u=e.disabled,c=e.joinValues,m=e.extractValue,v=e.delimiter,_=e.placeholder,y=e.options,O=e.multiple,C=e.valueField,b=e.initiallyOpen,g=e.unfoldedLevel,E=e.withChildren,F=e.onlyChildren,T=e.onlyLeaf,A=e.loading,N=e.hideRoot,te=e.rootLabel,ie=e.autoCheckChildren,ne=e.autoCancelParent,oe=e.cascade,re=e.rootValue,ae=e.showIcon,le=e.showRadio,se=e.showOutline,de=e.onAdd,ue=e.creatable,he=e.createTip,pe=e.addControls,ce=e.onEdit,ve=e.editable,me=e.editTip,fe=e.editControls,ge=e.removable,ye=e.removeTip,Ce=e.onDelete,Ee=e.rootCreatable,_e=e.rootCreateTip,Oe=e.labelField,be=e.iconField,Te=e.deferField,Fe=e.nodePath,Ae=e.deferLoad,we=e.expandTreeOptions,x=e.translate,Ie=e.data,De=e.virtualThreshold,W=e.itemHeight,Pe=e.loadingConfig,Se=e.menuTpl,Re=e.enableDefaultIcon,D=e.searchable,H=e.searchConfig,B=H===void 0?{}:H,Le=e.heightAuto,Ne=e.mobileUI,I=e.testIdBuilder,Be=e.nodeBehavior,je=e.itemActions,V=e.id,Me=e.wrapperCustomStyle,K=e.themeCss,Ue=e.env,P=this.props.highlightTxt,S=this.state,xe=S.filteredOptions,We=S.keyword,k=S.allowSearch,He=S.treeHeight;(0,l.SSQ)(P)&&(P=(0,l.OgC)(P,Ie));var Z=f().createElement(L.mpN,{classPrefix:o,onRef:this.domRef,labelField:Oe,valueField:C,iconField:be,deferField:Te,disabled:u,onChange:this.handleChange,onHandleNodeClick:this.handleNodeClick,joinValues:c,extractValue:m,delimiter:v,placeholder:x(_),options:D||k?xe:y,highlightTxt:D||k?We:P,multiple:O,initiallyOpen:b,unfoldedLevel:g,withChildren:E,onlyChildren:F,onlyLeaf:T,hideRoot:N,rootLabel:x(te),rootValue:re,showIcon:ae,showRadio:le,showOutline:se,autoCheckChildren:ie,autoCancelParent:ne,cascade:oe,foldedField:"collapsed",value:r||"",nodePath:Fe,enableNodePath:d,pathSeparator:h,selfDisabledAffectChildren:!1,onAdd:de,creatable:ue,createTip:he,rootCreatable:Ee,rootCreateTip:_e,onEdit:ce,editable:ve,editTip:me,removable:ge,removeTip:ye,onDelete:Ce,bultinCUD:!pe&&!fe,onDeferLoad:Ae,onExpandTree:we,virtualThreshold:De,height:He,itemHeight:(0,l.He2)(W)>0?(0,l.He2)(W):void 0,itemRender:Se?this.renderOptionItem:void 0,enableDefaultIcon:Re,mobileUI:Ne,nodeBehavior:Be,itemActionsRender:je?this.renderItemActions:void 0,actionClassName:R()((0,l.GwQ)((0,n.pi)((0,n.pi)({},this.props),{name:"actionControlClassName",id:V,themeCss:K}))),testIdBuilder:I==null?void 0:I.getChild("tree")});return f().createElement(f().Fragment,null,f().createElement("div",(0,n.pi)({ref:this.rootRef,className:R()("".concat(o,"TreeControl"),t,i,{"is-sticky":D&&(B==null?void 0:B.sticky),"h-auto":Le})},I==null?void 0:I.getChild("control").getTestId()),f().createElement(L.$jN,{size:"sm",key:"info",show:A,loadingConfig:Pe}),A?null:D?f().createElement(f().Fragment,null,this.renderSearch(),Z):Z),f().createElement(l.cWM,(0,n.pi)({},this.props,{config:{wrapperCustomStyle:Me,id:V,themeCss:K,classNames:[{key:"actionControlClassName"}]},env:Ue})))},a.defaultProps={placeholder:"placeholder.noData",multiple:!1,rootLabel:"Tree.root",rootValue:"",showIcon:!0,enableNodePath:!1,pathSeparator:"/"},(0,n.gn)([l.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object,Object]),(0,n.w6)("design:returntype",void 0)],a.prototype,"addItemFromAction",null),(0,n.gn)([l.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object,Object]),(0,n.w6)("design:returntype",void 0)],a.prototype,"editItemFromAction",null),(0,n.gn)([l.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object]),(0,n.w6)("design:returntype",void 0)],a.prototype,"deleteItemFromAction",null),(0,n.gn)([l.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object]),(0,n.w6)("design:returntype",Promise)],a.prototype,"handleChange",null),(0,n.gn)([l.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object]),(0,n.w6)("design:returntype",Promise)],a.prototype,"handleNodeClick",null),(0,n.gn)([l.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object]),(0,n.w6)("design:returntype",void 0)],a.prototype,"domRef",null),(0,n.gn)([l.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object,Object]),(0,n.w6)("design:returntype",void 0)],a.prototype,"renderOptionItem",null),(0,n.gn)([l.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object,Object]),(0,n.w6)("design:returntype",void 0)],a.prototype,"renderItemActions",null),(0,n.gn)([l.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],a.prototype,"renderSearch",null),(0,n.gn)([(0,q.i)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],a.prototype,"render",null),a}(f().Component),ee=function(w){(0,n.ZT)(a,w);function a(){return w!==null&&w.apply(this,arguments)||this}return a=(0,n.gn)([(0,l.oZB)({type:"input-tree"})],a),a}(U)}}]);
