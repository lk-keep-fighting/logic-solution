"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[2262],{21893:function(Se,M,e){e.r(M);var H=e(54306),g=e.n(H),V=e(78686),y=e(48364),Y=e(47829),T=e(28635),k=e(79549),Q=e(72197),S=e(8051),X=e(54145),A=e(4283),P=e(36267),h=e(87363),b=e.n(h),w=e(98306),l=e(33130);function _(a,L){window.document.title=">["+(a==null?void 0:a.name)+"]\u5B9E\u4F8B:"+(L==null?void 0:L.bizId)}var q=function(){var L=(0,w.UO)(),I=L.id,ee=(0,h.useState)(),B=g()(ee,2),ne=B[0],te=B[1],oe=(0,h.useState)(""),D=g()(oe,2),n=D[0],ue=D[1],ie=(0,h.useState)(!1),F=g()(ie,2),re=F[0],u=F[1],O=(0,h.useState)([]),Z=g()(O,2),p=Z[0],N=Z[1],U=(0,h.useState)(),s=g()(U,2),t=s[0],W=s[1];return(0,h.useEffect)(function(){u(!0),I&&(0,y.m9)(I).then(function(x){if(x){var E=x;W(x),u(!0),(0,y.Uh)(x.logicId,x.version).then(function(C){var K=C.configJson,R=C.name;ue(R),te(K),_(K,E),u(!1)}).catch(function(C){u(!1),console.log("err"),console.log(C)})}})},[I]),(0,h.useEffect)(function(){t&&(0,y.gC)(t).then(function(x){x&&N(x)})},[t]),(0,l.jsx)("div",{children:(0,l.jsx)(Q.Z,{spinning:re,children:(0,l.jsx)(V.Z,{btns:[(0,l.jsx)(S.Z,{type:"vertical"}),(0,l.jsxs)(X.ZP,{type:"primary",onClick:function(){u(!0),(0,y.m9)(I).then(function(E){E&&(W(E),(0,y.gC)(E).then(function(C){C&&N(C),u(!1)})),u(!1)})},children:[(0,l.jsx)(Y.Z,{}),"\u5237\u65B0\u8BB0\u5F55"]}),(0,l.jsx)(S.Z,{type:"vertical"}),(0,l.jsxs)("span",{children:["\u662F\u5426\u5B8C\u6210\uFF1A",t!=null&&t.isOver?(0,l.jsx)(T.Z,{twoToneColor:"#52c41a"}):(0,l.jsx)(k.Z,{twoToneColor:"red"})]}),(0,l.jsx)(S.Z,{type:"vertical"}),(0,l.jsxs)("span",{children:["\u5F85\u6267\u884C\uFF1A",t==null?void 0:t.nextName]}),(0,l.jsx)(S.Z,{type:"vertical"}),(0,l.jsxs)(A.Z,{children:["\u4E1A\u52A1\u6807\u8BC6\uFF1A",t==null?void 0:t.bizId,(0,l.jsx)(P.Z.Text,{copyable:{tooltips:["\u590D\u5236\u6807\u8BC6","\u590D\u5236\u6210\u529F!"],text:t==null?void 0:t.bizId}})]}),(0,l.jsx)(S.Z,{type:"vertical"}),(0,l.jsx)(A.Z,{children:n}),(0,l.jsx)(P.Z.Text,{copyable:{tooltips:["\u590D\u5236\u7F16\u53F7","\u590D\u5236\u6210\u529F!"],text:t==null?void 0:t.logicId}}),(0,l.jsx)(S.Z,{type:"vertical"}),(0,l.jsx)("span",{style:{color:"red"},children:"\u6267\u884C\u7248\u672C\uFF1A"}),(0,l.jsxs)("span",{children:[t==null?void 0:t.version,(0,l.jsx)(P.Z.Text,{copyable:{tooltips:["\u590D\u5236\u7248\u672C\u53F7","\u590D\u5236\u6210\u529F!"],text:t==null?void 0:t.version}})]})],nextId:t==null?void 0:t.nextId,config:ne,logicIns:t,debugLogs:p})})})};M.default=q},78686:function(Se,M,e){e.d(M,{Z:function(){return F}});var H=e(54306),g=e.n(H),V=e(8049),y=e(14990),Y=e(22465),T=e(5671),k=e(17696),Q=e(19227),S=e(75476),X=e(1167),A=e(22150),P=e(4283),h=e(36267),b=e(23360),w=e(8051),l=e(87155),_=e(54145),q=e(91711),a=e(87363),L=e.n(a),I=e(72107),ee=e(9364),B=e(44095),ne=e(3619),te=e(9976),oe=e(34957),D=e(94990),n=e(33130),ue=L().createContext({logic:new I.Iz("")}),ie=function(u){var O,Z,p,N=(0,a.useState)(),U=g()(N,2),s=U[0],t=U[1],W=(0,a.useState)(),x=g()(W,2),E=x[0],C=x[1],K=(0,a.useState)(!0),R=g()(K,2),J=R[0],le=R[1],je=(0,a.useState)(),ce=g()(je,2),r=ce[0],se=ce[1],ye=(0,a.useState)(),ve=g()(ye,2),c=ve[0],be=ve[1],Le=(0,a.useState)(),ge=g()(Le,2),de=ge[0],Ie=ge[1],De=(0,a.useState)(),fe=g()(De,2),$=fe[0],ae=fe[1],Ze=(0,a.useState)(),he=g()(Ze,2),Pe=he[0],Oe=he[1],me=(0,a.useRef)(),_e=function(f){var d=f.node;ae(d);var o=c==null?void 0:c.itemLogs.find(function(m){return m.config.id==d.id});se(o)};function pe(i,f,d,o){return{name:"button",args:{markup:[{tagName:"circle",selector:"button",attrs:{r:14,x:0,y:0,stroke:f.success?"#52C41A":"red","stroke-width":5-d<1?1:5-d,fill:"white",cursor:"pointer"}},{tagName:"text",textContent:i,selector:"icon",attrs:{"font-size":20-d<12?12:20-d,"text-anchor":"middle","pointer-events":"none",y:"0.3em"}}],x:(o-1)*28,y:0,onClick:function(j){var xe=j.view,z=xe.cell;ae(z),le(!1),se(f)}}}}(0,a.useEffect)(function(){de&&(s==null||s.centerCell(de))},[de,s]),(0,a.useEffect)(function(){console.log("select curItemLog",r)},[r]),(0,a.useEffect)(function(){var i=s==null?void 0:s.getNodes().find(function(f){return f.id==u.nextId});i==null||i.attr("body/fill","red"),Ie(i)},[u.nextId]),(0,a.useEffect)(function(){var i;s==null||(i=s.getNodes().find(function(f){return f.id==u.nextId}))===null||i===void 0||i.attr("body/fill","red")},[s]),(0,a.useEffect)(function(){u.config&&C(u.config)},[u.config]),(0,a.useEffect)(function(){var i,f;console.log("props.debugLogs",u.debugLogs),((i=u.debugLogs)===null||i===void 0?void 0:i.length)>0&&setInterval(Me,2e3);var d=[];u&&((f=u.debugLogs)===null||f===void 0||f.forEach(function(o){var m,j;d.push({children:(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("span",{style:{cursor:"pointer",fontWeight:o.id==(c==null?void 0:c.id)?"bolder":"normal",color:o.id==(c==null?void 0:c.id)?"#52c41a":"black"},onClick:function(){be(o),s==null||s.fromJSON(E==null?void 0:E.visualConfig);var z,G={};o.itemLogs.forEach(function(Ee,Ce){var v=s==null?void 0:s.getNodes().find(function(Ae){return Ae.id==Ee.config.id});console.log("\u9009\u4E2D\u7684\u8282\u70B9"),console.log(v),v&&(v.addTools({name:"boundary",args:{attrs:{stroke:"red",strokeWidth:1.5,rx:5,ry:5}}}),z=v),G[v==null?void 0:v.id]?G[v==null?void 0:v.id]+=1:G[v==null?void 0:v.id]=1,v==null||v.addTools(pe(Ce,Ee,Ce,G[v==null?void 0:v.id]))}),s==null||s.centerCell(z),se({}),ae({})},children:[(0,n.jsx)("p",{children:(m=o.itemLogs[0])===null||m===void 0?void 0:m.config.name}),(0,n.jsx)("p",{children:o.serverTime}),((j=u.logicIns)===null||j===void 0?void 0:j.version)==o.version?(0,n.jsx)("p",{}):(0,n.jsx)("p",{children:(0,n.jsxs)(P.Z,{children:[(0,n.jsx)(h.Z.Paragraph,{style:{color:"red"},children:"\u7248\u672C\u53F7:"}),(0,n.jsxs)(h.Z.Paragraph,{copyable:{tooltips:["\u70B9\u51FB\u590D\u5236","\u590D\u5236\u6210\u529F!"],text:o.version},children:[o.version,(0,n.jsx)(h.Z.Link,{style:{margin:"5px"},href:"#/assets/logic/i/".concat(o.logicId,"/view/").concat(o.version),target:"_blank",children:(0,n.jsx)(V.Z,{})})]})]})}),(0,n.jsx)("p",{children:o.message})]})}),color:o.success?"green":"red"})})),Oe(d)},[u.debugLogs,u.logicIns,s,c]),(0,a.useEffect)(function(){if(E){try{var i=(0,ee.K)(),f=i.Shapes;(0,B.m)(f)}catch(o){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(o)}var d=new T.kJ({container:me.current,embedding:{enabled:!0,validate:function(m){return m.child.setData({hoverNode:m.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new T.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(m){var j=m.targetMagnet;return!!j}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}},background:{color:"#F2F7FA"},grid:!0});d.use(new X.H({enabled:!0,sharp:!0})).use(new k.A({enabled:!0})).use(new S.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new A.T({enabled:!0})).use(new Q.N),d.on("edge:dblclick",function(){}),d.on("edge:mouseenter",function(){}),d.on("edge:mouseleave",function(){}),d.on("node:moved",function(){}),d.on("node:mouseenter",function(){}),d.on("node:mouseleave",function(){}),d.on("node:added",function(){}),d.on("node:dblclick",function(o){var m=o.node}),d.on("blank:dblclick",function(o){var m=o.x,j=o.y}),d.fromJSON(E.visualConfig),(0,ne.V)(d),t(d)}},[E]);var Me=function(){},Te=[{key:"debug-node-input",label:"\u8282\u70B9\u5165\u51FA\u53C2",children:(0,n.jsxs)("div",{children:[(0,n.jsx)(D.Z,{formId:"debug-node-input",values:{success:r==null?void 0:r.success,msg:r==null?void 0:r.msg,returnData:r==null?void 0:r.returnData,body:r==null||(O=r.configInstance)===null||O===void 0?void 0:O.body},onSubmit:function(){}}),(0,n.jsx)(h.Z.Text,{style:{marginLeft:"15px"},copyable:{tooltips:["\u590D\u5236\u8282\u70B9\u7F16\u53F7","\u590D\u5236\u6210\u529F!"],text:$==null?void 0:$.id},children:"\u8282\u70B9\u7F16\u53F7"})]})},{key:"config",label:"\u8282\u70B9\u914D\u7F6E",children:(0,n.jsx)("div",{children:(0,n.jsx)(oe.Z,{onSubmit:function(){},editNode:$})})},{key:"configIns",label:"\u8282\u70B9\u5B9E\u4F8B",children:(0,n.jsx)(D.Z,{formId:(r==null||(Z=r.config)===null||Z===void 0?void 0:Z.type)||"",values:r==null?void 0:r.configInstance,onSubmit:function(){}})},{key:"debug-context",label:"\u6267\u884C\u4E0A\u4E0B\u6587",children:(0,n.jsx)(D.Z,{formId:"debug-context",values:{varsJson:c==null?void 0:c.varsJson,paramsJson:c==null?void 0:c.paramsJson,varsJsonEnd:c==null?void 0:c.varsJsonEnd},onSubmit:function(){}})}];return(0,n.jsxs)(b.Z,{style:{margin:0,height:"100vh"},children:[(0,n.jsxs)(b.Z.Sider,{theme:"light",collapsedWidth:0,width:260,style:{overflow:"auto",height:"100vh",position:"fixed",left:0,top:0,bottom:0,borderRight:"0.5px solid"},children:[(0,n.jsx)(w.Z,{children:"\u6267\u884C\u8BB0\u5F55"}),(0,n.jsx)(l.Z,{style:{height:"100%"},items:Pe})]}),(0,n.jsxs)(b.Z,{style:{marginLeft:260},children:[(0,n.jsxs)(b.Z.Header,{style:{backgroundColor:"white",padding:0},children:[(p=u.btns)===null||p===void 0?void 0:p.map(function(i){return i}),(0,n.jsx)(_.ZP,{type:"text",icon:J?(0,n.jsx)(y.Z,{}):(0,n.jsx)(Y.Z,{}),onClick:function(){le(!J)},style:{float:"right",right:"16px",fontSize:"16px",width:64,height:64}})]}),(0,n.jsx)(b.Z.Content,{className:"app-content",children:(0,n.jsx)(te.Z,{ref:me})})]}),(0,n.jsxs)(b.Z.Sider,{theme:"light",collapsed:J,collapsedWidth:0,style:{overflow:"scroll"},width:500,children:[(0,n.jsx)(q.Z,{items:Te,defaultActiveKey:"inout"}),(0,n.jsx)(_.ZP,{type:"text",onClick:function(){le(!J)},style:{position:"absolute",top:0,right:0,fontSize:"16px",width:64,height:64},children:"x"})]})]})},F=ie}}]);
