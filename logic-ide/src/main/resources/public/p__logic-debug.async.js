"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[2262],{19435:function(me,B,e){e.d(B,{O:function(){return w},A:function(){return $.Z}});var $=e(28576),S=e(54306),f=e.n(S),j=e(8049),z=e(14990),U=e(22465),R=e(5671),L=e(17696),G=e(19227),J=e(75476),H=e(1167),V=e(22150),W=e(40767),O=e(38243),P=e(58856),I=e(22983),p=e(39092),E=e(75904),ie=e(18725),s=e(87363),u=e.n(s),Y=e(10486),Q=e(14232),X=e(37555),M=e(59998),D=e(72107),c=e(88287),g=e(23620),n=e(33130),i=u().createContext({logic:new D.Iz("")}),T=function(d){var _,q=(0,s.useState)(),Z=f()(q,2),t=Z[0],K=Z[1],ee=(0,s.useState)(),A=f()(ee,2),a=A[0],F=A[1],x=(0,s.useState)(!1),C=f()(x,2),y=C[0],Ze=C[1],Ee=(0,s.useState)(!0),ae=f()(Ee,2),N=ae[0],ne=ae[1],xe=(0,s.useState)(),le=f()(xe,2),te=le[0],re=le[1],Ce=(0,s.useState)(),de=f()(Ce,2),h=de[0],De=de[1],Pe=(0,s.useState)(),ue=f()(Pe,2),oe=ue[0],Le=ue[1],Se=(0,s.useState)(),ce=f()(Se,2),je=ce[0],ge=ce[1],Oe=(0,s.useState)(),ve=f()(Oe,2),Me=ve[0],ye=ve[1],fe=(0,s.useRef)(),_e=function(m){var r=m.node;ge(r);var o=h==null?void 0:h.itemLogs.find(function(v){return v.config.id==r.id});re(o)};(0,s.useEffect)(function(){oe&&(t==null||t.centerCell(oe))},[oe,t]),(0,s.useEffect)(function(){console.log("play curItemLog",te)},[te]),(0,s.useEffect)(function(){var l=t==null?void 0:t.getNodes().find(function(m){return m.id==d.nextId});l==null||l.attr("body/fill","red"),Le(l)},[d.nextId]),(0,s.useEffect)(function(){var l;t==null||(l=t.getNodes().find(function(m){return m.id==d.nextId}))===null||l===void 0||l.attr("body/fill","red")},[t]),(0,s.useEffect)(function(){d.config&&F(d.config)},[d.config]),(0,s.useEffect)(function(){var l,m;console.log("props.debugLogs",d.debugLogs),((l=d.debugLogs)===null||l===void 0?void 0:l.length)>0&&setInterval(be,2e3);var r=[];d&&((m=d.debugLogs)===null||m===void 0||m.forEach(function(o){var v,b;r.push({children:(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("span",{style:{cursor:"pointer",fontWeight:o.id==(h==null?void 0:h.id)?"bolder":"normal",color:o.id==(h==null?void 0:h.id)?"#52c41a":"black"},onClick:function(){De(o),console.log(o),t==null||t.fromJSON(a==null?void 0:a.visualConfig);var he;o.itemLogs.forEach(function(pe){var se=t==null?void 0:t.getNodes().find(function(Te){return Te.id==pe.config.id});se&&(se.attr("body/fill","#52c41a"),he=se)}),t==null||t.centerCell(he),re({}),ge({})},children:[(0,n.jsx)("p",{children:(v=o.itemLogs[0])===null||v===void 0?void 0:v.config.name}),((b=d.logicIns)===null||b===void 0?void 0:b.version)==o.version?(0,n.jsx)("p",{}):(0,n.jsx)("p",{children:(0,n.jsxs)(W.Z,{children:[(0,n.jsx)(O.Z.Paragraph,{style:{color:"red"},children:"\u7248\u672C\u53F7:"}),(0,n.jsxs)(O.Z.Paragraph,{copyable:{tooltips:["\u70B9\u51FB\u590D\u5236","\u590D\u5236\u6210\u529F!"],text:o.version},children:[o.version,(0,n.jsx)(O.Z.Link,{style:{margin:"5px"},href:"#/assets/logic/i/".concat(o.logicId,"/view/").concat(o.version),target:"_blank",children:(0,n.jsx)(j.Z,{})})]})]})}),(0,n.jsxs)("p",{children:["\u4E1A\u52A1\u6807\u8BC6\uFF1A",o.bizId]}),(0,n.jsx)("p",{children:o.serverTime}),(0,n.jsx)("p",{children:o.message})]})}),color:o.success?"green":"red"})})),ye(r)},[d.debugLogs,d.logicIns,t,h]),(0,s.useEffect)(function(){if(a){try{var l=(0,Y.K)(),m=l.Shapes;(0,Q.m)(m)}catch(o){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(o)}var r=new R.kJ({container:fe.current,embedding:{enabled:!0,validate:function(v){return v.child.setData({hoverNode:v.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new R.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(v){var b=v.targetMagnet;return!!b}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}},background:{color:"#F2F7FA"},grid:!0});r.use(new H.H({enabled:!0,sharp:!0})).use(new L.A({enabled:!0})).use(new J.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new V.T({enabled:!0})).use(new G.N),r.on("edge:dblclick",function(){}),r.on("edge:mouseenter",function(){}),r.on("edge:mouseleave",function(){}),r.on("node:moved",function(){}),r.on("node:mouseenter",function(){}),r.on("node:mouseleave",function(){}),r.on("node:added",function(){}),r.on("node:dblclick",function(o){var v=o.node;ne(!1)}),r.on("blank:dblclick",function(o){var v=o.x,b=o.y}),r.fromJSON(a.visualConfig),(0,M.V)(r),K(r)}},[a]),(0,s.useEffect)(function(){t==null||t.off("node:click",_e),t==null||t.on("node:click",_e)},[h]);var be=function(){},Ie=[{key:"1",label:"\u65E5\u5FD7",children:(0,n.jsx)(g.gcu,{src:te})},{key:"2",label:"\u8282\u70B9\u914D\u7F6E",children:(0,n.jsx)(c.Z,{editNode:je,configSchemaProvider:d.configSchemaProvider})}];return(0,n.jsxs)(P.Z,{style:{margin:0,height:"100vh"},children:[(0,n.jsxs)(P.Z.Sider,{theme:"light",collapsedWidth:0,width:300,style:{overflow:"auto",height:"100vh",position:"fixed",left:0,top:0,bottom:0,borderRight:"0.5px solid"},children:[(0,n.jsx)(I.Z,{children:"\u72B6\u6001\u53D8\u66F4\u8BB0\u5F55"}),(0,n.jsx)(p.Z,{style:{height:"100%"},items:Me})]}),(0,n.jsxs)(P.Z,{style:{marginLeft:300},children:[(0,n.jsxs)(P.Z.Header,{style:{backgroundColor:"white",padding:0},children:[(0,n.jsxs)(W.Z,{direction:"horizontal",style:{},children:[(0,n.jsx)(I.Z,{type:"vertical"}),(_=d.btns)===null||_===void 0?void 0:_.map(function(l){return l})]}),(0,n.jsx)(E.ZP,{type:"text",icon:N?(0,n.jsx)(z.Z,{}):(0,n.jsx)(U.Z,{}),onClick:function(){ne(!N)},style:{float:"right",right:"16px",fontSize:"16px",width:64,height:64}})]}),(0,n.jsx)(P.Z.Content,{className:"app-content",children:(0,n.jsx)(X.Z,{ref:fe})})]}),(0,n.jsxs)(P.Z.Sider,{theme:"light",collapsed:N,collapsedWidth:0,style:{overflow:"scroll"},title:"ddd",width:500,children:[(0,n.jsx)(E.ZP,{type:"text",onClick:function(){ne(!N)},style:{float:"right",fontSize:"16px",width:64,height:64},children:"x"}),(0,n.jsx)(ie.Z,{items:Ie,defaultActiveKey:"1"})]})]})},w=T},21893:function(me,B,e){e.r(B);var $=e(54306),S=e.n($),f=e(25359),j=e.n(f),z=e(49811),U=e.n(z),R=e(19435),L=e(48364),G=e(47829),J=e(28635),H=e(79549),V=e(52615),W=e(75904),O=e(22983),P=e(40767),I=e(38243),p=e(70517),E=e(87363),ie=e.n(E),s=e(98306),u=e(33130),Y=function(){var M=U()(j()().mark(function D(c){var g;return j()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,p.Z.get("/setting/node-form/".concat(c,".json"));case 2:return g=i.sent,console.log(g.data),i.abrupt("return",g.data);case 5:case"end":return i.stop()}},D)}));return function(c){return M.apply(this,arguments)}}(),Q=function(){var M=U()(j()().mark(function D(c){var g;return j()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,p.Z.get("/setting/node-log/".concat(c,".json")).catch(function(T){return T});case 2:if(g=i.sent,console.log(g.data),!g.data){i.next=8;break}return i.abrupt("return",g.data);case 8:return i.next=10,p.Z.get("/setting/node-log/_def.json");case 10:return i.abrupt("return",i.sent.data);case 11:case"end":return i.stop()}},D)}));return function(c){return M.apply(this,arguments)}}(),X=function(){var D=(0,s.UO)(),c=D.id,g=(0,E.useState)(),n=S()(g,2),i=n[0],T=n[1],w=(0,E.useState)(!1),k=S()(w,2),d=k[0],_=k[1],q=(0,E.useState)([]),Z=S()(q,2),t=Z[0],K=Z[1],ee=(0,E.useState)(),A=S()(ee,2),a=A[0],F=A[1];return(0,E.useEffect)(function(){_(!0),c&&(0,L.m9)(c).then(function(x){x&&(F(x),_(!0),(0,L.b9)(x.logicId,x.version).then(function(C){var y=C;y.id=c,T(y),_(!1)}).catch(function(C){_(!1),console.log("err"),console.log(C)}))})},[c]),(0,E.useEffect)(function(){a&&(0,L.gC)(a).then(function(x){x&&K(x)})},[a]),(0,u.jsx)("div",{children:(0,u.jsx)(V.Z,{spinning:d,children:(0,u.jsx)(R.O,{btns:[(0,u.jsxs)(W.ZP,{onClick:function(){_(!0),(0,L.m9)(c).then(function(C){C&&(F(C),(0,L.gC)(C).then(function(y){y&&K(y),_(!1)})),_(!1)})},children:[(0,u.jsx)(G.Z,{}),"\u5237\u65B0\u8BF7\u6C42"]}),(0,u.jsx)(O.Z,{type:"vertical"}),(0,u.jsxs)("span",{children:["\u662F\u5426\u5B8C\u6210\uFF1A",a!=null&&a.isOver?(0,u.jsx)(J.Z,{twoToneColor:"#52c41a"}):(0,u.jsx)(H.Z,{twoToneColor:"red"})]}),(0,u.jsx)(O.Z,{type:"vertical"}),(0,u.jsxs)(P.Z,{children:[(0,u.jsx)(I.Z.Paragraph,{style:{color:"red"},children:"\u6267\u884C\u7248\u672C:"}),(0,u.jsx)(I.Z.Paragraph,{copyable:{tooltips:["\u70B9\u51FB\u590D\u5236","\u590D\u5236\u6210\u529F!"]},children:a==null?void 0:a.version})]})],nextId:a==null?void 0:a.nextId,config:i,logicIns:a,configSchemaProvider:Y,itemLogSchemaProvider:Q,debugLogs:t})})})};B.default=X}}]);
