"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[5039],{38381:function(ge,$,e){e.r($),e.d($,{default:function(){return Te}});var H=e(54306),c=e.n(H),Y=e(25359),D=e.n(Y),b=e(49811),Q=e.n(b),X=e(14990),ie=e(22465),R=e(5671),se=e(17696),Z=e(19227),_=e(75476),O=e(1167),q=e(22150),F=e(23360),ee=e(4283),J=e(54145),te=e(91711),i=e(87363),ne=e.n(i),A=e(10486),ae=e(14232),w=e(37555),s=e(59998),f=e(57213),v=e.n(f),n=e(24594),x=e(63466),h=e(21140),P=e(52510),N=e(97944),he=e(95926),me=e(94326),z=e(84191),pe=e(49425),K=e(94744),a=e(33130),Ve=null,ye=function(o){var t=(0,N.Ik)(),L=(0,i.useContext)(he.r),l=L.logic;(0,i.useEffect)(function(){if(l){var u,y,C,I,U=K.y.getJsonByParams((u=l.variables)!==null&&u!==void 0?u:[]),ue=(0,z.k)("_var",U),oe=K.y.getJsonByParams((y=l.params)!==null&&y!==void 0?y:[]),G=(0,z.k)("_par",oe),T=K.y.getJsonByParams((C=l.returns)!==null&&C!==void 0?C:[]),V=(0,z.k)("_ret",T),re=K.y.getJsonByParams((I=l.envs)!==null&&I!==void 0?I:[]),k=(0,z.k)("_env",re);t==null||t.languages.typescript.javascriptDefaults.addExtraLib(ue,"var.ts"),t==null||t.languages.typescript.javascriptDefaults.addExtraLib(G,"input.ts"),t==null||t.languages.typescript.javascriptDefaults.addExtraLib(V,"return.ts"),t==null||t.languages.typescript.javascriptDefaults.addExtraLib(k,"env.ts"),t==null||t.languages.typescript.javascriptDefaults.addExtraLib("let _lastRet:{}","lastRet.ts")}return function(){var M;console.log("effect dispose"),t==null||(M=t.current)===null||M===void 0||M.dispose()}},[l==null?void 0:l.params,l==null?void 0:l.variables,l==null?void 0:l.returns,l==null?void 0:l.envs]);var d=(0,i.useState)(!1),g=c()(d,2),m=g[0],p=g[1];return(0,a.jsx)("div",{style:{width:"100%"},children:m?(0,a.jsx)(me.Z,{title:"js\u7F16\u8F91\u5668",centered:!0,width:1200,bodyStyle:{height:"80vh"},open:m,footer:null,onCancel:function(){return p(!1)},children:(0,a.jsx)(N.ML,v()(v()({theme:"vs-dark",defaultValue:o.value,defaultLanguage:o.language,options:{minimap:{enabled:!1}}},o),{},{height:"100%"}))}):(0,a.jsxs)("div",{children:[(0,a.jsx)(N.ML,v()({className:"editorByLoader",theme:"vs-dark",defaultValue:o.value,defaultLanguage:o.language,onMount:function(y){var C;(C=y.getAction("editor.action.formatDocument"))===null||C===void 0||C.run(),y.setValue(y.getValue())},options:{minimap:{enabled:!1}},height:500},o)),(0,a.jsx)(J.ZP,{size:"small",type:"text",icon:(0,a.jsx)(pe.Z,{}),style:{position:"absolute",top:0,right:0,margin:"10px",color:"whitesmoke"},onClick:function(){return p(!0)}})]})})},le=ne().memo(ye),We=null,xe=function(o){return(0,a.jsx)(le,v()(v()({},o),{},{language:"json"}))},Ee=xe,$e=null,Ce=function(o){return(0,a.jsx)(le,v()(v()({},o),{},{language:"javascript"}))},Se=Ce,Le=e(16414),de=function(o){return(0,i.useEffect)(function(){N._m.config({monaco:Le})},[]),(0,a.jsx)(n.ZP,v()({widgets:{json:Ee,js:Se}},o))},je=de,Pe=de||je,Ie=function(r){var o,t=(0,n.cI)(),L=r.configSchemaProvider,l=function(m){var p,u,y;(p=r.editNode)===null||p===void 0||p.setAttrByPath("text/text",m.name);var C=(u=r.editNode)===null||u===void 0?void 0:u.data.config;r.editNode&&r.editNode.setData({config:v()(v()({},C),m)}),console.log("submit---props.editNode.data.config"),console.log((y=r.editNode)===null||y===void 0?void 0:y.data.config),r==null||r.onSubmit()},d=function(m){if(m&&m.data){var p,u=m.data.config||{},y=m.attrs;return u.name=y==null||(p=y.text)===null||p===void 0?void 0:p.text,u}else return{name:""}};return(0,i.useEffect)(function(){if(r.editNode&&r.editNode.data){var g=r.editNode.data.config||{};L(r.editNode.data.configSchema||g.type).then(function(m){var p,u=r.editNode.attrs;g.name=u==null||(p=u.text)===null||p===void 0?void 0:p.text,console.log("nodeConfigSchema"),console.log(m),t.setSchema(m,!0),t.resetFields(),t.setValues(g)})}},[r.editNode,(o=r.editNode)===null||o===void 0?void 0:o.data]),(0,a.jsx)("div",{children:(0,a.jsx)(Pe,{form:t,onFinish:l,onReset:function(){var m=d(r.editNode);t.setValues(m)},footer:!!r.onSubmit})})},De=function(o){var t,L=(0,i.useState)(),l=c()(L,2),d=l[0],g=l[1],m=(0,i.useState)(),p=c()(m,2),u=p[0],y=p[1],C=(0,i.useState)(!1),I=c()(C,2),U=I[0],ue=I[1],oe=(0,i.useState)(!0),G=c()(oe,2),T=G[0],V=G[1],re=(0,i.useState)(),k=c()(re,2),M=k[0],Ze=k[1],Oe=(0,i.useState)(),ce=c()(Oe,2),Ae=ce[0],we=ce[1],ve=(0,i.useRef)();(0,i.useEffect)(function(){M&&(d==null||d.centerCell(M))},[M,d]),(0,i.useEffect)(function(){var S=d==null?void 0:d.getNodes().find(function(W){return W.id==o.nextId});S==null||S.attr("body/fill","red"),Ze(S)},[o.nextId]),(0,i.useEffect)(function(){var S;d==null||(S=d.getNodes().find(function(W){return W.id==o.nextId}))===null||S===void 0||S.attr("body/fill","red")},[d]),(0,i.useEffect)(function(){o.config&&y(o.config)},[o.config]),(0,i.useEffect)(function(){if(u){try{var S=(0,A.K)(),W=S.Shapes;(0,ae.m)(W)}catch(j){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(j)}var E=new R.kJ({container:ve.current,embedding:{enabled:!0,validate:function(B){return B.child.setData({hoverNode:B.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new R.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(B){var fe=B.targetMagnet;return!!fe}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}},background:{color:"#F2F7FA"},grid:!0});E.use(new O.H({enabled:!0,sharp:!0})).use(new se.A({enabled:!0})).use(new _.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new q.T({enabled:!0})).use(new Z.N),E.on("edge:dblclick",function(){}),E.on("edge:mouseenter",function(){}),E.on("edge:mouseleave",function(){}),E.on("node:moved",function(){}),E.on("node:mouseenter",function(){}),E.on("node:mouseleave",function(){}),E.on("node:added",function(){}),E.on("node:dblclick",function(j){var B=j.node;V(!1)}),E==null||E.on("node:click",function(j){var B=j.node;we(B)}),E.on("blank:dblclick",function(j){var B=j.x,fe=j.y}),E.fromJSON(u.visualConfig),(0,s.V)(E),g(E)}},[u]);var Ue=[{key:"2",label:"\u8282\u70B9\u914D\u7F6E",children:(0,a.jsx)(Ie,{editNode:Ae,configSchemaProvider:o.configSchemaProvider})}];return(0,a.jsxs)(F.Z,{style:{margin:0,height:"100vh"},children:[(0,a.jsxs)(F.Z,{style:{},children:[(0,a.jsxs)(F.Z.Header,{style:{padding:0,backgroundColor:"white"},children:[(0,a.jsx)(ee.Z,{direction:"horizontal",children:(t=o.btns)===null||t===void 0?void 0:t.map(function(S){return S})}),(0,a.jsx)(J.ZP,{type:"text",icon:T?(0,a.jsx)(X.Z,{}):(0,a.jsx)(ie.Z,{}),onClick:function(){V(!T)},style:{float:"right",right:"16px",fontSize:"16px",width:64,height:64}})]}),(0,a.jsx)(F.Z.Content,{className:"app-content",children:(0,a.jsx)(w.Z,{ref:ve})})]}),(0,a.jsxs)(F.Z.Sider,{theme:"light",collapsed:T,collapsedWidth:0,style:{overflow:"scroll"},title:"ddd",width:500,children:[(0,a.jsx)(J.ZP,{type:"text",onClick:function(){V(!T)},style:{float:"right",fontSize:"16px",width:64,height:64},children:"x"}),(0,a.jsx)(te.Z,{items:Ue,defaultActiveKey:"1"})]})]})},Fe=De,be=e(48364),ze=e(61719),Ne=e(72197),Be=e(70517),Je=e(98306),Me=function(){var r=Q()(D()().mark(function o(t){var L;return D()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,Be.Z.get("/setting/node-form/".concat(t,".json"));case 2:return L=d.sent,console.log(L.data),d.abrupt("return",L.data);case 5:case"end":return d.stop()}},o)}));return function(t){return r.apply(this,arguments)}}(),Re=function(){var o=(0,Je.UO)(),t=o.id,L=o.version,l=(0,i.useState)(),d=c()(l,2),g=d[0],m=d[1],p=(0,i.useState)(!1),u=c()(p,2),y=u[0],C=u[1];return(0,i.useEffect)(function(){C(!0),t&&(0,be.Uh)(t,L).then(function(I){var U=I;U.configJson.id=t,m(U),C(!1)}).catch(function(I){C(!1),console.log("err"),console.log(I)})},[t]),(0,a.jsx)("div",{children:(0,a.jsx)(Ne.Z,{spinning:y,children:(0,a.jsx)(Fe,{btns:[(0,a.jsxs)("span",{style:{marginLeft:"25px",color:"red"},children:["\u903B\u8F91\u7248\u672C\uFF1A",L]}),(0,a.jsxs)("span",{style:{marginLeft:"10px"},children:["\u66F4\u65B0\u65F6\u95F4\uFF1A",g==null?void 0:g.updateTime]}),(0,a.jsxs)("span",{style:{marginLeft:"10px"},children:["\u540D\u79F0\uFF1A",g==null?void 0:g.name]})],nextId:"",config:g==null?void 0:g.configJson,configSchemaProvider:Me})})})},Te=Re},48364:function(ge,$,e){e.d($,{Uh:function(){return ae},YH:function(){return _},az:function(){return q},b9:function(){return ne},gC:function(){return te},m9:function(){return ee}});var H=e(25359),c=e.n(H),Y=e(49811),D=e.n(Y),b=e(70517),Q=e(5726),X=e.n(Q);function ie(s){return R.apply(this,arguments)}function R(){return R=_asyncToGenerator(_regeneratorRuntime().mark(function s(f){return _regeneratorRuntime().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",axios.post("/api/ide/pub/logic/dev-to-test".concat(f)));case 1:case"end":return n.stop()}},s)})),R.apply(this,arguments)}function se(s){return Z.apply(this,arguments)}function Z(){return Z=_asyncToGenerator(_regeneratorRuntime().mark(function s(f){return _regeneratorRuntime().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",axios.get("/api/ide/logic/".concat(f)));case 1:case"end":return n.stop()}},s)})),Z.apply(this,arguments)}function _(s){return O.apply(this,arguments)}function O(){return O=D()(c()().mark(function s(f){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",b.Z.get("/api/ide/logic/".concat(f,"/config")).then(function(x){var h;return(h=x.data)===null||h===void 0?void 0:h.data}));case 1:case"end":return n.stop()}},s)})),O.apply(this,arguments)}function q(s,f,v){return F.apply(this,arguments)}function F(){return F=D()(c()().mark(function s(f,v,n){return c()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",b.Z.put("/api/ide/logic/edit/".concat(f),{version:v,configJson:n,updateTime:X()().format("YYYY-MM-DD HH:mm:ss")}));case 1:case"end":return h.stop()}},s)})),F.apply(this,arguments)}function ee(s){return J.apply(this,arguments)}function J(){return J=D()(c()().mark(function s(f){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",b.Z.get("/api/ide/logic-instance/".concat(f)).then(function(x){var h=x.data.data;return h}));case 1:case"end":return n.stop()}},s)})),J.apply(this,arguments)}function te(s){return i.apply(this,arguments)}function i(){return i=D()(c()().mark(function s(f){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",b.Z.post("/api/ide/logic-logs",{filters:[{dataIndex:"logicId",values:[f.logicId],type:"="},{dataIndex:"bizId",values:[f.bizId],type:"="}],pageSize:1e3,orderBy:[{dataIndex:"id",desc:!0}]}).then(function(x){var h=x.data.data.records;return h&&h.map(function(P){P.itemLogs&&(P.itemLogs=JSON.parse(P.itemLogs))}),h}));case 1:case"end":return n.stop()}},s)})),i.apply(this,arguments)}function ne(s,f){return A.apply(this,arguments)}function A(){return A=D()(c()().mark(function s(f,v){return c()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.abrupt("return",b.Z.post("/api/ide/logic-baks",{filters:[{dataIndex:"id",values:[f],type:"="},{dataIndex:"version",values:[v],type:"="}]}).then(function(h){var P=h.data.data.records[0].configJson,N=JSON.parse(P);return N}));case 1:case"end":return x.stop()}},s)})),A.apply(this,arguments)}function ae(s,f){return w.apply(this,arguments)}function w(){return w=D()(c()().mark(function s(f,v){return c()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.abrupt("return",b.Z.post("/api/ide/logic-baks",{filters:[{dataIndex:"id",values:[f],type:"="},{dataIndex:"version",values:[v],type:"="}]}).then(function(h){var P=h.data.data.records[0],N=P.configJson;return P.configJson=JSON.parse(N),P}));case 1:case"end":return x.stop()}},s)})),w.apply(this,arguments)}}}]);
