"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[5039],{70196:function(Xt,ne,s){s.r(ne),s.d(ne,{default:function(){return $t}});var we=s(54306),z=s.n(we),Pe=s(25359),oe=s.n(Pe),Te=s(49811),Ze=s.n(Te),ae=s(14990),ie=s(22465),M=s(5671),re=s(17696),se=s(19227),de=s(75476),le=s(1167),ue=s(22150),B=s(23360),q=s(4283),O=s(54145),Le=s(91711),N=s(87363),K=s.n(N),Ae=s(57213),y=s.n(Ae),F=s(12490),Ut=50,De=50,ze=[{name:"ExtSharp",config:{width:100,height:De,attrs:{body:{rx:6,ry:6,stroke:"#5F95FF",strokeWidth:1,fill:"rgba(95,149,255,0.05)",refWidth:1,refHeight:1},image:{refX:2,refY:0},text:{refX:4,refY:20,fontSize:12,"text-anchor":"start"}},markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}}];function ce(r,t,o){var g=50,e=50,v={body:{}},l=[{shape:"circle",width:g,height:e,attrs:{body:y()(y()({},v.body),{},{fill:"white"}),text:{text:"\u4EA4\u4E92\u70B9"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:F.Tt,data:{config:{type:"wait-for-continue"}},groups:["global"]},{shape:"circle",label:"end",width:g,height:e,attrs:{body:y()(y()({},v.body),{},{fill:"#d9d9d9"}),text:{text:"end"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:F.Tt,data:{config:{type:"end"}},groups:["global"]},{shape:"ExtSharp",attrs:{text:{text:"http\u8BF7\u6C42",fontSize:14},image:{"xlink:href":"/icons/http.svg",width:20,x:2,y:2}},data:{config:{type:"http",method:"POST"}},ports:F.Tt,groups:["biz"]},{shape:"ExtSharp",ports:F.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/code.svg"},text:{text:"js\u811A\u672C",fontSize:14}},data:{config:{type:"js"}},groups:["biz"]},{shape:"ExtSharp",ports:F.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/code.svg"},text:{text:"java\u65B9\u6CD5",fontSize:14}},data:{config:{type:"java"}},groups:["biz"]},{shape:"ExtSharp",ports:F.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/CarbonSubflowLocal.svg"},text:{text:"\u590D\u7528\u903B\u8F91",fontSize:14}},data:{config:{type:"sub-logic"}},groups:["biz"]},{shape:"ExtSharp",width:50,height:e,label:"switch",attrs:{image:{"xlink:href":"/icons/switch.svg",width:45,x:1,y:2},text:{text:"switch",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"switch"}},ports:F.Tt,groups:["ctrl"]},{shape:"ExtSharp",width:g,height:e,attrs:{image:{"xlink:href":"/icons/text.svg",width:30,x:8,y:10},text:{text:"case",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"switch-case"}},ports:F.Tt,groups:["ctrl"]},{shape:"ExtSharp",width:50,height:e,attrs:{image:{"xlink:href":"/icons/text.svg",width:30,x:8,y:10},text:{text:"default",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"switch-default"}},ports:F.Tt,groups:["ctrl"]},{shape:"polygon",x:600,y:70,width:g,height:e,points:"0,10 10,0 20,10 10,20",attrs:{body:y()({},v.body),text:{text:"if\u5224\u65AD",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},ports:F.Tt,data:{config:{type:"if"}},groups:["ctrl"]},{shape:"ExtSharp",width:g,height:e,attrs:{image:{"xlink:href":"/icons/delay.svg",width:30,x:8,y:10},text:{text:"\u7B49\u5F85",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"wait",timeout:"2000"}},ports:F.Tt,groups:["ctrl"]}];r&&r.length>0&&Array.prototype.push.apply(l,r);var h=[{name:"global",title:"\u5168\u5C40\u8282\u70B9",graphHeight:110},{name:"ctrl",title:"\u903B\u8F91\u63A7\u5236",graphHeight:330},{name:"biz",title:"\u4E1A\u52A1\u8C03\u7528",graphHeight:220}];t&&t.length>0&&Array.prototype.push.apply(h,t);var c=ze;return o&&o.length>0&&Array.prototype.push.apply(c,o),{Shapes:c,Nodes:l,Groups:h}}var G=s(95812),_=s(53914),X={customNode:"customNode___AyPI8",input:"input___Q5PmS",switchNode:"switchNode___fqB9a"},n=s(33130),Je=function(t){return(0,n.jsx)("div",{className:X.customNode,children:(0,n.jsx)(_.Z,{className:"input",value:t==null?void 0:t.data,width:80})})},Be=s(371),Oe=function(t){return(0,n.jsx)("div",{className:styles.customNode,children:(0,n.jsx)(Be.Z,{className:"input",value:t==null?void 0:t.data,width:80})})},Ie=function(t){var o,g,e,v=t.node,l=(o=v.data.config)===null||o===void 0?void 0:o.name,h=l||"case";return(0,n.jsxs)("div",{className:X.customNode,children:[(0,n.jsx)("span",{children:"case"}),(0,n.jsx)(_.Z,{addonAfter:l,className:"input",value:v==null||(g=v.data)===null||g===void 0||(e=g.config)===null||e===void 0?void 0:e.case,width:150,onChange:function(f){var m=v.data;v.setData(y()(y()({},m),{},{config:y()(y()({},m.config),{},{case:f.target.value})}))}})]})},ke=function(t){var o,g=t.node;return(0,n.jsx)("div",{className:X.customNode,children:(0,n.jsx)(_.Z,{addonBefore:"switch",className:"input",value:(o=g.data)===null||o===void 0?void 0:o.config.condition,onChange:function(v){var l=g.data;g.setData(y()(y()({},l),{},{config:y()(y()({},l.config),{},{condition:v.target.value})}))},width:100})})},Re=function(t){return(0,n.jsx)("div",{className:X.customNode,children:(0,n.jsx)("div",{style:{textAlign:"center",fontSize:"15px"},children:"default"})})};function ve(r){r.forEach(function(t){console.log("\u6CE8\u518C\u65B0\u8282\u70B9:"+t.name),M.kJ.registerNode(t.name,t.config,!0)}),(0,G.z2)({shape:"string",component:Je}),(0,G.z2)({shape:"num",component:Oe}),(0,G.z2)({shape:"switch",component:ke}),(0,G.z2)({shape:"switch-case",component:Ie}),(0,G.z2)({shape:"switch-default",component:Re})}function Ve(r){var t=r.createNode({shape:"circle",label:"start",width:50,height:50,attrs:{body:{}},ports:F.Hi,data:{config:{type:"start"}}});r.addNode(t)}var Me=(0,N.forwardRef)(function(r,t){return(0,n.jsx)("div",{className:"drag-graph",ref:t})}),fe=Me,ge=s(17600),he=function(t){var o=new ge.Vq({type:"dagre",begin:[400,100],ranker:"network-simplex",rankdir:"TB",ranksep:20,nodeSize:50,align:"DL",controlPoints:!0}),g=t.getNodes(),e=t.getEdges(),v=o.layout({nodes:g,edges:e}),l=v.nodes,h=l===void 0?[]:l;g.forEach(function(c){var f=h.find(function(m){return m.id===c.id});f.x-=c.size().width/2,f.y-=c.size().height/2,c.position(f.x,f.y)})},Ge=function(t,o){debugger;var g=new ge.Vq({type:"dagre",begin:[400,100],ranker:"tight-tree",rankdir:"TB",ranksep:20,nodeSize:50,controlPoints:!0}),e=g.layout({nodes:t,edges:o}),v=e.nodes,l=v===void 0?[]:v;t.forEach(function(h){var c=l.find(function(f){return f.id===h.id});c.x-=h.size().width/2,c.y-=h.size().height/2,h.position(c.x,c.y)})},ee=s(24594),Ye=s(63466),We=s.n(Ye),He=s(21140),$e=s.n(He),Ke=s(52510),w=s.n(Ke),V=s(97944),Xe=s(93525),Ue=s.n(Xe),Qe=s(68608),P=s.n(Qe),qe=s(58853),_e=s.n(qe),et=s(38888),tt=s.n(et),nt=s(72237),ot=s(11150),at=s(93853),it=s(28110),rt=s(89357),st=s(9722),dt=s(22046),lt=s(11250),U=s(83217),ut=s(70710),Y=s(10502),me=s(63866),te=s(43728),ct=s(77357),vt=s(55104),ft=s(70256),gt=function(r){var t=(0,N.useState)({type:"form"}),o=z()(t,2),g=o[0],e=o[1],v=(0,N.useState)({}),l=z()(v,2),h=l[0],c=l[1],f=function(u){var a,C,p;(a=r.editNode)===null||a===void 0||a.setAttrByPath("text/text",u.name);var j=(C=r.editNode)===null||C===void 0?void 0:C.data.config;r.editNode&&(console.log("update graph data",u),r.editNode.setData({config:y()(y()({},j),u)},{overwrite:!0})),console.log("submit---props.editNode.data.config"),console.log((p=r.editNode)===null||p===void 0?void 0:p.data.config);var i={config:y()(y()({},j),u)};r==null||r.onSubmit(i)},m=function(u){if(u&&u.data){var a,C=u.data.config||{},p=u.attrs;return C.name=p==null||(a=p.text)===null||a===void 0?void 0:a.text,C}else return{name:""}};return(0,N.useEffect)(function(){if(r.editNode&&r.editNode.data){var d=r.editNode.data.config||{};(0,ft.CD)(r.editNode.data.configSchema||d.type).then(function(u){console.log("nodeConfigSchema"),console.log(u),e(u)})}},[r.editNode]),(0,N.useEffect)(function(){var d,u,a=((d=r.editNode)===null||d===void 0?void 0:d.data.config)||{},C=y()({},a),p=(u=r.editNode)===null||u===void 0?void 0:u.attrs;p&&p.text&&p.text.text&&(C.name=p.text.text),c(C)},[g]),(0,n.jsx)(vt.Z,{config:g,values:y()({},h),onSubmit:f})};function ht(r){return(0,n.jsxs)("div",{style:{margin:0,height:"95vh",overflowY:"scroll"},children:[(0,n.jsx)(gt,{logic:r.logic,editNode:r.editNode,onSubmit:r.onSubmit}),r!=null&&r.isCollapsed?"":(0,n.jsx)(O.ZP,{type:"text",style:{position:"absolute",top:10,right:15,fontSize:20,textAlign:"center"},onClick:function(){r==null||r.onClose()},children:"x"})]})}var mt=ht,xe=s(62835),J=s(94744),xt=function(t){var o,g=(0,N.useState)({}),e=z()(g,2),v=e[0],l=e[1];(0,N.useEffect)(function(){var c=t.values,f=c.params,m=c.variables,d=c.envs,u=c.returns;l({params:JSON.stringify(J.y.getJsonByParams(f)),variables:JSON.stringify(J.y.getJsonByParams(m)),returns:JSON.stringify(J.y.getJsonByParams(u)),envs:JSON.stringify(J.y.getJsonByParams(d))})},[t.values]);var h=(0,N.useCallback)(function(c){try{return JSON.parse(c),!0}catch(f){return!1}},[]);return(0,n.jsxs)("span",{children:[t.children,(0,n.jsx)(Y.Z,{open:(o=t.open)!==null&&o!==void 0?o:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return t==null?void 0:t.setOpen(!1)},children:(0,n.jsx)(xe.Z,{formId:"logic-setting",values:v,onSubmit:function(f){console.log("\u63D0\u4EA4\u53C2\u6570"),console.log(f);var m=!1;Object.keys(f).forEach(function(d){var u=f[d];if(!h(u)){var a=d==="params"?"\u5165\u53C2":d==="variables"?"\u5C40\u90E8\u53D8\u91CF":d==="returns"?"\u8FD4\u56DE\u53C2\u6570":"\u73AF\u5883\u53D8\u91CF";return U.ZP.error("".concat(a,"json\u683C\u5F0F\u9519\u8BEF")),m=!0,!1}}),m||(t!=null&&t.onSubmit&&t.onSubmit(f),t==null||t.setOpen(!1))}})})]})},pt=xt,yt=function(t,o){var g,e,v,l,h=o.getData(),c=o.getPosition(),f=t.getNodes(),m;if(["ExtSharp","polygon"].indexOf(o.shape)>-1)switch(h.config.type){case"switch":var d=200,u=t.addNode({shape:"switch",position:c,width:d,height:50,ports:F.Tt,data:o.data,attrs:{body:{stroke:"#8f8f8f",strokeWidth:1,fill:"#fff",rx:6,ry:6}}});t.removeNode(o);var a=t.addNode({shape:"switch-case",position:{y:c.y+100,x:c.x-d/2},width:120,height:50,ports:F.Tt,data:{config:{type:"switch-case"}}}),C=t.addNode({shape:"switch-default",position:{y:c.y+100,x:c.x+d},width:120,height:50,ports:F.Tt,data:{config:{type:"switch-default"}}}),p=t.addEdge({source:u,sourcePort:(g=u.ports.items.find(function(A){return A.group=="bottom"}))===null||g===void 0?void 0:g.id,target:a,targetPort:(e=a.ports.items.find(function(A){return A.group=="top"}))===null||e===void 0?void 0:e.id,zIndex:0}),j=t.addEdge({source:u,sourcePort:(v=u.ports.items.find(function(A){return A.group=="bottom"}))===null||v===void 0?void 0:v.id,target:C,targetPort:(l=C.ports.items.find(function(A){return A.group=="top"}))===null||l===void 0?void 0:l.id,zIndex:0});m=u;break;case"switch-case":var i=t.createNode({shape:"switch-case",position:o.position(),width:120,height:50,ports:F.Tt,data:o.data});t.removeNode(o),t.addNode(i),m=i;break;case"switch-default":var x=t.addNode({shape:"switch-default",position:o.position(),width:120,height:50,ports:F.Tt,data:{config:{type:"switch-default"}}});t.removeNode(o),t.addNode(x),m=x;break;case"string":var S=t.createNode({shape:"string",position:o.position(),width:100,height:50,ports:F.Tt,data:o.data});t.removeNode(o),t.addNode(S),m=S;break;case"num":var b=t.createNode({shape:"num",position:o.position(),width:100,height:50,ports:F.Tt,data:o.data});t.removeNode(o),t.addNode(b),m=b;break;case"assignment":var E=t.createNode({shape:"assignment",position:o.position(),width:220,height:50,ports:F.Tt,data:o.data});t.removeNode(o),t.addNode(E),m=E;break;default:break}if(console.log("node:added"),m&&f.length==1){var T,L,k,W,H;t.addEdge({source:f[0],sourcePort:(T=f[0].ports.items.find(function(A){return A.group=="bottom"}))===null||T===void 0?void 0:T.id,target:m,targetPort:(L=m)===null||L===void 0||(k=L.ports)===null||k===void 0||(W=k.items)===null||W===void 0||(H=W.find(function(A){return A.group=="top"}))===null||H===void 0?void 0:H.id,zIndex:0})}},pe=s(72107),St=function(t){var o,g=(0,ee.cI)();(0,N.useEffect)(function(){var l=t.values.params;g.setValues({params:JSON.stringify(J.y.getJsonByParams(l))})},[t.values]);var e=(0,N.useCallback)(function(l){try{return JSON.parse(l),!0}catch(h){return!1}},[]);function v(l){var h=!1;Object.keys(l).forEach(function(c){var f=l[c];if(["params","headers"].indexOf(c)>-1&&!e(f)){var m=c==="params"?"\u5165\u53C2":"\u8BF7\u6C42\u5934";return U.ZP.error("".concat(m,"json\u683C\u5F0F\u9519\u8BEF")),h=!0,!1}}),h||(t!=null&&t.onSubmit&&t.onSubmit(l,l.debugType),t==null||t.setOpen(!1))}return(0,n.jsxs)("span",{children:[t.children,(0,n.jsx)(Y.Z,{open:(o=t.open)!==null&&o!==void 0?o:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return t==null?void 0:t.setOpen(!1)},children:(0,n.jsx)(xe.Z,{formId:"logic-debug-input",onSubmit:v})})]})},Ct=St,Nt=s(61719),ye=s(94326),Se=s(49425),Qt=null,jt=function(t){var o=(0,V.Ik)(),g=(0,N.useState)(!1),e=z()(g,2),v=e[0],l=e[1];return(0,n.jsx)("div",{style:{width:"100%"},children:v?(0,n.jsx)(ye.Z,{title:"js\u7F16\u8F91\u5668",centered:!0,width:1200,bodyStyle:{height:"80vh"},open:v,footer:null,onCancel:function(){return l(!1)},children:(0,n.jsx)(V.ML,y()(y()({theme:"vs-dark",defaultValue:t.value,defaultLanguage:t.language,options:{minimap:{enabled:!1}}},t),{},{height:"100%"}))}):(0,n.jsxs)("div",{children:[(0,n.jsx)(V.ML,y()({className:"editorByLoader",theme:"vs-dark",defaultValue:t.value,defaultLanguage:t.language,onMount:function(c){var f;(f=c.getAction("editor.action.formatDocument"))===null||f===void 0||f.run(),c.setValue(c.getValue())},options:{minimap:{enabled:!1}},height:500},t)),(0,n.jsx)(O.ZP,{size:"small",type:"text",icon:(0,n.jsx)(Se.Z,{}),style:{position:"absolute",top:0,right:0,margin:"10px",color:"whitesmoke"},onClick:function(){return l(!0)}})]})})},bt=K().memo(jt),Et=s(5726),Ft=s.n(Et),wt=s(23620),Pt=s(71731),Ce=s(11331),Tt=[{key:"saveToPng",label:"\u5BFC\u51FA\u56FE\u7247"},{key:"saveToClipboard",label:"\u590D\u5236\u5230\u526A\u8D34\u677F"}],Ne=K().createContext({logic:new pe.Iz("")}),je=function(t,o){for(var g=0,e=t.length;g<e;g+=1)t[g].style.visibility=o?"visible":"hidden"},qt=function(r){_e()(o,r);var t=tt()(o);function o(g){var e;$e()(this,o),e=t.call(this,g),w()(P()(e),"container",void 0),w()(P()(e),"stencilContainer",void 0),w()(P()(e),"state",{editingNode:void 0,openEdgeEditor:!1,embeddingEnable:!1,editingEdge:void 0,leftToolCollapsed:!1,rightToolCollapsed:!0,openFlowSetting:!1,openRunLogic:!1,editorCtx:{logic:new pe.Iz("1")},logs:[],panel:{nodes:[],groups:[]}}),w()(P()(e),"handleEdgeSubmit",function(d){var u;(u=e.state.editingEdge)===null||u===void 0||u.setLabels(d)}),w()(P()(e),"initGraph",function(d){var u,a=new M.kJ({container:d,embedding:{enabled:!0,findParent:function(x){var S=x.node,b=S.getBBox();return this.getNodes().filter(function(E){var T=E.getData();if(T&&T.parent){var L=E.getBBox();return b.isIntersectWithRect(L)}return!1})}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new M.bn.kS({tools:[],vertices:[],zIndex:0})},validateConnection:function(x){var S=x.targetMagnet;return!!S}},background:{color:"#F2F7FA"},grid:!0});a.use(new le.H({enabled:!0,sharp:!0})).use(new re.A({enabled:!0})).use(new de.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new ue.T({enabled:!0})).use(new se.N).use(new st.T).use(new lt.D).use(new rt.a({container:e.minimapContainer})).use(new Pt.w({resizing:{enabled:!0,minWidth:50,minHeight:50,orthogonal:!1,restrict:!1,preserveAspectRatio:!1}})),a.on("edge:dblclick",function(i){var x=i.cell}),a.on("edge:mouseenter",function(i){var x=i.cell;x.addTools(["vertices","segments",{name:"button-remove",args:{distance:-40}}])}),a.on("edge:mouseleave",function(i){var x=i.cell;x.removeTools()}),a.on("node:moved",function(i){var x=i.e,S=i.x,b=i.y,E=i.node,T=i.view}),a.on("node:mouseenter",function(i){var x,S,b,E=i.cell;((x=E.data)===null||x===void 0||(S=x.config)===null||S===void 0?void 0:S.type)!="start"&&E.addTools([{name:"button-remove",args:{x:"100%",y:0,offset:{x:-10,y:10}}}]);var T=(b=e.container)===null||b===void 0?void 0:b.querySelectorAll(".x6-port-body");je(T,!0)}),a.on("node:mouseleave",function(i){var x,S=i.cell;S.removeTools();var b=(x=e.container)===null||x===void 0?void 0:x.querySelectorAll(".x6-port-body");je(b,!1)}),a.on("node:click",function(i){var x=i.e,S=i.x,b=i.y,E=i.node,T=i.view;E.removeTools(),e.setState({editingNode:E})}),a.on("node:added",function(i){var x=i.node,S=i.index,b=i.options;yt(a,x)}),a.on("node:dblclick",function(i){var x=i.e,S=i.x,b=i.y,E=i.node,T=i.view;e.setState({rightToolCollapsed:!1,editingNode:E})}),a.bindKey(["meta+c","ctrl+c"],function(){var i=a.getSelectedCells();return i.length&&a.copy(i),!1}),a.bindKey(["meta+x","ctrl+x"],function(){var i=a.getSelectedCells();return i.length&&a.cut(i),!1}),a.bindKey(["meta+v","ctrl+v"],function(){if(!a.isClipboardEmpty()){var i=a.paste({offset:32});a.cleanSelection(),a.select(i)}return!1}),a.bindKey(["meta+z","ctrl+z"],function(){return a.canUndo()&&a.undo(),!1}),a.bindKey(["meta+shift+z","ctrl+shift+z"],function(){return a.canRedo()&&a.redo(),!1}),a.bindKey("backspace",function(){var i=a.getSelectedCells();i.length&&(i.find(function(x){var S;return x.data?["start"].indexOf((S=x.data.config)===null||S===void 0?void 0:S.type)>-1:!1})?U.ZP.error("\u7981\u6B62\u5220\u9664\u5F00\u59CB\u8282\u70B9\uFF01"):a.removeCells(i))}),a.on("blank:dblclick",function(i){var x=i.e,S=i.x,b=i.y;console.log("blank:dbclick",S,b),e.autoLayout(a)}),a.bindKey(["ctrl+1","meta+1"],function(){var i=a.zoom();i<1.5&&a.zoom(.1)}),a.bindKey(["ctrl+2","meta+2"],function(){var i=a.zoom();i>.5&&a.zoom(-.1)}),e.state.graph=a;var C=e.state.panel.groups,p=new dt.t({title:"\u5C55\u5F00/\u6536\u8D77",target:a,search:function(x,S){var b=x.getAttrByPath("text/text");return(b==null?void 0:b.indexOf(S))!==-1},notFoundText:"\u672A\u627E\u5230",collapsable:!0,stencilGraphWidth:250,groups:C,layoutOptions:{rowHeight:100}}),j={};return e.state.panel.nodes.forEach(function(i){var x=a.createNode(i);C.forEach(function(S){i.groups.includes(S.name)&&(j[S.name]?j[S.name].push(x):j[S.name]=[x])})}),Object.keys(j).forEach(function(i){p.load(Ue()(j[i]),i)}),(u=e.stencilContainer)===null||u===void 0||u.appendChild(p.container),e.props.config?(e.state.editorCtx.logic=e.props.config,a.fromJSON(e.state.editorCtx.logic.visualConfig)):(Ve(a),e.autoLayout(a)),a}),w()(P()(e),"autoLayout",function(d){he(d)}),w()(P()(e),"autoLayoutSelectedCells",function(d){var u=d.getSelectedCells().filter(function(C){return C.isNode()}),a=d.getSelectedCells().filter(function(C){return C.isEdge()});debugger;Ge(u,a)}),w()(P()(e),"refContainer",function(d){e.container=d}),w()(P()(e),"refStencil",function(d){e.stencilContainer=d}),w()(P()(e),"handleSubmit",function(d){var u;(u=e.state.editingNode)===null||u===void 0||u.setData(d),e.saveAndConvertGraphToDsl()}),w()(P()(e),"handleOnConfigChange",function(d){try{var u=JSON.parse(d);e.setState({stepFlow:u})}catch(a){console.log(a)}}),w()(P()(e),"onSaveMenuClick",function(d){var u;switch(d.key){case"saveToBrowser":break;case"loadFromBrowser":var a=localStorage.getItem("logic-json");if(a){var C,p=JSON.parse(a);e.state.editorCtx.logic=p,(C=e.state.graph)===null||C===void 0||C.fromJSON(p.visualConfig),e.saveAndConvertGraphToDsl()}else U.ZP.info("\u6D4F\u89C8\u5668\u65E0\u7F13\u5B58\u6570\u636E");break;case"saveToClipboard":try{navigator.clipboard.writeText(JSON.stringify(e.state.editorCtx.logic))}catch(j){console.error(j)}break;case"saveToPng":(u=e.state.graph)===null||u===void 0||u.exportPNG(new Date().toLocaleDateString(),{backgroundColor:"#F2F7FA",padding:10,quality:1});break}}),w()(P()(e),"updateLogicAndEditorCtx",function(d){var u=y()(y()({},e.state.editorCtx.logic),d);return u.version=Ft()(Date.now()).format("YYYYMMDDHHmmss"),e.setState({editorCtx:y()(y()({},e.state.editorCtx),{},{logic:u})}),u}),w()(P()(e),"saveAndConvertGraphToDsl",function(){var d,u=(d=e.state.graph)===null||d===void 0?void 0:d.toJSON(),a=e.convertGraphToDsl(u);if(a){var C,p=e.updateLogicAndEditorCtx({items:a.items,visualConfig:a.visualConfig});e.props.config&&(p.id=(C=e.props.config)===null||C===void 0?void 0:C.id),e.props.onSave&&e.props.onSave(p);var j=JSON.stringify(p);localStorage.setItem("logic-"+p.name,j)}}),w()(P()(e),"saveFlowSettingAndConvertGraphToDsl",function(d){var u,a,C,p,j,i=J.y.getParamArrayByJson(JSON.parse((u=d.params)!==null&&u!==void 0?u:"{}")),x=J.y.getReturnArrayByJson(JSON.parse((a=d.returns)!==null&&a!==void 0?a:"{}")),S=J.y.getVariableArrayByJson(JSON.parse((C=d.variables)!==null&&C!==void 0?C:"{}")),b=J.y.getEnvsArrayByJson(JSON.parse((p=d.envs)!==null&&p!==void 0?p:"{}")),E=e.updateLogicAndEditorCtx({params:i,returns:x,variables:S,envs:b});e.props.config&&(E.id=(j=e.props.config)===null||j===void 0?void 0:j.id),e.props.onSave&&e.props.onSave(E);var T=JSON.stringify(E);localStorage.setItem("logic-json-"+E.id,T)}),w()(P()(e),"convertGraphToDsl",function(d){var u,a=(0,ct.nq)((u=e.props.config)===null||u===void 0?void 0:u.id,d.cells);return a&&(a.visualConfig=d),a}),w()(P()(e),"setFlowSetting",function(d){e.setState({openFlowSetting:d})}),w()(P()(e),"minimapContainer",void 0),w()(P()(e),"refMiniMapContainer",function(d){e.minimapContainer=d});try{var v,l,h=ce(g.customNodes,g.customGroups,g.customSharps),c=h.Nodes,f=h.Shapes,m=h.Groups;ve(f),e.state.leftToolCollapsed=!(!((v=g.showLeft)!==null&&v!==void 0)||v),e.state.rightToolCollapsed=!((l=g.showRight)!==null&&l!==void 0&&l),e.state.panel.nodes=c,e.state.panel.groups=m}catch(d){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(d)}return e}return We()(o,[{key:"componentDidUpdate",value:function(e,v,l){if(this.props.config&&this.state.editorCtx.logic.id!=this.props.config.id){var h,c,f,m;this.state.editorCtx.logic=this.props.config,(h=this.state.editorCtx)!==null&&h!==void 0&&(c=h.logic)!==null&&c!==void 0&&c.visualConfig&&((f=this.state.graph)===null||f===void 0||f.fromJSON((m=this.state.editorCtx.logic)===null||m===void 0?void 0:m.visualConfig)),this.setState({editingNode:void 0})}}},{key:"componentDidMount",value:function(){var e;this.initGraph(this.container),this.updateLogicAndEditorCtx((e=this.state.editorCtx)===null||e===void 0?void 0:e.logic)}},{key:"render",value:function(){var e=this,v,l=this.state,h=l.editingNode,c=l.leftToolCollapsed,f=l.rightToolCollapsed,m=l.editorCtx,d=l.embeddingEnable,u=l.graph,a=l.openFlowSetting,C=l.openRunLogic,p=m.logic;return console.log("editorCtx",m),(0,n.jsx)(Ne.Provider,{value:m,children:(0,n.jsxs)(B.Z,{style:{height:"100vh",width:"100%",margin:0},children:[(0,n.jsx)(B.Z.Sider,{theme:"light",collapsed:c,collapsedWidth:0,width:250,ref:this.refStencil}),(0,n.jsxs)(B.Z,{style:{height:"100%"},children:[(0,n.jsxs)(B.Z.Header,{style:{padding:0,backgroundColor:"white"},children:[(0,n.jsxs)(q.Z,{direction:"horizontal",children:[(0,n.jsx)(O.ZP,{type:"text",icon:c?(0,n.jsx)(ie.Z,{}):(0,n.jsx)(ae.Z,{}),onClick:function(){e.setState({leftToolCollapsed:!c})},style:{fontSize:"16px",width:64,height:64}}),(0,n.jsx)(ut.Z.Button,{style:{float:"inline-start"},menu:{items:Tt,onClick:this.onSaveMenuClick},buttonsRender:function(i){return[(0,n.jsx)(O.ZP,{type:"primary",icon:(0,n.jsx)(nt.Z,{}),onClick:e.saveAndConvertGraphToDsl,children:"\u4FDD\u5B58"}),(0,n.jsx)(O.ZP,{type:"primary",icon:(0,n.jsx)(ot.Z,{})})]},children:"\u4FDD\u5B58"}),(0,n.jsx)(pt,{open:a,values:y()({},p),setOpen:this.setFlowSetting,onSubmit:this.saveFlowSettingAndConvertGraphToDsl,children:(0,n.jsx)(O.ZP,{onClick:function(){return e.setFlowSetting(!0)},icon:(0,n.jsx)(at.Z,{}),children:"\u914D\u7F6E\u53C2\u6570"})}),(v=this.props.btns)===null||v===void 0?void 0:v.map(function(j){return(0,n.jsx)(O.ZP,y()({},j))}),(0,n.jsx)(Ct,{open:C,setOpen:function(i){return e.setState({openRunLogic:i})},values:{params:p==null?void 0:p.params},onSubmit:function(i,x){if(e.setState({openRunLogic:!1}),p){var S=i.params,b=i.bizId,E=i.headers,T=i.bizStartCode;(0,Nt.L7)(p.id,JSON.parse(S),b,T,x,JSON.parse(E)).then(function(L){L.data.code==0?Y.Z.success({title:"\u6267\u884C\u6210\u529F",width:"1000px",closable:!0,content:(0,n.jsx)("div",{children:(0,n.jsx)(Ce.Z,{pageId:"debug-info",data:L.data})})}):Y.Z.error({title:(0,n.jsx)("span",{children:L.data.msg}),width:"1200px",closable:!0,content:(0,n.jsx)("div",{children:(0,n.jsx)(Ce.Z,{pageId:"debug-info",data:L.data})})})}).catch(function(L){var k=L.response.data;Y.Z.error({title:(0,n.jsx)("span",{children:k.msg}),width:"1200px",closable:!0,content:(0,n.jsx)("div",{children:(0,n.jsx)(me.Z,{children:(0,n.jsx)(te.Z,{children:(0,n.jsxs)(me.Z,{children:[(0,n.jsxs)(te.Z,{span:12,children:[(0,n.jsx)("h4",{children:"\u9519\u8BEF\u8BE6\u7EC6:"}),(0,n.jsx)(wt.gcu,{src:k.error,collapsed:1})]}),(0,n.jsxs)(te.Z,{span:12,children:[(0,n.jsx)("h4",{children:"\u8FD4\u56DE\u6570\u636E:"}),(0,n.jsx)(bt,{language:"json",value:JSON.stringify(k.data),width:500})]})]})})})})})}),e.state.logs.push({data:new Date().toLocaleTimeString()})}},children:(0,n.jsx)(O.ZP,{type:"default",onClick:function(){e.setState({openRunLogic:!0})},icon:(0,n.jsx)(it.Z,{}),children:"\u8C03\u8BD5"})}),(0,n.jsxs)("span",{children:["\u5F53\u524D\u7248\u672C:",p.version]})]}),(0,n.jsx)(q.Z,{style:{float:"right",right:"16px"}})]}),(0,n.jsxs)(B.Z.Content,{className:"app-content",children:[(0,n.jsx)(fe,{ref:this.refContainer}),(0,n.jsx)("div",{className:"app-minimap",ref:this.refMiniMapContainer})]})]}),(0,n.jsx)(B.Z.Sider,{theme:"light",collapsed:f,collapsedWidth:0,width:600,children:(0,n.jsx)(mt,{logic:p,onClear:function(){return e.setState({logs:[]})},editNode:h,onSubmit:this.handleSubmit,logs:this.state.logs,onClose:function(){e.setState({rightToolCollapsed:!0})},isCollapsed:f})})]})})}}]),o}(K().Component),Q=s(57456),_t=null,Zt=function(t){var o=(0,V.Ik)(),g=(0,N.useContext)(Ne),e=g.logic;(0,N.useEffect)(function(){if(e){var f,m,d,u,a=J.y.getJsonByParams((f=e.variables)!==null&&f!==void 0?f:[]),C=(0,Q.k)("_var",a),p=J.y.getJsonByParams((m=e.params)!==null&&m!==void 0?m:[]),j=(0,Q.k)("_par",p),i=J.y.getJsonByParams((d=e.returns)!==null&&d!==void 0?d:[]),x=(0,Q.k)("_ret",i),S=J.y.getJsonByParams((u=e.envs)!==null&&u!==void 0?u:[]),b=(0,Q.k)("_env",S);o==null||o.languages.typescript.javascriptDefaults.addExtraLib(C,"var.ts"),o==null||o.languages.typescript.javascriptDefaults.addExtraLib(j,"input.ts"),o==null||o.languages.typescript.javascriptDefaults.addExtraLib(x,"return.ts"),o==null||o.languages.typescript.javascriptDefaults.addExtraLib(b,"env.ts"),o==null||o.languages.typescript.javascriptDefaults.addExtraLib("let _lastRet:{}","lastRet.ts")}return function(){var E;console.log("effect dispose"),o==null||(E=o.current)===null||E===void 0||E.dispose()}},[e==null?void 0:e.params,e==null?void 0:e.variables,e==null?void 0:e.returns,e==null?void 0:e.envs]);var v=(0,N.useState)(!1),l=z()(v,2),h=l[0],c=l[1];return(0,n.jsx)("div",{style:{width:"100%"},children:h?(0,n.jsx)(ye.Z,{title:"js\u7F16\u8F91\u5668",centered:!0,width:1200,bodyStyle:{height:"80vh"},open:h,footer:null,onCancel:function(){return c(!1)},children:(0,n.jsx)(V.ML,y()(y()({theme:"vs-dark",defaultValue:t.value,defaultLanguage:t.language,options:{minimap:{enabled:!1}}},t),{},{height:"100%"}))}):(0,n.jsxs)("div",{children:[(0,n.jsx)(V.ML,y()({className:"editorByLoader",theme:"vs-dark",defaultValue:t.value,defaultLanguage:t.language,onMount:function(m){var d;(d=m.getAction("editor.action.formatDocument"))===null||d===void 0||d.run(),m.setValue(m.getValue())},options:{minimap:{enabled:!1}},height:500},t)),(0,n.jsx)(O.ZP,{size:"small",type:"text",icon:(0,n.jsx)(Se.Z,{}),style:{position:"absolute",top:0,right:0,margin:"10px",color:"whitesmoke"},onClick:function(){return c(!0)}})]})})},be=K().memo(Zt),en=null,Lt=function(t){return(0,n.jsx)(be,y()(y()({},t),{},{language:"json"}))},At=Lt,tn=null,Dt=function(t){return(0,n.jsx)(be,y()(y()({},t),{},{language:"javascript"}))},zt=Dt,Jt=s(16414),Ee=function(t){return(0,N.useEffect)(function(){V._m.config({monaco:Jt})},[]),(0,n.jsx)(ee.ZP,y()({widgets:{json:At,js:zt}},t))},Bt=Ee,Ot=Ee||Bt,It=function(r){var t,o=(0,ee.cI)(),g=r.configSchemaProvider,e=function(h){var c,f,m;(c=r.editNode)===null||c===void 0||c.setAttrByPath("text/text",h.name);var d=(f=r.editNode)===null||f===void 0?void 0:f.data.config;r.editNode&&r.editNode.setData({config:y()(y()({},d),h)}),console.log("submit---props.editNode.data.config"),console.log((m=r.editNode)===null||m===void 0?void 0:m.data.config),r==null||r.onSubmit()},v=function(h){if(h&&h.data){var c,f=h.data.config||{},m=h.attrs;return f.name=m==null||(c=m.text)===null||c===void 0?void 0:c.text,f}else return{name:""}};return(0,N.useEffect)(function(){if(r.editNode&&r.editNode.data){var l=r.editNode.data.config||{};g(r.editNode.data.configSchema||l.type).then(function(h){var c,f=r.editNode.attrs;l.name=f==null||(c=f.text)===null||c===void 0?void 0:c.text,console.log("nodeConfigSchema"),console.log(h),o.setSchema(h,!0),o.resetFields(),o.setValues(l)})}},[r.editNode,(t=r.editNode)===null||t===void 0?void 0:t.data]),(0,n.jsx)("div",{children:(0,n.jsx)(Ot,{form:o,onFinish:e,onReset:function(){var h=v(r.editNode);o.setValues(h)},footer:!!r.onSubmit})})},kt=function(t){var o,g=(0,N.useState)(),e=z()(g,2),v=e[0],l=e[1],h=(0,N.useState)(),c=z()(h,2),f=c[0],m=c[1],d=(0,N.useState)(!1),u=z()(d,2),a=u[0],C=u[1],p=(0,N.useState)(!0),j=z()(p,2),i=j[0],x=j[1],S=(0,N.useState)(),b=z()(S,2),E=b[0],T=b[1],L=(0,N.useState)(),k=z()(L,2),W=k[0],H=k[1],A=(0,N.useRef)();(0,N.useEffect)(function(){E&&(v==null||v.centerCell(E))},[E,v]),(0,N.useEffect)(function(){var D=v==null?void 0:v.getNodes().find(function($){return $.id==t.nextId});D==null||D.attr("body/fill","red"),T(D)},[t.nextId]),(0,N.useEffect)(function(){var D;v==null||(D=v.getNodes().find(function($){return $.id==t.nextId}))===null||D===void 0||D.attr("body/fill","red")},[v]),(0,N.useEffect)(function(){t.config&&m(t.config)},[t.config]),(0,N.useEffect)(function(){if(f){try{var D=ce(),$=D.Shapes;ve($)}catch(I){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(I)}var Z=new M.kJ({container:A.current,embedding:{enabled:!0,validate:function(R){return R.child.setData({hoverNode:R.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new M.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(R){var Fe=R.targetMagnet;return!!Fe}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}},background:{color:"#F2F7FA"},grid:!0});Z.use(new le.H({enabled:!0,sharp:!0})).use(new re.A({enabled:!0})).use(new de.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new ue.T({enabled:!0})).use(new se.N),Z.on("edge:dblclick",function(){}),Z.on("edge:mouseenter",function(){}),Z.on("edge:mouseleave",function(){}),Z.on("node:moved",function(){}),Z.on("node:mouseenter",function(){}),Z.on("node:mouseleave",function(){}),Z.on("node:added",function(){}),Z.on("node:dblclick",function(I){var R=I.node;x(!1)}),Z==null||Z.on("node:click",function(I){var R=I.node;H(R)}),Z.on("blank:dblclick",function(I){var R=I.x,Fe=I.y}),Z.fromJSON(f.visualConfig),he(Z),l(Z)}},[f]);var Kt=[{key:"2",label:"\u8282\u70B9\u914D\u7F6E",children:(0,n.jsx)(It,{editNode:W,configSchemaProvider:t.configSchemaProvider})}];return(0,n.jsxs)(B.Z,{style:{margin:0,height:"100vh"},children:[(0,n.jsxs)(B.Z,{style:{},children:[(0,n.jsxs)(B.Z.Header,{style:{padding:0,backgroundColor:"white"},children:[(0,n.jsx)(q.Z,{direction:"horizontal",children:(o=t.btns)===null||o===void 0?void 0:o.map(function(D){return D})}),(0,n.jsx)(O.ZP,{type:"text",icon:i?(0,n.jsx)(ae.Z,{}):(0,n.jsx)(ie.Z,{}),onClick:function(){x(!i)},style:{float:"right",right:"16px",fontSize:"16px",width:64,height:64}})]}),(0,n.jsx)(B.Z.Content,{className:"app-content",children:(0,n.jsx)(fe,{ref:A})})]}),(0,n.jsxs)(B.Z.Sider,{theme:"light",collapsed:i,collapsedWidth:0,style:{overflow:"scroll"},title:"ddd",width:500,children:[(0,n.jsx)(O.ZP,{type:"text",onClick:function(){x(!i)},style:{float:"right",fontSize:"16px",width:64,height:64},children:"x"}),(0,n.jsx)(Le.Z,{items:Kt,defaultActiveKey:"1"})]})]})},Rt=kt,Vt=s(48364),Mt=s(72197),Gt=s(70517),Yt=s(98306),Wt=function(){var r=Ze()(oe()().mark(function t(o){var g;return oe()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,Gt.Z.get("/setting/node-form/".concat(o,".json"));case 2:return g=v.sent,console.log(g.data),v.abrupt("return",g.data);case 5:case"end":return v.stop()}},t)}));return function(o){return r.apply(this,arguments)}}(),Ht=function(){var t=(0,Yt.UO)(),o=t.id,g=t.version,e=(0,N.useState)(),v=z()(e,2),l=v[0],h=v[1],c=(0,N.useState)(!1),f=z()(c,2),m=f[0],d=f[1];return(0,N.useEffect)(function(){d(!0),o&&(0,Vt.Uh)(o,g).then(function(u){var a=u;a.configJson.id=o,h(a),d(!1)}).catch(function(u){d(!1),console.log("err"),console.log(u)})},[o]),(0,n.jsx)("div",{children:(0,n.jsx)(Mt.Z,{spinning:m,children:(0,n.jsx)(Rt,{btns:[(0,n.jsxs)("span",{style:{marginLeft:"25px",color:"red"},children:["\u903B\u8F91\u7248\u672C\uFF1A",g]}),(0,n.jsxs)("span",{style:{marginLeft:"10px"},children:["\u66F4\u65B0\u65F6\u95F4\uFF1A",l==null?void 0:l.updateTime]}),(0,n.jsxs)("span",{style:{marginLeft:"10px"},children:["\u540D\u79F0\uFF1A",l==null?void 0:l.name]})],nextId:"",config:l==null?void 0:l.configJson,configSchemaProvider:Wt})})})},$t=Ht}}]);
