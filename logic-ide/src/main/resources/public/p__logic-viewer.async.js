"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[5039],{88287:function(se,w,e){e.d(w,{Z:function(){return oe}});var z=e(57213),o=e.n(z),W=e(85772),p=e(87363),F=e.n(p),_=e(63466),q=e(21140),ae=e(52510),b=e(54306),ee=e.n(b),N=e(97944),K=e(47533),M=e(75904),G=e(47503),S=e(84191),H=e(49425),I=e(94744),y=e(33130),v=null,Y=function(h){var d=(0,N.Ik)(),A=(0,p.useContext)(K.r),a=A.logic;(0,p.useEffect)(function(){if(a){var i,g,j,B,k=I.y.getJsonByParams((i=a.variables)!==null&&i!==void 0?i:[]),U=(0,S.k)("_var",k),R=I.y.getJsonByParams((g=a.params)!==null&&g!==void 0?g:[]),Q=(0,S.k)("_par",R),le=I.y.getJsonByParams((j=a.returns)!==null&&j!==void 0?j:[]),re=(0,S.k)("_ret",le),ne=I.y.getJsonByParams((B=a.envs)!==null&&B!==void 0?B:[]),$=(0,S.k)("_env",ne);d==null||d.languages.typescript.javascriptDefaults.addExtraLib(U,"var.ts"),d==null||d.languages.typescript.javascriptDefaults.addExtraLib(Q,"input.ts"),d==null||d.languages.typescript.javascriptDefaults.addExtraLib(re,"return.ts"),d==null||d.languages.typescript.javascriptDefaults.addExtraLib($,"env.ts"),d==null||d.languages.typescript.javascriptDefaults.addExtraLib("let _lastRet:{}","lastRet.ts")}return function(){var V;console.log("effect dispose"),d==null||(V=d.current)===null||V===void 0||V.dispose()}},[a==null?void 0:a.params,a==null?void 0:a.variables,a==null?void 0:a.returns,a==null?void 0:a.envs]);var C=(0,p.useState)(!1),m=ee()(C,2),c=m[0],n=m[1];return(0,y.jsx)("div",{style:{width:"100%"},children:c?(0,y.jsx)(G.Z,{title:"js\u7F16\u8F91\u5668",centered:!0,width:1200,bodyStyle:{height:"80vh"},open:c,footer:null,onCancel:function(){return n(!1)},children:(0,y.jsx)(N.ML,o()(o()({theme:"vs-dark",defaultValue:h.value,defaultLanguage:h.language,options:{minimap:{enabled:!1}}},h),{},{height:"100%"}))}):(0,y.jsxs)("div",{children:[(0,y.jsx)(N.ML,o()({className:"editorByLoader",theme:"vs-dark",defaultValue:h.value,defaultLanguage:h.language,onMount:function(g){var j;(j=g.getAction("editor.action.formatDocument"))===null||j===void 0||j.run(),g.setValue(g.getValue())},options:{minimap:{enabled:!1}},height:500},h)),(0,y.jsx)(M.ZP,{size:"small",type:"text",icon:(0,y.jsx)(H.Z,{}),style:{position:"absolute",top:0,right:0,margin:"10px",color:"whitesmoke"},onClick:function(){return n(!0)}})]})})},J=F().memo(Y),te=null,Z=function(h){return(0,y.jsx)(J,o()(o()({},h),{},{language:"json"}))},s=Z,t=null,E=function(h){return(0,y.jsx)(J,o()(o()({},h),{},{language:"javascript"}))},r=E,f=e(16414),u=function(h){return(0,p.useEffect)(function(){N._m.config({monaco:f})},[]),(0,y.jsx)(W.ZP,o()({widgets:{json:s,js:r}},h))},P=u,O=u||P,oe=function(l){var h,d=(0,W.cI)(),A=l.configSchemaProvider,a=function(c){var n,i,g;(n=l.editNode)===null||n===void 0||n.setAttrByPath("text/text",c.name);var j=(i=l.editNode)===null||i===void 0?void 0:i.data.config;l.editNode&&l.editNode.setData({config:o()(o()({},j),c)}),console.log("submit---props.editNode.data.config"),console.log((g=l.editNode)===null||g===void 0?void 0:g.data.config),l==null||l.onSubmit()},C=function(c){if(c&&c.data){var n,i=c.data.config||{},g=c.attrs;return i.name=g==null||(n=g.text)===null||n===void 0?void 0:n.text,i}else return{name:""}};return(0,p.useEffect)(function(){if(l.editNode&&l.editNode.data){var m=l.editNode.data.config||{};A(l.editNode.data.configSchema||m.type).then(function(c){var n,i=l.editNode.attrs;m.name=i==null||(n=i.text)===null||n===void 0?void 0:n.text,console.log("nodeConfigSchema"),console.log(c),d.setSchema(c,!0),d.resetFields(),d.setValues(m)})}},[l.editNode,(h=l.editNode)===null||h===void 0?void 0:h.data]),(0,y.jsx)("div",{children:(0,y.jsx)(O,{form:d,onFinish:a,onReset:function(){var c=C(l.editNode);d.setValues(c)},footer:!!l.onSubmit})})}},98257:function(se,w,e){e.r(w),e.d(w,{default:function(){return d}});var z=e(54306),o=e.n(z),W=e(25359),p=e.n(W),F=e(49811),_=e.n(F),q=e(14990),ae=e(22465),b=e(5671),ee=e(17696),N=e(19227),K=e(75476),M=e(1167),G=e(22150),S=e(58856),H=e(40767),I=e(75904),y=e(18725),v=e(87363),Y=e(10486),J=e(14232),te=e(37555),Z=e(59998),s=e(88287),t=e(33130),E=function(a){var C,m=(0,v.useState)(),c=o()(m,2),n=c[0],i=c[1],g=(0,v.useState)(),j=o()(g,2),B=j[0],k=j[1],U=(0,v.useState)(!1),R=o()(U,2),Q=R[0],le=R[1],re=(0,v.useState)(!0),ne=o()(re,2),$=ne[0],V=ne[1],fe=(0,v.useState)(),de=o()(fe,2),ie=de[0],ge=de[1],he=(0,v.useState)(),ue=o()(he,2),me=ue[0],pe=ue[1],ce=(0,v.useRef)();(0,v.useEffect)(function(){ie&&(n==null||n.centerCell(ie))},[ie,n]),(0,v.useEffect)(function(){var L=n==null?void 0:n.getNodes().find(function(X){return X.id==a.nextId});L==null||L.attr("body/fill","red"),ge(L)},[a.nextId]),(0,v.useEffect)(function(){var L;n==null||(L=n.getNodes().find(function(X){return X.id==a.nextId}))===null||L===void 0||L.attr("body/fill","red")},[n]),(0,v.useEffect)(function(){a.config&&k(a.config)},[a.config]),(0,v.useEffect)(function(){if(B){try{var L=(0,Y.K)(),X=L.Shapes;(0,J.m)(X)}catch(D){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(D)}var x=new b.kJ({container:ce.current,embedding:{enabled:!0,validate:function(T){return T.child.setData({hoverNode:T.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new b.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(T){var ve=T.targetMagnet;return!!ve}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}},background:{color:"#F2F7FA"},grid:!0});x.use(new M.H({enabled:!0,sharp:!0})).use(new ee.A({enabled:!0})).use(new K.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new G.T({enabled:!0})).use(new N.N),x.on("edge:dblclick",function(){}),x.on("edge:mouseenter",function(){}),x.on("edge:mouseleave",function(){}),x.on("node:moved",function(){}),x.on("node:mouseenter",function(){}),x.on("node:mouseleave",function(){}),x.on("node:added",function(){}),x.on("node:dblclick",function(D){var T=D.node;V(!1)}),x==null||x.on("node:click",function(D){var T=D.node;pe(T)}),x.on("blank:dblclick",function(D){var T=D.x,ve=D.y}),x.fromJSON(B.visualConfig),(0,Z.V)(x),i(x)}},[B]);var ye=[{key:"2",label:"\u8282\u70B9\u914D\u7F6E",children:(0,t.jsx)(s.Z,{editNode:me,configSchemaProvider:a.configSchemaProvider})}];return(0,t.jsxs)(S.Z,{style:{margin:0,height:"100vh"},children:[(0,t.jsxs)(S.Z,{style:{},children:[(0,t.jsxs)(S.Z.Header,{style:{padding:0,backgroundColor:"white"},children:[(0,t.jsx)(H.Z,{direction:"horizontal",children:(C=a.btns)===null||C===void 0?void 0:C.map(function(L){return L})}),(0,t.jsx)(I.ZP,{type:"text",icon:$?(0,t.jsx)(q.Z,{}):(0,t.jsx)(ae.Z,{}),onClick:function(){V(!$)},style:{float:"right",right:"16px",fontSize:"16px",width:64,height:64}})]}),(0,t.jsx)(S.Z.Content,{className:"app-content",children:(0,t.jsx)(te.Z,{ref:ce})})]}),(0,t.jsxs)(S.Z.Sider,{theme:"light",collapsed:$,collapsedWidth:0,style:{overflow:"scroll"},title:"ddd",width:500,children:[(0,t.jsx)(I.ZP,{type:"text",onClick:function(){V(!$)},style:{float:"right",fontSize:"16px",width:64,height:64},children:"x"}),(0,t.jsx)(y.Z,{items:ye,defaultActiveKey:"1"})]})]})},r=E,f=e(48364),u=e(61719),P=e(52615),O=e(70517),oe=e(98306),l=function(){var A=_()(p()().mark(function a(C){var m;return p()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,O.Z.get("/setting/node-form/".concat(C,".json"));case 2:return m=n.sent,console.log(m.data),n.abrupt("return",m.data);case 5:case"end":return n.stop()}},a)}));return function(C){return A.apply(this,arguments)}}(),h=function(){var a=(0,oe.UO)(),C=a.id,m=a.version,c=(0,v.useState)(),n=o()(c,2),i=n[0],g=n[1],j=(0,v.useState)(!1),B=o()(j,2),k=B[0],U=B[1];return(0,v.useEffect)(function(){U(!0),C&&(0,f.Uh)(C,m).then(function(R){var Q=R;Q.configJson.id=C,g(Q),U(!1)}).catch(function(R){U(!1),console.log("err"),console.log(R)})},[C]),(0,t.jsx)("div",{children:(0,t.jsx)(P.Z,{spinning:k,children:(0,t.jsx)(r,{btns:[(0,t.jsxs)("span",{style:{marginLeft:"25px",color:"red"},children:["\u903B\u8F91\u7248\u672C\uFF1A",m]}),(0,t.jsxs)("span",{style:{marginLeft:"10px"},children:["\u66F4\u65B0\u65F6\u95F4\uFF1A",i==null?void 0:i.updateTime]}),(0,t.jsxs)("span",{style:{marginLeft:"10px"},children:["\u540D\u79F0\uFF1A",i==null?void 0:i.name]})],nextId:"",config:i==null?void 0:i.configJson,configSchemaProvider:l})})})},d=h},48364:function(se,w,e){e.d(w,{Uh:function(){return te},YH:function(){return K},az:function(){return G},b9:function(){return Y},gC:function(){return y},m9:function(){return H}});var z=e(25359),o=e.n(z),W=e(49811),p=e.n(W),F=e(70517),_=e(5726),q=e.n(_);function ae(s){return b.apply(this,arguments)}function b(){return b=_asyncToGenerator(_regeneratorRuntime().mark(function s(t){return _regeneratorRuntime().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",axios.post("/api/ide/pub/logic/dev-to-test".concat(t)));case 1:case"end":return r.stop()}},s)})),b.apply(this,arguments)}function ee(s){return N.apply(this,arguments)}function N(){return N=_asyncToGenerator(_regeneratorRuntime().mark(function s(t){return _regeneratorRuntime().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",axios.get("/api/ide/logic/".concat(t)));case 1:case"end":return r.stop()}},s)})),N.apply(this,arguments)}function K(s){return M.apply(this,arguments)}function M(){return M=p()(o()().mark(function s(t){return o()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",F.Z.get("/api/ide/logic/".concat(t,"/config")).then(function(f){var u;return(u=f.data)===null||u===void 0?void 0:u.data}));case 1:case"end":return r.stop()}},s)})),M.apply(this,arguments)}function G(s,t,E){return S.apply(this,arguments)}function S(){return S=p()(o()().mark(function s(t,E,r){return o()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",F.Z.put("/api/ide/logic/edit/".concat(t),{version:E,configJson:r,updateTime:q()().format("YYYY-MM-DD HH:mm:ss")}));case 1:case"end":return u.stop()}},s)})),S.apply(this,arguments)}function H(s){return I.apply(this,arguments)}function I(){return I=p()(o()().mark(function s(t){return o()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",F.Z.get("/api/ide/logic-instance/".concat(t)).then(function(f){var u=f.data.data;return u}));case 1:case"end":return r.stop()}},s)})),I.apply(this,arguments)}function y(s){return v.apply(this,arguments)}function v(){return v=p()(o()().mark(function s(t){return o()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",F.Z.post("/api/ide/logic-logs",{filters:[{dataIndex:"logicId",values:[t.logicId],type:"="},{dataIndex:"bizId",values:[t.bizId],type:"="}],pageSize:1e3,orderBy:[{dataIndex:"id",desc:!0}]}).then(function(f){var u=f.data.data.records;return u&&u.map(function(P){P.itemLogs&&(P.itemLogs=JSON.parse(P.itemLogs))}),u}));case 1:case"end":return r.stop()}},s)})),v.apply(this,arguments)}function Y(s,t){return J.apply(this,arguments)}function J(){return J=p()(o()().mark(function s(t,E){return o()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",F.Z.post("/api/ide/logic-baks",{filters:[{dataIndex:"id",values:[t],type:"="},{dataIndex:"version",values:[E],type:"="}]}).then(function(u){var P=u.data.data.records[0].configJson,O=JSON.parse(P);return O}));case 1:case"end":return f.stop()}},s)})),J.apply(this,arguments)}function te(s,t){return Z.apply(this,arguments)}function Z(){return Z=p()(o()().mark(function s(t,E){return o()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",F.Z.post("/api/ide/logic-baks",{filters:[{dataIndex:"id",values:[t],type:"="},{dataIndex:"version",values:[E],type:"="}]}).then(function(u){var P=u.data.data.records[0],O=P.configJson;return P.configJson=JSON.parse(O),P}));case 1:case"end":return f.stop()}},s)})),Z.apply(this,arguments)}}}]);
