"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[961],{961:function(S,A,w){w.r(A),w.d(A,{MatrixRenderer:function(){return P},default:function(){return D}});var a=w(15767),O=w(87363),u=w.n(O),y=w(42977),M=w(94391),N=w(45581),D=function(k){(0,a.ZT)(l,k);function l(t){var e=k.call(this,t)||this;return e.mounted=!1,e.toDispose=[],e.state={columns:t.columns||[],rows:t.rows||[],loading:!1},e.toggleItem=e.toggleItem.bind(e),e.reload=e.reload.bind(e),e.initOptions=e.initOptions.bind(e),e.mounted=!0,e}return l.prototype.componentDidMount=function(){var t=this.props,e=t.formInited,r=t.addHook,n=t.formItem;n&&this.toDispose.push(e||!r?n.addInitHook(this.initOptions):r(this.initOptions,"init"))},l.prototype.componentDidUpdate=function(t){var e=this.props;if(t.columns!==e.columns||t.rows!==e.rows)this.setState({columns:e.columns||[],rows:e.rows||[]});else if(e.formInited&&(e.source!==t.source||t.data!==e.data)){var r=(0,y.xkX)(t.source,t.data,{ignoreData:!0}),n=(0,y.xkX)(e.source,e.data,{ignoreData:!0});r.url!==n.url&&(0,y.Few)(n.url)&&this.reload()}},l.prototype.componentWillUnmount=function(){this.mounted=!1,this.toDispose.forEach(function(t){return t()}),this.toDispose=[]},l.prototype.doAction=function(t,e,r){var n,o,i=this.props,c=i.resetValue,d=i.onChange,h=i.formStore,C=i.store,g=i.name,f=t==null?void 0:t.actionType;if(f==="clear")d==null||d("");else if(f==="reset"){var s=(o=(0,y.E04)((n=h==null?void 0:h.pristine)!==null&&n!==void 0?n:C==null?void 0:C.pristine,g))!==null&&o!==void 0?o:c;d==null||d(s!=null?s:"")}},l.prototype.initOptions=function(t){return(0,a.mG)(this,void 0,void 0,function(){var e,r,n;return(0,a.Jh)(this,function(o){switch(o.label){case 0:return[4,this.reload()];case 1:return o.sent(),e=this.props,r=e.formItem,n=e.name,r?(r.value&&(0,y.NI0)(t,n,r.value),[2]):[2]}})})},l.prototype.reload=function(){return(0,a.mG)(this,void 0,void 0,function(){var t,e,r,n,o,i,c=this;return(0,a.Jh)(this,function(d){switch(d.label){case 0:if(t=this.props,e=t.source,r=t.data,n=t.env,o=t.onChange,i=t.translate,!(0,y.X1t)(e,r)||this.state.loading)return[2];if(!n||!n.fetcher)throw new Error("fetcher is required");return[4,new Promise(function(h,C){if(!c.mounted)return h();c.setState({loading:!0},function(){if(!c.mounted)return h();n.fetcher(e,r).then(function(g){if(!g.ok)throw new Error(g.msg||i("fetchFailed"));if(!c.mounted)return h();c.setState({loading:!1,rows:g.data.rows||[],columns:g.data.columns||[]},function(){var f=e&&e.replaceData,s=g.data.value;s&&(s=e.replaceData?s:R(s,c.state.columns,c.state.rows),o(s)),h()})}).catch(function(g){return c.setState({error:g,loading:!1},function(){return h()})})})})];case 1:return[2,d.sent()]}})})},l.prototype.toggleItem=function(t,e,r){return(0,a.mG)(this,void 0,void 0,function(){var n,o,i,c,d,h,C,g,f,v,p,s,p,s,p,v,E,b;return(0,a.Jh)(this,function(m){switch(m.label){case 0:if(n=this.state,o=n.columns,i=n.rows,c=this.props,d=c.multiple,h=c.singleSelectMode,C=c.dispatchEvent,g=c.data,f=this.props.value||x(o,i),d)f[e][r]=(0,a.pi)((0,a.pi)({},f[e][r]),{checked:t});else if(h==="row")for(v=0,p=o.length;v<p;v++)f[v][r]=(0,a.pi)((0,a.pi)({},f[v][r]),{checked:e===v?t:!t});else if(h==="column")for(s=0,p=i.length;s<p;s++)f[e][s]=(0,a.pi)((0,a.pi)({},f[e][s]),{checked:r===s?t:!t});else for(s=0,p=i.length;s<p;s++)for(v=0,E=o.length;v<E;v++)f[v][s]=(0,a.pi)((0,a.pi)({},f[v][s]),{checked:e===v&&r===s?t:!t});return[4,C("change",(0,y.vXk)(this.props,{value:f.concat()}))];case 1:return b=m.sent(),b!=null&&b.prevented?[2]:(this.props.onChange(f.concat()),[2])}})})},l.prototype.isColumChecked=function(t,e){var r=t[e];return r?r.some(function(n){return n&&n.checked}):!1},l.prototype.isColumnPartialChecked=function(t,e){var r=t[e];if(!r||r.length==1)return!1;var n=r[0].checked;return r.some(function(o){return o.checked!==n})&&!r.every(function(o){return o.checked===n})},l.prototype.toggleColumnCheckAll=function(t,e,r){return(0,a.mG)(this,void 0,void 0,function(){var n,o;return(0,a.Jh)(this,function(i){switch(i.label){case 0:n=e[r],o=0,i.label=1;case 1:return o<n.length?[4,this.toggleItem(t,r,o)]:[3,4];case 2:i.sent(),i.label=3;case 3:return o++,[3,1];case 4:return[2]}})})},l.prototype.isRowChecked=function(t,e){return t&&t.some(function(r){return r[e]&&r[e].checked})},l.prototype.isRowPartialChecked=function(t,e){if(!t||t.length==1)return!1;var r=t[0][e].checked;return t.some(function(n){return r!==n[e].checked})&&!t.every(function(n){return n.checked})},l.prototype.toggleRowCheckAll=function(t,e,r){return(0,a.mG)(this,void 0,void 0,function(){var n;return(0,a.Jh)(this,function(o){switch(o.label){case 0:n=0,o.label=1;case 1:return n<e.length?[4,this.toggleItem(t,n,r)]:[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},l.prototype.renderInput=function(t){var e=this;t===void 0&&(t=!1);var r=this.state,n=r.columns,o=r.rows,i=this.props,c=i.rowLabel,d=i.disabled,h=i.classnames,C=i.multiple,g=i.textAlign,f=i.xCheckAll,s=i.yCheckAll,p=i.testIdBuilder,v=i.mobileUI,E=this.props.value||x(n,o);return u().createElement("div",{className:h("Table m-b-none",{"is-mobile":v})},u().createElement("div",{className:h("Table-content")},u().createElement("table",{className:h("Table-table")},u().createElement("thead",null,u().createElement("tr",null,u().createElement("th",null,c),n.map(function(b,m){return u().createElement("th",{key:m,className:"text-"+(g||C?"left":"center")},C&&s?u().createElement(M.XZJ,{type:"checkbox",disabled:t||d,checked:e.isColumChecked(E,m),partial:e.isColumnPartialChecked(E,m),onChange:function(_){return e.toggleColumnCheckAll(_,E,m)}}):null,b.label)}))),u().createElement("tbody",null,o.map(function(b,m){return u().createElement("tr",{key:m},u().createElement("td",null,C&&f?u().createElement(M.XZJ,{type:"checkbox",disabled:t||d,checked:e.isRowChecked(E,m),partial:e.isRowPartialChecked(E,m),onChange:function(_){return e.toggleRowCheckAll(_,E,m)},testIdBuilder:p==null?void 0:p.getChild(m)}):null,b.label,b.description||b.desc?u().createElement("span",{className:"m-l-xs text-muted text-xs"},b.description||b.desc):null),n.map(function(_,I){return u().createElement("td",{key:I,className:"text-"+(g||C?"left":"center")},u().createElement(M.XZJ,{type:C?"checkbox":"radio",disabled:t||d,checked:!!(E[I]&&E[I][m]&&E[I][m].checked),onChange:function(T){return e.toggleItem(T,I,m)},testIdBuilder:p==null?void 0:p.getChild("".concat(I,"-").concat(m))}))}))})))))},l.prototype.renderStatic=function(t){t===void 0&&(t="-");var e=this.props,r=e.className,n=e.render,o=e.classnames,i=this.state.error;return u().createElement("div",{key:"input",className:o("MatrixControl",r||"")},i?t:this.renderInput(!0))},l.prototype.render=function(){var t=this.props,e=t.className,r=t.render,n=t.classnames,o=t.loadingConfig,i=this.state,c=i.error,d=i.loading;return u().createElement("div",{key:"input",className:n("MatrixControl",e||"")},c?u().createElement("div",{className:n("MatrixControl-error Alert Alert--danger")},String(c)):this.renderInput(),u().createElement(M.$jN,{size:"lg",overlay:!0,key:"info",show:d,loadingConfig:o}))},l.defaultProps={columns:[],rows:[],multiple:!0,singleSelectMode:"column"},(0,a.gn)([(0,N.i)(),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[]),(0,a.w6)("design:returntype",void 0)],l.prototype,"render",null),l}(u().Component);function x(k,l){return Array.isArray(k)||(k=[]),Array.isArray(l)||(l=[]),k.map(function(t){return l.map(function(e){return(0,a.pi)((0,a.pi)((0,a.pi)({},e),t),{checked:!1})})})}function R(k,l,t){return k.map(function(e,r){return e.map(function(n,o){return(0,a.pi)((0,a.pi)((0,a.pi)({},l[r]),t[o]),n)})})}var P=function(k){(0,a.ZT)(l,k);function l(){return k!==null&&k.apply(this,arguments)||this}return l=(0,a.gn)([(0,y.xJW)({type:"matrix-checkboxes",strictMode:!1,sizeMutable:!1})],l),l}(D)}}]);
