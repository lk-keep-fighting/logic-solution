"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[5315],{19435:function(Ie,H,e){e.d(H,{O:function(){return A},A:function(){return ee.Z}});var ee=e(28576),x=e(54306),p=e.n(x),I=e(8049),te=e(14990),ne=e(22465),oe=e(5671),ae=e(17696),ie=e(19227),K=e(75476),M=e(1167),U=e(22150),F=e(40767),G=e(38243),L=e(58856),Q=e(22983),h=e(39092),C=e(75904),ge=e(18725),c=e(87363),X=e.n(c),he=e(10486),$=e(14232),se=e(37555),me=e(59998),re=e(72107),le=e(88287),Y=e(23620),n=e(33130),de=X().createContext({logic:new re.Iz("")}),ue=function(i){var l,b=(0,c.useState)(),f=p()(b,2),s=f[0],Z=f[1],r=(0,c.useState)(),v=p()(r,2),t=v[0],m=v[1],S=(0,c.useState)(!1),B=p()(S,2),k=B[0],T=B[1],z=(0,c.useState)(!0),J=p()(z,2),P=J[0],D=J[1],w=(0,c.useState)(),V=p()(w,2),R=V[0],xe=V[1],Ce=(0,c.useState)(),ye=p()(Ce,2),j=ye[0],Le=ye[1],Se=(0,c.useState)(),ve=p()(Se,2),q=ve[0],Ze=ve[1],je=(0,c.useState)(),ce=p()(je,2),Pe=ce[0],Ee=ce[1],pe=(0,c.useState)(),fe=p()(pe,2),Fe=fe[0],Ae=fe[1],E=(0,c.useRef)(),g=function(y){var o=y.node;Ee(o);var d=j==null?void 0:j.itemLogs.find(function(N){return N.config.id==o.id});xe(d)};(0,c.useEffect)(function(){q&&(s==null||s.centerCell(q))},[q,s]),(0,c.useEffect)(function(){console.log("play curItemLog",R)},[R]),(0,c.useEffect)(function(){var a=s==null?void 0:s.getNodes().find(function(y){return y.id==i.nextId});a==null||a.attr("body/fill","red"),Ze(a)},[i.nextId]),(0,c.useEffect)(function(){var a;s==null||(a=s.getNodes().find(function(y){return y.id==i.nextId}))===null||a===void 0||a.attr("body/fill","red")},[s]),(0,c.useEffect)(function(){i.config&&m(i.config)},[i.config]),(0,c.useEffect)(function(){var a,y;console.log("props.debugLogs",i.debugLogs),((a=i.debugLogs)===null||a===void 0?void 0:a.length)>0&&setInterval(W,2e3);var o=[];i&&((y=i.debugLogs)===null||y===void 0||y.forEach(function(d){var N,_;o.push({children:(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("span",{style:{cursor:"pointer",fontWeight:d.id==(j==null?void 0:j.id)?"bolder":"normal",color:d.id==(j==null?void 0:j.id)?"#52c41a":"black"},onClick:function(){Le(d),console.log(d),s==null||s.fromJSON(t==null?void 0:t.visualConfig);var Be;d.itemLogs.forEach(function(Te){var Ne=s==null?void 0:s.getNodes().find(function(Je){return Je.id==Te.config.id});Ne&&(Ne.attr("body/fill","#52c41a"),Be=Ne)}),s==null||s.centerCell(Be),xe({}),Ee({})},children:[(0,n.jsx)("p",{children:(N=d.itemLogs[0])===null||N===void 0?void 0:N.config.name}),((_=i.logicIns)===null||_===void 0?void 0:_.version)==d.version?(0,n.jsx)("p",{}):(0,n.jsx)("p",{children:(0,n.jsxs)(F.Z,{children:[(0,n.jsx)(G.Z.Paragraph,{style:{color:"red"},children:"\u7248\u672C\u53F7:"}),(0,n.jsxs)(G.Z.Paragraph,{copyable:{tooltips:["\u70B9\u51FB\u590D\u5236","\u590D\u5236\u6210\u529F!"],text:d.version},children:[d.version,(0,n.jsx)(G.Z.Link,{style:{margin:"5px"},href:"#/assets/logic/i/".concat(d.logicId,"/view/").concat(d.version),target:"_blank",children:(0,n.jsx)(I.Z,{})})]})]})}),(0,n.jsxs)("p",{children:["\u4E1A\u52A1\u6807\u8BC6\uFF1A",d.bizId]}),(0,n.jsx)("p",{children:d.serverTime}),(0,n.jsx)("p",{children:d.message})]})}),color:d.success?"green":"red"})})),Ae(o)},[i.debugLogs,i.logicIns,s,j]),(0,c.useEffect)(function(){if(t){try{var a=(0,he.K)(),y=a.Shapes;(0,$.m)(y)}catch(d){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(d)}var o=new oe.kJ({container:E.current,embedding:{enabled:!0,validate:function(N){return N.child.setData({hoverNode:N.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new oe.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(N){var _=N.targetMagnet;return!!_}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}},background:{color:"#F2F7FA"},grid:!0});o.use(new M.H({enabled:!0,sharp:!0})).use(new ae.A({enabled:!0})).use(new K.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new U.T({enabled:!0})).use(new ie.N),o.on("edge:dblclick",function(){}),o.on("edge:mouseenter",function(){}),o.on("edge:mouseleave",function(){}),o.on("node:moved",function(){}),o.on("node:mouseenter",function(){}),o.on("node:mouseleave",function(){}),o.on("node:added",function(){}),o.on("node:dblclick",function(d){var N=d.node;D(!1)}),o.on("blank:dblclick",function(d){var N=d.x,_=d.y}),o.fromJSON(t.visualConfig),(0,me.V)(o),Z(o)}},[t]),(0,c.useEffect)(function(){s==null||s.off("node:click",g),s==null||s.on("node:click",g)},[j]);var W=function(){},O=[{key:"1",label:"\u65E5\u5FD7",children:(0,n.jsx)(Y.gcu,{src:R})},{key:"2",label:"\u8282\u70B9\u914D\u7F6E",children:(0,n.jsx)(le.Z,{editNode:Pe,configSchemaProvider:i.configSchemaProvider})}];return(0,n.jsxs)(L.Z,{style:{margin:0,height:"100vh"},children:[(0,n.jsxs)(L.Z.Sider,{theme:"light",collapsedWidth:0,width:300,style:{overflow:"auto",height:"100vh",position:"fixed",left:0,top:0,bottom:0,borderRight:"0.5px solid"},children:[(0,n.jsx)(Q.Z,{children:"\u6700\u8FD1\u8BF7\u6C42"}),(0,n.jsx)(h.Z,{style:{height:"100%"},items:Fe})]}),(0,n.jsxs)(L.Z,{style:{marginLeft:300},children:[(0,n.jsxs)(L.Z.Header,{style:{backgroundColor:"white",padding:0},children:[(0,n.jsxs)(F.Z,{direction:"horizontal",style:{},children:[(0,n.jsx)(Q.Z,{type:"vertical"}),(l=i.btns)===null||l===void 0?void 0:l.map(function(a){return a})]}),(0,n.jsx)(C.ZP,{type:"text",icon:P?(0,n.jsx)(te.Z,{}):(0,n.jsx)(ne.Z,{}),onClick:function(){D(!P)},style:{float:"right",right:"16px",fontSize:"16px",width:64,height:64}})]}),(0,n.jsx)(L.Z.Content,{className:"app-content",children:(0,n.jsx)(se.Z,{ref:E})})]}),(0,n.jsxs)(L.Z.Sider,{theme:"light",collapsed:P,collapsedWidth:0,style:{overflow:"scroll"},title:"ddd",width:500,children:[(0,n.jsx)(C.ZP,{type:"text",onClick:function(){D(!P)},style:{float:"right",fontSize:"16px",width:64,height:64},children:"x"}),(0,n.jsx)(ge.Z,{items:O,defaultActiveKey:"1"})]})]})},A=ue},88287:function(Ie,H,e){e.d(H,{Z:function(){return A}});var ee=e(57213),x=e.n(ee),p=e(61293),I=e(87363),te=e.n(I),ne=e(63466),oe=e(21140),ae=e(52510),ie=e(54306),K=e.n(ie),M=e(97944),U=e(28576),F=e(75904),G=e(47503),L=e(84191),Q=e(49425),h=e(94744),C=e(33130),ge=null,c=function(i){var l=(0,M.Ik)(),b=(0,I.useContext)(U.r),f=b.logic;(0,I.useEffect)(function(){if(f){var t,m,S,B,k=h.y.getJsonByParams((t=f.variables)!==null&&t!==void 0?t:[]),T=(0,L.k)("_var",k),z=h.y.getJsonByParams((m=f.params)!==null&&m!==void 0?m:[]),J=(0,L.k)("_par",z),P=h.y.getJsonByParams((S=f.returns)!==null&&S!==void 0?S:[]),D=(0,L.k)("_ret",P),w=h.y.getJsonByParams((B=f.envs)!==null&&B!==void 0?B:[]),V=(0,L.k)("_env",w);l==null||l.languages.typescript.javascriptDefaults.addExtraLib(T,"var.ts"),l==null||l.languages.typescript.javascriptDefaults.addExtraLib(J,"input.ts"),l==null||l.languages.typescript.javascriptDefaults.addExtraLib(D,"return.ts"),l==null||l.languages.typescript.javascriptDefaults.addExtraLib(V,"env.ts"),l==null||l.languages.typescript.javascriptDefaults.addExtraLib("let _lastRet:{}","lastRet.ts")}return function(){var R;console.log("effect dispose"),l==null||(R=l.current)===null||R===void 0||R.dispose()}},[f==null?void 0:f.params,f==null?void 0:f.variables,f==null?void 0:f.returns,f==null?void 0:f.envs]);var s=(0,I.useState)(!1),Z=K()(s,2),r=Z[0],v=Z[1];return(0,C.jsx)("div",{style:{width:"100%"},children:r?(0,C.jsx)(G.Z,{title:"js\u7F16\u8F91\u5668",centered:!0,width:1200,bodyStyle:{height:"80vh"},open:r,footer:null,onCancel:function(){return v(!1)},children:(0,C.jsx)(M.ML,x()(x()({theme:"vs-dark",defaultValue:i.value,defaultLanguage:i.language,options:{minimap:{enabled:!1}}},i),{},{height:"100%"}))}):(0,C.jsxs)("div",{children:[(0,C.jsx)(M.ML,x()({className:"editorByLoader",theme:"vs-dark",defaultValue:i.value,defaultLanguage:i.language,onMount:function(m){var S;(S=m.getAction("editor.action.formatDocument"))===null||S===void 0||S.run(),m.setValue(m.getValue())},options:{minimap:{enabled:!1}},height:500},i)),(0,C.jsx)(F.ZP,{size:"small",type:"text",icon:(0,C.jsx)(Q.Z,{}),style:{position:"absolute",top:0,right:0,margin:"10px",color:"whitesmoke"},onClick:function(){return v(!0)}})]})})},X=te().memo(c),he=null,$=function(i){return(0,C.jsx)(X,x()(x()({},i),{},{language:"json"}))},se=$,me=null,re=function(i){return(0,C.jsx)(X,x()(x()({},i),{},{language:"javascript"}))},le=re,Y=e(16414),n=function(i){return(0,I.useEffect)(function(){M._m.config({monaco:Y})},[]),(0,C.jsx)(p.ZP,x()({widgets:{json:se,js:le}},i))},de=n,ue=n||de,A=function(u){var i,l=(0,p.cI)(),b=u.configSchemaProvider,f=function(r){var v,t,m;(v=u.editNode)===null||v===void 0||v.setAttrByPath("text/text",r.name);var S=(t=u.editNode)===null||t===void 0?void 0:t.data.config;u.editNode&&u.editNode.setData({config:x()(x()({},S),r)}),console.log("submit---props.editNode.data.config"),console.log((m=u.editNode)===null||m===void 0?void 0:m.data.config),u==null||u.onSubmit()},s=function(r){if(r&&r.data){var v,t=r.data.config||{},m=r.attrs;return t.name=m==null||(v=m.text)===null||v===void 0?void 0:v.text,t}else return{name:""}};return(0,I.useEffect)(function(){if(u.editNode&&u.editNode.data){var Z=u.editNode.data.config||{};b(u.editNode.data.configSchema||Z.type).then(function(r){var v,t=u.editNode.attrs;Z.name=t==null||(v=t.text)===null||v===void 0?void 0:v.text,console.log("nodeConfigSchema"),console.log(r),l.setSchema(r,!0),l.resetFields(),l.setValues(Z)})}},[u.editNode,(i=u.editNode)===null||i===void 0?void 0:i.data]),(0,C.jsx)("div",{children:(0,C.jsx)(ue,{form:l,onFinish:f,onReset:function(){var r=s(u.editNode);l.setValues(r)},footer:!!u.onSubmit})})}},81201:function(Ie,H,e){e.r(H),e.d(H,{default:function(){return Z}});var ee=e(54306),x=e.n(ee),p=e(98306),I={editorContainer:"editorContainer___czC1W"},te=e(21140),ne=e.n(te),oe=e(63466),ae=e.n(oe),ie=e(58853),K=e.n(ie),M=e(38888),U=e.n(M),F=e(87363),G=e(63204),L=e(23620),Q=e(19435),h=e(33130),C=function(r){K()(t,r);var v=U()(t);function t(){return ne()(this,t),v.apply(this,arguments)}return ae()(t,[{key:"render",value:function(){return(0,h.jsx)(Q.A,{})}}]),t}(F.Component);(0,L.Thl)({type:"logic",autoVar:!0})(C);var ge=function(r){K()(t,r);var v=U()(t);function t(){return ne()(this,t),v.apply(this,arguments)}return ae()(t,[{key:"render",value:function(){var S,B="cxd",k="zh-CN",T=this.props,z=T.pageSchmea,J=T.preview,P=T.isMobile,D=T.onChange;return(0,h.jsx)(G.MLE,{value:z,isMobile:P,preview:J,onChange:D,showCustomRenderersPanel:!0})}}]),t}(F.Component),c=ge,X=e(38243),he=e(40767),$=e(75904),se=e(22983),me=e(46464),re=e(54882),le=e(43702),Y=e(52943),n=e(90010),de=e.n(n),ue=e(56868),A=e(70517),u=e(70256),i=e(33358),l=e(49500),b=e(16123),f=e(82162);A.Z.interceptors.response.use(function(r){return console.log("axios config"),console.log(r),r.data?r:Promise.reject(new Error(r.data.message))},function(r){if(console.log("axios error"),r.response.data){var v=r.response;return console.log("--\u300Bdata\u6709\u8FD4\u56DE\u503C\uFF0C\u5224\u5B9A\u4E3A\u4E1A\u52A1\u5F02\u5E38\uFF0C\u7EE7\u7EED\u8FD4\u56DEresponse\uFF01"),console.log(v),v}return Promise.reject(r)});var s=function(v){var t="cxd",m="zh-CN",S=(0,p.UO)(),B=S.render,k=S.id,T=(0,F.useState)({}),z=x()(T,2),J=z[0],P=z[1];(0,F.useEffect)(function(){console.log("Editor"),console.log(B),(0,u.n4)(B,k).then(function(E){return P(E)})},[k]);var D=(0,F.useState)(!1),w=x()(D,2),V=w[0],R=w[1],xe=(0,F.useState)(!1),Ce=x()(xe,2),ye=Ce[0],j=Ce[1],Le=(0,F.useState)(!1),Se=x()(Le,2),ve=Se[0],q=Se[1],Ze=(0,F.useState)(""),je=x()(Ze,2),ce=je[0],Pe=je[1],Ee=(0,F.useState)(""),pe=x()(Ee,2),fe=pe[0],Fe=pe[1],Ae=X.Z.Text;return(0,h.jsxs)("div",{className:I.editorContainer,children:[(0,h.jsxs)(he.Z,{style:{margin:"5px",float:"right"},children:[(0,h.jsx)($.ZP,{onClick:function(){return R(!V)},children:V?"\u7F16\u8F91":"\u9884\u89C8"},1),(0,h.jsx)($.ZP,{type:"primary",onClick:function(g){de()(JSON.stringify(J))},children:"\u590D\u5236\u914D\u7F6E"},2)]}),(0,h.jsx)(se.Z,{style:{margin:"0px"}}),(0,h.jsx)(c,{pageSchmea:J,preview:V,onChange:function(g){return P(g)},style:{height:"100vh"}}),(0,h.jsxs)(me.Z,{open:ye,confirmLoading:ve,title:"\u914D\u7F6E\u751F\u6210\u5C0F\u52A9\u624B(Beta)",cancelText:"\u53D6\u6D88",okText:"\u4F7F\u7528\u914D\u7F6E",width:800,onOk:function(){j(!1),P(JSON.parse(fe))},onCancel:function(){return j(!1)},children:[(0,h.jsx)(re.Z.TextArea,{style:{margin:"5px"},placeholder:'\u8F93\u5165\u4E00\u6BB5\u9700\u6C42\uFF0C\u5982"\u751F\u6210\u4E00\u4E2A\u4EFB\u52A1\u7BA1\u7406\u754C\u9762\uFF0C\u4EFB\u52A1\u4FE1\u606F\u5305\u542B\u4EFB\u52A1\u53F7id\u3001\u65F6\u95F4time\u3001\u8D1F\u8D23\u4EBAmgr_user',onChange:function(g){return Pe(g.target.value)}}),(0,h.jsx)($.ZP,{loading:ve,onClick:function(){if(ce.length==0){le.ZP.warning("\u8BF7\u8F93\u5165\u4E00\u6BB5\u9700\u6C42\u63D0\u793A");return}j(!0),q(!0),A.Z.post("/openai/v1/chat/completions",{headers:{Authorization:"Bearer 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"},data:{model:"gpt-3.5-turbo",messages:[{role:"system",content:"\u4F60\u662F\u4E00\u4E2Aamis\u914D\u7F6E\u6587\u4EF6\u751F\u6210\u5668\uFF0C\u5E2E\u6211\u751F\u6210json\u914D\u7F6E\u6587\u4EF6"},{role:"user",content:ce}]}}).then(function(g){var W=g.choices[0].message.content;q(!1);var O=W.indexOf("```"),a=W.lastIndexOf("```"),y=W.substring(O+7,a);console.log(y),Fe(y)})},icon:(0,h.jsx)(ue.Z,{}),type:"primary",style:{width:"100%",marginTop:"5px",marginBottom:"5px"},children:"\u751F\u6210\u914D\u7F6E\u2193"}),(0,h.jsx)(Y.ML,{value:fe,onChange:function(g){return Fe(g)},height:300,language:"json",options:{fetcher:function(g){var W=g.url,O=g.method,a=g.data,y=g.responseType,o=g.config,d=g.headers;return o=o||{},o.withCredentials=!0,y&&(o.responseType=y),o.cancelExecutor&&(o.cancelToken=new A.Z.CancelToken(o.cancelExecutor)),o.headers=d||{},O!=="post"&&O!=="put"&&O!=="patch"?(a&&(o.params=a),A.Z[O](W,o)):(a&&a instanceof FormData?(o.headers=o.headers||{},o.headers["Content-Type"]="multipart/form-data"):a&&typeof a!="string"&&!(a instanceof Blob)&&!(a instanceof ArrayBuffer)&&(a=JSON.stringify(a),o.headers=o.headers||{},o.headers["Content-Type"]="application/json"),A.Z[O](W,a,o))},isCancel:function(g){return A.Z.isCancel(g)},copy:function(g){de()(g),Y.Am.success("\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u7C98\u8D34\u677F")},theme:t}})]})]})},Z=s}}]);
