"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[6541],{76541:function(z,_,C){C.r(_),C.d(_,{CardsRenderer:function(){return W},default:function(){return O}});var h=C(15767),w=C(87363),u=C.n(w),A=C(61533),X=C.n(A),p=C(42977),b=C(94391),G=C(65861),L=C(33170),U=C.n(L),O=function(E){(0,h.ZT)(l,E);function l(t){var e=E.call(this,t)||this;e.handleAction=e.handleAction.bind(e),e.handleCheck=e.handleCheck.bind(e),e.handleClick=e.handleClick.bind(e),e.handleCheckAll=e.handleCheckAll.bind(e),e.handleQuickChange=e.handleQuickChange.bind(e),e.handleSave=e.handleSave.bind(e),e.handleSaveOrder=e.handleSaveOrder.bind(e),e.reset=e.reset.bind(e),e.dragTipRef=e.dragTipRef.bind(e),e.bodyRef=e.bodyRef.bind(e),e.renderToolbar=e.renderToolbar.bind(e);var r=t.store,a=t.selectable,n=t.draggable,i=t.orderBy,o=t.orderDir,d=t.multiple,s=t.hideCheckToggler,c=t.itemCheckableOn,m=t.itemDraggableOn;return r.update({selectable:a,draggable:n,orderBy:i,orderDir:o,multiple:d,hideCheckToggler:s,itemCheckableOn:c,itemDraggableOn:m}),l.syncItems(r,e.props)&&e.syncSelected(),e}return l.syncItems=function(t,e,r){var a=e.source,n=(0,p.v8S)(e,function(c){return c.items}),i=[],o=!1;if(Array.isArray(n)&&(!r||(0,p.v8S)(r,function(c){return c.items})!==n))i=n,o=!0;else if(typeof a=="string"){var d=(0,p.OgC)(a,e.data,"| raw"),s=r?(0,p.OgC)(a,r.data,"| raw"):null;s===d?o=!1:(i=Array.isArray(d)?d:[],o=!0)}return o&&t.initItems(i,e.fullItems,e.selected),Array.isArray(e.selected)&&t.updateSelected(e.selected,e.valueField),o},l.prototype.componentDidUpdate=function(t){var e=this.props,r=e.store;(0,p.aGv)(["selectable","draggable","orderBy","orderDir","multiple","hideCheckToggler","itemCheckableOn","itemDraggableOn"],t,e)&&r.update({selectable:e.selectable,draggable:e.draggable,orderBy:e.orderBy,orderDir:e.orderDir,multiple:e.multiple,hideCheckToggler:e.hideCheckToggler,itemCheckableOn:e.itemCheckableOn,itemDraggableOn:e.itemDraggableOn}),(0,p.aGv)(["source","value","items"],t,e)||!e.value&&!e.items&&(e.data!==t.data||typeof e.source=="string"&&(0,p.SSQ)(e.source))?l.syncItems(r,e,t)&&this.syncSelected():t.selected!==e.selected&&r.updateSelected(e.selected||[],e.valueField)},l.prototype.bodyRef=function(t){this.body=t},l.prototype.handleAction=function(t,e,r){var a=this.props.onAction;return a==null?void 0:a(t,e,r)},l.prototype.handleCheck=function(t){t.toggle(),this.syncSelected();var e=this.props,r=e.store,a=e.dispatchEvent;a("selectedChange",(0,p.nW9)(r.data,(0,h.pi)((0,h.pi)({},r.eventContext),{item:t.data})))},l.prototype.handleClick=function(t){var e=this.props,r=e.dispatchEvent,a=e.data;return r("rowClick",(0,p.nW9)(a,{item:t.data,index:t.index}))},l.prototype.handleCheckAll=function(){var t=this.props.store;t.toggleAll(),this.syncSelected()},l.prototype.handleSelectAll=function(){var t=this.props.store;t.selectAll(),this.syncSelected()},l.prototype.handleClearAll=function(){var t=this.props.store;t.clearAll(),this.syncSelected()},l.prototype.syncSelected=function(){var t=this.props,e=t.store,r=t.onSelect,a=t.dispatchEvent,n=e.selectedItems.map(function(o){return o.data}),i=e.unSelectedItems.map(function(o){return o.data});a("selected",(0,p.nW9)(e.data,{selectItems:n,unSelectItems:i})),r&&r(n,i)},l.prototype.handleQuickChange=function(t,e,r,a,n){t.change(e,a);var i=this.props,o=i.onSave,d=i.onItemChange,s=i.primaryField;if(!a){if(d==null||d(t.data,(0,p.e50)(t.data,t.pristine,["id",s]),t.index),r&&r.api){this.props.onAction(null,{actionType:"ajax",api:r.api,reload:n==null?void 0:n.reload},t.locals);return}!r||!o||o(t.data,(0,p.e50)(t.data,t.pristine,["id",s]),t.index,void 0,t.pristine,n)}},l.prototype.handleSave=function(){var t=this.props,e=t.store,r=t.onSave,a=t.primaryField;if(!(!r||!e.modifiedItems.length)){var n=e.modifiedItems.map(function(s){return s.data}),i=e.modifiedItems.map(function(s){return s.index}),o=e.modifiedItems.map(function(s){return(0,p.e50)(s.data,s.pristine,["id",a])}),d=e.items.filter(function(s){return!s.modified}).map(function(s){return s.data});r(n,o,i,d,e.modifiedItems.map(function(s){return s.pristine}))}},l.prototype.handleSaveOrder=function(){return(0,h.mG)(this,void 0,void 0,function(){var t,e,r,a,n,i,o;return(0,h.Jh)(this,function(d){switch(d.label){case 0:return t=this.props,e=t.store,r=t.onSaveOrder,a=t.data,n=t.dispatchEvent,i=e.movedItems.map(function(s){return s.data}),[4,n("orderChange",(0,p.nW9)(a,{movedItems:i}))];case 1:return o=d.sent(),o!=null&&o.prevented?[2]:!r||!e.movedItems.length?[2]:(r(e.movedItems.map(function(s){return s.data}),e.items.map(function(s){return s.data})),[2])}})})},l.prototype.reset=function(){var t=this.props.store;t.reset()},l.prototype.bulkUpdate=function(t,e){var r=this.props,a=r.store,n=r.primaryField;if(n&&t.ids){var i=t.ids.split(","),o=a.items.filter(function(s){return U()(i,function(c){return c&&c==s.data[n]})}),d=(0,h.pi)((0,h.pi)({},t),{ids:void 0});o.forEach(function(s){return s.change(d)})}else if(Array.isArray(e)){var o=a.items.filter(function(c){return~e.indexOf(c.pristine)});o.forEach(function(c){return c.change(t)})}},l.prototype.getSelected=function(){var t=this.props.store;return t.selectedItems.map(function(e){return e.data})},l.prototype.dragTipRef=function(t){!this.dragTip&&t?this.initDragging():this.dragTip&&!t&&this.destroyDragging(),this.dragTip=t},l.prototype.initDragging=function(){if(!this.sortable){var t=this.props.store,e=(0,A.findDOMNode)(this),r=this.props.classPrefix;this.sortable=new G.ZP(e.querySelector(".".concat(r,"Cards-body")),{group:"table",animation:150,handle:".".concat(r,"Card-dragBtn"),ghostClass:"is-dragging",onEnd:function(a){if(a.newIndex!==a.oldIndex){var n=a.to;a.oldIndex<n.childNodes.length-1?n.insertBefore(a.item,n.childNodes[a.oldIndex>a.newIndex?a.oldIndex+1:a.oldIndex]):n.appendChild(a.item),t.exchange(a.oldIndex,a.newIndex)}}})}},l.prototype.destroyDragging=function(){this.sortable&&this.sortable.destroy(),this.sortable=void 0},l.prototype.renderActions=function(t){var e=this,r=this.props,a=r.actions,n=r.render,i=r.store,o=r.classnames,d;return a=Array.isArray(a)?a.concat():[],!~this.renderedToolbars.indexOf("check-all")&&(d=this.renderCheckAll())&&a.unshift({type:"button",children:d}),t==="header"&&!~this.renderedToolbars.indexOf("drag-toggler")&&(d=this.renderDragToggler())&&a.unshift({type:"button",children:d}),Array.isArray(a)&&a.length?u().createElement("div",{className:o("Cards-actions")},a.map(function(s,c){return n("action/".concat(c),(0,h.pi)({type:"button"},s),{onAction:e.handleAction,key:c,btnDisabled:i.dragging})})):null},l.prototype.renderHeading=function(){var t=this.props,e=t.title,r=t.store,a=t.hideQuickSaveBtn,n=t.classnames,i=t.data;return e||r.modified&&!a||r.moved?u().createElement("div",{className:n("Cards-heading")},r.modified&&!a?u().createElement("span",null,"\u5F53\u524D\u6709 ".concat(r.modified," \u6761\u8BB0\u5F55\u4FEE\u6539\u4E86\u5185\u5BB9, \u4F46\u5E76\u6CA1\u6709\u63D0\u4EA4\u3002\u8BF7\u9009\u62E9:"),u().createElement("button",{type:"button",className:n("Button Button--xs Button--success m-l-sm"),onClick:this.handleSave},u().createElement(b.JO$,{icon:"check",className:"icon m-r-xs"}),"\u63D0\u4EA4"),u().createElement("button",{type:"button",className:n("Button Button--xs Button--danger m-l-sm"),onClick:this.reset},u().createElement(b.JO$,{icon:"close",className:"icon m-r-xs"}),"\u653E\u5F03")):r.moved?u().createElement("span",null,"\u5F53\u524D\u6709 ".concat(r.moved," \u6761\u8BB0\u5F55\u4FEE\u6539\u4E86\u987A\u5E8F, \u4F46\u5E76\u6CA1\u6709\u63D0\u4EA4\u3002\u8BF7\u9009\u62E9:"),u().createElement("button",{type:"button",className:n("Button Button--xs Button--success m-l-sm"),onClick:this.handleSaveOrder},u().createElement(b.JO$,{icon:"check",className:"icon m-r-xs"}),"\u63D0\u4EA4"),u().createElement("button",{type:"button",className:n("Button Button--xs Button--danger m-l-sm"),onClick:this.reset},u().createElement(b.JO$,{icon:"close",className:"icon m-r-xs"}),"\u653E\u5F03")):e?(0,p.hXT)(e,i):""):null},l.prototype.renderHeader=function(){var t=this.props,e=t.header,r=t.headerClassName,a=t.headerToolbar,n=t.headerToolbarRender,i=t.showHeader,o=t.render,d=t.store,s=t.classnames,c=t.translate;if(i===!1)return null;var m=n?n((0,h.pi)((0,h.pi)({},this.props),d.eventContext),this.renderToolbar):null,g=this.renderActions("header"),f=g||m||d.dragging?u().createElement("div",{className:s("Cards-toolbar"),key:"header-toolbar"},g,m,d.dragging?u().createElement("div",{className:s("Cards-dragTip"),ref:this.dragTipRef},c("Card.dragTip")):null):null,v=e?u().createElement("div",{className:s("Cards-header",r),key:"header"},o("header",e)):null;return v&&f?[v,f]:v||f||null},l.prototype.renderFooter=function(){var t=this.props,e=t.footer,r=t.footerClassName,a=t.footerToolbar,n=t.footerToolbarRender,i=t.render,o=t.showFooter,d=t.store,s=t.classnames,c=t.affixFooter;if(o===!1)return null;var m=n?n((0,h.pi)((0,h.pi)({},this.props),d.eventContext),this.renderToolbar):null,g=this.renderActions("footer"),f=e?u().createElement("div",{className:s("Cards-footer",r,c?"Cards-footer--affix":""),key:"footer"},i("footer",e)):null,v=g||m?u().createElement("div",{className:s("Cards-toolbar",!f&&c?"Cards-footToolbar--affix":""),key:"footer-toolbar"},g,m):null;return f&&v?[v,f]:f||v||null},l.prototype.renderCheckAll=function(){var t=this.props,e=t.store,r=t.multiple,a=t.selectable,n=t.checkAll;return!e.selectable||!r||!a||e.dragging||!e.items.length||!n?null:u().createElement(b.zxk,{key:"checkall",tooltip:"\u5207\u6362\u5168\u9009",onClick:this.handleCheckAll,size:"sm",level:e.allChecked?"info":"default"},"\u5168\u9009")},l.prototype.renderDragToggler=function(){var t=this,e=this.props,r=e.store,a=e.multiple,n=e.selectable,i=e.popOverContainer,o=e.env,d=e.translate,s=e.dragIcon;return!r.draggable||r.items.length<2?null:u().createElement(b.zxk,{iconOnly:!0,key:"dragging-toggle",tooltip:d("Card.toggleDrag"),tooltipContainer:i||(o==null?void 0:o.getModalContainer),size:"sm",active:r.dragging,onClick:function(c){c.preventDefault(),r.toggleDragging(),r.dragging&&r.clear(),r.dragging&&t.initDragging()}},u().isValidElement(s)?s:u().createElement(b.JO$,{icon:"exchange",className:"icon r90"}))},l.prototype.renderToolbar=function(t,e){var r=t.type||t;if(r==="drag-toggler")return this.renderedToolbars.push(r),this.renderDragToggler();if(r==="check-all")return this.renderedToolbars.push(r),this.renderCheckAll()},l.prototype.renderCard=function(t,e,r,a,n){var i=this,o=this.props,d=o.render,s=o.classnames,c=o.store,m=o.multiple,g=o.checkOnItemClick,f=o.hideCheckToggler,v={className:s((0,p.Hxu)(e&&e.className||"",r.locals),{"is-checked":r.checked,"is-modified":r.modified,"is-moved":r.moved,"is-dragging":c.dragging}),item:r,key:t,itemIndex:r.index,multiple:m,selectable:c.selectable,checkable:r.checkable,draggable:r.draggable,selected:r.checked,dragging:c.dragging,data:r.locals,onAction:this.handleAction,onCheck:this.handleCheck,onClick:this.handleClick,onQuickChange:c.dragging?null:this.handleQuickChange};return(e==null?void 0:e.type)==="card2"&&(v=(0,h.pi)((0,h.pi)({},v),{item:r.locals,onCheck:function(){i.handleCheck(r)}})),u().createElement("div",{key:r.index,className:s(a),style:n},d("card/".concat(t),(0,h.pi)({type:e.type||"card",hideCheckToggler:f,checkOnItemClick:g},e),v))},l.prototype.render=function(){var t=this,e=this.props,r=e.className,a=e.style,n=e.store,i=e.columnsCount,o=e.itemClassName,d=e.placeholder,s=e.card,c=e.data,m=e.render,g=e.affixHeader,f=e.masonryLayout,v=e.itemsClassName,k=e.classnames,P=e.translate,N=e.loading,Q=N===void 0?!1:N,H=e.loadingConfig,K=e.env,D=e.id,I=e.wrapperCustomStyle,S=e.themeCss,J=e.mobileUI;this.renderedToolbars=[];var B=function(){if(J&&!f)return"";if(f&&i){var y=Math.round(12/i);return"Grid-col--xs".concat(y," Grid-col--sm").concat(y," Grid-col--md").concat(y," Grid-col--lg").concat(y)}return o||""}(),F=this.renderHeader(),R=this.renderHeading(),$=this.renderFooter(),M="";f&&(M="Cards--masonry "+B.split(/\s/).map(function(y){return/^Grid-col--(xs|sm|md|lg)(\d+)/.test(y)?"Cards--masonry".concat((0,p.zfV)(RegExp.$1)).concat(RegExp.$2):y}).join(" "));var T={},x={};return(a==null?void 0:a.gutterX)>=0&&(T.marginLeft=T.marginRight=-((a==null?void 0:a.gutterX)/2)+"px",x.paddingLeft=x.paddingRight=(a==null?void 0:a.gutterX)/2+"px"),(a==null?void 0:a.gutterY)>=0&&(x.marginBottom=(a==null?void 0:a.gutterY)+"px"),u().createElement("div",{ref:this.bodyRef,className:k("Cards",r,{"Cards--unsaved":!!n.modified||!!n.moved},(0,p.GwQ)((0,h.pi)((0,h.pi)({},this.props),{name:"baseControlClassName",id:D,themeCss:S})),(0,p.GwQ)((0,h.pi)((0,h.pi)({},this.props),{name:"wrapperCustomStyle",id:D,themeCss:I}))),style:(0,p.uBL)(a,c)},g?u().createElement("div",{className:k("Cards-fixedTop")},F,R):u().createElement(u().Fragment,null,F,R),n.items.length?u().createElement("div",{className:k("Cards-body Grid",v,M),style:T},n.items.map(function(y,j){return t.renderCard(j,s,y,B,x)})):u().createElement("div",{className:k("Cards-placeholder")},m("placeholder",P(d))),$,u().createElement(b.$jN,{loadingConfig:H,overlay:!0,show:Q}),u().createElement(p.cWM,(0,h.pi)({},this.props,{config:{wrapperCustomStyle:I,id:D,themeCss:S,classNames:[{key:"baseControlClassName"}]},env:K})))},l.propsList=["header","headerToolbarRender","footer","footerToolbarRender","placeholder","source","selectable","headerClassName","footerClassName","hideQuickSaveBtn","hideCheckToggler","itemCheckableOn","itemDraggableOn","masonryLayout","items","valueField"],l.defaultProps={className:"",placeholder:"placeholder.noData",source:"$items",selectable:!1,headerClassName:"",footerClassName:"",itemClassName:"Grid-col--xs12 Grid-col--sm6 Grid-col--md4 Grid-col--lg3",hideCheckToggler:!1,masonryLayout:!1,affixHeader:!0,itemsClassName:"",checkAll:!0},l}(u().Component),W=function(E){(0,h.ZT)(l,E);function l(t,e){var r=E.call(this,t)||this;return e.registerComponent(r),r}return l.prototype.componentWillUnmount=function(){var t;(t=E.prototype.componentWillUnmount)===null||t===void 0||t.call(this),this.context.unRegisterComponent(this)},l.prototype.receive=function(t,e){var r,a,n,i,o=this.context,d=(r=o==null?void 0:o.parent)===null||r===void 0?void 0:r.getComponents();if(!((a=this.props)===null||a===void 0)&&a.host)return(i=(n=this.props.host).receive)===null||i===void 0?void 0:i.call(n,t,e);if(e)return o.send(e,t)},l.prototype.reload=function(t,e,r,a,n,i){var o,d,s;return(0,h.mG)(this,void 0,void 0,function(){var c,m;return(0,h.Jh)(this,function(g){return c=this.props.store,i!=null&&i.index||i!=null&&i.condition?[2]:(m=this.context,!((o=this.props)===null||o===void 0)&&o.host?[2,(s=(d=this.props.host).reload)===null||s===void 0?void 0:s.call(d,t,e,r)]:t?[2,m.reload(t,r)]:[2])})})},l.prototype.setData=function(t,e,r,a){var n,i,o;return(0,h.mG)(this,void 0,void 0,function(){var d,s;return(0,h.Jh)(this,function(c){switch(c.label){case 0:return d=this.props.store,r!==void 0||a!==void 0?[4,(0,p.tW8)(d.items,this.props.data,r,a)]:[3,2];case 1:return s=c.sent(),s.forEach(function(m){m.updateData(t)}),[3,3];case 2:return!((n=this.props)===null||n===void 0)&&n.host?[2,(o=(i=this.props.host).setData)===null||o===void 0?void 0:o.call(i,t,e,r,a)]:[2,d.updateData(t,void 0,e)];case 3:return[2]}})})},l.prototype.getData=function(){var t=this.props,e=t.store,r=t.data;return e.getData(r)},l.prototype.hasModifiedItems=function(){return this.props.store.modified},l.prototype.doAction=function(t,e,r,a){return(0,h.mG)(this,void 0,void 0,function(){var n,i,o,d,s,c,m;return(0,h.Jh)(this,function(g){switch(g.label){case 0:switch(n=this.props,i=n.store,o=n.valueField,d=n.data,s=t==null?void 0:t.actionType,c=s,c){case"selectAll":return[3,1];case"clearAll":return[3,2];case"select":return[3,3];case"initDrag":return[3,5];case"cancelDrag":return[3,6];case"submitQuickEdit":return[3,7]}return[3,9];case 1:return i.clear(),i.toggleAll(),this.syncSelected(),[3,10];case 2:return i.clear(),this.syncSelected(),[3,10];case 3:return[4,(0,p.tW8)(i.items,e||this.props.data,a.index,a.condition,a.selected)];case 4:return m=g.sent(),i.updateSelected(m.map(function(f){return f.data}),o),this.syncSelected(),[3,10];case 5:return i.startDragging(),[3,10];case 6:return i.stopDragging(),[3,10];case 7:return[4,this.handleSave()];case 8:return g.sent(),[3,10];case 9:return[2,this.handleAction(void 0,t,d)];case 10:return[2]}})})},l.contextType=p.ZHe,l=(0,h.gn)([(0,p.Thl)({name:"cards",type:"cards",storeType:p.oPK.name,weight:-100}),(0,h.w6)("design:paramtypes",[Object,Object])],l),l}(O)}}]);
