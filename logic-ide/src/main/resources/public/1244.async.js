"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[1244],{91244:function(C,w,c){c.r(w),c.d(w,{PdfView:function(){return E},PdfViewerRenderer:function(){return F},default:function(){return P}});var t=c(15767),v=c(87363),d=c.n(v),a=c(42977),E=d().lazy(function(){return c.e(6386).then(c.bind(c,56386))}),P=function(h){(0,t.ZT)(r,h);function r(e){var i=h.call(this,e)||this;return i.wrapper=d().createRef(),i.state={inited:!1,loading:!1,error:!1},i}return r.prototype.componentDidMount=function(){this.wrapper.current&&this.setState({width:this.wrapper.current.clientWidth-100}),this.renderPdf()},r.prototype.componentDidUpdate=function(e){var i=this,n=this.props;((0,a.rMT)(e.src,n.src,e.data,n.data)||(0,a.OgC)(n.src,n.data,"| raw")!==(0,a.OgC)(e.src,e.data,"| raw"))&&(this.abortLoad(),setTimeout(function(){i.fetchPdf()},0)),(0,a.E04)(n.data,n.name)&&(0,a.E04)(e.data,e.name)!==(0,a.E04)(n.data,n.name)&&(this.abortLoad(),this.renderPdf())},r.prototype.componentWillUnmount=function(){this.abortLoad()},r.prototype.abortLoad=function(){this.fetchCancel&&(this.fetchCancel("load canceled"),this.fetchCancel=void 0),this.reader&&(this.reader.abort(),this.reader=void 0)},r.prototype.renderPdf=function(){return(0,t.mG)(this,void 0,void 0,function(){var e,i,n,o;return(0,t.Jh)(this,function(s){switch(s.label){case 0:return e=this.props,i=e.src,n=e.name,o=e.data,this.setState({error:!1}),i?this.file?[3,2]:[4,this.fetchPdf()]:[3,3];case 1:s.sent(),s.label=2;case 2:return[3,5];case 3:return(0,a.E04)(o,n)?[4,this.renderFormFile()]:[3,5];case 4:s.sent(),s.label=5;case 5:return[2]}})})},r.prototype.fetchPdf=function(){return(0,t.mG)(this,void 0,void 0,function(){var e,i,n,o,s,l,u,f,m,g=this;return(0,t.Jh)(this,function(p){switch(p.label){case 0:if(e=this.props,i=e.env,n=e.src,o=e.data,s=e.translate,n&&(u=(0,a.OgC)(n,o,"| raw"),typeof u=="string"?l=u:typeof u=="object"&&typeof u.value=="string"&&(l=u.value)),!l)return console.warn("file src is empty"),[2];this.setState({inited:!0,loading:!0,error:!1}),p.label=1;case 1:return p.trys.push([1,3,4,5]),[4,i.fetcher(l,o,{responseType:"arraybuffer",cancelExecutor:function(y){return g.fetchCancel=y}})];case 2:return f=p.sent(),this.file=f.data,this.forceUpdate(),[3,5];case 3:return m=p.sent(),this.setState({error:!0}),console.error(m),[3,5];case 4:return this.setState({loading:!1}),[7];case 5:return[2]}})})},r.prototype.renderFormFile=function(){return(0,t.mG)(this,void 0,void 0,function(){var e,i,n,o,s,l=this;return(0,t.Jh)(this,function(u){return e=this.props,i=e.name,n=e.data,o=(0,a.E04)(n,i),this.setState({inited:!0,loading:!0}),o instanceof File&&(s=new FileReader,s.onload=function(f){var m=s.result;l.file=m,l.setState({loading:!1}),l.forceUpdate()},s.onerror=function(f){l.setState({error:!0})},s.readAsArrayBuffer(o),this.reader=s),[2]})})},r.prototype.renderEmpty=function(){var e=this.props,i=e.src,n=e.name;return!i&&!n?d().createElement("svg",{width:"100%",height:"100",xmlns:"http://www.w3.org/2000/svg"},d().createElement("rect",{x:"0",y:"0",width:"100%",height:"100",style:{fill:"#F7F7F9"}}),d().createElement("text",{x:"50%",y:"50%",fontSize:"18",textAnchor:"middle",alignmentBaseline:"middle",fontFamily:"monospace, sans-serif",fill:"#555555"},"PDF viewer")):null},r.prototype.renderError=function(){var e=this.props,i=e.src,n=e.translate,o=this.state.error;return o&&i?d().createElement("div",null,n("loadingFailed")+" url:"+i):null},r.prototype.renderTip=function(){return d().createElement("div",null,d().createElement("p",null,"[PdfViewer]: pdfjsWorkerSrc is required, Please set the `pdfjsWorkerSrc` in setGlobalOptions function."))},r.prototype.render=function(){var e=this.props,i=e.className,n=e.classnames,o=e.translate,s=e.height,l=e.background,u=(0,a.lN9)().pdfjsWorkerSrc,f=this.state,m=f.loading,g=f.inited,p=f.error,y=Math.max(this.props.width||this.state.width,300);return d().createElement("div",{ref:this.wrapper},this.renderEmpty(),u?d().createElement(v.Suspense,{fallback:d().createElement("div",null,"...")},g&&!p?d().createElement(E,{file:this.file,loading:m,className:i,classnames:n,width:y,height:s,background:l}):null):this.renderTip(),this.renderError())},(0,t.gn)([a.NjZ,(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[]),(0,t.w6)("design:returntype",void 0)],r.prototype,"abortLoad",null),(0,t.gn)([a.NjZ,(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[]),(0,t.w6)("design:returntype",Promise)],r.prototype,"renderPdf",null),(0,t.gn)([a.NjZ,(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[]),(0,t.w6)("design:returntype",Promise)],r.prototype,"fetchPdf",null),(0,t.gn)([a.NjZ,(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[]),(0,t.w6)("design:returntype",Promise)],r.prototype,"renderFormFile",null),(0,t.gn)([a.NjZ,(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[]),(0,t.w6)("design:returntype",void 0)],r.prototype,"renderEmpty",null),(0,t.gn)([a.NjZ,(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[]),(0,t.w6)("design:returntype",void 0)],r.prototype,"renderError",null),(0,t.gn)([a.NjZ,(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[]),(0,t.w6)("design:returntype",void 0)],r.prototype,"renderTip",null),r}(d().Component),F=function(h){(0,t.ZT)(r,h);function r(e,i){var n=h.call(this,e)||this,o=i;return o.registerComponent(n),n}return r.prototype.componentWillUnmount=function(){var e;(e=h.prototype.componentWillUnmount)===null||e===void 0||e.call(this);var i=this.context;i.unRegisterComponent(this)},r.contextType=a.ZHe,r=(0,t.gn)([(0,a.Thl)({type:"pdf-viewer"}),(0,t.w6)("design:paramtypes",[Object,Object])],r),r}(P)}}]);
