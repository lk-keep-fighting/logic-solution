"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[9305],{60860:function(B,h,a){a.d(h,{l:function(){return E.Z}});var E=a(7899)},8678:function(B,h,a){a.d(h,{n:function(){return c}});var E=a(15451);function c(D){var g=D.createNode({shape:"start",width:50,height:50,ports:E.Tt,data:{config:{type:"start",name:"\u5F00\u59CB"}}});D.addNode(g)}},74737:function(B,h,a){a.d(h,{S8:function(){return f},nq:function(){return s}});var E=a(26068),c=a.n(E),D=a(25298),g=a.n(D),O=a(17069),p=a.n(O),m=a(63121),P=a(88195),v=a(15451),M=null;function u(n,r,e,t){var l,i,o=n.data.config,_=o.type,d=e.flatMap(function(y){return y.source.cell===n.id?r[y.target.cell]:[]}),A=n.attrs,C=new P.Du((l=n.id)!==null&&l!==void 0?l:"",_);if(C=c()(c()({},o),{},{id:n.id,name:A==null||(i=A.text)===null||i===void 0?void 0:i.text,nextId:""}),!(t.findIndex(function(y){return y.id===C.id})>-1)&&(t.push(C),d.length!==0))switch(_){default:if(d.length>1||C.type==="switch"){var b;console.log((b=n.data)===null||b===void 0?void 0:b.config),console.log(d),C.branches=[],d.forEach(function(y){var L,U;if(console.log((L=y.data)===null||L===void 0?void 0:L.config),((U=y.data)===null||U===void 0?void 0:U.config.type)==="switch-cases"){var T;(T=y.data)===null||T===void 0||(T=T.config)===null||T===void 0||(T=T.cases)===null||T===void 0||T.forEach(function(F){var R;(R=C.branches)===null||R===void 0||R.push({when:F,nextId:y.id})})}else{var K,I;(K=C.branches)===null||K===void 0||K.push({when:(I=y.data)===null||I===void 0||(I=I.config)===null||I===void 0?void 0:I.case,nextId:y.id})}u(r[y.id],r,e,t)})}else C.nextId=d[0].id,u(r[d[0].id],r,e,t);break}}function s(n,r){var e=new P.Iz(n),t=[],l=[],i={},o=void 0;r.forEach(function(_){var d=_.id||"";_.shape==="edge"?t.push(_):(i[d]=_,l.push(_),_.data.config.type==="start"&&(o=_))});debugger;if(!o){m.ZP.error("\u672A\u53D1\u73B0\u5F00\u59CB\u8282\u70B9\uFF0C\u8BF7\u914D\u7F6E\uFF01");return}return u(o,i,t,e.items),console.log("logic.items"),console.log(e.items),e}function f(n){var r;if(!(n!=null&&(r=n.items)!==null&&r!==void 0&&r.length))return{nodes:[],edges:[]};var e=function(_){switch(console.log("type"),console.log(_),_){case"http":case"js":case"java":case"sub-logic":return{size:{width:100,height:50}};case"switch":return{size:{width:200,height:50}};case"switch-case":case"switch-default":case"switch-cases":return{size:{width:120,height:50}};case"assign-global":case"assign-local":return{size:{width:150,height:40}};default:return{size:{width:50,height:50}}}},t={shape:"edge"},l=n.items.map(function(o){return c()(c()({},e(o.type)),{},{id:o.id,ports:c()(c()({},v.Tt),{},{items:v.Tt.items.map(function(_){return c()(c()({},_),{},{id:"".concat(o.id,"-").concat(_.group)})})}),shape:o.type,data:{config:o}})}),i=n.items.flatMap(function(o){var _;return(_=o.branches)!==null&&_!==void 0&&_.length?o.branches.map(function(d){return c()(c()({},t),{},{source:{cell:o.id,port:o.id+"-bottom"},target:{cell:d.nextId,port:d.nextId+"-top"}})}):o.nextId?[c()(c()({},t),{},{source:{cell:o.id,port:o.id+"-bottom"},target:{cell:o.nextId,port:o.nextId+"-top"}})]:[]});return{nodes:l,edges:i}}},20210:function(B,h,a){a.d(h,{y:function(){return u}});var E=a(31759),c=a.n(E),D=a(25298),g=a.n(D),O=a(17069),p=a.n(O),m=a(88195),P=a(82092),v=a.n(P),M=p()(function s(f){g()(this,s),v()(this,"concept","EnvParam"),v()(this,"name",void 0),v()(this,"description",void 0),v()(this,"typeAnnotation",void 0),v()(this,"required",!1),v()(this,"defaultValue",void 0),this.name=f}),u=function(){function s(){g()(this,s)}return p()(s,null,[{key:"valueToTypeAnnotaion",value:function(n){var r=this,e={concept:m.Ld.TypeAnnotation,typeKind:"primitive",typeName:"string",defaultValue:n};if(Array.isArray(n))e.typeName="array";else{var t=c()(n);switch(t){case"boolean":e.typeKind="primitive",e.typeName="boolean";break;case"number":e.typeKind="primitive",e.typeName="number";break;case"string":e.typeKind="primitive",e.typeName="string";break;case"object":n==null?e.typeName="null":n instanceof Date?(e.typeKind="primitive",e.typeName="date"):n instanceof RegExp?(e.typeKind="primitive",e.typeName="regexp"):n instanceof Function?(e.typeKind="primitive",e.typeName="function"):(e.typeKind="anonymousStructure",e.typeName="object",e.properties=[],Object.keys(n).map(function(l){var i,o=n[l],_=r.valueToTypeAnnotaion(o),d=new m.X0(l);d.typeAnnotation=_,d.defaultValue=o,(i=e.properties)===null||i===void 0||i.push(d)}));break;default:e.typeKind="unknown",e.typeName=t;break}}return e}},{key:"typeAnnotaionToValue",value:function(n){var r,e,t=this,l;switch(n.typeName){case"array":l=(r=n.defaultValue)!==null&&r!==void 0?r:[];break;case"boolean":l=n.defaultValue?n.defaultValue=="true":!1;break;case"number":l=parseFloat(n.defaultValue);break;case"null":l=null;break;case"date":l=new Date(n.defaultValue);break;case"regexp":l=new RegExp(n.defaultValue);break;case"object":l={},(e=n.properties)===null||e===void 0||e.forEach(function(i){l[i.name]=t.typeAnnotaionToValue(i.typeAnnotation)});break;case"string":case"function":default:l=n.defaultValue;break}return l}},{key:"getParamArrayByJson",value:function(n){var r=[];return n&&Object.keys(n).forEach(function(e){var t=new m.dO(e);t.typeAnnotation=s.valueToTypeAnnotaion(n[e]),t.defaultValue=n[e],r.push(t)}),r}},{key:"getReturnArrayByJson",value:function(n){var r=[];return n&&Object.keys(n).forEach(function(e){var t=new m.z1(e);t.typeAnnotation=s.valueToTypeAnnotaion(n[e]),t.defaultValue=n[e],r.push(t)}),r}},{key:"getVariableArrayByJson",value:function(n){var r=[];return n&&Object.keys(n).forEach(function(e){var t=new m._w(e);t.typeAnnotation=s.valueToTypeAnnotaion(n[e]),t.defaultValue=n[e],r.push(t)}),r}},{key:"getEnvsArrayByJson",value:function(n){var r=[];return n&&Object.keys(n).forEach(function(e){var t=new M(e);t.typeAnnotation=s.valueToTypeAnnotaion(n[e]),t.defaultValue=n[e],r.push(t)}),r}},{key:"getJsonByParams",value:function(n){var r=this,e={};return n==null||n.forEach(function(t){e[t.name]=t.typeAnnotation?r.typeAnnotaionToValue(t.typeAnnotation):t.defaultValue}),e}}]),s}()},76262:function(B,h,a){var E=a(48305),c=a.n(E),D=a(85343),g=a(20210),O=a(39710),p=a(63121),m=a(87363),P=a.n(m),v=a(62086),M=function(s){var f,n=(0,m.useState)({}),r=c()(n,2),e=r[0],t=r[1];(0,m.useEffect)(function(){var i=s.values,o=i.params,_=i.variables,d=i.envs,A=i.returns,C=i.log;t({params:JSON.stringify(g.y.getJsonByParams(o)),variables:JSON.stringify(g.y.getJsonByParams(_)),returns:JSON.stringify(g.y.getJsonByParams(A)),envs:JSON.stringify(g.y.getJsonByParams(d)),log:C})},[s.values]);var l=(0,m.useCallback)(function(i){try{return JSON.parse(i),!0}catch(o){return!1}},[]);return(0,v.jsxs)("span",{children:[s.children,(0,v.jsx)(O.Z,{open:(f=s.open)!==null&&f!==void 0?f:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return s==null?void 0:s.setOpen(!1)},children:(0,v.jsx)(D.Z,{formId:"logic-setting",values:e,onSubmit:function(o){console.log("\u63D0\u4EA4\u53C2\u6570"),console.log(o);var _=!1;Object.keys(o).forEach(function(d){var A=o[d];if(!l(A)){var C=d==="params"?"\u5165\u53C2":d==="variables"?"\u5C40\u90E8\u53D8\u91CF":d==="returns"?"\u8FD4\u56DE\u53C2\u6570":"\u73AF\u5883\u53D8\u91CF";switch(d){case"params":return p.ZP.error("\u5165\u53C2json\u683C\u5F0F\u9519\u8BEF"),_=!0,!1;break;case"variables":return p.ZP.error("\u5C40\u90E8\u53D8\u91CFjson\u683C\u5F0F\u9519\u8BEF"),_=!0,!1;break;case"returns":return p.ZP.error("\u8FD4\u56DE\u53C2\u6570json\u683C\u5F0F\u9519\u8BEF"),_=!0,!1;break;case"ens":return p.ZP.error("\u73AF\u5883\u53D8\u91CFjson\u683C\u5F0F\u9519\u8BEF"),_=!0,!1;break;default:break}}}),_||(s!=null&&s.onSubmit&&s.onSubmit(o),s==null||s.setOpen(!1))}})})]})};h.Z=M},98496:function(B,h,a){var E=a(85343),c=a(20210),D=a(63121),g=a(39710),O=a(26031),p=a(87363),m=a.n(p),P=a(62086),v=function(u){var s,f=(0,O.cI)();(0,p.useEffect)(function(){var e=u.values.params;f.setValues({params:JSON.stringify(c.y.getJsonByParams(e))})},[u.values]);var n=(0,p.useCallback)(function(e){try{return JSON.parse(e),!0}catch(t){return!1}},[]);function r(e){var t=!1;Object.keys(e).forEach(function(l){var i=e[l];if(["params","headers"].indexOf(l)>-1&&!n(i)){var o=l==="params"?"\u5165\u53C2":"\u8BF7\u6C42\u5934";return D.ZP.error("".concat(o,"json\u683C\u5F0F\u9519\u8BEF")),t=!0,!1}}),t||(u!=null&&u.onSubmit&&u.onSubmit(e,e.debugType),u==null||u.setOpen(!1))}return(0,P.jsxs)("span",{children:[u.children,(0,P.jsx)(g.Z,{open:(s=u.open)!==null&&s!==void 0?s:!1,title:"\u8C03\u8BD5\u53C2\u6570\u914D\u7F6E",width:1e3,footer:!1,onCancel:function(){return u==null?void 0:u.setOpen(!1)},children:(0,P.jsx)(E.Z,{formId:"logic-debug-input",onSubmit:r})})]})};h.Z=v},72677:function(B,h,a){a.d(h,{W:function(){return P}});var E=a(26068),c=a.n(E),D=a(25298),g=a.n(D),O=a(17069),p=a.n(O),m=a(74737),P=function(){function v(){g()(this,v)}return p()(v,[{key:"graphToLogicItems",value:function(u,s){var f=(0,m.nq)(s==null?void 0:s.id,u==null?void 0:u.getCells());return f.visualConfig=u==null?void 0:u.toJSON(),c()(c()({},s),{},{visualConfig:f.visualConfig,items:f.items})}},{key:"logicToGraphJson",value:function(u){var s=(0,m.S8)(u);return s}}]),v}()},30098:function(B,h,a){a.d(h,{O:function(){return s}});var E=a(90228),c=a.n(E),D=a(87999),g=a.n(D),O=a(950),p=a(8250),m=a(15451),P=a(12119),v={buildGroup:function(r,e,t,l){var i=Number.parseInt(e/2),o=e%2==0;return{name:r,title:t,graphHeight:(o?i:i+1)*(l||70)+10}}},M=v;function u(n){return n.length>7?"".concat(n.substring(0,7),`\r
`).concat(n.substring(7)):n}function s(n){return f.apply(this,arguments)}function f(){return f=g()(c()().mark(function n(r){var e,t;return c()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return e=[],t="/api/ide/asset/v1/logic-item/readFromCode",r&&(t="/api/ide/papi/".concat(r,"/api/ide/asset/v1/logic-item/readFromCode")),i.abrupt("return",Promise.all([(0,p.K)(),O.Z.get(t)]).then(function(o){if(console.log("getPanelData"),o[1].status==200){var _=o[1].data.data;Object.keys(_).forEach(function(d,A){var C=M.buildGroup(d,_[d].length,d);e.push(C),_[d].sort(function(b,y){return b.order?b.order.localeCompare(y.order):1}).forEach(function(b){o[0].Nodes.push(new P.Z({shape:b.shape?b.shape:"ExtShape"+(A%3==0?"1":A%3==1?"2":"3"),ports:m.Tt,width:100,height:50,text:b.name,data:{config:b.logicItem},_groups:[b.group]}))})})}return{Nodes:o[0].Nodes,Groups:e}}));case 4:case"end":return i.stop()}},n)})),f.apply(this,arguments)}}}]);
