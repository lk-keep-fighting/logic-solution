"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[1651],{11651:function(N,O,c){c.r(O),c.d(O,{ExcelControlRenderer:function(){return L},default:function(){return T}});var v=c(15767),M=c(87363),y=c.n(M),A=c(89567),R=c(59245),W=c.n(R),B=c(67929),U=c.n(B),F=c(82691),S=c.n(F),K=c(69143),I=c.n(K),m=c(42977),T=function(P){(0,v.ZT)(h,P);function h(){var n=P!==null&&P.apply(this,arguments)||this;return n.state={filename:""},n}return h.prototype.componentDidUpdate=function(n){n.value!==this.props.value&&!this.props.value&&this.setState({filename:""})},h.prototype.syncAutoFill=function(n){var r=this.props,i=r.autoFill,a=r.onBulkChange,u=r.data,p=r.name;if(!(i!=null&&i.hasOwnProperty("api")||!(0,m.Kn2)(i))){var t=p?W()(i,p):i;if(!S()(t)&&a){var o=(0,m.buJ)(t,{filename:n});Object.keys(o).forEach(function(e){I()(o[e])&&I()(u[e])&&(o[e]=U()({},u[e],o[e]))}),a(o)}}},h.prototype.handleDrop=function(n){var r=this,i=n[0],a=i.name,u=new FileReader;u.readAsArrayBuffer(i),u.onload=function(){return(0,v.mG)(r,void 0,void 0,function(){var p=this;return(0,v.Jh)(this,function(t){return u.result&&(a.toLowerCase().endsWith(".xls")?Promise.all([c.e(4221),c.e(4863)]).then(c.bind(c,64221)).then(function(o){var e=o.read(new Uint8Array(u.result),{cellDates:!0}),f=o.writeXLSX(e,{type:"array"});p.processExcelFile(f,a)}):this.processExcelFile(u.result,a)),[2]})})}},h.prototype.processExcelFile=function(n,r){var i=this,a=this.props,u=a.allSheets,p=a.onChange,t=a.parseImage,o=a.autoFill;c.e(7834).then(c.t.bind(c,87834,23)).then(function(e){return(0,v.mG)(i,void 0,void 0,function(){var f,d,s,l,C,E,g=this;return(0,v.Jh)(this,function(D){switch(D.label){case 0:return f=e.default||e,this.ExcelJS=f,d=new f.Workbook,[4,d.xlsx.load(n)];case 1:return D.sent(),s=[],u?d.eachSheet(function(x){var b=x.state||"visible";b!=="hidden"&&(t?s.push({sheetName:x.name,data:g.readWorksheet(x),images:g.readImages(x,d)}):s.push({sheetName:x.name,data:g.readWorksheet(x)}))}):(l=d.worksheets.find(function(x){return x.state!=="hidden"}),t?(C=this.readImages(l,d),s={data:this.readWorksheet(l),images:C}):s=this.readWorksheet(l)),[4,this.dispatchEvent("change",s)];case 2:return E=D.sent(),E!=null&&E.prevented?[2]:(p(s),o&&this.syncAutoFill(r),this.setState({filename:r}),[2])}})})})},h.prototype.readImages=function(n,r){var i,a,u=this.props.imageDataURI,p=n.getImages(),t=[];try{for(var o=(0,v.XA)(p),e=o.next();!e.done;e=o.next()){var f=e.value,d=r.getImage(+f.imageId),s=this.encodeBase64Bytes(d.buffer);if(u){var l=d.extension||"png";t.push("data:image/".concat(l,";base64,")+s)}else t.push(s)}}catch(C){i={error:C}}finally{try{e&&!e.done&&(a=o.return)&&a.call(o)}finally{if(i)throw i.error}}return t},h.prototype.encodeBase64Bytes=function(n){return btoa(n.reduce(function(r,i){return r+String.fromCharCode(i)},""))},h.prototype.dispatchEvent=function(n,r){return(0,v.mG)(this,void 0,void 0,function(){var i,a,u;return(0,v.Jh)(this,function(p){switch(p.label){case 0:return i=this.props,a=i.dispatchEvent,u=i.data,[4,a(n,(0,m.vXk)(this.props,{value:r}))];case 1:return[2,p.sent()]}})})},h.prototype.isRichTextValue=function(n){return!!(n&&(0,m.Kn2)(n)&&n.hasOwnProperty("richText")&&Array.isArray(n==null?void 0:n.richText))},h.prototype.richText2PlainString=function(n,r){r===void 0&&(r=!1);var i=n.richText.map(function(a){var u=a.text,p=a.font,t=p===void 0?{}:p,o=u;if(r){var e="",f=t!=null&&t.bold?"strong":t!=null&&t.italic?"em":(t==null?void 0:t.vertAlign)==="superscript"?"sup":(t==null?void 0:t.vertAlign)==="subscript"?"sub":"span";t!=null&&t.strike?e+="text-decoration: line-through;":t!=null&&t.underline&&(e+="text-decoration: underline;"),t!=null&&t.outline&&(e+="outline: solid;"),t!=null&&t.size&&(e+="font-size: ".concat(t.size,"px;")),o="<".concat(f," ").concat(e?"style=".concat(e):"",">").concat(u,"</").concat(f,">")}return o});return i.join("")},h.prototype.readWorksheet=function(n){var r=this,i=[],a=this.props,u=a.parseMode,p=a.plainText,t=a.includeEmpty;if(u==="array")return n.eachRow(function(e,f){var d=e.values;d.shift(),p&&(d=d.map(function(s){if(s instanceof Object){if(s.hyperlink)return s.hyperlink.startsWith("mailto:")?s.hyperlink.substring(7):s.hyperlink;if(s.result)return s.result;if(s.richText)return r.richText2PlainString(s)}return s})),i.push(d)}),i;var o=[];return n.eachRow(function(e,f){var d;if(f==1)o=((d=e.values)!==null&&d!==void 0?d:[]).map(function(l){return r.isRichTextValue(l)?r.richText2PlainString(l):l});else{var s={};t&&o.forEach(function(l){s[l]=""}),e.eachCell(function(l,C){if(o[C]){var E=l.value;if(p){var g=r.ExcelJS.ValueType;l.type===g.Hyperlink?(E=l.value.hyperlink,E.startsWith("mailto:")&&(E=E.substring(7))):l.type===g.Formula?E=l.value.result:l.type===g.RichText?E=r.richText2PlainString(l.value):l.type===g.Error&&(E="")}s[o[C]]=E}}),i.push(s)}}),i},h.prototype.doAction=function(n,r,i){var a,u,p=n==null?void 0:n.actionType,t=this.props,o=t.onChange,e=t.resetValue,f=t.formStore,d=t.store,s=t.name;if(p==="clear")o("");else if(p==="reset"){var l=(u=(0,m.E04)((a=f==null?void 0:f.pristine)!==null&&a!==void 0?a:d==null?void 0:d.pristine,s))!==null&&u!==void 0?u:e;o(l!=null?l:"")}},h.prototype.render=function(){var n=this,r=this.props,i=r.className,a=r.classnames,u=r.classPrefix,p=r.disabled,t=r.translate,o=r.placeholder,e=r.testIdBuilder;return y().createElement("div",{className:a("ExcelControl",i)},y().createElement(A.ZP,{key:"drop-zone",onDrop:this.handleDrop,accept:".xlsx,.xls",multiple:!1,disabled:p},function(f){var d=f.getRootProps,s=f.getInputProps;return y().createElement("section",{className:a("ExcelControl-container",i)},y().createElement("div",(0,v.pi)({},d({className:a("ExcelControl-dropzone")}),e==null?void 0:e.getTestId()),y().createElement("input",(0,v.pi)({},s(),e==null?void 0:e.getChild("input").getTestId())),n.state.filename?t("Excel.parsed",{filename:n.state.filename}):y().createElement("p",null,o!=null?o:t("Excel.placeholder"))))}))},h.defaultProps={allSheets:!1,parseMode:"object",includeEmpty:!0,plainText:!0,parseImage:!1,imageDataURI:!0},(0,v.gn)([m.NjZ,(0,v.w6)("design:type",Function),(0,v.w6)("design:paramtypes",[String]),(0,v.w6)("design:returntype",void 0)],h.prototype,"syncAutoFill",null),(0,v.gn)([m.NjZ,(0,v.w6)("design:type",Function),(0,v.w6)("design:paramtypes",[Array]),(0,v.w6)("design:returntype",void 0)],h.prototype,"handleDrop",null),h}(y().PureComponent),L=function(P){(0,v.ZT)(h,P);function h(){return P!==null&&P.apply(this,arguments)||this}return h=(0,v.gn)([(0,m.xJW)({type:"input-excel"})],h),h}(T)}}]);
