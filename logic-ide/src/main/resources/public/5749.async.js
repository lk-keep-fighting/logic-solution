"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[5749],{88287:function($,M,t){t.d(M,{Z:function(){return Y}});var N=t(57213),i=t.n(N),J=t(61293),h=t(87363),x=t.n(h),W=t(63466),Z=t(21140),z=t(52510),j=t(54306),V=t.n(j),L=t(97944),w=t(28576),D=t(75904),O=t(47503),C=t(84191),S=t(49425),I=t(94744),f=t(33130),R=null,T=function(c){var r=(0,L.Ik)(),F=(0,h.useContext)(w.r),u=F.logic;(0,h.useEffect)(function(){if(u){var l,g,E,A,G=I.y.getJsonByParams((l=u.variables)!==null&&l!==void 0?l:[]),H=(0,C.k)("_var",G),Q=I.y.getJsonByParams((g=u.params)!==null&&g!==void 0?g:[]),X=(0,C.k)("_par",Q),q=I.y.getJsonByParams((E=u.returns)!==null&&E!==void 0?E:[]),ee=(0,C.k)("_ret",q),te=I.y.getJsonByParams((A=u.envs)!==null&&A!==void 0?A:[]),ne=(0,C.k)("_env",te);r==null||r.languages.typescript.javascriptDefaults.addExtraLib(H,"var.ts"),r==null||r.languages.typescript.javascriptDefaults.addExtraLib(X,"input.ts"),r==null||r.languages.typescript.javascriptDefaults.addExtraLib(ee,"return.ts"),r==null||r.languages.typescript.javascriptDefaults.addExtraLib(ne,"env.ts"),r==null||r.languages.typescript.javascriptDefaults.addExtraLib("let _lastRet:{}","lastRet.ts")}return function(){var U;console.log("effect dispose"),r==null||(U=r.current)===null||U===void 0||U.dispose()}},[u==null?void 0:u.params,u==null?void 0:u.variables,u==null?void 0:u.returns,u==null?void 0:u.envs]);var k=(0,h.useState)(!1),y=V()(k,2),v=y[0],m=y[1];return(0,f.jsx)("div",{style:{width:"100%"},children:v?(0,f.jsx)(O.Z,{title:"js\u7F16\u8F91\u5668",centered:!0,width:1200,bodyStyle:{height:"80vh"},open:v,footer:null,onCancel:function(){return m(!1)},children:(0,f.jsx)(L.ML,i()(i()({theme:"vs-dark",defaultValue:c.value,defaultLanguage:c.language,options:{minimap:{enabled:!1}}},c),{},{height:"100%"}))}):(0,f.jsxs)("div",{children:[(0,f.jsx)(L.ML,i()({className:"editorByLoader",theme:"vs-dark",defaultValue:c.value,defaultLanguage:c.language,onMount:function(g){var E;(E=g.getAction("editor.action.formatDocument"))===null||E===void 0||E.run(),g.setValue(g.getValue())},options:{minimap:{enabled:!1}},height:500},c)),(0,f.jsx)(D.ZP,{size:"small",type:"text",icon:(0,f.jsx)(S.Z,{}),style:{position:"absolute",top:0,right:0,margin:"10px",color:"whitesmoke"},onClick:function(){return m(!0)}})]})})},P=x().memo(T),K=null,b=function(c){return(0,f.jsx)(P,i()(i()({},c),{},{language:"json"}))},n=b,s=null,p=function(c){return(0,f.jsx)(P,i()(i()({},c),{},{language:"javascript"}))},e=p,d=t(16414),o=function(c){return(0,h.useEffect)(function(){L._m.config({monaco:d})},[]),(0,f.jsx)(J.ZP,i()({widgets:{json:n,js:e}},c))},_=o,B=o||_,Y=function(a){var c,r=(0,J.cI)(),F=a.configSchemaProvider,u=function(v){var m,l,g;(m=a.editNode)===null||m===void 0||m.setAttrByPath("text/text",v.name);var E=(l=a.editNode)===null||l===void 0?void 0:l.data.config;a.editNode&&a.editNode.setData({config:i()(i()({},E),v)}),console.log("submit---props.editNode.data.config"),console.log((g=a.editNode)===null||g===void 0?void 0:g.data.config),a==null||a.onSubmit()},k=function(v){if(v&&v.data){var m,l=v.data.config||{},g=v.attrs;return l.name=g==null||(m=g.text)===null||m===void 0?void 0:m.text,l}else return{name:""}};return(0,h.useEffect)(function(){if(a.editNode&&a.editNode.data){var y=a.editNode.data.config||{};F(a.editNode.data.configSchema||y.type).then(function(v){var m,l=a.editNode.attrs;y.name=l==null||(m=l.text)===null||m===void 0?void 0:m.text,console.log("nodeConfigSchema"),console.log(v),r.setSchema(v,!0),r.resetFields(),r.setValues(y)})}},[a.editNode,(c=a.editNode)===null||c===void 0?void 0:c.data]),(0,f.jsx)("div",{children:(0,f.jsx)(B,{form:r,onFinish:u,onReset:function(){var v=k(a.editNode);r.setValues(v)},footer:!!a.onSubmit})})}},48364:function($,M,t){t.d(M,{Uh:function(){return K},YH:function(){return w},az:function(){return O},b9:function(){return T},gC:function(){return f},m9:function(){return S}});var N=t(25359),i=t.n(N),J=t(49811),h=t.n(J),x=t(70517),W=t(5726),Z=t.n(W);function z(n){return j.apply(this,arguments)}function j(){return j=_asyncToGenerator(_regeneratorRuntime().mark(function n(s){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",axios.post("/api/ide/pub/logic/dev-to-test".concat(s)));case 1:case"end":return e.stop()}},n)})),j.apply(this,arguments)}function V(n){return L.apply(this,arguments)}function L(){return L=_asyncToGenerator(_regeneratorRuntime().mark(function n(s){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",axios.get("/api/ide/logic/".concat(s)));case 1:case"end":return e.stop()}},n)})),L.apply(this,arguments)}function w(n){return D.apply(this,arguments)}function D(){return D=h()(i()().mark(function n(s){return i()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",x.Z.get("/api/ide/logic/".concat(s,"/config")).then(function(d){var o;return(o=d.data)===null||o===void 0?void 0:o.data}));case 1:case"end":return e.stop()}},n)})),D.apply(this,arguments)}function O(n,s,p){return C.apply(this,arguments)}function C(){return C=h()(i()().mark(function n(s,p,e){return i()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",x.Z.put("/api/ide/logic/edit/".concat(s),{version:p,configJson:e,updateTime:Z()().format("YYYY-MM-DD HH:mm:ss")}));case 1:case"end":return o.stop()}},n)})),C.apply(this,arguments)}function S(n){return I.apply(this,arguments)}function I(){return I=h()(i()().mark(function n(s){return i()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",x.Z.get("/api/ide/logic-instance/".concat(s)).then(function(d){var o=d.data.data;return o}));case 1:case"end":return e.stop()}},n)})),I.apply(this,arguments)}function f(n){return R.apply(this,arguments)}function R(){return R=h()(i()().mark(function n(s){return i()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",x.Z.post("/api/ide/logic-logs",{filters:[{dataIndex:"logicId",values:[s.logicId],type:"="},{dataIndex:"bizId",values:[s.bizId],type:"="}],pageSize:1e3,orderBy:[{dataIndex:"id",desc:!0}]}).then(function(d){var o=d.data.data.records;return o&&o.map(function(_){_.itemLogs&&(_.itemLogs=JSON.parse(_.itemLogs))}),o}));case 1:case"end":return e.stop()}},n)})),R.apply(this,arguments)}function T(n,s){return P.apply(this,arguments)}function P(){return P=h()(i()().mark(function n(s,p){return i()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",x.Z.post("/api/ide/logic-baks",{filters:[{dataIndex:"id",values:[s],type:"="},{dataIndex:"version",values:[p],type:"="}]}).then(function(o){var _=o.data.data.records[0].configJson,B=JSON.parse(_);return B}));case 1:case"end":return d.stop()}},n)})),P.apply(this,arguments)}function K(n,s){return b.apply(this,arguments)}function b(){return b=h()(i()().mark(function n(s,p){return i()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",x.Z.post("/api/ide/logic-baks",{filters:[{dataIndex:"id",values:[s],type:"="},{dataIndex:"version",values:[p],type:"="}]}).then(function(o){var _=o.data.data.records[0],B=_.configJson;return _.configJson=JSON.parse(B),_}));case 1:case"end":return d.stop()}},n)})),b.apply(this,arguments)}}}]);
