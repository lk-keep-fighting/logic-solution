"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[9207],{60341:function(Z,f,e){e.d(f,{l:function(){return m.Z}});var m=e(93797)},2008:function(Z,f,e){e.d(f,{n:function(){return h}});var m=e(57213),a=e.n(m),l=e(12490),v=e(42651),S=80,p=80,i={body:{fill:"#fff",stroke:"#8f8f8f",strokeWidth:1}},d=new Map;d.set("group",{shape:"rect",x:40,y:40,width:100,height:50,ports:l.Tt,attrs:{body:a()(a()({},i.body),{},{stroke:"black",strokeWidth:1,fillOpacity:0}),text:{text:"\u5DE5\u5E8F\u7EC4",refX:0,refY:10,"text-anchor":"start"}},data:{parent:!0}}),d.set("end",{shape:"circle",width:60,height:60,attrs:{body:a()(a()({},i.body),{},{fill:"gray"}),text:{text:"end"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:l.Tt,data:{configScheme:"end"}}),d.set("circle",{shape:"circle",width:60,height:60,attrs:{body:a()(a()({},i.body),{},{fill:"white"}),text:{text:""}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:l.Tt,data:{},groups:["process"]}),d.set("triangle",{shape:"path",x:40,y:40,width:S,height:60,path:"M3,45 C1.9,45 1,44.2 1,43.1 L29,2.9 C30.1,1.3 31.3,1 32.1,1 L32.1,1 C32.1,1 33.8,1.1 35.1,2.9 L63,43.1 C63,44.1 62.1,45 61,45 L3,45 L3,45 Z",attrs:{body:a()(a()({},i.body),{},{fill:"white"}),text:{text:"\u4E09\u89D2\u5F62",refY:50}},ports:l.Tt,data:{config:{}}}),d.set("triangle2",{shape:"path",x:40,y:40,width:S,height:60,path:"M3,1 C1.9,1 1,1.8 1,2.9 L29,43.1 C30.1,44.7 31.3,45 32.1,45 L32.1,45 C32.1,45 33.8,44.9 35.1,43.1 L63,2.9 C63,1.9 62.1,1 61,1 L3,1 L3,1 Z",attrs:{body:a()(a()({},i.body),{},{fill:"white"}),text:{text:"\u914D\u6599\u5DE5\u5E8F",refY:10}},ports:l.Tt,data:{config:{type:"process"}},groups:["process"]}),d.set("rhombus",{shape:"polygon",x:600,y:70,width:S,height:p,points:"0,10 10,0 20,10 10,20",attrs:{body:a()({},i.body),text:{text:"\u68C0\u9A8C\u5DE5\u5E8F"}},ports:l.Tt,data:{config:{type:"process"}},groups:["process"]}),d.set("ExtSharp",{shape:"ExtSharp",attrs:{text:{text:"http\u8BF7\u6C42",fontSize:14},image:{width:20,x:2,y:2}},ports:l.Tt});function h(r){return new v.Z(d.get(r))}},2325:function(Z,f,e){e.d(f,{C:function(){return m}});var m=new Map,a=50,l=50;m.set("ExtSharp",{name:"ExtSharp",config:{width:100,height:l,attrs:{body:{rx:6,ry:6,stroke:"#5F95FF",strokeWidth:1,fill:"rgba(95,149,255,0.05)",refWidth:1,refHeight:1},image:{refX:2,refY:0},text:{refX:4,refY:20,fontSize:12,"text-anchor":"start"}},markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}})},42651:function(Z,f,e){e.d(f,{Z:function(){return i}});var m=e(21140),a=e.n(m),l=e(63466),v=e.n(l),S=e(52510),p=e.n(S),i=function(){function d(h){a()(this,d),p()(this,"_nodeConfig",void 0),p()(this,"_groups",void 0),this._nodeConfig=JSON.parse(JSON.stringify(h)),this._nodeConfig._groups&&(this._groups=this._nodeConfig._groups)}return v()(d,[{key:"getNodeConfig",value:function(){return this._nodeConfig}},{key:"getGroups",value:function(){return this._groups}},{key:"setLabel",value:function(r){this._nodeConfig.attrs&&(this._nodeConfig.attrs.text.text=r)}},{key:"setGroups",value:function(r){this._groups=r}},{key:"setConfigSchemel",value:function(r){this._nodeConfig.data?(this._nodeConfig.data.configSchema=r,this._nodeConfig.data.config={type:r}):this._nodeConfig.data={configSchema:r,config:{type:r}}}},{key:"setConfigData",value:function(r){this._nodeConfig.data?this._nodeConfig.data.config=r:this._nodeConfig.data={config:r}}}]),d}()},44132:function(Z,f,e){var m=e(54306),a=e.n(m),l=e(70517),v=e(90010),S=e.n(v),p=e(23620),i=e(2069),d=e(87363),h=e.n(d),r=e(70256),b=e(33358),L=e(49500),E=e(16123),W=e(69078),T=e(33130);l.Z.interceptors.response.use(function(n){return console.log("axios response"),console.log(n),n&&n.data?(console.log("--\u8BF7\u6C42\u672A\u62A5\u9519\uFF0C\u9002\u914Dstatus=0"),n.data.error||(n.data.error={code:0}),n.data.code==500&&(n.data.error={code:500,message:n.data.msg}),n.data.data&&n.data.data.records&&(n.data.data.items=n.data.data.records),n):(console.log("--\u8FD4\u56DE\u6570\u636E\u4E3A\u7A7A\uFF0C\u5224\u65AD\u4E3A\u5F02\u5E38"),console.log(n.data),Promise.reject(new Error(n.data.message)))},function(n){if(console.log("\u6355\u6349axios error"),console.log(n),n.response&&n.response.data){var C,A=n.response;return console.log("--data\u6709\u8FD4\u56DE\u503C\uFF0C\u5224\u5B9A\u4E3A\u4E1A\u52A1\u5F02\u5E38\uFF0C\u7EE7\u7EED\u8FD4\u56DEresponse,\u9002\u914Dstatus=500\uFF01"),((C=n.response.data.error)===null||C===void 0?void 0:C.code)==0&&(n.response.data.error.code=500),console.log(A),A}return Promise.reject(n)});var K=function(C){var A=(0,d.useState)({type:"page"}),$=a()(A,2),se=$[0],re=$[1],k="cxd",q="zh-CN";return(0,d.useEffect)(function(){C.pageId&&(0,r.UD)(C.pageId).then(function(I){re(I)})},[C.pageId]),(0,T.jsxs)("div",{children:[(0,T.jsx)(i.qR,{theme:k,position:"top-right",locale:q},"toast"),(0,T.jsx)(i.wx,{theme:k,locale:q},"alert"),(0,p.sYA)(se,{data:C.data},{fetcher:function(x){var J=x.url,F=x.method,M=x.data,ee=x.responseType,o=x.config,ie=x.headers;return o=o||{},o.withCredentials=!0,ee&&(o.responseType=ee),o.cancelExecutor&&(o.cancelToken=new l.Z.CancelToken(o.cancelExecutor)),o.headers=ie||{},o.headers.Authorization||(o.headers.Authorization="Bearer "+W.F.getTokenFormLocal()),F!=="post"&&F!=="put"&&F!=="patch"?(M&&(o.params=M),l.Z[F](J,o)):(M&&M instanceof FormData?(o.headers=o.headers||{},o.headers["Content-Type"]="multipart/form-data"):M&&typeof M!="string"&&!(M instanceof Blob)&&!(M instanceof ArrayBuffer)&&(M=JSON.stringify(M),o.headers=o.headers||{},o.headers["Content-Type"]="application/json"),l.Z[F](J,M,o))},isCancel:function(x){return l.Z.isCancel(x)},copy:function(x){S()(x),i.Am.success("\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u7C98\u8D34\u677F")},theme:k,jumpTo:function(x,J){debugger;J.blank==!0?window.open(window.location.origin+window.location.pathname+"#"+x,"_blank"):window.location.hash=x}})]})};f.Z=K},25948:function(Z,f,e){e.r(f),e.d(f,{default:function(){return xe}});var m=e(93525),a=e.n(m),l=e(54306),v=e.n(l),S=e(60341),p=e(83217),i=e(36267),d=e(4283),h=e(8051),r=e(72197),b=e(54145),L=e(98825),E=e(87363),W=e(98306),T=e(70517),K=e(75575),n=e(44132),C=e(69078),A=e(5671),$=e(14990),se=e(22465),re=e(72237),k=e(2069),q=e(25590),I=e(21140),x=e.n(I),J=e(63466),F=e.n(J),M=function(){function te(){x()(this,te)}return F()(te,[{key:"graphToMesDsl",value:function(z,u){var le=[],he=[],ne=z==null?void 0:z.getCells(),ge={},N=u||{};return N.routeProductDetailList=[],ne.forEach(function(X){var de=X.id||"";if(X.shape==="edge"){var G,w=X,Q=((G=w.labels)===null||G===void 0?void 0:G.length)>0?w.labels[0].attrs.label.text:"",Y=w.data.type,s=w.getSourceNode(),_=w.getTargetNode();if(_.getChildCount()>0){var V=_.getChildren();V==null||V.forEach(function(U){var R;(R=N.routeProductDetailList)===null||R===void 0||R.push({fromNode:s==null?void 0:s.id,fromNodeName:s==null?void 0:s.getAttrByPath("text/text"),toNode:U.id,toNodeName:U.getAttrByPath("text/text"),productCode:u==null?void 0:u.productCode,productName:u==null?void 0:u.productName,routeType:Y,routeDetailDto:U.data.config,inputOutputRatio:Q,groupTag:_==null?void 0:_.getAttrByPath("text/text")})})}else if((s==null?void 0:s.getChildCount())>0){var H=s==null?void 0:s.getChildren();H==null||H.forEach(function(U){var R;(R=N.routeProductDetailList)===null||R===void 0||R.push({fromNode:U.id,fromNodeName:U.getAttrByPath("text/text"),toNode:_.id,toNodeName:_==null?void 0:_.getAttrByPath("text/text"),productCode:u==null?void 0:u.productCode,productName:u==null?void 0:u.productName,routeType:Y,routeDetailDto:U.data.config,inputOutputRatio:Q,groupTag:s==null?void 0:s.getAttrByPath("text/text")})})}else{var y;(y=N.routeProductDetailList)===null||y===void 0||y.push({fromNode:s==null?void 0:s.id,fromNodeName:s==null?void 0:s.getAttrByPath("text/text"),toNode:_.id,toNodeName:_==null?void 0:_.getAttrByPath("text/text"),routeType:Y,productCode:u==null?void 0:u.productCode,productName:u==null?void 0:u.productName,routeDetailDto:s==null?void 0:s.data.config,inputOutputRatio:Q})}}}),N}}]),te}(),ee=e(82628),o=e(2008),ie=e(2325),t=e(33130),_e=new ee.e,P=(0,o.n)("circle");P==null||P.setConfigSchemel("start"),P==null||P.setConfigData({name:"start"}),P==null||P.setLabel("start"),P.setGroups(["def"]);var De=function(){var ve=(0,E.useState)({}),z=v()(ve,2),u=z[0],le=z[1],he=(0,E.useState)({}),ne=v()(he,2),ge=ne[0],N=ne[1],X=(0,E.useState)(!0),de=v()(X,2),G=de[0],w=de[1],Q=(0,E.useState)(!1),Y=v()(Q,2),s=Y[0],_=Y[1],V=(0,W.lr)(),H=v()(V,2),y=H[0],U=H[1],R=(0,E.useState)("1"),fe=v()(R,2),oe=fe[0],Ee=fe[1],Pe=(0,E.useState)(),me=v()(Pe,2),B=me[0],ye=me[1],Oe=(0,E.useState)([]),pe=v()(Oe,2),Se=pe[0],Me=pe[1];function Ce(g){u.graphData=JSON.stringify(g.toJSON());var c=new M().graphToMesDsl(g,u);le(c),_(!0),_e.updateRouteProcessDesign(c).then(function(j){console.log("\u4FDD\u5B58\u63A5\u53E3\u8FD4\u56DE");var D=JSON.parse(j.data);D.code=="500"?p.ZP.error(D.message):p.ZP.success("\u4FDD\u5B58\u6210\u529F"),_(!1)}).catch(function(j){p.ZP.error(j),_(!1)})}(0,E.useEffect)(function(){_(!0),_e.getRouteProcessDesign(y.get("prodCode"),y.get("version")).then(function(j){var D=JSON.parse(j.data);D.result&&(le(D.result),N(D.result.graphData?JSON.parse(D.result.graphData):{})),_(!1)}).catch(function(j){_(!1),console.log("err"),console.log(j)});var g=[];g.push(P);var c=(0,o.n)("circle");c==null||c.setConfigSchemel("end"),P==null||P.setConfigData({name:"end"}),c==null||c.setLabel("end"),c==null||c.setGroups(["def"]),g.push(c),(0,q.O)().then(function(j){console.log("\u62C9\u53D6\u5927\u7C7B\u6570\u636E"),console.log(j),j.data.forEach(function(ue){var ce,O;switch(ue.key){case"PROCESS_GROUP":O=(0,o.n)("circle"),O.setConfigSchemel("process");break;case"CHECK_GROUP":O=(0,o.n)("rhombus"),O.setConfigSchemel("process");break;case"WAIT_GROUP":O=(0,o.n)("triangle"),O.setConfigSchemel("process");break;case"PICK_GROUP":O=(0,o.n)("triangle2"),O.setConfigSchemel("process");break;default:O=(0,o.n)("ExtSharp"),O.setConfigSchemel("process");break}(ce=O)===null||ce===void 0||ce.setConfigData(ue),O.setLabel(ue.text),O.setGroups(["process"]);var Ae=O;g.push(Ae)});var D=(0,o.n)("group");D==null||D.setLabel("\u5DE5\u5E8F\u7EC4"),D==null||D.setConfigSchemel("process-group"),D.setGroups(["process"]),g.push(D),console.log("cusNodes"),console.log(g),Me(g)})},[]);var be=(0,E.useCallback)(function(){return new A.bn.kS({attrs:{line:{targetMarker:"classic",stroke:oe=="1"?"#000000":"#FF9900"}},tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0,data:{type:oe}})},[oe]),ae=i.Z.Text,Te=function(){return(0,t.jsxs)(d.Z,{style:{height:"50px",marginLeft:"20px"},children:[(0,t.jsx)(i.Z,{children:"\u4EA7\u54C1\u7F16\u7801"}),(0,t.jsx)(ae,{underline:!0,children:y==null?void 0:y.get("prodCode")}),(0,t.jsx)(h.Z,{type:"vertical"}),(0,t.jsx)(i.Z,{children:"\u4EA7\u54C1\u540D\u79F0"}),(0,t.jsx)(ae,{underline:!0,children:y==null?void 0:y.get("prodName")}),(0,t.jsx)(h.Z,{type:"vertical"}),(0,t.jsx)(i.Z,{children:"\u5BA2\u6237\u6599\u53F7"}),(0,t.jsx)(ae,{underline:!0,children:y.get("cusCode")}),(0,t.jsx)(h.Z,{type:"vertical"}),(0,t.jsx)(i.Z,{children:"\u7248\u672C\u53F7"}),(0,t.jsx)(ae,{underline:!0,children:y.get("version")})]})};return(0,t.jsxs)("div",{children:[(0,t.jsx)(Te,{}),(0,t.jsx)(r.Z,{spinning:s,children:(0,t.jsx)(S.l,{panelData:{Nodes:a()(Se),Shapes:[ie.C.get("ExtSharp")],Groups:[{name:"def",title:"\u9ED8\u8BA4\u8282\u70B9",graphHeight:100},{name:"process",title:"\u5DE5\u5E8F",graphHeight:400}]},showLeft:G,graphIns:B,toolElements:[(0,t.jsx)(b.ZP,{type:"text",icon:G?(0,t.jsx)($.Z,{}):(0,t.jsx)(se.Z,{}),onClick:function(){w(!G)},style:{fontSize:"16px",width:64,height:64}}),(0,t.jsx)(b.ZP,{icon:(0,t.jsx)(re.Z,{}),type:"primary",onClick:function(){Ce(B)},children:"\u4FDD\u5B58"}),(0,t.jsxs)("span",{children:["\u8FDE\u63A5\u7EBF\u7C7B\u578B\uFF1A",(0,t.jsxs)(L.Z,{style:{width:"100px"},value:oe,onSelect:function(c){Ee(c)},children:[(0,t.jsx)(L.Z.Option,{children:(0,t.jsx)("span",{style:{textDecoration:"underline",textDecorationThickness:3,textDecorationColor:"#000000"},children:"\u52A0\u5DE5\u7EBF"})},"1"),(0,t.jsx)(L.Z.Option,{children:(0,t.jsx)("span",{style:{textDecoration:"underline",textDecorationThickness:3,textDecorationColor:"#FF9900"},children:"\u8FD4\u5DE5\u7EBF"})},"2")]})]}),(0,t.jsx)(b.ZP,{icon:(0,t.jsx)(k.g9,{}),onClick:function(){debugger;B&&B.canUndo()&&B.undo()},children:"\u64A4\u9500"}),(0,t.jsx)(b.ZP,{icon:(0,t.jsx)(k.NW,{}),onClick:function(){debugger;B&&B.canRedo()&&B.undo()},children:"\u91CD\u505A"}),(0,t.jsx)(b.ZP,{onClick:function(){T.Z.post("/api/mes/asm-system/bbs/v1/common/accounts/employee/access-token",{loginName:"admin",password:"1234@qwer"}).then(function(c){debugger;C.F.setTokenToLocal(c.data.data.accessToken),p.ZP.success(c.data.data.accessToken)}).catch(function(c){return p.ZP.error(c.toString())})},children:"\u83B7\u53D6\u6743\u9650"})],graphJson:ge,createEdge:be,onSave:Ce,onGraphInsChange:function(c){return ye(c)}})})]})},xe=De},82628:function(Z,f,e){e.d(f,{e:function(){return b}});var m=e(25359),a=e.n(m),l=e(49811),v=e.n(l),S=e(21140),p=e.n(S),i=e(63466),d=e.n(i),h=e(70517),r=new h.Z.Axios({headers:{Authorization:"Bearer "+localStorage.getItem("token"),"Content-Type":"application/json"}}),b=function(){function L(){p()(this,L)}return d()(L,[{key:"updateRouteProcessDesign",value:function(){var E=v()(a()().mark(function T(K){return a()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.abrupt("return",r.post("/api/mes/asm-standard/route/update-route-process-design",JSON.stringify(K)));case 1:case"end":return C.stop()}},T)}));function W(T){return E.apply(this,arguments)}return W}()},{key:"getRouteProcessDesign",value:function(){var E=v()(a()().mark(function T(K,n){return a()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.abrupt("return",r.post("/api/mes/asm-standard/route/route-process-design",JSON.stringify({version:n,productCode:K})));case 1:case"end":return A.stop()}},T)}));function W(T,K){return E.apply(this,arguments)}return W}()}]),L}()},25590:function(Z,f,e){e.d(f,{O:function(){return p}});var m=e(25359),a=e.n(m),l=e(49811),v=e.n(l),S=e(70517);function p(){return i.apply(this,arguments)}function i(){return i=v()(a()().mark(function d(){return a()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,S.Z)("/api/mes/asm-system/bbs/v1/common/dictionaries/list",{method:"post",data:{applicationCode:"bbs",dictionaryCategoryCode:"GROUP-TYPES",isEnabled:!0}}).then(function(b){if(b.data){var L=b.data;return L}else return[]}));case 1:case"end":return r.stop()}},d)})),i.apply(this,arguments)}}}]);
