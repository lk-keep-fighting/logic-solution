"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[9207],{60341:function(Z,_,e){e.d(_,{l:function(){return f.Z}});var f=e(93797)},2008:function(Z,_,e){e.d(_,{n:function(){return h}});var f=e(57213),o=e.n(f),d=e(12490),c=e(42651),y=80,m=80,i={body:{fill:"#fff",stroke:"#8f8f8f",strokeWidth:1}},u=new Map;u.set("group",{shape:"rect",x:40,y:40,width:100,height:50,ports:d.Tt,attrs:{body:o()(o()({},i.body),{},{stroke:"black",strokeWidth:1,fillOpacity:0}),text:{text:"\u5DE5\u5E8F\u7EC4",refX:0,refY:10,"text-anchor":"start"}},data:{parent:!0}}),u.set("end",{shape:"circle",width:60,height:60,attrs:{body:o()(o()({},i.body),{},{fill:"gray"}),text:{text:"end"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:d.Tt,data:{configScheme:"end"}}),u.set("circle",{shape:"circle",width:60,height:60,attrs:{body:o()(o()({},i.body),{},{fill:"white"}),text:{text:""}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:d.Tt,data:{},groups:["process"]}),u.set("triangle",{shape:"path",x:40,y:40,width:y,height:60,path:"M3,45 C1.9,45 1,44.2 1,43.1 L29,2.9 C30.1,1.3 31.3,1 32.1,1 L32.1,1 C32.1,1 33.8,1.1 35.1,2.9 L63,43.1 C63,44.1 62.1,45 61,45 L3,45 L3,45 Z",attrs:{body:o()(o()({},i.body),{},{fill:"white"}),text:{text:"\u4E09\u89D2\u5F62",refY:50}},ports:d.Tt,data:{config:{}}}),u.set("triangle2",{shape:"path",x:40,y:40,width:y,height:60,path:"M3,1 C1.9,1 1,1.8 1,2.9 L29,43.1 C30.1,44.7 31.3,45 32.1,45 L32.1,45 C32.1,45 33.8,44.9 35.1,43.1 L63,2.9 C63,1.9 62.1,1 61,1 L3,1 L3,1 Z",attrs:{body:o()(o()({},i.body),{},{fill:"white"}),text:{text:"\u914D\u6599\u5DE5\u5E8F",refY:10}},ports:d.Tt,data:{config:{type:"process"}},groups:["process"]}),u.set("rhombus",{shape:"polygon",x:600,y:70,width:y,height:m,points:"0,10 10,0 20,10 10,20",attrs:{body:o()({},i.body),text:{text:"\u68C0\u9A8C\u5DE5\u5E8F"}},ports:d.Tt,data:{config:{type:"process"}},groups:["process"]}),u.set("ExtSharp",{shape:"ExtSharp",attrs:{text:{text:"http\u8BF7\u6C42",fontSize:14},image:{width:20,x:2,y:2}},ports:d.Tt});function h(s){return new c.Z(u.get(s))}},2325:function(Z,_,e){e.d(_,{C:function(){return f}});var f=new Map,o=50,d=50;f.set("ExtSharp",{name:"ExtSharp",config:{width:100,height:d,attrs:{body:{rx:6,ry:6,stroke:"#5F95FF",strokeWidth:1,fill:"rgba(95,149,255,0.05)",refWidth:1,refHeight:1},image:{refX:2,refY:0},text:{refX:4,refY:20,fontSize:12,"text-anchor":"start"}},markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}})},42651:function(Z,_,e){e.d(_,{Z:function(){return i}});var f=e(21140),o=e.n(f),d=e(63466),c=e.n(d),y=e(52510),m=e.n(y),i=function(){function u(h){o()(this,u),m()(this,"_nodeConfig",void 0),m()(this,"_groups",void 0),this._nodeConfig=JSON.parse(JSON.stringify(h)),this._nodeConfig._groups&&(this._groups=this._nodeConfig._groups)}return c()(u,[{key:"getNodeConfig",value:function(){return this._nodeConfig}},{key:"getGroups",value:function(){return this._groups}},{key:"setLabel",value:function(s){this._nodeConfig.attrs&&(this._nodeConfig.attrs.text.text=s)}},{key:"setGroups",value:function(s){this._groups=s}},{key:"setConfigSchemel",value:function(s){this._nodeConfig.data?(this._nodeConfig.data.configSchema=s,this._nodeConfig.data.config={type:s}):this._nodeConfig.data={configSchema:s,config:{type:s}}}},{key:"setConfigData",value:function(s){this._nodeConfig.data?this._nodeConfig.data.config=s:this._nodeConfig.data={config:s}}}]),u}()},53105:function(Z,_,e){e.r(_),e.d(_,{default:function(){return Ce}});var f=e(93525),o=e.n(f),d=e(54306),c=e.n(d),y=e(60341),m=e(83217),i=e(36267),u=e(4283),h=e(8051),s=e(72197),P=e(54145),E=e(98825),D=e(87363),F=e(98306),L=e(70517),B=e(99273),I=e(5671),M=e(14990),k=e(22465),ue=e(72237),ee=e(2069),de=e(25590),ce=e(21140),ve=e.n(ce),he=e(63466),ge=e.n(he),_e=function(){function H(){ve()(this,H)}return ge()(H,[{key:"graphToMesDsl",value:function(G,a){var $=[],oe=[],Y=G==null?void 0:G.getCells(),se={},A=a||{};return A.routeProductDetailList=[],Y.forEach(function(w){var Q=w.id||"";if(w.shape==="edge"){var R,U=w,K=((R=U.labels)===null||R===void 0?void 0:R.length)>0?U.labels[0].attrs.label.text:"",N=U.data.type,n=U.getSourceNode(),l=U.getTargetNode();if(l.getChildCount()>0){var J=l.getChildren();J==null||J.forEach(function(j){var b;(b=A.routeProductDetailList)===null||b===void 0||b.push({fromNode:n==null?void 0:n.id,fromNodeName:n==null?void 0:n.getAttrByPath("text/text"),toNode:j.id,toNodeName:j.getAttrByPath("text/text"),productCode:a==null?void 0:a.productCode,productName:a==null?void 0:a.productName,routeType:N,routeDetailDto:j.data.config,inputOutputRatio:K,groupTag:l==null?void 0:l.getAttrByPath("text/text")})})}else if((n==null?void 0:n.getChildCount())>0){var W=n==null?void 0:n.getChildren();W==null||W.forEach(function(j){var b;(b=A.routeProductDetailList)===null||b===void 0||b.push({fromNode:j.id,fromNodeName:j.getAttrByPath("text/text"),toNode:l.id,toNodeName:l==null?void 0:l.getAttrByPath("text/text"),productCode:a==null?void 0:a.productCode,productName:a==null?void 0:a.productName,routeType:N,routeDetailDto:j.data.config,inputOutputRatio:K,groupTag:n==null?void 0:n.getAttrByPath("text/text")})})}else{var C;(C=A.routeProductDetailList)===null||C===void 0||C.push({fromNode:n==null?void 0:n.id,fromNodeName:n==null?void 0:n.getAttrByPath("text/text"),toNode:l.id,toNodeName:l==null?void 0:l.getAttrByPath("text/text"),routeType:N,productCode:a==null?void 0:a.productCode,productName:a==null?void 0:a.productName,routeDetailDto:n==null?void 0:n.data.config,inputOutputRatio:K})}}}),A}}]),H}(),fe=e(82628),O=e(2008),me=e(2325),t=e(33130),te=new fe.e,p=(0,O.n)("circle");p==null||p.setConfigSchemel("start"),p==null||p.setConfigData({name:"start"}),p==null||p.setLabel("start"),p.setGroups(["def"]);var pe=function(){var ne=(0,D.useState)({}),G=c()(ne,2),a=G[0],$=G[1],oe=(0,D.useState)({}),Y=c()(oe,2),se=Y[0],A=Y[1],w=(0,D.useState)(!0),Q=c()(w,2),R=Q[0],U=Q[1],K=(0,D.useState)(!1),N=c()(K,2),n=N[0],l=N[1],J=(0,F.lr)(),W=c()(J,2),C=W[0],j=W[1],b=(0,D.useState)("1"),ae=c()(b,2),z=ae[0],xe=ae[1],De=(0,D.useState)(),re=c()(De,2),T=re[0],ye=re[1],Pe=(0,D.useState)([]),ie=c()(Pe,2),Se=ie[0],Ee=ie[1];function le(v){a.graphData=JSON.stringify(v.toJSON());var r=new _e().graphToMesDsl(v,a);$(r),l(!0),te.updateRouteProcessDesign(r).then(function(S){console.log("\u4FDD\u5B58\u63A5\u53E3\u8FD4\u56DE");var g=JSON.parse(S.data);g.code=="500"?m.ZP.error(g.message):m.ZP.success("\u4FDD\u5B58\u6210\u529F"),l(!1)}).catch(function(S){m.ZP.error(S),l(!1)})}(0,D.useEffect)(function(){l(!0),te.getRouteProcessDesign(C.get("prodCode"),C.get("version")).then(function(S){var g=JSON.parse(S.data);g.result&&($(g.result),A(g.result.graphData?JSON.parse(g.result.graphData):{})),l(!1)}).catch(function(S){l(!1),console.log("err"),console.log(S)});var v=[];v.push(p);var r=(0,O.n)("circle");r==null||r.setConfigSchemel("end"),p==null||p.setConfigData({name:"end"}),r==null||r.setLabel("end"),r==null||r.setGroups(["def"]),v.push(r),(0,de.O)().then(function(S){console.log("\u62C9\u53D6\u5927\u7C7B\u6570\u636E"),console.log(S),S.data.forEach(function(V){var q,x;switch(V.key){case"PROCESS_GROUP":x=(0,O.n)("circle"),x.setConfigSchemel("process");break;case"CHECK_GROUP":x=(0,O.n)("rhombus"),x.setConfigSchemel("process");break;case"WAIT_GROUP":x=(0,O.n)("triangle"),x.setConfigSchemel("process");break;case"PICK_GROUP":x=(0,O.n)("triangle2"),x.setConfigSchemel("process");break;default:x=(0,O.n)("ExtSharp"),x.setConfigSchemel("process");break}(q=x)===null||q===void 0||q.setConfigData(V),x.setLabel(V.text),x.setGroups(["process"]);var je=x;v.push(je)});var g=(0,O.n)("group");g==null||g.setLabel("\u5DE5\u5E8F\u7EC4"),g==null||g.setConfigSchemel("process-group"),g.setGroups(["process"]),v.push(g),console.log("cusNodes"),console.log(v),Ee(v)})},[]);var be=(0,D.useCallback)(function(){return new I.bn.kS({attrs:{line:{targetMarker:"classic",stroke:z=="1"?"#000000":"#FF9900"}},tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0,data:{type:z}})},[z]),X=i.Z.Text,Oe=function(){return(0,t.jsxs)(u.Z,{style:{height:"50px",marginLeft:"20px"},children:[(0,t.jsx)(i.Z,{children:"\u4EA7\u54C1\u7F16\u7801"}),(0,t.jsx)(X,{underline:!0,children:C==null?void 0:C.get("prodCode")}),(0,t.jsx)(h.Z,{type:"vertical"}),(0,t.jsx)(i.Z,{children:"\u4EA7\u54C1\u540D\u79F0"}),(0,t.jsx)(X,{underline:!0,children:C==null?void 0:C.get("prodName")}),(0,t.jsx)(h.Z,{type:"vertical"}),(0,t.jsx)(i.Z,{children:"\u5BA2\u6237\u6599\u53F7"}),(0,t.jsx)(X,{underline:!0,children:C.get("cusCode")}),(0,t.jsx)(h.Z,{type:"vertical"}),(0,t.jsx)(i.Z,{children:"\u7248\u672C\u53F7"}),(0,t.jsx)(X,{underline:!0,children:C.get("version")})]})};return(0,t.jsxs)("div",{children:[(0,t.jsx)(Oe,{}),(0,t.jsx)(s.Z,{spinning:n,children:(0,t.jsx)(y.l,{panelData:{Nodes:o()(Se),Shapes:[me.C.get("ExtSharp")],Groups:[{name:"def",title:"\u9ED8\u8BA4\u8282\u70B9",graphHeight:100},{name:"process",title:"\u5DE5\u5E8F",graphHeight:400}]},showLeft:R,graphIns:T,toolElements:[(0,t.jsx)(P.ZP,{type:"text",icon:R?(0,t.jsx)(M.Z,{}):(0,t.jsx)(k.Z,{}),onClick:function(){U(!R)},style:{fontSize:"16px",width:64,height:64}}),(0,t.jsx)(P.ZP,{icon:(0,t.jsx)(ue.Z,{}),type:"primary",onClick:function(){le(T)},children:"\u4FDD\u5B58"}),(0,t.jsxs)("span",{children:["\u8FDE\u63A5\u7EBF\u7C7B\u578B\uFF1A",(0,t.jsxs)(E.Z,{style:{width:"100px"},value:z,onSelect:function(r){xe(r)},children:[(0,t.jsx)(E.Z.Option,{children:(0,t.jsx)("span",{style:{textDecoration:"underline",textDecorationThickness:3,textDecorationColor:"#000000"},children:"\u52A0\u5DE5\u7EBF"})},"1"),(0,t.jsx)(E.Z.Option,{children:(0,t.jsx)("span",{style:{textDecoration:"underline",textDecorationThickness:3,textDecorationColor:"#FF9900"},children:"\u8FD4\u5DE5\u7EBF"})},"2")]})]}),(0,t.jsx)(P.ZP,{icon:(0,t.jsx)(ee.g9,{}),onClick:function(){debugger;T&&T.canUndo()&&T.undo()},children:"\u64A4\u9500"}),(0,t.jsx)(P.ZP,{icon:(0,t.jsx)(ee.NW,{}),onClick:function(){debugger;T&&T.canRedo()&&T.undo()},children:"\u91CD\u505A"}),(0,t.jsx)(P.ZP,{onClick:function(){L.Z.post("/api/mes/asm-system/bbs/v1/common/accounts/employee/access-token",{loginName:"admin",password:"1234@qwer"}).then(function(r){debugger;B.F.setTokenToLocal(r.data.data.accessToken),m.ZP.success(r.data.data.accessToken)}).catch(function(r){return m.ZP.error(r.toString())})},children:"\u83B7\u53D6\u6743\u9650"})],graphJson:se,createEdge:be,onSave:le,onGraphInsChange:function(r){return ye(r)}})})]})},Ce=pe},82628:function(Z,_,e){e.d(_,{e:function(){return P}});var f=e(25359),o=e.n(f),d=e(49811),c=e.n(d),y=e(21140),m=e.n(y),i=e(63466),u=e.n(i),h=e(70517),s=new h.Z.Axios({headers:{Authorization:"Bearer "+localStorage.getItem("token"),"Content-Type":"application/json"}}),P=function(){function E(){m()(this,E)}return u()(E,[{key:"updateRouteProcessDesign",value:function(){var D=c()(o()().mark(function L(B){return o()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.abrupt("return",s.post("/api/mes/asm-standard/route/update-route-process-design",JSON.stringify(B)));case 1:case"end":return M.stop()}},L)}));function F(L){return D.apply(this,arguments)}return F}()},{key:"getRouteProcessDesign",value:function(){var D=c()(o()().mark(function L(B,I){return o()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.abrupt("return",s.post("/api/mes/asm-standard/route/route-process-design",JSON.stringify({version:I,productCode:B})));case 1:case"end":return k.stop()}},L)}));function F(L,B){return D.apply(this,arguments)}return F}()}]),E}()},25590:function(Z,_,e){e.d(_,{O:function(){return m}});var f=e(25359),o=e.n(f),d=e(49811),c=e.n(d),y=e(70517);function m(){return i.apply(this,arguments)}function i(){return i=c()(o()().mark(function u(){return o()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,y.Z)("/api/mes/asm-system/bbs/v1/common/dictionaries/list",{method:"post",data:{applicationCode:"bbs",dictionaryCategoryCode:"GROUP-TYPES",isEnabled:!0}}).then(function(P){if(P.data){var E=P.data;return E}else return[]}));case 1:case"end":return s.stop()}},u)})),i.apply(this,arguments)}}}]);
