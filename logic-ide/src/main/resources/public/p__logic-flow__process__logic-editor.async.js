"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[9207],{60341:function(T,h,e){e.d(h,{l:function(){return g.Z}});var g=e(93797)},2008:function(T,h,e){e.d(h,{n:function(){return _}});var g=e(57213),n=e.n(g),i=e(12490),d=e(42651),y=80,f=80,l={body:{fill:"#fff",stroke:"#8f8f8f",strokeWidth:1}},c=new Map;c.set("group",{shape:"rect",x:40,y:40,width:100,height:50,ports:i.Tt,attrs:{body:n()(n()({},l.body),{},{stroke:"black",strokeWidth:1,fillOpacity:0}),text:{text:"\u5DE5\u5E8F\u7EC4",refX:0,refY:10,"text-anchor":"start"}},data:{parent:!0}}),c.set("end",{shape:"circle",width:60,height:60,attrs:{body:n()(n()({},l.body),{},{fill:"gray"}),text:{text:"end"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:i.Tt,data:{configScheme:"end"}}),c.set("circle",{shape:"circle",width:60,height:60,attrs:{body:n()(n()({},l.body),{},{fill:"white"}),text:{text:""}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:i.Tt,data:{},groups:["process"]}),c.set("triangle",{shape:"path",x:40,y:40,width:y,height:60,path:"M3,45 C1.9,45 1,44.2 1,43.1 L29,2.9 C30.1,1.3 31.3,1 32.1,1 L32.1,1 C32.1,1 33.8,1.1 35.1,2.9 L63,43.1 C63,44.1 62.1,45 61,45 L3,45 L3,45 Z",attrs:{body:n()(n()({},l.body),{},{fill:"white"}),text:{text:"\u4E09\u89D2\u5F62",refY:50}},ports:i.Tt,data:{config:{}}}),c.set("triangle2",{shape:"path",x:40,y:40,width:y,height:60,path:"M3,1 C1.9,1 1,1.8 1,2.9 L29,43.1 C30.1,44.7 31.3,45 32.1,45 L32.1,45 C32.1,45 33.8,44.9 35.1,43.1 L63,2.9 C63,1.9 62.1,1 61,1 L3,1 L3,1 Z",attrs:{body:n()(n()({},l.body),{},{fill:"white"}),text:{text:"\u914D\u6599\u5DE5\u5E8F",refY:10}},ports:i.Tt,data:{config:{type:"process"}},groups:["process"]}),c.set("rhombus",{shape:"polygon",x:600,y:70,width:y,height:f,points:"0,10 10,0 20,10 10,20",attrs:{body:n()({},l.body),text:{text:"\u68C0\u9A8C\u5DE5\u5E8F"}},ports:i.Tt,data:{config:{type:"process"}},groups:["process"]}),c.set("ExtSharp",{shape:"ExtSharp",attrs:{text:{text:"http\u8BF7\u6C42",fontSize:14},image:{width:20,x:2,y:2}},ports:i.Tt});function _(a){return new d.Z(c.get(a))}},65020:function(T,h,e){e.d(h,{n:function(){return n}});var g=e(12490);function n(i){var d=i.createNode({shape:"circle",label:"start",width:50,height:50,attrs:{body:{}},ports:g.Hi,data:{config:{type:"start"}}});i.addNode(d)}},2325:function(T,h,e){e.d(h,{C:function(){return g}});var g=new Map,n=50,i=50;g.set("ExtSharp",{name:"ExtSharp",config:{width:100,height:i,attrs:{body:{rx:6,ry:6,stroke:"#5F95FF",strokeWidth:1,fill:"rgba(95,149,255,0.05)",refWidth:1,refHeight:1},image:{refX:2,refY:0},text:{refX:4,refY:20,fontSize:12,"text-anchor":"start"}},markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}})},42651:function(T,h,e){e.d(h,{Z:function(){return l}});var g=e(21140),n=e.n(g),i=e(63466),d=e.n(i),y=e(52510),f=e.n(y),l=function(){function c(_){n()(this,c),f()(this,"_nodeConfig",void 0),f()(this,"_groups",void 0),this._nodeConfig=JSON.parse(JSON.stringify(_)),this._nodeConfig._groups&&(this._groups=this._nodeConfig._groups)}return d()(c,[{key:"getNodeConfig",value:function(){return this._nodeConfig}},{key:"getGroups",value:function(){return this._groups}},{key:"setLabel",value:function(a){this._nodeConfig.attrs&&(this._nodeConfig.attrs.text.text=a)}},{key:"setGroups",value:function(a){this._groups=a}},{key:"setConfigSchemel",value:function(a){this._nodeConfig.data?(this._nodeConfig.data.configSchema=a,this._nodeConfig.data.config={type:a}):this._nodeConfig.data={configSchema:a,config:{type:a}}}},{key:"setConfigData",value:function(a){this._nodeConfig.data?this._nodeConfig.data.config=a:this._nodeConfig.data={config:a}}}]),c}()},53105:function(T,h,e){e.r(h),e.d(h,{default:function(){return xe}});var g=e(93525),n=e.n(g),i=e(54306),d=e.n(i),y=e(60341),f=e(43702),l=e(95812),c=e(40767),_=e(22983),a=e(52615),P=e(75904),S=e(7995),x=e(87363),F=e(98306),L=e(70517),Z=e(99273),H=e(5671),A=e(14990),N=e(22465),ue=e(72237),ee=e(52943),de=e(25590),ce=e(21140),ve=e.n(ce),he=e(63466),ge=e.n(he),_e=function(){function I(){ve()(this,I)}return ge()(I,[{key:"graphToMesDsl",value:function(G,r){var $=[],oe=[],Y=G==null?void 0:G.getCells(),se={},R=r||{};return R.routeProductDetailList=[],Y.forEach(function(K){var Q=K.id||"";if(K.shape==="edge"){var U,B=K,w=((U=B.labels)===null||U===void 0?void 0:U.length)>0?B.labels[0].attrs.label.text:"",k=B.data.type,o=B.getSourceNode(),u=B.getTargetNode();if(u.getChildCount()>0){var J=u.getChildren();J==null||J.forEach(function(j){var E;(E=R.routeProductDetailList)===null||E===void 0||E.push({fromNode:o==null?void 0:o.id,fromNodeName:o==null?void 0:o.getAttrByPath("text/text"),toNode:j.id,toNodeName:j.getAttrByPath("text/text"),productCode:r==null?void 0:r.productCode,productName:r==null?void 0:r.productName,routeType:k,routeDetailDto:j.data.config,inputOutputRatio:w,groupTag:u==null?void 0:u.getAttrByPath("text/text")})})}else if((o==null?void 0:o.getChildCount())>0){var W=o==null?void 0:o.getChildren();W==null||W.forEach(function(j){var E;(E=R.routeProductDetailList)===null||E===void 0||E.push({fromNode:j.id,fromNodeName:j.getAttrByPath("text/text"),toNode:u.id,toNodeName:u==null?void 0:u.getAttrByPath("text/text"),productCode:r==null?void 0:r.productCode,productName:r==null?void 0:r.productName,routeType:k,routeDetailDto:j.data.config,inputOutputRatio:w,groupTag:o==null?void 0:o.getAttrByPath("text/text")})})}else{var m;(m=R.routeProductDetailList)===null||m===void 0||m.push({fromNode:o==null?void 0:o.id,fromNodeName:o==null?void 0:o.getAttrByPath("text/text"),toNode:u.id,toNodeName:u==null?void 0:u.getAttrByPath("text/text"),routeType:k,productCode:r==null?void 0:r.productCode,productName:r==null?void 0:r.productName,routeDetailDto:o==null?void 0:o.data.config,inputOutputRatio:w})}}}),R}}]),I}(),fe=e(82628),O=e(2008),me=e(65020),pe=e(2325),t=e(33130),te=new fe.e,Ce=function(){var ne=(0,x.useState)({}),G=d()(ne,2),r=G[0],$=G[1],oe=(0,x.useState)({}),Y=d()(oe,2),se=Y[0],R=Y[1],K=(0,x.useState)(!0),Q=d()(K,2),U=Q[0],B=Q[1],w=(0,x.useState)(!1),k=d()(w,2),o=k[0],u=k[1],J=(0,F.lr)(),W=d()(J,2),m=W[0],j=W[1],E=(0,x.useState)("1"),ae=d()(E,2),z=ae[0],De=ae[1],ye=(0,x.useState)(),re=d()(ye,2),M=re[0],Pe=re[1],Se=(0,x.useState)([]),ie=d()(Se,2),Ee=ie[0],be=ie[1];function le(v){r.graphData=JSON.stringify(v.toJSON());var s=new _e().graphToMesDsl(v,r);$(s),u(!0),te.updateRouteProcessDesign(s).then(function(p){console.log("\u4FDD\u5B58\u63A5\u53E3\u8FD4\u56DE");var b=JSON.parse(p.data);b.code=="500"?f.ZP.error(b.message):f.ZP.success("\u4FDD\u5B58\u6210\u529F"),u(!1)}).catch(function(p){f.ZP.error(p),u(!1)})}(0,x.useEffect)(function(){u(!0),te.getRouteProcessDesign(m.get("prodCode"),m.get("version")).then(function(b){var D=JSON.parse(b.data);D.result&&($(D.result),R(D.result.graphData?JSON.parse(D.result.graphData):{})),u(!1)}).catch(function(b){u(!1),console.log("err"),console.log(b)});var v=[],s=(0,O.n)("circle");s==null||s.setConfigSchemel("start"),s==null||s.setConfigData({name:"start"}),s==null||s.setLabel("start"),s.setGroups(["def"]),v.push(s);var p=(0,O.n)("circle");p==null||p.setConfigSchemel("end"),s==null||s.setConfigData({name:"end"}),p==null||p.setLabel("end"),p==null||p.setGroups(["def"]),v.push(p),(0,de.O)().then(function(b){console.log("\u62C9\u53D6\u5927\u7C7B\u6570\u636E"),console.log(b),b.data.forEach(function(V){var q,C;switch(V.key){case"PROCESS_GROUP":C=(0,O.n)("circle"),C.setConfigSchemel("process");break;case"CHECK_GROUP":C=(0,O.n)("rhombus"),C.setConfigSchemel("process");break;case"WAIT_GROUP":C=(0,O.n)("triangle"),C.setConfigSchemel("process");break;case"PICK_GROUP":C=(0,O.n)("triangle2"),C.setConfigSchemel("process");break;default:C=(0,O.n)("ExtSharp"),C.setConfigSchemel("process");break}(q=C)===null||q===void 0||q.setConfigData(V),C.setLabel(V.text),C.setGroups(["process"]);var Me=C;v.push(Me)});var D=(0,O.n)("group");D==null||D.setLabel("\u5DE5\u5E8F\u7EC4"),D==null||D.setConfigSchemel("process-group"),D.setGroups(["process"]),v.push(D),console.log("cusNodes"),console.log(v),be(v)})},[]);var Oe=(0,x.useCallback)(function(){return new H.bn.kS({attrs:{line:{targetMarker:"classic",stroke:z=="1"?"#000000":"#FF9900"}},tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0,data:{type:z}})},[z]),X=l.Z.Text,je=function(){return(0,t.jsxs)(c.Z,{style:{height:"50px",marginLeft:"20px"},children:[(0,t.jsx)(l.Z,{children:"\u4EA7\u54C1\u7F16\u7801"}),(0,t.jsx)(X,{underline:!0,children:m==null?void 0:m.get("prodCode")}),(0,t.jsx)(_.Z,{type:"vertical"}),(0,t.jsx)(l.Z,{children:"\u4EA7\u54C1\u540D\u79F0"}),(0,t.jsx)(X,{underline:!0,children:m==null?void 0:m.get("prodName")}),(0,t.jsx)(_.Z,{type:"vertical"}),(0,t.jsx)(l.Z,{children:"\u5BA2\u6237\u6599\u53F7"}),(0,t.jsx)(X,{underline:!0,children:m.get("cusCode")}),(0,t.jsx)(_.Z,{type:"vertical"}),(0,t.jsx)(l.Z,{children:"\u7248\u672C\u53F7"}),(0,t.jsx)(X,{underline:!0,children:m.get("version")})]})};return(0,t.jsxs)("div",{children:[(0,t.jsx)(je,{}),(0,t.jsx)(a.Z,{spinning:o,children:(0,t.jsx)(y.l,{panelData:{Nodes:n()(Ee),Shapes:[pe.C.get("ExtSharp")],Groups:[{name:"def",title:"\u9ED8\u8BA4\u8282\u70B9",graphHeight:100},{name:"process",title:"\u5DE5\u5E8F",graphHeight:400}]},showLeft:U,graphIns:M,toolElements:[(0,t.jsx)(P.ZP,{type:"text",icon:U?(0,t.jsx)(A.Z,{}):(0,t.jsx)(N.Z,{}),onClick:function(){B(!U)},style:{fontSize:"16px",width:64,height:64}}),(0,t.jsx)(P.ZP,{icon:(0,t.jsx)(ue.Z,{}),type:"primary",onClick:function(){le(M)},children:"\u4FDD\u5B58"}),(0,t.jsxs)("span",{children:["\u8FDE\u63A5\u7EBF\u7C7B\u578B\uFF1A",(0,t.jsxs)(S.Z,{style:{width:"100px"},value:z,onSelect:function(s){De(s)},children:[(0,t.jsx)(S.Z.Option,{children:(0,t.jsx)("span",{style:{textDecoration:"underline",textDecorationThickness:3,textDecorationColor:"#000000"},children:"\u52A0\u5DE5\u7EBF"})},"1"),(0,t.jsx)(S.Z.Option,{children:(0,t.jsx)("span",{style:{textDecoration:"underline",textDecorationThickness:3,textDecorationColor:"#FF9900"},children:"\u8FD4\u5DE5\u7EBF"})},"2")]})]}),(0,t.jsx)(P.ZP,{icon:(0,t.jsx)(ee.g9,{}),onClick:function(){debugger;M&&M.canUndo()&&M.undo()},children:"\u64A4\u9500"}),(0,t.jsx)(P.ZP,{icon:(0,t.jsx)(ee.NW,{}),onClick:function(){debugger;M&&M.canRedo()&&M.undo()},children:"\u91CD\u505A"}),(0,t.jsx)(P.ZP,{onClick:function(){L.Z.post("/api/mes/asm-system/bbs/v1/common/accounts/employee/access-token",{loginName:"admin",password:"1234@qwer"}).then(function(s){debugger;Z.F.setTokenToLocal(s.data.data.accessToken),f.ZP.success(s.data.data.accessToken)}).catch(function(s){return f.ZP.error(s.toString())})},children:"\u83B7\u53D6\u6743\u9650"})],graphJson:se,onGraphJsonEmpty:me.n,createEdge:Oe,onSave:le,onGraphInsChange:function(s){return Pe(s)}})})]})},xe=Ce},82628:function(T,h,e){e.d(h,{e:function(){return P}});var g=e(25359),n=e.n(g),i=e(49811),d=e.n(i),y=e(21140),f=e.n(y),l=e(63466),c=e.n(l),_=e(70517),a=new _.Z.Axios({headers:{Authorization:"Bearer "+localStorage.getItem("token"),"Content-Type":"application/json"}}),P=function(){function S(){f()(this,S)}return c()(S,[{key:"updateRouteProcessDesign",value:function(){var x=d()(n()().mark(function L(Z){return n()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.abrupt("return",a.post("/api/mes/asm-standard/route/update-route-process-design",JSON.stringify(Z)));case 1:case"end":return A.stop()}},L)}));function F(L){return x.apply(this,arguments)}return F}()},{key:"getRouteProcessDesign",value:function(){var x=d()(n()().mark(function L(Z,H){return n()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.abrupt("return",a.post("/api/mes/asm-standard/route/route-process-design",JSON.stringify({version:H,productCode:Z})));case 1:case"end":return N.stop()}},L)}));function F(L,Z){return x.apply(this,arguments)}return F}()}]),S}()},25590:function(T,h,e){e.d(h,{O:function(){return f}});var g=e(25359),n=e.n(g),i=e(49811),d=e.n(i),y=e(70517);function f(){return l.apply(this,arguments)}function l(){return l=d()(n()().mark(function c(){return n()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,y.Z)("/api/mes/asm-system/bbs/v1/common/dictionaries/list",{method:"post",data:{applicationCode:"bbs",dictionaryCategoryCode:"GROUP-TYPES",isEnabled:!0}}).then(function(P){if(P.data){var S=P.data;return S}else return[]}));case 1:case"end":return a.stop()}},c)})),l.apply(this,arguments)}}}]);
