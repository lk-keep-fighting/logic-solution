"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[8029],{68029:function(q,B,h){h.r(B),h.d(B,{PickerControlRenderer:function(){return Y},default:function(){return S}});var t=h(15767),W=h(87363),p=h.n(W),j=h(84875),M=h.n(j),L=h(59245),F=h.n(L),K=h(33170),V=h.n(K),x=h(31223),R=h.n(x),Z=h(33886),G=h.n(Z),Q=h(67929),J=h.n(Q),s=h(42977),D=h(94391),z=h(4295),H=h.n(z),X=h(45581),$=h(23293),S=function(b){(0,t.ZT)(o,b);function o(e){var n=b.call(this,e)||this;n.state={isOpened:!1,schema:n.buildSchema(n.props),isFocused:!1},n.input=p().createRef(),n.toDispose=[],n.mounted=!1;var l=e.formInited,i=e.addHook,a=e.formItem,d=function(){return(0,t.mG)(n,void 0,void 0,function(){var r=this;return(0,t.Jh)(this,function(u){switch(u.label){case 0:return[4,this.fetchOptions()];case 1:return u.sent(),this.mounted&&this.toDispose.push((0,$.U5)(function(){return JSON.stringify(a==null?void 0:a.tmpValue)},function(){return r.fetchOptions()})),[2]}})})};return a&&n.toDispose.push(l||!i?a.addInitHook(d):i(d,"init")),n}return o.prototype.componentDidMount=function(){this.mounted=!0},o.prototype.componentDidUpdate=function(e){var n,l=this.props,i=["multiple","source","pickerSchema"];i.some(function(a){return!R()(e[a],l[a])})?this.setState({schema:this.buildSchema(l)}):(0,s.rMT)(e.source,l.source,e.data,l.data)&&!((n=l.formItem)===null||n===void 0)&&n.inited&&this.fetchOptions()},o.prototype.componentWillUnmount=function(){this.toDispose.forEach(function(e){return e()}),this.toDispose=[],this.mounted=!1},o.prototype.fetchOptions=function(){var e,n=this.props,l=n.value,i=n.formItem,a=n.valueField,d=n.labelField,r=n.source,u=n.data,v;if(!(!r||!i||(a||"value")===(d||"label")||(v=i.getSelectedOptions(l))&&(!v.length||v[0][a||"value"]!==v[0][d||"label"]))){var g=(0,s.nW9)(u,(e={value:l},e[a||"value"]=l,e.op="loadOptions",e));if((0,s.SSQ)(r))i.setOptions((0,s.OgC)(r,u,"| raw"));else if((0,s.X1t)(r,g))return i.loadOptions(r,g,{autoAppend:!0})}},o.prototype.buildSchema=function(e){var n,l,i=(0,s.SSQ)(e.source);return(0,t.pi)((0,t.pi)({checkOnItemClick:!0,listItem:{title:"${".concat(e.labelField||"label","|raw}")}},e.pickerSchema),{labelTpl:(l=(n=e.pickerSchema)===null||n===void 0?void 0:n.labelTpl)!==null&&l!==void 0?l:e.labelTpl,type:"crud",pickerMode:!0,syncLocation:!1,filterCanAccessSuperData:!1,api:i?null:e.source,source:i?e.source:null,keepItemSelectionOnPageChange:!0,valueField:e.valueField,labelField:e.labelField,bulkActions:e.multiple?e.pickerSchema.bulkActions:[]})},o.prototype.crudRef=function(e){for(;e&&e.getWrappedInstance;)e=e.getWrappedInstance();this.crud=e},o.prototype.reload=function(e,n){if(this.crud)this.crud.reload(e,n);else{var l=this.props.reloadOptions;l&&l(e,n)}},o.prototype.open=function(){this.setState({isOpened:!0})},o.prototype.close=function(){this.setState({isOpened:!1})},o.prototype.handleModalConfirm=function(e,n,l,i){return(0,t.mG)(this,void 0,void 0,function(){var a;return(0,t.Jh)(this,function(d){switch(d.label){case 0:return a=G()(i,function(r){return r.props.type==="crud"}),[4,this.handleChange(e[a].items)];case 1:return d.sent(),this.close(),[2]}})})},o.prototype.handleChange=function(e){return(0,t.mG)(this,void 0,void 0,function(){var n,l,i,a,d,r,u,v,g,C,E,m,c,f,O,y;return(0,t.Jh)(this,function(_){switch(_.label){case 0:return n=this.props,l=n.joinValues,i=n.valueField,a=n.delimiter,d=n.extractValue,r=n.multiple,u=n.options,v=n.data,g=n.dispatchEvent,C=n.selectedOptions,E=n.setOptions,m=n.onChange,c=e,l?c=e.map(function(P){return P[i||"value"]}).join(a||","):d?c=r?e.map(function(P){return P[i||"value"]}):e[0]&&e[0][i||"value"]||"":c=r?e:e[0],f=[],e.forEach(function(P){V()(u,function(k){return P[i||"value"]==k[i||"value"]})||f.push(P)}),f.length&&E(u.concat(f)),O=r?e:e[0],[4,g("change",(0,s.vXk)(this.props,{value:c,option:O,selectedItems:O}))];case 1:return y=_.sent(),y!=null&&y.prevented?[2]:(m(c),[2])}})})},o.prototype.handleItemClick=function(e){return(0,t.mG)(this,void 0,void 0,function(){var n,l,i,a;return(0,t.Jh)(this,function(d){switch(d.label){case 0:return n=this.props,l=n.data,i=n.dispatchEvent,[4,i("itemClick",(0,s.nW9)(l,{item:e}))];case 1:return a=d.sent(),a!=null&&a.prevented?[2]:[2]}})})},o.prototype.removeItem=function(e){return(0,t.mG)(this,void 0,void 0,function(){var n,l,i,a,d,r,u,v,g,C,E,m,c,f;return(0,t.Jh)(this,function(O){switch(O.label){case 0:return n=this.props,l=n.selectedOptions,i=n.joinValues,a=n.extractValue,d=n.delimiter,r=n.valueField,u=n.onChange,v=n.multiple,g=n.dispatchEvent,C=l.concat(),E=(0,t.CR)(C.splice(e,1),1),m=E[0],c=C,i?c=C.map(function(y){return y[r||"value"]}).join(d||","):a?c=v?C.map(function(y){return y[r||"value"]}):C[0]&&C[0][r||"value"]||"":c=v?C:C[0],[4,g("change",(0,s.vXk)(this.props,{value:c,option:m,selectedItems:m}))];case 1:return f=O.sent(),f!=null&&f.prevented?[2]:(u(c),[2])}})})},o.prototype.handleKeyDown=function(e){var n=this.props.selectedOptions;e.key===" "?(this.open(),e.preventDefault()):n.length&&e.key=="Backspace"&&this.removeItem(n.length-1)},o.prototype.handleFocus=function(e){this.input.current&&this.input.current.focus(),e.stopPropagation(),this.setState({isFocused:!0})},o.prototype.handleBlur=function(){this.setState({isFocused:!1})},o.prototype.handleClick=function(){this.open()},o.prototype.clearValue=function(e){e.stopPropagation();var n=this.props,l=n.onChange,i=n.resetValue;l(i!==void 0?i:"")},o.prototype.getOverflowConfig=function(){var e=this.props.overflowConfig;return J()(o.defaultProps.overflowConfig,e)},o.prototype.handleSelect=function(e,n){var l=this.props,i=l.selectedOptions,a=l.valueField;if(!(!Array.isArray(e)||!Array.isArray(n)||!e.length&&!n.length)){var d=H()(e,i,function(r,u){var v=r[a||"value"],g=u[a||"value"];return v||g?v===g:R()(F()(r,"value"),F()(u,"value"))});d.length===e.length&&d.length===i.length||this.handleChange(e)}},o.prototype.renderTag=function(e,n){var l=this,i=this.props,a=i.itemClearable,d=a===void 0?!0:a,r=i.classPrefix,u=i.classnames,v=i.labelField,g=i.labelTpl,C=i.translate,E=i.disabled,m=i.env,c=i.id,f=i.themeCss,O=i.css;return p().createElement("div",{key:n,className:u("".concat(r,"Picker-value"),(0,s.GwQ)((0,t.pi)((0,t.pi)({},this.props),{name:"pickValueWrapClassName",id:c,themeCss:f||O})),{"is-disabled":E})},d&&p().createElement("span",{className:u("".concat(r,"Picker-valueIcon"),(0,s.GwQ)((0,t.pi)((0,t.pi)({},this.props),{name:"pickValueIconClassName",id:c,themeCss:f||O}))),onClick:function(y){y.stopPropagation(),l.removeItem(n)}},"\xD7"),p().createElement(D.mad,{inline:!1,tooltip:(0,s.E04)(e,v||"label")},p().createElement("span",{className:u("".concat(r,"Picker-valueLabel"),(0,s.GwQ)((0,t.pi)((0,t.pi)({},this.props),{name:"pickFontClassName",id:c,themeCss:f||O}))),onClick:function(y){y.stopPropagation(),l.handleItemClick(e)}},g?p().createElement(D.Vtq,{html:(0,s.hXT)(g,e),filterHtml:m.filterHtml}):"".concat((0,s.E04)(e,v||"label")||(0,s.E04)(e,"id")))))},o.prototype.renderValues=function(){var e=this,n=this.props,l=n.classPrefix,i=n.selectedOptions,a=n.translate,d=n.disabled,r=n.multiple,u=n.popOverContainer,v=n.id,g=n.themeCss,C=n.css,E=this.getOverflowConfig(),m=E.maxTagCount,c=E.overflowTagPopover,f=i.length,O=i,y=r!==!1&&(0,s.wYV)(m,{start:0,end:f,left:"inclusive",right:"exclusive"});return y&&(O=(0,t.ev)((0,t.ev)([],(0,t.CR)(i.slice(0,m)),!1),[{label:"+ ".concat(f-m," ..."),value:"__overflow_tag__"}],!1)),p().createElement(p().Fragment,null,O.map(function(_,P){return y&&P===m?p().createElement(D.pfc,{key:P,container:u,tooltip:(0,t.pi)((0,t.pi)({tooltipClassName:M()("Picker-overflow",c==null?void 0:c.tooltipClassName),title:a("\u5DF2\u9009\u9879")},F()(c,["children","content","tooltipClassName"])),{children:function(){return p().createElement("div",{className:M()("".concat(l,"Picker-overflow-wrapper"))},i.slice(m,f).map(function(k,T){var I=T+m;return e.renderTag(k,I)}))}})},p().createElement("div",{key:P,className:M()("".concat(l,"Picker-value"),{"is-disabled":d})},p().createElement("span",{className:"".concat(l,"Picker-valueLabel ").concat((0,s.GwQ)((0,t.pi)((0,t.pi)({},e.props),{name:"pickFontClassName",id:v,themeCss:g||C})))},_.label))):e.renderTag(_,P)}))},o.prototype.overrideCRUDProps=function(){return{}},o.prototype.renderBody=function(e){var n=e===void 0?{}:e,l=n.popOverContainer,i=this.props,a=i.render,d=i.selectedOptions,r=i.options,u=i.multiple,v=i.valueField,g=i.embed,C=i.source,E=i.strictMode,m=i.testIdBuilder,c=this.getOverflowConfig(),f=c.maxTagCount,O=c.overflowTagPopoverInCRUD,y=c.displayPosition;return a("modal-body",this.state.schema,(0,t.pi)((0,t.pi)({value:d,valueField:v,primaryField:v,options:C?[]:r,multiple:u,strictMode:E,onSelect:g?this.handleSelect:void 0,testIdBuilder:m==null?void 0:m.getChild("body-schema"),ref:this.crudRef,popOverContainer:l},g||Array.isArray(y)&&y.includes("crud")?{maxTagCount:f,overflowTagPopover:O}:{}),this.overrideCRUDProps()))},o.prototype.render=function(){var e=this.props,n=e.className,l=e.style,i=e.modalClassName,a=e.classnames,d=e.disabled,r=e.render,u=e.modalMode,v=e.source,g=e.modalSize,C=e.clearable,E=e.multiple,m=e.placeholder,c=e.embed,f=e.selectedOptions,O=e.translate,y=e.popOverContainer,_=e.modalTitle,P=e.data,k=e.mobileUI,T=e.env,I=e.themeCss,N=e.css,A=e.id,U=e.classPrefix,w=e.testIdBuilder;return p().createElement("div",{className:a("PickerControl",{"is-mobile":k},n)},c?p().createElement("div",{className:a("Picker")},this.renderBody({popOverContainer:y})):p().createElement("div",{className:a("Picker",{"Picker--single":!E,"Picker--multi":E,"is-focused":this.state.isFocused,"is-disabled":d})},p().createElement("div",{onClick:this.handleClick,className:a("Picker-input",d&&"is-disabled",this.state.isFocused&&"is-focused",(0,s.GwQ)((0,t.pi)((0,t.pi)({},this.props),{name:"pickControlClassName",id:A,themeCss:I||N})))},!f.length&&m?p().createElement("div",{className:a("Picker-placeholder")},O(m)):p().createElement("div",(0,t.pi)({className:a("Picker-valueWrap")},w==null?void 0:w.getTestId()),this.renderValues(),p().createElement("input",{onChange:s.ZTd,value:"",ref:this.input,onKeyDown:this.handleKeyDown,onClick:this.handleFocus,onBlur:this.handleBlur,readOnly:k})),C&&!d&&f.length?p().createElement("a",{onClick:this.clearValue,className:a("Picker-clear")},p().createElement(D.JO$,{icon:"input-clear",className:"icon"})):null,p().createElement("span",(0,t.pi)({onClick:this.open,className:a("Picker-btn")},w==null?void 0:w.getChild("picker-open-btn").getTestId()),p().createElement(D.JO$,{icon:"window-restore",className:a("icon",(0,s.GwQ)((0,t.pi)((0,t.pi)({},this.props),{name:"pickIconClassName",id:A,themeCss:I||N}))),iconContent:"Picker-icon"}))),r("modal",{title:_&&typeof _=="string"?(0,s.hXT)(_,P):O("Select.placeholder"),size:g,type:u,className:i,body:{children:this.renderBody},testIdBuilder:w==null?void 0:w.getChild("modal")},{key:"modal",lazyRender:!!v,onConfirm:this.handleModalConfirm,onClose:this.close,show:this.state.isOpened})),p().createElement(s.cWM,(0,t.pi)({},this.props,{config:{themeCss:I||N,classNames:[{key:"pickControlClassName",weights:{default:{important:!0},hover:{important:!0},focused:{important:!0,parent:".".concat(U,"Picker.is-focused >")},disabled:{important:!0,parent:".".concat(U,"Picker.is-disabled >")}}},{key:"pickFontClassName"},{key:"pickValueWrapClassName",weights:{default:{important:!0}}},{key:"pickValueIconClassName",weights:{default:{important:!0},hover:{important:!0}}},{key:"pickIconClassName",weights:{default:{suf:" svg"}}}],id:A},env:T})))},o.propsList=["modalTitle","modalMode","modalSize","pickerSchema","labelField","onChange","options","value","inline","multiple","embed","resetValue","placeholder","onQuery"],o.defaultProps={modalMode:"dialog",multiple:!1,placeholder:"Picker.placeholder",labelField:"label",valueField:"value",pickerSchema:{mode:"list"},embed:!1,overflowConfig:{maxTagCount:-1,displayPosition:["select","crud"],overflowTagPopover:{placement:"top",trigger:"hover",showArrow:!1,offset:[0,-5]},overflowTagPopoverInCRUD:{placement:"bottom",trigger:"hover",showArrow:!1,offset:[0,0]}}},(0,t.gn)([s.NjZ,(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[]),(0,t.w6)("design:returntype",Object)],o.prototype,"fetchOptions",null),(0,t.gn)([s.NjZ,(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[Object]),(0,t.w6)("design:returntype",void 0)],o.prototype,"crudRef",null),(0,t.gn)([s.NjZ,(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[]),(0,t.w6)("design:returntype",void 0)],o.prototype,"open",null),(0,t.gn)([s.NjZ,(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[]),(0,t.w6)("design:returntype",void 0)],o.prototype,"close",null),(0,t.gn)([s.NjZ,(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[Array,Object,Object,Array]),(0,t.w6)("design:returntype",Promise)],o.prototype,"handleModalConfirm",null),(0,t.gn)([s.NjZ,(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[Array]),(0,t.w6)("design:returntype",Promise)],o.prototype,"handleChange",null),(0,t.gn)([s.NjZ,(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[Object]),(0,t.w6)("design:returntype",Promise)],o.prototype,"handleItemClick",null),(0,t.gn)([s.NjZ,(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[Object]),(0,t.w6)("design:returntype",void 0)],o.prototype,"handleKeyDown",null),(0,t.gn)([s.NjZ,(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[Object]),(0,t.w6)("design:returntype",void 0)],o.prototype,"handleFocus",null),(0,t.gn)([s.NjZ,(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[]),(0,t.w6)("design:returntype",void 0)],o.prototype,"handleBlur",null),(0,t.gn)([s.NjZ,(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[]),(0,t.w6)("design:returntype",void 0)],o.prototype,"handleClick",null),(0,t.gn)([s.NjZ,(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[Object]),(0,t.w6)("design:returntype",void 0)],o.prototype,"clearValue",null),(0,t.gn)([s.NjZ,(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[Array,Array]),(0,t.w6)("design:returntype",void 0)],o.prototype,"handleSelect",null),(0,t.gn)([s.NjZ,(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[]),(0,t.w6)("design:returntype",void 0)],o.prototype,"overrideCRUDProps",null),(0,t.gn)([s.NjZ,(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[Object]),(0,t.w6)("design:returntype",void 0)],o.prototype,"renderBody",null),(0,t.gn)([(0,X.i)(),(0,t.w6)("design:type",Function),(0,t.w6)("design:paramtypes",[]),(0,t.w6)("design:returntype",void 0)],o.prototype,"render",null),o}(p().PureComponent),Y=function(b){(0,t.ZT)(o,b);function o(){return b!==null&&b.apply(this,arguments)||this}return o=(0,t.gn)([(0,s.oZB)({type:"picker",autoLoadOptionsFromSource:!1,sizeMutable:!1})],o),o}(S)}}]);
