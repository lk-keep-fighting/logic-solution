"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[3988],{60341:function(I,C,e){e.d(C,{l:function(){return E.Z}});var E=e(93797)},44174:function(I,C,e){e.d(C,{n:function(){return y}});var E=e(12490),d=e(57213),O=e.n(d),g=50,h=50,D={body:{}},p={"wati-for-continu":{shape:"circle",ports:E.Tt,width:g,height:h,attrs:{body:O()(O()({},D.body),{},{fill:"white"}),text:{text:"\u4EA4\u4E92\u70B9"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],data:{config:{type:"wait-for-continue"}}},js:{shape:"ExtSharp",ports:E.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/logic/icons/code.svg"},text:{text:"js\u811A\u672C",fontSize:14}},data:{config:{type:"js"}}},java:{shape:"ExtSharp",ports:E.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/logic/icons/java.svg"},text:{text:"java\u65B9\u6CD5",fontSize:14}},data:{config:{type:"java"}}},switch:{shape:"ExtSharp",width:50,height:h,ports:E.Tt,label:"switch",attrs:{image:{"xlink:href":"/logic/icons/switch.svg",width:45,x:1,y:2},text:{text:"switch",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}}}};function y(f){var i=f.createNode({shape:"start",width:50,height:50,ports:E.Tt,data:{config:{type:"start",name:"\u5F00\u59CB"}}});f.addNode(i)}function c(f,i){var _=LogicItemSharpMapping[i.type];if(_){_.data={config:i};var m=f.createNode(_);m.setAttrByPath("text/text",i.name),f.addNode(m)}}},77357:function(I,C,e){e.d(C,{S8:function(){return m},nq:function(){return _}});var E=e(57213),d=e.n(E),O=e(21140),g=e.n(O),h=e(63466),D=e.n(h),p=e(83217),y=e(72107),c=e(12490),f=null;function i(n,r,t,a){var o,l,s=n.data.config,u=s.type,v=t.flatMap(function(M){return M.source.cell===n.id?r[M.target.cell]:[]}),U=n.attrs,P=new y.Du((o=n.id)!==null&&o!==void 0?o:"",u);if(P=d()(d()({},s),{},{id:n.id,name:U==null||(l=U.text)===null||l===void 0?void 0:l.text}),!(a.findIndex(function(M){return M.id===P.id})>-1)&&(a.push(P),v.length!==0))switch(u){default:if(v.length>1||P.type==="switch"){var T;console.log((T=n.data)===null||T===void 0?void 0:T.config),console.log(v),P.branches=[],v.forEach(function(M){var S,W;if(console.log((S=M.data)===null||S===void 0?void 0:S.config),((W=M.data)===null||W===void 0?void 0:W.config.type)==="switch-cases"){var j,B,w;(j=M.data)===null||j===void 0||(B=j.config)===null||B===void 0||(w=B.cases)===null||w===void 0||w.forEach(function(G){var V;(V=P.branches)===null||V===void 0||V.push({when:G,nextId:M.id})})}else{var F,N,L;(F=P.branches)===null||F===void 0||F.push({when:(N=M.data)===null||N===void 0||(L=N.config)===null||L===void 0?void 0:L.case,nextId:M.id})}i(r[M.id],r,t,a)})}else P.nextId=v[0].id,i(r[v[0].id],r,t,a);break}}function _(n,r){var t=new y.Iz(n),a=[],o=[],l={},s=void 0;if(r.forEach(function(u){var v=u.id||"";u.shape==="edge"?a.push(u):(l[v]=u,o.push(u),u.data.config.type==="start"&&(s=u))}),!s){p.ZP.error("\u672A\u53D1\u73B0\u5F00\u59CB\u8282\u70B9\uFF0C\u8BF7\u914D\u7F6E\uFF01");return}return i(s,l,a,t.items),console.log("logic.items"),console.log(t.items),t}function m(n){var r;if(!(n!=null&&(r=n.items)!==null&&r!==void 0&&r.length))return{nodes:[],edges:[]};var t=function(u){switch(console.log("type"),console.log(u),u){case"http":case"js":case"java":case"sub-logic":return{size:{width:100,height:50}};case"switch":return{size:{width:200,height:50}};case"switch-case":case"switch-default":case"switch-cases":return{size:{width:120,height:50}};default:return{size:{width:50,height:50}}}},a={shape:"edge"},o=n.items.map(function(s){return d()(d()({},t(s.type)),{},{id:s.id,ports:d()(d()({},c.Tt),{},{items:c.Tt.items.map(function(u){return d()(d()({},u),{},{id:"".concat(s.id,"-").concat(u.group)})})}),shape:s.type,data:{config:s}})}),l=n.items.flatMap(function(s){var u;return(u=s.branches)!==null&&u!==void 0&&u.length?s.branches.map(function(v){return d()(d()({},a),{},{source:{cell:s.id,port:s.id+"-bottom"},target:{cell:v.nextId,port:v.nextId+"-top"}})}):s.nextId?[d()(d()({},a),{},{source:{cell:s.id,port:s.id+"-bottom"},target:{cell:s.nextId,port:s.nextId+"-top"}})]:[]});return{nodes:o,edges:l}}},94744:function(I,C,e){e.d(C,{y:function(){return i}});var E=e(37635),d=e.n(E),O=e(21140),g=e.n(O),h=e(63466),D=e.n(h),p=e(72107),y=e(52510),c=e.n(y),f=D()(function _(m){g()(this,_),c()(this,"concept","EnvParam"),c()(this,"name",void 0),c()(this,"description",void 0),c()(this,"typeAnnotation",void 0),c()(this,"required",!1),c()(this,"defaultValue",void 0),this.name=m}),i=function(){function _(){g()(this,_)}return D()(_,null,[{key:"valueToTypeAnnotaion",value:function(n){var r=this,t={concept:p.Ld.TypeAnnotation,typeKind:"primitive",typeName:"string",defaultValue:n};if(Array.isArray(n))t.typeName="array";else{var a=d()(n);switch(a){case"boolean":t.typeKind="primitive",t.typeName="boolean";break;case"number":t.typeKind="primitive",t.typeName="number";break;case"string":t.typeKind="primitive",t.typeName="string";break;case"object":n==null?t.typeName="null":n instanceof Date?(t.typeKind="primitive",t.typeName="date"):n instanceof RegExp?(t.typeKind="primitive",t.typeName="regexp"):n instanceof Function?(t.typeKind="primitive",t.typeName="function"):(t.typeKind="anonymousStructure",t.typeName="object",t.properties=[],Object.keys(n).map(function(o){var l,s=n[o],u=r.valueToTypeAnnotaion(s),v=new p.X0(o);v.typeAnnotation=u,v.defaultValue=s,(l=t.properties)===null||l===void 0||l.push(v)}));break;default:t.typeKind="unknown",t.typeName=a;break}}return t}},{key:"typeAnnotaionToValue",value:function(n){var r,t,a=this,o;switch(n.typeName){case"array":o=(r=n.defaultValue)!==null&&r!==void 0?r:[];break;case"boolean":o=n.defaultValue?n.defaultValue=="true":!1;break;case"number":o=parseFloat(n.defaultValue);break;case"null":o=null;break;case"date":o=new Date(n.defaultValue);break;case"regexp":o=new RegExp(n.defaultValue);break;case"object":o={},(t=n.properties)===null||t===void 0||t.forEach(function(l){o[l.name]=a.typeAnnotaionToValue(l.typeAnnotation)});break;case"string":case"function":default:o=n.defaultValue;break}return o}},{key:"getParamArrayByJson",value:function(n){var r=[];return n&&Object.keys(n).forEach(function(t){var a=new p.dO(t);a.typeAnnotation=_.valueToTypeAnnotaion(n[t]),a.defaultValue=n[t],r.push(a)}),r}},{key:"getReturnArrayByJson",value:function(n){var r=[];return n&&Object.keys(n).forEach(function(t){var a=new p.z1(t);a.typeAnnotation=_.valueToTypeAnnotaion(n[t]),a.defaultValue=n[t],r.push(a)}),r}},{key:"getVariableArrayByJson",value:function(n){var r=[];return n&&Object.keys(n).forEach(function(t){var a=new p._w(t);a.typeAnnotation=_.valueToTypeAnnotaion(n[t]),a.defaultValue=n[t],r.push(a)}),r}},{key:"getEnvsArrayByJson",value:function(n){var r=[];return n&&Object.keys(n).forEach(function(t){var a=new f(t);a.typeAnnotation=_.valueToTypeAnnotaion(n[t]),a.defaultValue=n[t],r.push(a)}),r}},{key:"getJsonByParams",value:function(n){var r=this,t={};return n==null||n.forEach(function(a){t[a.name]=a.typeAnnotation?r.typeAnnotaionToValue(a.typeAnnotation):a.defaultValue}),t}}]),_}()},44132:function(I,C,e){var E=e(57213),d=e.n(E),O=e(54306),g=e.n(O),h=e(70517),D=e(90010),p=e.n(D),y=e(23620),c=e(2069),f=e(87363),i=e.n(f),_=e(12472),m=e(33358),n=e(49500),r=e(16123),t=e(78057),a=e(69078),o=e(98896),l=e(31837),s=e(32126),u=e(33130),v=function(P){var T=(0,f.useState)({type:"page"}),M=g()(T,2),S=M[0],W=M[1],j=(0,f.useState)(),B=g()(j,2),w=B[0],F=B[1],N=(0,f.useState)(),L=g()(N,2),G=L[0],V=L[1],Z="cxd",z="zh-CN";return(0,f.useEffect)(function(){(0,o.m)(h.Z)},[]),(0,f.useEffect)(function(){P.pageId&&((0,_.UD)(P.pageId).then(function(x){W(x)}),s.S.getEnvJson().then(function(x){F(JSON.parse(l.j.getEnv()))}))},[P.pageId]),(0,u.jsxs)("div",{children:[(0,u.jsx)(c.qR,{theme:Z,position:"top-right",locale:z},"toast"),(0,u.jsx)(c.wx,{theme:Z,locale:z},"alert"),(0,y.sYA)(S,{data:d()({envs:w},P.data)},{fetcher:function(A){var K=A.url,J=A.method,R=A.data,k=A.responseType,b=A.config,Y=A.headers;return P.data&&P.data.runtime&&(K="/api/ide/papi/".concat(P.data.runtime).concat(K)),b=b||{},b.withCredentials=!0,k&&(b.responseType=k),b.cancelExecutor&&(b.cancelToken=new h.Z.CancelToken(b.cancelExecutor)),b.headers=Y||{},b.headers.Authorization||(b.headers.Authorization="Bearer "+a.F.getTokenFormLocal()),J!=="post"&&J!=="put"&&J!=="patch"?(R&&(b.params=R),h.Z[J](K,b)):(R&&R instanceof FormData?(b.headers=b.headers||{},b.headers["Content-Type"]="multipart/form-data"):R&&typeof R!="string"&&!(R instanceof Blob)&&!(R instanceof ArrayBuffer)&&(R=JSON.stringify(R),b.headers=b.headers||{},b.headers["Content-Type"]="application/json"),h.Z[J](K,R,b))},isCancel:function(A){return h.Z.isCancel(A)},copy:function(A){p()(A),c.Am.success("\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u7C98\u8D34\u677F")},theme:Z,jumpTo:function(A,K){debugger;K.blank==!0?window.open(window.location.origin+window.location.pathname+"#"+A,"_blank"):window.location.hash=A}})]})};C.Z=v},7944:function(I,C,e){var E=e(54306),d=e.n(E),O=e(94990),g=e(94744),h=e(51394),D=e(83217),p=e(87363),y=e.n(p),c=e(33130),f=function(_){var m,n=(0,p.useState)({}),r=d()(n,2),t=r[0],a=r[1];(0,p.useEffect)(function(){var l=_.values,s=l.params,u=l.variables,v=l.envs,U=l.returns,P=l.log;a({params:JSON.stringify(g.y.getJsonByParams(s)),variables:JSON.stringify(g.y.getJsonByParams(u)),returns:JSON.stringify(g.y.getJsonByParams(U)),envs:JSON.stringify(g.y.getJsonByParams(v)),log:P})},[_.values]);var o=(0,p.useCallback)(function(l){try{return JSON.parse(l),!0}catch(s){return!1}},[]);return(0,c.jsxs)("span",{children:[_.children,(0,c.jsx)(h.Z,{open:(m=_.open)!==null&&m!==void 0?m:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return _==null?void 0:_.setOpen(!1)},children:(0,c.jsx)(O.Z,{formId:"logic-setting",values:t,onSubmit:function(s){console.log("\u63D0\u4EA4\u53C2\u6570"),console.log(s);var u=!1;Object.keys(s).forEach(function(v){var U=s[v];if(!o(U)){var P=v==="params"?"\u5165\u53C2":v==="variables"?"\u5C40\u90E8\u53D8\u91CF":v==="returns"?"\u8FD4\u56DE\u53C2\u6570":"\u73AF\u5883\u53D8\u91CF";switch(v){case"params":return D.ZP.error("\u5165\u53C2json\u683C\u5F0F\u9519\u8BEF"),u=!0,!1;break;case"variables":return D.ZP.error("\u5C40\u90E8\u53D8\u91CFjson\u683C\u5F0F\u9519\u8BEF"),u=!0,!1;break;case"returns":return D.ZP.error("\u8FD4\u56DE\u53C2\u6570json\u683C\u5F0F\u9519\u8BEF"),u=!0,!1;break;case"ens":return D.ZP.error("\u73AF\u5883\u53D8\u91CFjson\u683C\u5F0F\u9519\u8BEF"),u=!0,!1;break;default:break}}}),u||(_!=null&&_.onSubmit&&_.onSubmit(s),_==null||_.setOpen(!1))}})})]})};C.Z=f},79671:function(I,C,e){var E=e(94990),d=e(94744),O=e(83217),g=e(51394),h=e(77129),D=e(87363),p=e.n(D),y=e(33130),c=function(i){var _,m=(0,h.cI)();(0,D.useEffect)(function(){var t=i.values.params;m.setValues({params:JSON.stringify(d.y.getJsonByParams(t))})},[i.values]);var n=(0,D.useCallback)(function(t){try{return JSON.parse(t),!0}catch(a){return!1}},[]);function r(t){var a=!1;Object.keys(t).forEach(function(o){var l=t[o];if(["params","headers"].indexOf(o)>-1&&!n(l)){var s=o==="params"?"\u5165\u53C2":"\u8BF7\u6C42\u5934";return O.ZP.error("".concat(s,"json\u683C\u5F0F\u9519\u8BEF")),a=!0,!1}}),a||(i!=null&&i.onSubmit&&i.onSubmit(t,t.debugType),i==null||i.setOpen(!1))}return(0,y.jsxs)("span",{children:[i.children,(0,y.jsx)(g.Z,{open:(_=i.open)!==null&&_!==void 0?_:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return i==null?void 0:i.setOpen(!1)},children:(0,y.jsx)(E.Z,{formId:"logic-debug-input",onSubmit:r})})]})};C.Z=c},21558:function(I,C,e){e.d(C,{W:function(){return y}});var E=e(57213),d=e.n(E),O=e(21140),g=e.n(O),h=e(63466),D=e.n(h),p=e(77357),y=function(){function c(){g()(this,c)}return D()(c,[{key:"graphToLogicItems",value:function(i,_){var m=(0,p.nq)(_==null?void 0:_.id,i==null?void 0:i.getCells());return m.visualConfig=i==null?void 0:i.toJSON(),d()(d()({},_),{},{visualConfig:m.visualConfig,items:m.items})}},{key:"logicToGraphJson",value:function(i){var _=(0,p.S8)(i);return _}}]),c}()},79716:function(I,C,e){e.d(C,{O:function(){return _}});var E=e(25359),d=e.n(E),O=e(49811),g=e.n(O),h=e(70517),D=e(9364),p=e(12490),y=e(42651),c={buildGroup:function(r,t,a,o){var l=Number.parseInt(t/2),s=t%2==0;return{name:r,title:a,graphHeight:(s?l:l+1)*(o||70)+10}}},f=c;function i(n){return n.length>7?"".concat(n.substring(0,7),`\r
`).concat(n.substring(7)):n}function _(n){return m.apply(this,arguments)}function m(){return m=g()(d()().mark(function n(r){var t,a;return d()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return t=[],a="/api/ide/asset/v1/logic-item/readFromCode",r&&(a="/api/ide/papi/".concat(r,"/api/ide/asset/v1/logic-item/readFromCode")),l.abrupt("return",Promise.all([(0,D.K)(),h.Z.get(a)]).then(function(s){if(console.log("getPanelData"),s[1].status==200){var u=s[1].data.data;Object.keys(u).forEach(function(v,U){var P=f.buildGroup(v,u[v].length,v);t.push(P),u[v].sort(function(T,M){return T.order?T.order.localeCompare(M.order):1}).forEach(function(T){s[0].Nodes.push(new y.Z({shape:T.shape?T.shape:"ExtShape"+(U%3==0?"1":U%3==1?"2":"3"),ports:p.Tt,width:100,height:50,text:T.name,data:{config:T.logicItem},_groups:[T.group]}))})})}return{Nodes:s[0].Nodes,Groups:t}}));case 4:case"end":return l.stop()}},n)})),m.apply(this,arguments)}},32126:function(I,C,e){e.d(C,{S:function(){return i}});var E=e(25359),d=e.n(E),O=e(49811),g=e.n(O),h=e(21140),D=e.n(h),p=e(63466),y=e.n(p),c=e(31837),f=e(57475),i=function(){function _(){D()(this,_)}return y()(_,null,[{key:"getEnvJson",value:function(){var m=g()(d()().mark(function r(){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,f.U2)("/api/runtime/env").then(function(o){return o.data.data}).then(function(o){return c.j.setModel(o.UI_CONFIG_MODEL),c.j.setEnv(JSON.stringify(o)),c.j.setApiUrlPrefix(o.API_GATEWAY_PREFIX),c.j.setReryApi(o.CUSTOM_RETRY_URL),c.j.setReryApi(o.CUSTOM_RETRY_URL),o}));case 1:case"end":return a.stop()}},r)}));function n(){return m.apply(this,arguments)}return n}()},{key:"getRemoteRuntimeConfig",value:function(){var m=g()(d()().mark(function r(){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,f.v_)("/api/ide/remote-runtimes").then(function(o){return o.data}).then(function(o){return console.log("remote runtimes:",o.data),c.j.setRemoteRuntimes(JSON.stringify(o.data)),o}));case 1:case"end":return a.stop()}},r)}));function n(){return m.apply(this,arguments)}return n}()}]),_}()}}]);
