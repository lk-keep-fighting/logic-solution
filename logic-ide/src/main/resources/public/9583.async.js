"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[9583],{59583:function(U,v,E){E.r(v),E.d(v,{TaskRenderer:function(){return b},default:function(){return C}});var h=E(15767),y=E(87363),l=E.n(y),c=E(42977),k=E(85899),P=E.n(k),D=E(94391),C=function(A){(0,h.ZT)(o,A);function o(s){var a=A.call(this,s)||this;return a.state={items:s.items?s.items.concat():[]},a.handleLoaded=a.handleLoaded.bind(a),a.tick=a.tick.bind(a),a}return o.prototype.componentDidMount=function(){this.tick(!!this.props.checkApi)},o.prototype.componentDidUpdate=function(s){var a=this.props;s.items!==a.items?this.setState({items:a.items?a.items.concat():[]}):(0,c.rMT)(s.checkApi,a.checkApi,s.data,a.data)&&this.tick(!0)},o.prototype.componentWillUnmount=function(){clearTimeout(this.timer)},o.prototype.reload=function(){this.tick(!0)},o.prototype.tick=function(s){var a=this;s===void 0&&(s=!1);var u=this.props,d=u.loadingStatusCode,f=u.data,$=u.interval,g=u.checkApi,M=u.env,L=this.state.items;if(clearTimeout(this.timer),!(!s&&!L.some(function(S){return S.status===d}))){if($&&!(0,c.X1t)(g))return M.alert("checkApi \u6CA1\u6709\u8BBE\u7F6E, \u4E0D\u80FD\u53CA\u65F6\u83B7\u53D6\u4EFB\u52A1\u72B6\u6001");(0,c.X1t)(g,f)&&M&&M.fetcher(g,f).then(this.handleLoaded).catch(function(S){return a.setState({error:S})})}},o.prototype.handleLoaded=function(s){if(!Array.isArray(s.data))return this.props.env.alert("\u8FD4\u56DE\u683C\u5F0F\u4E0D\u6B63\u786E, \u671F\u671B response.data \u4E3A\u6570\u7EC4, \u5305\u542B\u6BCF\u4E2A task \u7684\u72B6\u6001\u4FE1\u606F");this.setState({items:s.data});var a=this.props.interval;clearTimeout(this.timer),this.timer=setTimeout(this.tick,a)},o.prototype.submitTask=function(s,a,u){var d=this;u===void 0&&(u=!1);var f=this.props,$=f.submitApi,g=f.reSubmitApi,M=f.loadingStatusCode,L=f.errorStatusCode,S=f.data,T=f.env;if(!u&&!(0,c.X1t)($))return T.alert("submitApi \u6CA1\u6709\u914D\u7F6E");if(u&&!(0,c.X1t)(g))return T.alert("reSubmitApi \u6CA1\u6709\u914D\u7F6E");this.setState(P()(this.state,{items:{$splice:[[a,1,(0,h.pi)((0,h.pi)({},s),{status:M})]]}}));var e=u?g:$;(0,c.X1t)(e,S)&&T&&T.fetcher(e,(0,c.nW9)(S,s)).then(function(t){if(t&&t.data){if(Array.isArray(t.data))d.handleLoaded(t);else{var n=e&&e.replaceData,i=d.state.items.map(function(r){return r.key===t.data.key?(0,h.pi)((0,h.pi)({},e.replaceData?{}:r),t.data):r});d.handleLoaded((0,h.pi)((0,h.pi)({},t),{data:i}))}return}clearTimeout(d.timer),d.timer=setTimeout(d.tick,4)}).catch(function(t){return d.setState(P()(d.state,{items:{$splice:[[a,1,(0,h.pi)((0,h.pi)({},s),{status:L,remark:t.message||t})]]}}))})},o.prototype.render=function(){var s=this,a=this.props,u=a.classnames,d=a.className,f=a.style,$=a.tableClassName,g=a.taskNameLabel,M=a.operationLabel,L=a.statusLabel,S=a.remarkLabel,T=a.btnText,e=a.retryBtnText,t=a.btnClassName,n=a.retryBtnClassName,i=a.statusLabelMap,r=a.statusTextMap,p=a.readyStatusCode,m=a.loadingStatusCode,B=a.canRetryStatusCode,N=a.translate,R=a.render,I=a.loadingConfig,K=this.state.items,W=this.state.error;return l().createElement("div",{className:u("Table-content",d),style:f},l().createElement("table",{className:u("Table-table",$)},l().createElement("thead",null,l().createElement("tr",null,l().createElement("th",null,g),l().createElement("th",null,N(M)),l().createElement("th",null,L),l().createElement("th",null,S))),l().createElement("tbody",null,W?l().createElement("tr",null,l().createElement("td",{colSpan:4},l().createElement("div",{className:"text-danger"},W))):K.map(function(_,w){return l().createElement("tr",{key:w},l().createElement("td",null,l().createElement("span",{className:u("word-break")},_.label)),l().createElement("td",null,_.status==m?l().createElement(D.$jN,{loadingConfig:I,show:!0,icon:"reload",spinnerClassName:u("Task-spinner")}):_.status==B?l().createElement("a",{onClick:function(){return s.submitTask(_,w,!0)},className:u("Button","Button--danger","Button--size-md",n||t)},e||T):l().createElement("a",{onClick:function(){return s.submitTask(_,w)},className:u("Button","Button--default","Button--size-md",t,{disabled:_.status!==p})},T)),l().createElement("td",null,l().createElement("span",{className:u("label",i&&i[_.status||0])},r&&r[_.status||0])),l().createElement("td",null,_.remark?R("".concat(w,"/remark"),_.remark):null))}))))},o.defaultProps={className:"",tableClassName:"",taskNameLabel:"\u4EFB\u52A1\u540D\u79F0",operationLabel:"Table.operation",statusLabel:"\u72B6\u6001",remarkLabel:"\u5907\u6CE8\u8BF4\u660E",btnText:"\u4E0A\u7EBF",retryBtnText:"\u91CD\u8BD5",btnClassName:"",retryBtnClassName:"",statusLabelMap:["label-warning","label-info","label-info","label-danger","label-success","label-danger"],statusTextMap:["\u672A\u5F00\u59CB","\u5C31\u7EEA","\u8FDB\u884C\u4E2D","\u51FA\u9519","\u5DF2\u5B8C\u6210","\u51FA\u9519"],initialStatusCode:0,readyStatusCode:1,loadingStatusCode:2,errorStatusCode:3,finishStatusCode:4,canRetryStatusCode:5,interval:3e3},o}(l().Component),b=function(A){(0,h.ZT)(o,A);function o(s,a){var u=A.call(this,s)||this,d=a;return d.registerComponent(u),u}return o.prototype.componentWillUnmount=function(){A.prototype.componentWillUnmount.call(this);var s=this.context;s.unRegisterComponent(this)},o.contextType=c.ZHe,o=(0,h.gn)([(0,c.Thl)({type:"tasks"}),(0,h.w6)("design:paramtypes",[Object,Object])],o),o}(C)},85899:function(U,v,E){var h=E(14224);Object.defineProperty(v,"__esModule",{value:!0});function y(e){return typeof e=="object"&&!("toString"in e)?Object.prototype.toString.call(e).slice(8,-1):e}var l=typeof h=="object"&&!0;function c(e,t){if(!e)throw l?new Error("Invariant failed"):new Error(t())}v.invariant=c;var k=Object.prototype.hasOwnProperty,P=Array.prototype.splice,D=Object.prototype.toString;function C(e){return D.call(e).slice(8,-1)}var b=Object.assign||function(e,t){return A(t).forEach(function(n){k.call(t,n)&&(e[n]=t[n])}),e},A=typeof Object.getOwnPropertySymbols=="function"?function(e){return Object.keys(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.keys(e)};function o(e){return Array.isArray(e)?b(e.constructor(e.length),e):C(e)==="Map"?new Map(e):C(e)==="Set"?new Set(e):e&&typeof e=="object"?b(Object.create(Object.getPrototypeOf(e)),e):e}var s=function(){function e(){this.commands=b({},a),this.update=this.update.bind(this),this.update.extend=this.extend=this.extend.bind(this),this.update.isEquals=function(t,n){return t===n},this.update.newContext=function(){return new e().update}}return Object.defineProperty(e.prototype,"isEquals",{get:function(){return this.update.isEquals},set:function(t){this.update.isEquals=t},enumerable:!0,configurable:!0}),e.prototype.extend=function(t,n){this.commands[t]=n},e.prototype.update=function(t,n){var i=this,r=typeof n=="function"?{$apply:n}:n;Array.isArray(t)&&Array.isArray(r)||c(!Array.isArray(r),function(){return"update(): You provided an invalid spec to update(). The spec may not contain an array except as the value of $set, $push, $unshift, $splice or any custom command allowing an array value."}),c(typeof r=="object"&&r!==null,function(){return"update(): You provided an invalid spec to update(). The spec and every included key path must be plain objects containing one of the "+("following commands: "+Object.keys(i.commands).join(", ")+".")});var p=t;return A(r).forEach(function(m){if(k.call(i.commands,m)){var B=t===p;p=i.commands[m](r[m],p,r,t),B&&i.isEquals(p,t)&&(p=t)}else{var N=C(t)==="Map"?i.update(t.get(m),r[m]):i.update(t[m],r[m]),R=C(p)==="Map"?p.get(m):p[m];(!i.isEquals(N,R)||typeof N=="undefined"&&!k.call(t,m))&&(p===t&&(p=o(t)),C(p)==="Map"?p.set(m,N):p[m]=N)}}),p},e}();v.Context=s;var a={$push:function(e,t,n){return d(t,n,"$push"),e.length?t.concat(e):t},$unshift:function(e,t,n){return d(t,n,"$unshift"),e.length?e.concat(t):t},$splice:function(e,t,n,i){return $(t,n),e.forEach(function(r){g(r),t===i&&r.length&&(t=o(i)),P.apply(t,r)}),t},$set:function(e,t,n){return L(n),e},$toggle:function(e,t){f(e,"$toggle");var n=e.length?o(t):t;return e.forEach(function(i){n[i]=!t[i]}),n},$unset:function(e,t,n,i){return f(e,"$unset"),e.forEach(function(r){Object.hasOwnProperty.call(t,r)&&(t===i&&(t=o(i)),delete t[r])}),t},$add:function(e,t,n,i){return T(t,"$add"),f(e,"$add"),C(t)==="Map"?e.forEach(function(r){var p=r[0],m=r[1];t===i&&t.get(p)!==m&&(t=o(i)),t.set(p,m)}):e.forEach(function(r){t===i&&!t.has(r)&&(t=o(i)),t.add(r)}),t},$remove:function(e,t,n,i){return T(t,"$remove"),f(e,"$remove"),e.forEach(function(r){t===i&&t.has(r)&&(t=o(i)),t.delete(r)}),t},$merge:function(e,t,n,i){return S(t,e),A(e).forEach(function(r){e[r]!==t[r]&&(t===i&&(t=o(i)),t[r]=e[r])}),t},$apply:function(e,t){return M(e),e(t)}},u=new s;v.isEquals=u.update.isEquals,v.extend=u.extend,v.default=u.update,v.default.default=U.exports=b(v.default,v);function d(e,t,n){c(Array.isArray(e),function(){return"update(): expected target of "+y(n)+" to be an array; got "+y(e)+"."}),f(t[n],n)}function f(e,t){c(Array.isArray(e),function(){return"update(): expected spec of "+y(t)+" to be an array; got "+y(e)+". Did you forget to wrap your parameter in an array?"})}function $(e,t){c(Array.isArray(e),function(){return"Expected $splice target to be an array; got "+y(e)}),g(t.$splice)}function g(e){c(Array.isArray(e),function(){return"update(): expected spec of $splice to be an array of arrays; got "+y(e)+". Did you forget to wrap your parameters in an array?"})}function M(e){c(typeof e=="function",function(){return"update(): expected spec of $apply to be a function; got "+y(e)+"."})}function L(e){c(Object.keys(e).length===1,function(){return"Cannot have more than one key in an object with $set"})}function S(e,t){c(t&&typeof t=="object",function(){return"update(): $merge expects a spec of type 'object'; got "+y(t)}),c(e&&typeof e=="object",function(){return"update(): $merge expects a target of type 'object'; got "+y(e)})}function T(e,t){var n=C(e);c(n==="Map"||n==="Set",function(){return"update(): "+y(t)+" expects a target of type Set or Map; got "+y(n)})}}}]);
