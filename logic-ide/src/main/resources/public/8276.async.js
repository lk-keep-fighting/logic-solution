"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[8276],{98276:function(k,_,L){L.r(_),L.d(_,{Log:function(){return x},LogRenderer:function(){return M}});var y=L(15767),H=L(87363),s=L.n(H),g=L(42977),C=L(94391),T={30:"black",31:"red",32:"green",33:"yellow",34:"blue",35:"magenta",36:"cyan",37:"white",90:"grey"},w={40:"black",41:"red",42:"green",43:"yellow",44:"blue",45:"magenta",46:"cyan",47:"white"},x=function(R){(0,y.ZT)(a,R);function a(t){var e=R.call(this,t)||this;return e.isDone=!1,e.autoScroll=!1,e.state={lastLine:"",logs:[],originLastLine:"",originLogs:[],refresh:!0,showLineNumber:!1,filterWord:""},e.refresh=function(r){var n=e.state.refresh;e.setState({refresh:!n}),n||(e.clear(r),e.loadLogs()),r.preventDefault()},e.clear=function(r){e.setState({logs:e.logs=[],lastLine:e.lastLine="",originLogs:[],originLastLine:""}),r==null||r.preventDefault()},e.filterWord=function(r,n,i){var o=r,p=n;i!==""&&i!==void 0&&i!==null&&i.length>0&&(r=r.filter(function(E){return E.includes(i)}),n.includes(i)||(n="")),e.setState({filterWord:i,lastLine:e.lastLine=n,logs:e.logs=r,originLogs:o,originLastLine:p})},e.addLines=function(r){r=r.concat();var n=e.props.maxLength,i=e.lastLine||"",o=(e.logs||[]).concat();r.length===1?(i+=r[0],e.setState({lastLine:e.lastLine=i})):(r[0]=i+(r[0]||""),i=r.pop()||"",n&&o.length+r.length>n&&o.splice(0,o.length+r.length-n),o=o.concat(r),e.filterWord(o,i,e.state.filterWord))},e.logRef=s().createRef(),e.autoScroll=t.autoScroll||!1,e.pauseOrResumeScrolling=e.pauseOrResumeScrolling.bind(e),e}return a.prototype.componentWillUnmount=function(){this.logRef&&this.logRef.current&&this.logRef.current.removeEventListener("scroll",this.pauseOrResumeScrolling)},a.prototype.componentDidMount=function(){if(this.autoScroll&&this.logRef&&this.logRef.current&&this.logRef.current.addEventListener("scroll",this.pauseOrResumeScrolling),this.props.source){var t=typeof this.props.source=="string"?(0,g.OgC)(this.props.source,this.props.data,"| raw"):this.props.source;t&&(0,g.X1t)(t)?this.loadLogs():(typeof t=="string"||Array.isArray(t)&&t.every(function(e){return typeof e=="string"}))&&(this.clear(),this.addLines(Array.isArray(t)?t:[t]))}},a.prototype.componentDidUpdate=function(t){if(this.autoScroll&&this.logRef&&this.logRef.current&&(this.logRef.current.scrollTop=this.logRef.current.scrollHeight),!!this.props.source){var e=typeof this.props.source=="string"?(0,g.OgC)(this.props.source,this.props.data,"| raw"):this.props.source;if(e&&(0,g.X1t)(e))(0,g.rMT)(t.source,this.props.source,t.data,this.props.data)&&this.loadLogs();else if(typeof e=="string"||Array.isArray(e)&&e.every(function(n){return typeof n=="string"})){var r=(0,g.OgC)(t.source,t.data,"| raw");r!==e&&e&&(this.clear(),this.addLines(Array.isArray(e)?e:[e]))}}},a.prototype.pauseOrResumeScrolling=function(){if(this.logRef&&this.logRef.current){var t=this.logRef.current,e=t.scrollHeight,r=t.scrollTop,n=t.offsetHeight;this.autoScroll=e-(r+n)<50}},a.prototype.loadLogs=function(){var t,e,r;return(0,y.mG)(this,void 0,void 0,function(){var n,i,o,p,E,W,A,u,c,l,O,f,S,d,D,b,h,m,N=this;return(0,y.Jh)(this,function(v){switch(v.label){case 0:return n=this.props,i=n.source,o=n.data,p=n.env,E=n.translate,W=n.encoding,A=n.maxLength,u=n.credentials,c=u===void 0?"include":u,l=(0,g.xkX)(i,o),l.url?[4,fetch(l.url,{method:((t=l.method)===null||t===void 0?void 0:t.toLocaleUpperCase())||"GET",headers:l.headers||void 0,body:l.data?JSON.stringify(l.data):void 0,credentials:c})]:[2];case 1:if(O=v.sent(),O.status!==200)return[3,8];if(f=O.body,!f)return[2];S=f.getReader(),v.label=2;case 2:return this.state.refresh?[3,4]:[4,S.cancel("click cancel button").then(function(){N.props.env.notify("success","\u65E5\u5FD7\u5DF2\u7ECF\u505C\u6B62\u5237\u65B0")})];case 3:v.sent(),v.label=4;case 4:return[4,S.read()];case 5:if(d=v.sent(),D=d.done,b=d.value,b&&(h=new TextDecoder(W).decode(b,{stream:!0}),m=h.split(`
`),this.addLines(m)),D)return this.isDone=!0,[2];v.label=6;case 6:return[3,2];case 7:return[3,9];case 8:!l.silent&&p.notify("error",(r=(e=l==null?void 0:l.messages)===null||e===void 0?void 0:e.failed)!==null&&r!==void 0?r:E("fetchFailed")),v.label=9;case 9:return[2]}})})},a.prototype.ansiColrToHtml=function(t){var e=this.props.disableColor;if(e===!0)return t;var r=t.match(/\u001b\[([^m]+)m/);if(r){var n=r[1];if(n){if(t=t.replace(/\u001b[^m]*?m/g,""),n in T)return s().createElement("span",{style:{color:T[n]}},t);if(n in w)return s().createElement("span",{style:{backgroundColor:w[n]}},t.replace(/\u001b[^m]*?m/g,""))}}return t},a.prototype.renderHighlightWord=function(t){var e=this,r=this.props.classnames,n=this.state.filterWord;if(n==="")return this.ansiColrToHtml(t);var i=t.split(n);return i.map(function(o,p){return p<i.length-1?s().createElement("span",null,e.ansiColrToHtml(o),s().createElement("span",{className:r("Log-line-highlight")},n)):o})},a.prototype.renderLine=function(t,e,r){var n=this.props,i=n.classnames,o=n.disableColor;return s().createElement("div",{className:i("Log-line"),key:t},r&&s().createElement("span",{className:i("Log-line-number")},t+1," "),this.renderHighlightWord(e))},a.prototype.render=function(){var t=this,e=this.props,r=e.source,n=e.className,i=e.style,o=e.classnames,p=e.placeholder,E=e.height,W=e.rowHeight,A=e.disableColor,u=e.translate,c=e.operation,l=this.state,O=l.refresh,f=l.showLineNumber,S=u(p);r||(S=u("Log.mustHaveSource"));var d,D=this.state.lastLine?this.state.logs.concat([this.state.lastLine]):this.state.logs,b=W;return b?d=s().createElement(C.CPJ,{height:E,itemCount:D.length,itemSize:W,renderItem:function(h){var m=h.index,N=h.style;return s().createElement("div",{className:o("Log-line"),key:m,style:(0,y.pi)((0,y.pi)({},N),{whiteSpace:"nowrap"})},f&&s().createElement("span",{className:o("Log-line-number")},m+1," "),t.renderHighlightWord(D[m]))}}):d=D.map(function(h,m){return t.renderLine(m,h,f)}),s().createElement("div",{className:o("Log",n),style:i},s().createElement("div",{className:o("Log-operation")},c&&(c==null?void 0:c.length)>0&&s().createElement(s().Fragment,null,c.includes("stop")&&s().createElement("a",{title:u("stop"),className:O?"":"is-disabled",onClick:this.refresh},s().createElement(C.JO$,{icon:"pause"})),c.includes("restart")&&s().createElement("a",{title:u("reload"),className:O?"is-disabled":"",onClick:this.refresh},s().createElement(C.JO$,{icon:"refresh"})),c.includes("showLineNumber")&&s().createElement("a",{title:u(f?"Log.notShowLineNumber":"Log.showLineNumber"),onClick:function(h){t.setState({showLineNumber:!f}),h.preventDefault()}},s().createElement(C.JO$,{icon:f?"invisible":"view"})),c.includes("clear")&&s().createElement("a",{onClick:this.clear,title:u("clear")},s().createElement(C.JO$,{icon:"remove"})),c&&c.includes("filter")&&s().createElement(C.Rj2,{className:o("Log-filter-box"),placeholder:"\u8FC7\u6EE4\u8BCD",onChange:function(h){return t.filterWord(t.state.originLogs,t.state.lastLine,h)},value:this.state.filterWord}))),s().createElement("div",{ref:this.logRef,className:o("Log-body"),style:{height:b?"auto":E}},b||d.length?d:S))},a.defaultProps={height:500,autoScroll:!0,placeholder:"loading",encoding:"utf-8"},a}(s().Component),M=function(R){(0,y.ZT)(a,R);function a(){return R!==null&&R.apply(this,arguments)||this}return a=(0,y.gn)([(0,g.Thl)({type:"log"})],a),a}(x)}}]);
