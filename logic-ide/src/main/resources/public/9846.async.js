"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[9846],{69846:function(K,B,y){y.r(B),y.d(B,{DrawerRenderer:function(){return W},default:function(){return k}});var s=y(15767),I=y(87363),C=y.n(I),f=y(42977),P=y(94391),_=y(23293),F=y(61533),j=y.n(F),R=y(6663),k=function(A){(0,s.ZT)(i,A);function i(r){var e=A.call(this,r)||this;e.$$id=(0,f.M8z)(),r.store.setEntered(!!r.show),e.handleSelfClose=e.handleSelfClose.bind(e),e.handleAction=e.handleAction.bind(e),e.handleActionSensor=e.handleActionSensor.bind(e),e.handleDrawerConfirm=e.handleDrawerConfirm.bind(e),e.handleDrawerClose=e.handleDrawerClose.bind(e),e.handleDialogConfirm=e.handleDialogConfirm.bind(e),e.handleDialogClose=e.handleDialogClose.bind(e),e.handleChildFinished=e.handleChildFinished.bind(e),e.handleEntered=e.handleEntered.bind(e),e.handleExited=e.handleExited.bind(e),e.handleFormInit=e.handleFormInit.bind(e),e.handleFormChange=e.handleFormChange.bind(e),e.handleFormSaved=e.handleFormSaved.bind(e);var t=r.store;return e.reaction=(0,_.U5)(function(){return"".concat(t.loading).concat(t.error)},function(){return e.forceUpdate()}),e}return i.prototype.componentWillUnmount=function(){this.reaction&&this.reaction(),clearTimeout(this.clearErrorTimer)},i.prototype.buildActions=function(){var r=this.props,e=r.actions,t=r.confirm,o=r.translate,n=r.testIdBuilder;if(typeof e!="undefined")return e;var a=[];return a.push({type:"button",testIdBuilder:n==null?void 0:n.getChild("cancel"),actionType:"close",label:o("cancel")}),t&&a.push({type:"button",actionType:"confirm",testIdBuilder:n==null?void 0:n.getChild("confirm"),label:o("confirm"),primary:!0}),a},i.prototype.handleSelfClose=function(){return(0,s.mG)(this,void 0,void 0,function(){var r,e,t,o,n;return(0,s.Jh)(this,function(a){switch(a.label){case 0:return r=this.props,e=r.onClose,t=r.store,o=r.dispatchEvent,t.dialogOpen!==!1||t.drawerOpen!==!1?[2]:[4,o("cancel",this.props.data)];case 1:return n=a.sent(),n!=null&&n.prevented?[2]:n!=null&&n.pendingPromise.length?[4,n.allDone()]:[3,3];case 2:a.sent(),a.label=3;case 3:return t.updateMessage(),e(),[2]}})})},i.prototype.handleActionSensor=function(r){var e=this.props.store,t=e.busying;e.markBusying(!0),e.updateMessage(),r.then(function(){e.markBusying(t)}).catch(function(o){e.updateMessage(o.message,!0),e.markBusying(t)})},i.prototype.handleAction=function(r,e,t){var o=this.props,n=o.onClose,a=o.onAction;e.actionType==="close"||e.actionType==="cancel"?n():a&&a(r,e,t)},i.prototype.handleDrawerConfirm=function(r,e){for(var t=[],o=2;o<arguments.length;o++)t[o-2]=arguments[o];var n=this.props.store;e.mergeData&&r.length===1&&r[0]&&n.updateData(r[0]);var a=n.action,l=a.drawer;l.onConfirm&&l.onConfirm.apply(l,(0,s.ev)([r,e],(0,s.CR)(t),!1))===!1||n.closeDrawer(!0,r)},i.prototype.handleDrawerClose=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=this.props.store,o=t.action,n=o.drawer;n.onClose&&n.onClose.apply(n,(0,s.ev)([],(0,s.CR)(r),!1))===!1||t.closeDrawer.apply(t,(0,s.ev)([],(0,s.CR)(r),!1))},i.prototype.handleDialogConfirm=function(r,e){for(var t=[],o=2;o<arguments.length;o++)t[o-2]=arguments[o];var n=this.props.store;e.mergeData&&r.length===1&&r[0]&&n.updateData(r[0]);var a=n.action,l=a.dialog;l.onConfirm&&l.onConfirm.apply(l,(0,s.ev)([r,e],(0,s.CR)(t),!1))===!1||n.closeDialog(!0,r)},i.prototype.handleDialogClose=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=this.props.store,o=t.action,n=o.dialog;n.onClose&&n.onClose.apply(n,(0,s.ev)([],(0,s.CR)(r),!1))===!1||t.closeDialog(r[1])},i.prototype.handleChildFinished=function(r,e){},i.prototype.handleFormInit=function(r){var e=this.props.store;e.setFormData(r)},i.prototype.handleFormChange=function(r,e){var t=this.props.store;if(typeof e=="string"){t.changeValue(e,r);return}t.setFormData(r)},i.prototype.handleFormSaved=function(r,e){var t=this.props.store;t.setFormData((0,s.pi)((0,s.pi)({},r),e))},i.prototype.handleEntered=function(){var r=this.props,e=r.lazySchema,t=r.store;t.setEntered(!0),t.markBusying(!1),typeof e=="function"&&t.setSchema(e(this.props))},i.prototype.handleExited=function(){var r=this.props,e=r.lazySchema,t=r.store,o=r.statusStore;o&&(0,R.fh)(o)&&o.resetAll(),(0,R.fh)(t)&&(t.reset(),t.clearMessage(),t.markBusying(!1),t.setEntered(!1),typeof e=="function"&&t.setSchema(""))},i.prototype.getPopOverContainer=function(){return(0,F.findDOMNode)(this).querySelector(".".concat(this.props.classPrefix,"Drawer-content"))},i.prototype.renderBody=function(r,e){var t=this,o=this.props,n=o.render,a=o.store;if(Array.isArray(r))return r.map(function(h,d){return t.renderBody(h,d)});var l=r,p={key:e,disabled:a.loading,onAction:this.handleAction,onFinished:this.handleChildFinished,popOverContainer:this.getPopOverContainer,onChange:this.handleFormChange,onInit:this.handleFormInit,onSaved:this.handleFormSaved,onActionSensor:this.handleActionSensor,btnDisabled:a.loading,syncLocation:!1};return l.type==="form"&&(l=(0,s.pi)({mode:"horizontal",wrapWithPanel:!1,submitText:null},l)),n("body".concat(e?"/".concat(e):""),l,p)},i.prototype.renderFooter=function(){var r=this,e=this.buildActions(),t=this.props.hideActions;if(!e||!e.length||t)return null;var o=this.props,n=o.store,a=o.render,l=o.env,p=o.classnames,h=o.showErrorMsg,d=o.footerClassName,c=o.id,m=o.themeCss;return C().createElement("div",{className:p("Drawer-footer",d,(0,f.GwQ)((0,s.pi)((0,s.pi)({},this.props),{name:"drawerFooterClassName",id:c,themeCss:m})))},n.loading||n.error?C().createElement("div",{className:p("Drawer-info")},C().createElement(P.$jN,{size:"sm",key:"info",show:n.loading}),!l.forceSilenceInsideError&&h&&n.error?C().createElement("span",{className:p("Drawer-error")},n.msg):null):null,e.map(function(u,O){return a("action/".concat(O),u,{onAction:r.handleAction,onActionSensor:void 0,btnDisabled:n.loading,data:n.formData,key:O,disabled:u.disabled||n.loading})}))},i.prototype.openFeedback=function(r,e){var t=this;return new Promise(function(o){var n=t.props.store;n.setCurrentAction({type:"button",actionType:"dialog",dialog:r},t.props.resolveDefinitions),n.openDialog(e,void 0,function(a){o(a)},t.context)})},i.prototype.render=function(){var r=this.props.store,e=(0,s.pi)((0,s.pi)({},this.props),r.schema),t=e.className,o=e.style,n=e.size,a=e.closeOnEsc,l=e.position,p=e.title,h=e.render,d=e.header,c=e.body,m=e.bodyClassName,u=e.headerClassName,O=e.show,D=e.showCloseButton,E=e.width,S=e.height,g=e.wrapperComponent,v=e.env,w=e.resizable,T=e.overlay,b=e.closeOnOutside,U=e.classPrefix,x=e.classnames,z=e.drawerContainer,G=e.loadingConfig,H=e.popOverContainer,N=e.themeCss,M=e.id,L=(0,s._T)(e,["className","style","size","closeOnEsc","position","title","render","header","body","bodyClassName","headerClassName","show","showCloseButton","width","height","wrapperComponent","env","resizable","overlay","closeOnOutside","classPrefix","classnames","drawerContainer","loadingConfig","popOverContainer","themeCss","id"]),$=g||P.dys;return C().createElement($,(0,s.pi)({},L,{resizable:w,classPrefix:U,className:t,style:o,drawerClassName:(0,f.GwQ)((0,s.pi)((0,s.pi)({},this.props),{name:"drawerClassName",id:M,themeCss:N})),drawerMaskClassName:(0,f.GwQ)((0,s.pi)((0,s.pi)({},this.props),{name:"drawerMaskClassName",id:M,themeCss:N})),size:n,onHide:this.handleSelfClose,disabled:r.loading,show:O,showCloseButton:D,width:E,height:S,position:l,overlay:T,onEntered:this.handleEntered,onExited:this.handleExited,closeOnEsc:a,closeOnOutside:!r.drawerOpen&&!r.dialogOpen&&b,container:z||(v==null?void 0:v.getModalContainer)}),p||d?C().createElement("div",{className:x("Drawer-header",u,(0,f.GwQ)((0,s.pi)((0,s.pi)({},this.props),{name:"drawerHeaderClassName",id:M,themeCss:N})))},p?C().createElement("div",{className:x("Drawer-title",(0,f.GwQ)((0,s.pi)((0,s.pi)({},this.props),{name:"drawerTitleClassName",id:M,themeCss:N})))},h("title",p,{data:r.formData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,onAction:this.handleAction,onActionSensor:void 0,btnDisabled:r.loading})):null,d?h("header",d,{data:r.formData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,onAction:this.handleAction,onActionSensor:void 0,btnDisabled:r.loading}):null):null,r.entered?c?C().createElement("div",{className:x("Drawer-body",m,(0,f.GwQ)((0,s.pi)((0,s.pi)({},this.props),{name:"drawerBodyClassName",id:M,themeCss:N}))),role:"dialog-body"},this.renderBody(c,"body"),C().createElement(f.cWM,(0,s.pi)({},this.props,{config:{themeCss:N,classNames:[{key:"drawerClassName"},{key:"drawerMaskClassName"},{key:"drawerHeaderClassName"},{key:"drawerTitleClassName"},{key:"drawerBodyClassName"},{key:"drawerFooterClassName"}],id:M},env:v}))):null:C().createElement("div",{className:x("Drawer-body",m,(0,f.GwQ)((0,s.pi)((0,s.pi)({},this.props),{name:"drawerBodyClassName",id:M,themeCss:N})))},C().createElement(P.$jN,{overlay:!0,show:!0,size:"lg",loadingConfig:G})),this.renderFooter(),c?h("dialog",(0,s.pi)((0,s.pi)({},r.action&&r.action.dialog),{type:"dialog"}),{key:"dialog",data:r.dialogData,onConfirm:this.handleDialogConfirm,onClose:this.handleDialogClose,onAction:this.handleAction,show:r.dialogOpen}):null,c?h("drawer",(0,s.pi)((0,s.pi)({},r.action&&r.action.drawer),{type:"drawer"}),{key:"drawer",data:r.drawerData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,onAction:this.handleAction,show:r.drawerOpen}):null)},i.propsList=["title","size","closeOnEsc","closeOnOutside","children","className","bodyClassName","headerClassName","footerClassName","confirm","position","onClose","onConfirm","show","showCloseButton","width","height","resizable","overlay","body","popOverContainer","showErrorMsg"],i.defaultProps={title:"",className:"",bodyClassName:"",headerClassName:"",footerClassName:"",confirm:!0,position:"right",resizable:!1,showCloseButton:!0,overlay:!0,closeOnEsc:!1,closeOnOutside:!1,showErrorMsg:!0},(0,s.gn)([f.NjZ,(0,s.w6)("design:type",Function),(0,s.w6)("design:paramtypes",[]),(0,s.w6)("design:returntype",void 0)],i.prototype,"getPopOverContainer",null),i}(C().Component),W=function(A){(0,s.ZT)(i,A);function i(r,e){var t=A.call(this,r)||this,o=e;return o.registerComponent(t),t}return i.prototype.componentWillUnmount=function(){var r=this.context;r.unRegisterComponent(this),A.prototype.componentWillUnmount.call(this)},i.prototype.tryChildrenToHandle=function(r,e,t){var o=this,n=this.context,a=[],l=this.props,p=l.onConfirm,h=l.store;if(r.target&&a.push.apply(a,(0,s.ev)([],(0,s.CR)(r.target.split(",").map(function(u){return n.getComponentByName(u)}).filter(function(u){return u&&u.doAction})),!1)),(r==null?void 0:r.isolateScope)!==!0&&!a.length)for(var d=n.getComponents().filter(function(u){return!~["drawer","dialog"].indexOf(u.props.type)}),c=d.concat();c.length;){var m=c.pop();if(~["crud","form","wizard"].indexOf(m.props.type)){a.push(m);break}else{if(~["drawer","dialog"].indexOf(m.props.type))continue;~["page","service"].indexOf(m.props.type)&&c.unshift.apply(c,m.context.getComponents())}}return a.length?(h.markBusying(!0),h.updateMessage(),Promise.all(a.map(function(u){return u.doAction((0,s.pi)((0,s.pi)({},r),{from:o.$$id}),e,!0)})).then(function(u){(r.type==="submit"||r.actionType==="submit"||r.actionType==="confirm")&&r.close!==!1?p&&p(u,t||r,e,a):r.close&&(r.close===!0?o.handleSelfClose():o.closeTarget(r.close)),h.markBusying(!1)}).catch(function(u){h.updateMessage(u.message,!0),h.markBusying(!1),clearTimeout(o.clearErrorTimer),o.clearErrorTimer=setTimeout(function(){h.updateMessage("")},3e3)}),!0):!1},i.prototype.doAction=function(r,e,t){this.handleAction(void 0,r,e)},i.prototype.handleAction=function(r,e,t,o,n,a){return o===void 0&&(o=!1),(0,s.mG)(this,void 0,void 0,function(){var l,p,h,d,c,m,u,O,D,E,S=this;return(0,s.Jh)(this,function(g){switch(g.label){case 0:return l=this.props,p=l.onClose,h=l.onAction,d=l.store,c=l.env,m=l.dispatchEvent,u=l.show,e.from===this.$$id||!u?[2,h?h(r,e,t,o,n||this.context):!1]:a!=null&&a.pendingPromise.length?[4,a.allDone()]:[3,2];case 1:g.sent(),g.label=2;case 2:return O=this.context,e.actionType==="close"||e.actionType==="cancel"?[4,m("cancel",(0,f.nW9)(this.props.data,t))]:[3,6];case 3:return D=g.sent(),D!=null&&D.prevented?[2]:D!=null&&D.pendingPromise.length?[4,D.allDone()]:[3,5];case 4:g.sent(),g.label=5;case 5:return d.setCurrentAction(e,this.props.resolveDefinitions),p(),e.close&&(e.close===!0?this.handleSelfClose():this.closeTarget(e.close)),[3,17];case 6:return e.actionType!=="confirm"?[3,10]:[4,m("confirm",(0,f.nW9)(this.props.data,t))];case 7:return E=g.sent(),E!=null&&E.prevented?[2]:E!=null&&E.pendingPromise.length?[4,E.allDone()]:[3,9];case 8:g.sent(),g.label=9;case 9:return d.setCurrentAction(e,this.props.resolveDefinitions),this.tryChildrenToHandle(e,t)||p(),[3,17];case 10:return e.actionType!=="drawer"?[3,11]:(d.setCurrentAction(e,this.props.resolveDefinitions),[2,new Promise(function(v){d.openDrawer(t,void 0,function(w,T){var b;(b=e.callback)===null||b===void 0||b.call(e,w,T),v({confirmed:w,value:T})})})]);case 11:return e.actionType!=="dialog"?[3,12]:(d.setCurrentAction(e,this.props.resolveDefinitions),[2,new Promise(function(v){d.openDialog(t,void 0,function(w,T){var b;(b=e.callback)===null||b===void 0||b.call(e,w,T),v({confirmed:w,value:T})},n||S.context)})]);case 12:return e.actionType!=="reload"?[3,13]:(d.setCurrentAction(e,this.props.resolveDefinitions),e.target&&O.reload(e.target,t),e.close&&(e.close===!0?this.handleSelfClose():this.closeTarget(e.close)),[3,17]);case 13:return!e.from&&this.tryChildrenToHandle(e,t)?[3,17]:[3,14];case 14:return e.actionType!=="ajax"?[3,15]:(d.setCurrentAction(e,this.props.resolveDefinitions),d.saveRemote(e.api,t,{successMessage:e.messages&&e.messages.success,errorMessage:e.messages&&e.messages.failed}).then(function(){return(0,s.mG)(S,void 0,void 0,function(){var v;return(0,s.Jh)(this,function(w){switch(w.label){case 0:return e.feedback&&(0,f.pn4)(e.feedback,d.data)?[4,this.openFeedback(e.feedback,d.data)]:[3,2];case 1:w.sent(),w.label=2;case 2:return v=e.redirect&&(0,f.hXT)(e.redirect,d.data),v&&c.jumpTo(v,e,d.data),e.reload&&this.reloadTarget((0,f.u22)(e.reload,d.data),d.data),e.close&&(e.close===!0?this.handleSelfClose():this.closeTarget(e.close)),[2]}})})}).catch(function(v){if(o||e.countDown)throw v}),[3,17]);case 15:return h?[4,h(r,e,t,o,n||this.context)]:[3,17];case 16:g.sent(),e.close&&(e.close===!0?this.handleSelfClose():this.closeTarget(e.close)),g.label=17;case 17:return[2]}})})},i.prototype.handleChildFinished=function(r,e){if(!(e&&e.from===this.$$id||e.close===!1)){var t=this.context,o=t.getComponents().filter(function(a){return!~["drawer","dialog","action","button","submit","reset"].indexOf(a.props.type)}),n=this.props.onConfirm;o.length===1&&(o[0].props.type==="form"||o[0].props.type==="wizard")&&n([r],e,{},o)}},i.prototype.handleDialogConfirm=function(r,e){for(var t,o,n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];A.prototype.handleDialogConfirm.apply(this,(0,s.ev)([r,e],(0,s.CR)(n),!1));var l=this.props.store,p=l.getDialogScoped()||this.context,h=l.action,d=(t=e.reload)!==null&&t!==void 0?t:h.reload;d?p.reload(d,l.data):p.component!==this&&(!((o=p.component)===null||o===void 0)&&o.reload)?p.component.reload():this.context.getComponents().filter(function(c){return c.props.type==="crud"}).forEach(function(c){return c.reload&&c.reload()})},i.prototype.handleDrawerConfirm=function(r,e){for(var t=this,o,n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];A.prototype.handleDrawerConfirm.call(this,r,e);var l=this.props.store,p=l.getDialogScoped()||this.context,h=l.action,d=(o=e.reload)!==null&&o!==void 0?o:h.reload;setTimeout(function(){var c;d?p.reload(d,l.data):p.component!==t&&(!((c=p.component)===null||c===void 0)&&c.reload)?p.component.reload():t.context.getComponents().filter(function(m){return m.props.type==="crud"}).forEach(function(m){return m.reload&&m.reload()})},300)},i.prototype.reloadTarget=function(r,e){var t=this.context;t.reload(r,e)},i.prototype.closeTarget=function(r){var e=this.context;e.close(r)},i.prototype.setData=function(r,e){return this.props.store.updateData(r,void 0,e)},i.prototype.getData=function(){var r=this.props.store;return r.data},i.contextType=f.ZHe,i=(0,s.gn)([(0,f.Thl)({type:"drawer",storeType:f.vqG.name,storeExtendsData:!1,isolateScope:!0,shouldSyncSuperStore:function(r,e,t){return!!((r.drawerOpen||e.show)&&(e.show!==t.show||(0,f.RjM)(t.data,e.data)))}}),(0,s.w6)("design:paramtypes",[Object,Object])],i),i}(k)}}]);
