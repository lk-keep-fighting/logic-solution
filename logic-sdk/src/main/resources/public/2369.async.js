"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[2369],{91656:function(le,B,e){e.d(B,{O:function(){return ce},A:function(){return M.Z}});var M=e(60463),f=e(54306),v=e.n(f),x=e(68673),y=e(86961),T=e(89769),O=e(9722),K=e(17696),S=e(19227),W=e(75476),b=e(1167),P=e(22150),C=e(11250),L=e(69624),I=e(4632),E=e(25232),j=e(81021),N=e(82447),a=e(87363),R=e.n(a),D=e(11275),r=e(92873),l=e(64266),h=e(30685),t=e(6706),c=e(88593),d=e(48204),n=e(33130),G=R().createContext({logic:new t.Iz("")}),de=function(g){var A,ge=(0,a.useState)(),Y=v()(ge,2),o=Y[0],fe=Y[1],ve=(0,a.useState)(),H=v()(ve,2),_=H[0],me=H[1],he=(0,a.useState)(!1),V=v()(he,2),F=V[0],pe=V[1],xe=(0,a.useState)(!0),Q=v()(xe,2),Z=Q[0],$=Q[1],ye=(0,a.useState)(),X=v()(ye,2),k=X[0],q=X[1],Le=(0,a.useState)(),ee=v()(Le,2),w=ee[0],_e=ee[1],Se=(0,a.useState)(0),ne=v()(Se,2),be=ne[0],Ne=ne[1],Ce=(0,a.useState)(),te=v()(Ce,2),U=te[0],Ie=te[1],Ee=(0,a.useState)(),oe=v()(Ee,2),je=oe[0],ae=oe[1],De=(0,a.useState)(),re=v()(De,2),Te=re[0],Ze=re[1],ie=(0,a.useRef)(),se=function(p){var s=p.node;ae(s);var u=w==null?void 0:w.itemLogs.find(function(m){return m.config.id==s.id});q(u)};(0,a.useEffect)(function(){U&&(o==null||o.centerCell(U))},[U,o]),(0,a.useEffect)(function(){console.log("play curItemLog",k)},[k]),(0,a.useEffect)(function(){var i=o==null?void 0:o.getNodes().find(function(p){return p.id==g.nextId});i==null||i.attr("body/fill","red"),Ie(i)},[g.nextId]),(0,a.useEffect)(function(){var i;o==null||(i=o.getNodes().find(function(p){return p.id==g.nextId}))===null||i===void 0||i.attr("body/fill","red")},[o]),(0,a.useEffect)(function(){g.config&&me(g.config)},[g.config]),(0,a.useEffect)(function(){var i,p;console.log("props.debugLogs",g.debugLogs),((i=g.debugLogs)===null||i===void 0?void 0:i.length)>0&&setInterval(we,2e3);var s=[];g&&((p=g.debugLogs)===null||p===void 0||p.forEach(function(u){var m;s.push({children:(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("span",{style:{cursor:"pointer"},onClick:function(){_e(u),console.log(u),o==null||o.fromJSON(_==null?void 0:_.visualConfig);var ue;u.itemLogs.forEach(function(Me){var J=o==null?void 0:o.getNodes().find(function(Oe){return Oe.id==Me.config.id});J&&(J.attr("body/fill","#52c41a"),ue=J)}),o==null||o.centerCell(ue),q({}),ae({})},children:[(0,n.jsx)("p",{children:(m=u.itemLogs[0])===null||m===void 0?void 0:m.config.name}),(0,n.jsx)("p",{children:u.serverTime}),(0,n.jsx)("p",{children:u.message})]})}),color:u.success?"green":"red"})})),Ze(s)},[be,g.debugLogs]),(0,a.useEffect)(function(){if(_){try{var i=(0,D.K)(),p=i.Shapes;(0,r.m)(p)}catch(u){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(u)}var s=new T.kJ({container:ie.current,embedding:{enabled:!0,validate:function(m){return m.child.setData({hoverNode:m.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new T.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(m){var z=m.targetMagnet;return!!z}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}},background:{color:"#F2F7FA"},grid:!0});s.use(new b.H({enabled:!0,sharp:!0})).use(new K.A({enabled:!0})).use(new W.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new P.T({enabled:!0})).use(new S.N).use(new O.T).use(new C.D),s.on("edge:dblclick",function(){}),s.on("edge:mouseenter",function(){}),s.on("edge:mouseleave",function(){}),s.on("node:moved",function(){}),s.on("node:mouseenter",function(){}),s.on("node:mouseleave",function(){}),s.on("node:added",function(){}),s.on("node:dblclick",function(u){var m=u.node;$(!1)}),s.on("blank:dblclick",function(u){var m=u.x,z=u.y}),s.fromJSON(_.visualConfig),(0,h.V)(s),fe(s)}},[_]),(0,a.useEffect)(function(){o==null||o.off("node:click",se),o==null||o.on("node:click",se)},[w]);var we=function(){},Be=[{key:"1",label:"\u65E5\u5FD7",children:(0,n.jsx)(d.gcu,{src:k})},{key:"2",label:"\u8282\u70B9\u914D\u7F6E",children:(0,n.jsx)(c.Z,{editNode:je,configSchemaProvider:g.configSchemaProvider})}];return(0,n.jsxs)(L.Z,{style:{margin:0,height:"100vh"},children:[(0,n.jsxs)(L.Z.Sider,{theme:"light",collapsed:F,collapsedWidth:0,width:300,style:{padding:5},children:[(0,n.jsx)("h3",{children:"\u4EA4\u4E92\u8BF7\u6C42\u8BB0\u5F55"}),(0,n.jsx)(I.Z,{items:Te})]}),(0,n.jsxs)(L.Z,{style:{},children:[(0,n.jsxs)(L.Z.Header,{style:{padding:0,backgroundColor:"white"},children:[(0,n.jsx)(E.ZP,{type:"text",icon:F?(0,n.jsx)(x.Z,{}):(0,n.jsx)(y.Z,{}),onClick:function(){pe(!F)},style:{fontSize:"16px",width:64,height:64}}),(0,n.jsx)(j.Z,{direction:"horizontal",children:(A=g.btns)===null||A===void 0?void 0:A.map(function(i){return i})}),(0,n.jsx)(E.ZP,{type:"text",icon:Z?(0,n.jsx)(y.Z,{}):(0,n.jsx)(x.Z,{}),onClick:function(){$(!Z)},style:{float:"right",right:"16px",fontSize:"16px",width:64,height:64}})]}),(0,n.jsx)(L.Z.Content,{className:"app-content",children:(0,n.jsx)(l.Z,{ref:ie})})]}),(0,n.jsxs)(L.Z.Sider,{theme:"light",collapsed:Z,collapsedWidth:0,style:{overflow:"scroll"},title:"ddd",width:500,children:[(0,n.jsx)(E.ZP,{type:"text",onClick:function(){$(!Z)},style:{float:"right",fontSize:"16px",width:64,height:64},children:"x"}),(0,n.jsx)(N.Z,{items:Be,defaultActiveKey:"1"})]})]})},ce=de},514:function(le,B,e){e.d(B,{YH:function(){return P},az:function(){return L},b9:function(){return R},gC:function(){return N},m9:function(){return E}});var M=e(25359),f=e.n(M),v=e(49811),x=e.n(v),y=e(70517),T=e(5726),O=e.n(T);function K(r){return S.apply(this,arguments)}function S(){return S=_asyncToGenerator(_regeneratorRuntime().mark(function r(l){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",axios.post("/api/ide/pub/logic/dev-to-test".concat(l)));case 1:case"end":return t.stop()}},r)})),S.apply(this,arguments)}function W(r){return b.apply(this,arguments)}function b(){return b=_asyncToGenerator(_regeneratorRuntime().mark(function r(l){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",axios.get("/api/ide/logic/".concat(l)));case 1:case"end":return t.stop()}},r)})),b.apply(this,arguments)}function P(r){return C.apply(this,arguments)}function C(){return C=x()(f()().mark(function r(l){return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",y.Z.get("/api/ide/logic/".concat(l,"/config")).then(function(c){var d;return(d=c.data)===null||d===void 0?void 0:d.data}));case 1:case"end":return t.stop()}},r)})),C.apply(this,arguments)}function L(r,l,h){return I.apply(this,arguments)}function I(){return I=x()(f()().mark(function r(l,h,t){return f()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",y.Z.put("/api/ide/logic/edit/".concat(l),{version:h,configJson:t,updateTime:O()().format("YYYY-MM-DD HH:mm:ss")}));case 1:case"end":return d.stop()}},r)})),I.apply(this,arguments)}function E(r){return j.apply(this,arguments)}function j(){return j=x()(f()().mark(function r(l){return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",y.Z.get("/api/ide/logic-instance/".concat(l)).then(function(c){var d=c.data.data;return d}));case 1:case"end":return t.stop()}},r)})),j.apply(this,arguments)}function N(r){return a.apply(this,arguments)}function a(){return a=x()(f()().mark(function r(l){return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",y.Z.post("/api/ide/logic-logs",{filters:[{dataIndex:"logicId",values:[l.logicId],type:"and"},{dataIndex:"bizId",values:[l.bizId],type:"and"}],orderBy:[{dataIndex:"serverTime"}]}).then(function(c){var d=c.data.data.records;return d&&d.map(function(n){n.itemLogs&&(n.itemLogs=JSON.parse(n.itemLogs))}),d}));case 1:case"end":return t.stop()}},r)})),a.apply(this,arguments)}function R(r,l){return D.apply(this,arguments)}function D(){return D=x()(f()().mark(function r(l,h){return f()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",y.Z.post("/api/ide/logic-baks",{filters:[{dataIndex:"id",values:[l],type:"and"},{dataIndex:"version",values:[h],type:"and"}]}).then(function(d){var n=d.data.data.records[0].configJson,G=JSON.parse(n);return G}));case 1:case"end":return c.stop()}},r)})),D.apply(this,arguments)}}}]);
