"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[2369],{91656:function(le,O,e){e.d(O,{O:function(){return ce},A:function(){return P.Z}});var P=e(60463),f=e(54306),v=e.n(f),x=e(68673),y=e(86961),Z=e(89769),N=e(9722),K=e(17696),b=e(19227),W=e(75476),C=e(1167),B=e(22150),I=e(11250),L=e(69624),j=e(4632),E=e(25232),D=e(81021),R=e(82447),r=e(87363),F=e.n(r),T=e(11275),a=e(92873),l=e(64266),h=e(30685),t=e(6706),g=e(88593),d=e(48204),n=e(33130),G=F().createContext({logic:new t.Iz("")}),de=function(c){var $,ge=(0,r.useState)(),Y=v()(ge,2),o=Y[0],fe=Y[1],ve=(0,r.useState)(),H=v()(ve,2),_=H[0],me=H[1],he=(0,r.useState)(!1),V=v()(he,2),A=V[0],pe=V[1],xe=(0,r.useState)(!0),Q=v()(xe,2),w=Q[0],k=Q[1],ye=(0,r.useState)(),X=v()(ye,2),U=X[0],q=X[1],Le=(0,r.useState)(),ee=v()(Le,2),M=ee[0],_e=ee[1],Se=(0,r.useState)(0),ne=v()(Se,2),be=ne[0],Be=ne[1],Ce=(0,r.useState)(),te=v()(Ce,2),z=te[0],Ie=te[1],je=(0,r.useState)(),oe=v()(je,2),Ee=oe[0],re=oe[1],De=(0,r.useState)(),ae=v()(De,2),Te=ae[0],Ze=ae[1],ie=(0,r.useRef)(),se=function(p){var u=p.node;re(u);var s=M==null?void 0:M.itemLogs.find(function(m){return m.config.id==u.id});q(s)};(0,r.useEffect)(function(){z&&(o==null||o.centerCell(z))},[z,o]),(0,r.useEffect)(function(){console.log("play curItemLog",U)},[U]),(0,r.useEffect)(function(){var i=o==null?void 0:o.getNodes().find(function(p){return p.id==c.nextId});i==null||i.attr("body/fill","red"),Ie(i)},[c.nextId]),(0,r.useEffect)(function(){var i;o==null||(i=o.getNodes().find(function(p){return p.id==c.nextId}))===null||i===void 0||i.attr("body/fill","red")},[o]),(0,r.useEffect)(function(){c.config&&me(c.config)},[c.config]),(0,r.useEffect)(function(){var i,p;console.log("props.debugLogs",c.debugLogs),((i=c.debugLogs)===null||i===void 0?void 0:i.length)>0&&setInterval(we,2e3);var u=[];c&&((p=c.debugLogs)===null||p===void 0||p.forEach(function(s){var m,S;u.push({children:(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("span",{style:{cursor:"pointer"},onClick:function(){_e(s),console.log(s),o==null||o.fromJSON(_==null?void 0:_.visualConfig);var ue;s.itemLogs.forEach(function(Oe){var J=o==null?void 0:o.getNodes().find(function(Pe){return Pe.id==Oe.config.id});J&&(J.attr("body/fill","#52c41a"),ue=J)}),o==null||o.centerCell(ue),q({}),re({})},children:[(0,n.jsx)("p",{children:(m=s.itemLogs[0])===null||m===void 0?void 0:m.config.name}),((S=c.logicIns)===null||S===void 0?void 0:S.version)==s.version?(0,n.jsx)("p",{}):(0,n.jsxs)("p",{style:{color:"red"},children:["\u7248\u672C\u53D8\u66F4:",s.version]}),(0,n.jsx)("p",{children:s.serverTime}),(0,n.jsx)("p",{children:s.message})]})}),color:s.success?"green":"red"})})),Ze(u)},[be,c.debugLogs,c.logicIns,o]),(0,r.useEffect)(function(){if(_){try{var i=(0,T.K)(),p=i.Shapes;(0,a.m)(p)}catch(s){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(s)}var u=new Z.kJ({container:ie.current,embedding:{enabled:!0,validate:function(m){return m.child.setData({hoverNode:m.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new Z.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(m){var S=m.targetMagnet;return!!S}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}},background:{color:"#F2F7FA"},grid:!0});u.use(new C.H({enabled:!0,sharp:!0})).use(new K.A({enabled:!0})).use(new W.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new B.T({enabled:!0})).use(new b.N).use(new N.T).use(new I.D),u.on("edge:dblclick",function(){}),u.on("edge:mouseenter",function(){}),u.on("edge:mouseleave",function(){}),u.on("node:moved",function(){}),u.on("node:mouseenter",function(){}),u.on("node:mouseleave",function(){}),u.on("node:added",function(){}),u.on("node:dblclick",function(s){var m=s.node;k(!1)}),u.on("blank:dblclick",function(s){var m=s.x,S=s.y}),u.fromJSON(_.visualConfig),(0,h.V)(u),fe(u)}},[_]),(0,r.useEffect)(function(){o==null||o.off("node:click",se),o==null||o.on("node:click",se)},[M]);var we=function(){},Me=[{key:"1",label:"\u65E5\u5FD7",children:(0,n.jsx)(d.gcu,{src:U})},{key:"2",label:"\u8282\u70B9\u914D\u7F6E",children:(0,n.jsx)(g.Z,{editNode:Ee,configSchemaProvider:c.configSchemaProvider})}];return(0,n.jsxs)(L.Z,{style:{margin:0,height:"100vh"},children:[(0,n.jsxs)(L.Z.Sider,{theme:"light",collapsed:A,collapsedWidth:0,width:300,style:{padding:5},children:[(0,n.jsx)("h3",{children:"\u6700\u8FD1\u8BF7\u6C42"}),(0,n.jsx)(j.Z,{items:Te})]}),(0,n.jsxs)(L.Z,{style:{},children:[(0,n.jsxs)(L.Z.Header,{style:{padding:0,backgroundColor:"white"},children:[(0,n.jsx)(E.ZP,{type:"text",icon:A?(0,n.jsx)(x.Z,{}):(0,n.jsx)(y.Z,{}),onClick:function(){pe(!A)},style:{fontSize:"16px",width:64,height:64}}),(0,n.jsx)(D.Z,{direction:"horizontal",children:($=c.btns)===null||$===void 0?void 0:$.map(function(i){return i})}),(0,n.jsx)(E.ZP,{type:"text",icon:w?(0,n.jsx)(y.Z,{}):(0,n.jsx)(x.Z,{}),onClick:function(){k(!w)},style:{float:"right",right:"16px",fontSize:"16px",width:64,height:64}})]}),(0,n.jsx)(L.Z.Content,{className:"app-content",children:(0,n.jsx)(l.Z,{ref:ie})})]}),(0,n.jsxs)(L.Z.Sider,{theme:"light",collapsed:w,collapsedWidth:0,style:{overflow:"scroll"},title:"ddd",width:500,children:[(0,n.jsx)(E.ZP,{type:"text",onClick:function(){k(!w)},style:{float:"right",fontSize:"16px",width:64,height:64},children:"x"}),(0,n.jsx)(R.Z,{items:Me,defaultActiveKey:"1"})]})]})},ce=de},514:function(le,O,e){e.d(O,{YH:function(){return B},az:function(){return L},b9:function(){return F},gC:function(){return R},m9:function(){return E}});var P=e(25359),f=e.n(P),v=e(49811),x=e.n(v),y=e(70517),Z=e(5726),N=e.n(Z);function K(a){return b.apply(this,arguments)}function b(){return b=_asyncToGenerator(_regeneratorRuntime().mark(function a(l){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",axios.post("/api/ide/pub/logic/dev-to-test".concat(l)));case 1:case"end":return t.stop()}},a)})),b.apply(this,arguments)}function W(a){return C.apply(this,arguments)}function C(){return C=_asyncToGenerator(_regeneratorRuntime().mark(function a(l){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",axios.get("/api/ide/logic/".concat(l)));case 1:case"end":return t.stop()}},a)})),C.apply(this,arguments)}function B(a){return I.apply(this,arguments)}function I(){return I=x()(f()().mark(function a(l){return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",y.Z.get("/api/ide/logic/".concat(l,"/config")).then(function(g){var d;return(d=g.data)===null||d===void 0?void 0:d.data}));case 1:case"end":return t.stop()}},a)})),I.apply(this,arguments)}function L(a,l,h){return j.apply(this,arguments)}function j(){return j=x()(f()().mark(function a(l,h,t){return f()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",y.Z.put("/api/ide/logic/edit/".concat(l),{version:h,configJson:t,updateTime:N()().format("YYYY-MM-DD HH:mm:ss")}));case 1:case"end":return d.stop()}},a)})),j.apply(this,arguments)}function E(a){return D.apply(this,arguments)}function D(){return D=x()(f()().mark(function a(l){return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",y.Z.get("/api/ide/logic-instance/".concat(l)).then(function(g){var d=g.data.data;return d}));case 1:case"end":return t.stop()}},a)})),D.apply(this,arguments)}function R(a){return r.apply(this,arguments)}function r(){return r=x()(f()().mark(function a(l){return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",y.Z.post("/api/ide/logic-logs",{filters:[{dataIndex:"logicId",values:[l.logicId],type:"and"},{dataIndex:"bizId",values:[l.bizId],type:"and"}],orderBy:[{dataIndex:"serverTime"}]}).then(function(g){var d=g.data.data.records;return d&&d.map(function(n){n.itemLogs&&(n.itemLogs=JSON.parse(n.itemLogs))}),d}));case 1:case"end":return t.stop()}},a)})),r.apply(this,arguments)}function F(a,l){return T.apply(this,arguments)}function T(){return T=x()(f()().mark(function a(l,h){return f()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",y.Z.post("/api/ide/logic-baks",{filters:[{dataIndex:"id",values:[l],type:"and"},{dataIndex:"version",values:[h],type:"and"}]}).then(function(d){var n=d.data.data.records[0].configJson,G=JSON.parse(n);return G}));case 1:case"end":return g.stop()}},a)})),T.apply(this,arguments)}}}]);
