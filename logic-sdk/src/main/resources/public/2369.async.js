"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[2369],{91656:function(ue,k,n){n.d(k,{O:function(){return de},A:function(){return A.Z}});var A=n(60463),g=n(54306),h=n.n(g),L=n(50261),b=n(86961),F=n(68673),O=n(89769),G=n(17696),j=n(19227),Y=n(75476),I=n(1167),R=n(22150),S=n(81021),E=n(60180),x=n(69624),P=n(38451),D=n(4632),M=n(25232),Z=n(82447),i=n(87363),T=n.n(i),$=n(11275),w=n(92873),a=n(64266),s=n(30685),f=n(6706),t=n(88593),d=n(48204),e=n(33130),y=T().createContext({logic:new f.Iz("")}),B=function(c){var U,ce=(0,i.useState)(),H=h()(ce,2),o=H[0],ge=H[1],fe=(0,i.useState)(),V=h()(fe,2),_=V[0],ve=V[1],he=(0,i.useState)(!1),Q=h()(he,2),Be=Q[0],Oe=Q[1],me=(0,i.useState)(!0),X=h()(me,2),N=X[0],J=X[1],pe=(0,i.useState)(),q=h()(pe,2),W=q[0],ee=q[1],xe=(0,i.useState)(),ne=h()(xe,2),m=ne[0],ye=ne[1],Le=(0,i.useState)(),te=h()(Le,2),z=te[0],be=te[1],Se=(0,i.useState)(),oe=h()(Se,2),_e=oe[0],re=oe[1],Ce=(0,i.useState)(),ae=h()(Ce,2),je=ae[0],Ie=ae[1],ie=(0,i.useRef)(),se=function(p){var u=p.node;re(u);var r=m==null?void 0:m.itemLogs.find(function(v){return v.config.id==u.id});ee(r)};(0,i.useEffect)(function(){z&&(o==null||o.centerCell(z))},[z,o]),(0,i.useEffect)(function(){console.log("play curItemLog",W)},[W]),(0,i.useEffect)(function(){var l=o==null?void 0:o.getNodes().find(function(p){return p.id==c.nextId});l==null||l.attr("body/fill","red"),be(l)},[c.nextId]),(0,i.useEffect)(function(){var l;o==null||(l=o.getNodes().find(function(p){return p.id==c.nextId}))===null||l===void 0||l.attr("body/fill","red")},[o]),(0,i.useEffect)(function(){c.config&&ve(c.config)},[c.config]),(0,i.useEffect)(function(){var l,p;console.log("props.debugLogs",c.debugLogs),((l=c.debugLogs)===null||l===void 0?void 0:l.length)>0&&setInterval(Ee,2e3);var u=[];c&&((p=c.debugLogs)===null||p===void 0||p.forEach(function(r){var v,C;u.push({children:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("span",{style:{cursor:"pointer",fontWeight:r.id==(m==null?void 0:m.id)?"bolder":"normal",color:r.id==(m==null?void 0:m.id)?"#52c41a":"black"},onClick:function(){ye(r),console.log(r),o==null||o.fromJSON(_==null?void 0:_.visualConfig);var le;r.itemLogs.forEach(function(Ze){var K=o==null?void 0:o.getNodes().find(function(Te){return Te.id==Ze.config.id});K&&(K.attr("body/fill","#52c41a"),le=K)}),o==null||o.centerCell(le),ee({}),re({})},children:[(0,e.jsx)("p",{children:(v=r.itemLogs[0])===null||v===void 0?void 0:v.config.name}),((C=c.logicIns)===null||C===void 0?void 0:C.version)==r.version?(0,e.jsx)("p",{}):(0,e.jsx)("p",{children:(0,e.jsxs)(S.Z,{children:[(0,e.jsx)(E.Z.Paragraph,{style:{color:"red"},children:"\u7248\u672C\u53F7:"}),(0,e.jsxs)(E.Z.Paragraph,{copyable:{tooltips:["\u70B9\u51FB\u590D\u5236","\u590D\u5236\u6210\u529F!"],text:r.version},children:[r.version,(0,e.jsx)(E.Z.Link,{style:{margin:"5px"},href:"#/assets/logic/i/".concat(r.logicId,"/view/").concat(r.version),target:"_blank",children:(0,e.jsx)(L.Z,{})})]})]})}),(0,e.jsxs)("p",{children:["\u4E1A\u52A1\u6807\u8BC6\uFF1A",r.bizId]}),(0,e.jsx)("p",{children:r.serverTime}),(0,e.jsx)("p",{children:r.message})]})}),color:r.success?"green":"red"})})),Ie(u)},[c.debugLogs,c.logicIns,o,m]),(0,i.useEffect)(function(){if(_){try{var l=(0,$.K)(),p=l.Shapes;(0,w.m)(p)}catch(r){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(r)}var u=new O.kJ({container:ie.current,embedding:{enabled:!0,validate:function(v){return v.child.setData({hoverNode:v.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new O.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(v){var C=v.targetMagnet;return!!C}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}},background:{color:"#F2F7FA"},grid:!0});u.use(new I.H({enabled:!0,sharp:!0})).use(new G.A({enabled:!0})).use(new Y.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new R.T({enabled:!0})).use(new j.N),u.on("edge:dblclick",function(){}),u.on("edge:mouseenter",function(){}),u.on("edge:mouseleave",function(){}),u.on("node:moved",function(){}),u.on("node:mouseenter",function(){}),u.on("node:mouseleave",function(){}),u.on("node:added",function(){}),u.on("node:dblclick",function(r){var v=r.node;J(!1)}),u.on("blank:dblclick",function(r){var v=r.x,C=r.y}),u.fromJSON(_.visualConfig),(0,s.V)(u),ge(u)}},[_]),(0,i.useEffect)(function(){o==null||o.off("node:click",se),o==null||o.on("node:click",se)},[m]);var Ee=function(){},De=[{key:"1",label:"\u65E5\u5FD7",children:(0,e.jsx)(d.gcu,{src:W})},{key:"2",label:"\u8282\u70B9\u914D\u7F6E",children:(0,e.jsx)(t.Z,{editNode:_e,configSchemaProvider:c.configSchemaProvider})}];return(0,e.jsxs)(x.Z,{style:{margin:0,height:"100vh"},children:[(0,e.jsxs)(x.Z.Sider,{theme:"light",collapsedWidth:0,width:300,style:{overflow:"auto",height:"100vh",position:"fixed",left:0,top:0,bottom:0,padding:"5px",backgroundColor:"WhiteSmoke",borderRight:"0.5px solid"},children:[(0,e.jsx)(P.Z,{children:"\u6700\u8FD1\u8BF7\u6C42"}),(0,e.jsx)(D.Z,{style:{height:"100%"},items:je})]}),(0,e.jsxs)(x.Z,{style:{marginLeft:300},children:[(0,e.jsxs)(x.Z.Header,{style:{backgroundColor:"white",padding:0},children:[(0,e.jsxs)(S.Z,{direction:"horizontal",style:{},children:[(0,e.jsx)(P.Z,{type:"vertical"}),(U=c.btns)===null||U===void 0?void 0:U.map(function(l){return l})]}),(0,e.jsx)(M.ZP,{type:"text",icon:N?(0,e.jsx)(b.Z,{}):(0,e.jsx)(F.Z,{}),onClick:function(){J(!N)},style:{float:"right",right:"16px",fontSize:"16px",width:64,height:64}})]}),(0,e.jsx)(x.Z.Content,{className:"app-content",children:(0,e.jsx)(a.Z,{ref:ie})})]}),(0,e.jsxs)(x.Z.Sider,{theme:"light",collapsed:N,collapsedWidth:0,style:{overflow:"scroll"},title:"ddd",width:500,children:[(0,e.jsx)(M.ZP,{type:"text",onClick:function(){J(!N)},style:{float:"right",fontSize:"16px",width:64,height:64},children:"x"}),(0,e.jsx)(Z.Z,{items:De,defaultActiveKey:"1"})]})]})},de=B},514:function(ue,k,n){n.d(k,{Uh:function(){return $},YH:function(){return R},az:function(){return E},b9:function(){return i},gC:function(){return M},m9:function(){return P}});var A=n(25359),g=n.n(A),h=n(49811),L=n.n(h),b=n(70517),F=n(5726),O=n.n(F);function G(a){return j.apply(this,arguments)}function j(){return j=_asyncToGenerator(_regeneratorRuntime().mark(function a(s){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",axios.post("/api/ide/pub/logic/dev-to-test".concat(s)));case 1:case"end":return t.stop()}},a)})),j.apply(this,arguments)}function Y(a){return I.apply(this,arguments)}function I(){return I=_asyncToGenerator(_regeneratorRuntime().mark(function a(s){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",axios.get("/api/ide/logic/".concat(s)));case 1:case"end":return t.stop()}},a)})),I.apply(this,arguments)}function R(a){return S.apply(this,arguments)}function S(){return S=L()(g()().mark(function a(s){return g()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",b.Z.get("/api/ide/logic/".concat(s,"/config")).then(function(d){var e;return(e=d.data)===null||e===void 0?void 0:e.data}));case 1:case"end":return t.stop()}},a)})),S.apply(this,arguments)}function E(a,s,f){return x.apply(this,arguments)}function x(){return x=L()(g()().mark(function a(s,f,t){return g()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",b.Z.put("/api/ide/logic/edit/".concat(s),{version:f,configJson:t,updateTime:O()().format("YYYY-MM-DD HH:mm:ss")}));case 1:case"end":return e.stop()}},a)})),x.apply(this,arguments)}function P(a){return D.apply(this,arguments)}function D(){return D=L()(g()().mark(function a(s){return g()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",b.Z.get("/api/ide/logic-instance/".concat(s)).then(function(d){var e=d.data.data;return e}));case 1:case"end":return t.stop()}},a)})),D.apply(this,arguments)}function M(a){return Z.apply(this,arguments)}function Z(){return Z=L()(g()().mark(function a(s){return g()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",b.Z.post("/api/ide/logic-logs",{filters:[{dataIndex:"logicId",values:[s.logicId],type:"="},{dataIndex:"bizId",values:[s.bizId],type:"="}],pageSize:1e3,orderBy:[{dataIndex:"serverTime",desc:!0}]}).then(function(d){var e=d.data.data.records;return e&&e.map(function(y){y.itemLogs&&(y.itemLogs=JSON.parse(y.itemLogs))}),e}));case 1:case"end":return t.stop()}},a)})),Z.apply(this,arguments)}function i(a,s){return T.apply(this,arguments)}function T(){return T=L()(g()().mark(function a(s,f){return g()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",b.Z.post("/api/ide/logic-baks",{filters:[{dataIndex:"id",values:[s],type:"="},{dataIndex:"version",values:[f],type:"="}]}).then(function(e){var y=e.data.data.records[0].configJson,B=JSON.parse(y);return B}));case 1:case"end":return d.stop()}},a)})),T.apply(this,arguments)}function $(a,s){return w.apply(this,arguments)}function w(){return w=L()(g()().mark(function a(s,f){return g()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",b.Z.post("/api/ide/logic-baks",{filters:[{dataIndex:"id",values:[s],type:"="},{dataIndex:"version",values:[f],type:"="}]}).then(function(e){var y=e.data.data.records[0],B=y.configJson;return y.configJson=JSON.parse(B),y}));case 1:case"end":return d.stop()}},a)})),w.apply(this,arguments)}}}]);
