"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[1199],{59927:function(Le,ie,i){i.d(ie,{O:function(){return Ae},A:function(){return re.Z}});var re=i(60463),b=i(54306),I=i.n(b),P=i(68673),N=i(86961),Q=i(89769),ae=i(17696),he=i(19227),F=i(75476),ve=i(1167),U=i(22150),_=i(69624),J=i(3303),Z=i.n(J),r=i(87363),oe=i.n(r),H=i(59546),le=function(e,t){var d={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(d[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(d[n[a]]=e[n[a]]);return d},q=e=>{var{prefixCls:t,className:d,color:n="blue",dot:a,pending:o=!1,position:A,label:E,children:w}=e,$=le(e,["prefixCls","className","color","dot","pending","position","label","children"]);const{getPrefixCls:D}=r.useContext(H.E_),y=D("timeline",t),z=Z()(`${y}-item`,{[`${y}-item-pending`]:o},d),O=/blue|red|green|gray/.test(n||"")?void 0:n,T=Z()(`${y}-item-head`,{[`${y}-item-head-custom`]:!!a,[`${y}-item-head-${n}`]:!O});return r.createElement("li",Object.assign({},$,{className:z}),E&&r.createElement("div",{className:`${y}-item-label`},E),r.createElement("div",{className:`${y}-item-tail`}),r.createElement("div",{className:T,style:{borderColor:O,color:O}},a),r.createElement("div",{className:`${y}-item-content`},w))},K=i(45074),se=i(70581),W=function(e,t){var d={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(d[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(d[n[a]]=e[n[a]]);return d},m=e=>{var{prefixCls:t,className:d,pending:n=!1,children:a,items:o,rootClassName:A,reverse:E=!1,direction:w,hashId:$,pendingDot:D,mode:y=""}=e,z=W(e,["prefixCls","className","pending","children","items","rootClassName","reverse","direction","hashId","pendingDot","mode"]);const O=(g,B)=>y==="alternate"?g==="right"?`${t}-item-right`:g==="left"?`${t}-item-left`:B%2===0?`${t}-item-left`:`${t}-item-right`:y==="left"?`${t}-item-left`:y==="right"?`${t}-item-right`:g==="right"?`${t}-item-right`:"",T=(0,K.Z)(o||[]),ce=typeof n=="boolean"?null:n;n&&T.push({pending:!!n,dot:D||r.createElement(se.Z,null),children:ce}),E&&T.reverse();const X=T.length,M=`${t}-item-last`,Y=T.filter(g=>!!g).map((g,B)=>{var V;const ne=B===X-2?M:"",x=B===X-1?M:"",{className:ue}=g,ge=W(g,["className"]);return r.createElement(q,Object.assign({},ge,{className:Z()([ue,!E&&n?ne:x,O((V=g==null?void 0:g.position)!==null&&V!==void 0?V:"",B)]),key:(g==null?void 0:g.key)||B}))}),ee=T.some(g=>!!(g!=null&&g.label)),te=Z()(t,{[`${t}-pending`]:!!n,[`${t}-reverse`]:!!E,[`${t}-${y}`]:!!y&&!ee,[`${t}-label`]:ee,[`${t}-rtl`]:w==="rtl"},d,A,$);return r.createElement("ul",Object.assign({},z,{className:te}),Y)},S=i(64517);function l(e,t){return e&&Array.isArray(e)?e:(0,S.Z)(t).map(d=>{var n,a;return Object.assign({children:(a=(n=d==null?void 0:d.props)===null||n===void 0?void 0:n.children)!==null&&a!==void 0?a:""},d.props)})}var p=l,h=i(38826),L=i(7886),G=i(13577);const Oe=e=>{const{componentCls:t}=e;return{[t]:Object.assign(Object.assign({},(0,h.Wf)(e)),{margin:0,padding:0,listStyle:"none",[`${t}-item`]:{position:"relative",margin:0,paddingBottom:e.itemPaddingBottom,fontSize:e.fontSize,listStyle:"none","&-tail":{position:"absolute",insetBlockStart:e.itemHeadSize,insetInlineStart:(e.itemHeadSize-e.tailWidth)/2,height:`calc(100% - ${e.itemHeadSize}px)`,borderInlineStart:`${e.tailWidth}px ${e.lineType} ${e.tailColor}`},"&-pending":{[`${t}-item-head`]:{fontSize:e.fontSizeSM,backgroundColor:"transparent"},[`${t}-item-tail`]:{display:"none"}},"&-head":{position:"absolute",width:e.itemHeadSize,height:e.itemHeadSize,backgroundColor:e.dotBg,border:`${e.dotBorderWidth}px ${e.lineType} transparent`,borderRadius:"50%","&-blue":{color:e.colorPrimary,borderColor:e.colorPrimary},"&-red":{color:e.colorError,borderColor:e.colorError},"&-green":{color:e.colorSuccess,borderColor:e.colorSuccess},"&-gray":{color:e.colorTextDisabled,borderColor:e.colorTextDisabled}},"&-head-custom":{position:"absolute",insetBlockStart:e.itemHeadSize/2,insetInlineStart:e.itemHeadSize/2,width:"auto",height:"auto",marginBlockStart:0,paddingBlock:e.customHeadPaddingVertical,lineHeight:1,textAlign:"center",border:0,borderRadius:0,transform:"translate(-50%, -50%)"},"&-content":{position:"relative",insetBlockStart:-(e.fontSize*e.lineHeight-e.fontSize)+e.lineWidth,marginInlineStart:e.margin+e.itemHeadSize,marginInlineEnd:0,marginBlockStart:0,marginBlockEnd:0,wordBreak:"break-word"},"&-last":{[`> ${t}-item-tail`]:{display:"none"},[`> ${t}-item-content`]:{minHeight:e.controlHeightLG*1.2}}},[`&${t}-alternate,
        &${t}-right,
        &${t}-label`]:{[`${t}-item`]:{"&-tail, &-head, &-head-custom":{insetInlineStart:"50%"},"&-head":{marginInlineStart:`-${e.marginXXS}px`,"&-custom":{marginInlineStart:e.tailWidth/2}},"&-left":{[`${t}-item-content`]:{insetInlineStart:`calc(50% - ${e.marginXXS}px)`,width:`calc(50% - ${e.marginSM}px)`,textAlign:"start"}},"&-right":{[`${t}-item-content`]:{width:`calc(50% - ${e.marginSM}px)`,margin:0,textAlign:"end"}}}},[`&${t}-right`]:{[`${t}-item-right`]:{[`${t}-item-tail,
            ${t}-item-head,
            ${t}-item-head-custom`]:{insetInlineStart:`calc(100% - ${(e.itemHeadSize+e.tailWidth)/2}px)`},[`${t}-item-content`]:{width:`calc(100% - ${e.itemHeadSize+e.marginXS}px)`}}},[`&${t}-pending
        ${t}-item-last
        ${t}-item-tail`]:{display:"block",height:`calc(100% - ${e.margin}px)`,borderInlineStart:`${e.tailWidth}px dotted ${e.tailColor}`},[`&${t}-reverse
        ${t}-item-last
        ${t}-item-tail`]:{display:"none"},[`&${t}-reverse ${t}-item-pending`]:{[`${t}-item-tail`]:{insetBlockStart:e.margin,display:"block",height:`calc(100% - ${e.margin}px)`,borderInlineStart:`${e.tailWidth}px dotted ${e.tailColor}`},[`${t}-item-content`]:{minHeight:e.controlHeightLG*1.2}},[`&${t}-label`]:{[`${t}-item-label`]:{position:"absolute",insetBlockStart:-(e.fontSize*e.lineHeight-e.fontSize)+e.tailWidth,width:`calc(50% - ${e.marginSM}px)`,textAlign:"end"},[`${t}-item-right`]:{[`${t}-item-label`]:{insetInlineStart:`calc(50% + ${e.marginSM}px)`,width:`calc(50% - ${e.marginSM}px)`,textAlign:"start"}}},"&-rtl":{direction:"rtl",[`${t}-item-head-custom`]:{transform:"translate(50%, -50%)"}}})}};var je=(0,L.Z)("Timeline",e=>{const t=(0,G.TS)(e,{itemHeadSize:10,customHeadPaddingVertical:e.paddingXXS,paddingInlineEnd:2});return[Oe(t)]},e=>({tailColor:e.colorSplit,tailWidth:e.lineWidthBold,dotBorderWidth:e.wireframe?e.lineWidthBold:e.lineWidth*3,dotBg:e.colorBgContainer,itemPaddingBottom:e.padding*1.25})),Ee=function(e,t){var d={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(d[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(d[n[a]]=e[n[a]]);return d};const pe=e=>{const{getPrefixCls:t,direction:d,timeline:n}=r.useContext(H.E_),{prefixCls:a,children:o,items:A,className:E,style:w}=e,$=Ee(e,["prefixCls","children","items","className","style"]),D=t("timeline",a),[y,z]=je(D),O=p(A,o);return y(r.createElement(m,Object.assign({},$,{className:Z()(n==null?void 0:n.className,E),style:Object.assign(Object.assign({},n==null?void 0:n.style),w),prefixCls:D,direction:d,items:O,hashId:z})))};pe.Item=q;var Pe=pe,Ne=Pe,de=i(25232),Te=i(81021),Be=i(82447),_e=i(11275),we=i(92873),De=i(64266),ze=i(30685),Ze=i(6706),Me=i(88593),He=i(48204),s=i(33130),ke=oe().createContext({logic:new Ze.Iz("")}),We=function(t){var d,n=(0,r.useState)(),a=I()(n,2),o=a[0],A=a[1],E=(0,r.useState)(),w=I()(E,2),$=w[0],D=w[1],y=(0,r.useState)(!1),z=I()(y,2),O=z[0],T=z[1],ce=(0,r.useState)(!0),X=I()(ce,2),M=X[0],Y=X[1],ee=(0,r.useState)(),te=I()(ee,2),g=te[0],B=te[1],V=(0,r.useState)(),ne=I()(V,2),x=ne[0],ue=ne[1],ge=(0,r.useState)(),ye=I()(ge,2),me=ye[0],Re=ye[1],Fe=(0,r.useState)(),be=I()(Fe,2),Ue=be[0],Se=be[1],Je=(0,r.useState)(),xe=I()(Je,2),Ke=xe[0],Ge=xe[1],$e=(0,r.useRef)(),Ce=function(j){var v=j.node;Se(v);var u=x==null?void 0:x.itemLogs.find(function(C){return C.config.id==v.id});B(u)};(0,r.useEffect)(function(){me&&(o==null||o.centerCell(me))},[me,o]),(0,r.useEffect)(function(){console.log("play curItemLog",g)},[g]),(0,r.useEffect)(function(){var f=o==null?void 0:o.getNodes().find(function(j){return j.id==t.nextId});f==null||f.attr("body/fill","red"),Re(f)},[t.nextId]),(0,r.useEffect)(function(){var f;o==null||(f=o.getNodes().find(function(j){return j.id==t.nextId}))===null||f===void 0||f.attr("body/fill","red")},[o]),(0,r.useEffect)(function(){t.config&&D(t.config)},[t.config]),(0,r.useEffect)(function(){var f,j;console.log("props.debugLogs",t.debugLogs),((f=t.debugLogs)===null||f===void 0?void 0:f.length)>0&&setInterval(Xe,2e3);var v=[];t&&((j=t.debugLogs)===null||j===void 0||j.forEach(function(u){var C,R;v.push({children:(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("span",{style:{cursor:"pointer",fontWeight:u.id==(x==null?void 0:x.id)?"bolder":"normal",color:u.id==(x==null?void 0:x.id)?"#52c41a":"black"},onClick:function(){ue(u),console.log(u),o==null||o.fromJSON($==null?void 0:$.visualConfig);var Ie;u.itemLogs.forEach(function(Ve){var fe=o==null?void 0:o.getNodes().find(function(Qe){return Qe.id==Ve.config.id});fe&&(fe.attr("body/fill","#52c41a"),Ie=fe)}),o==null||o.centerCell(Ie),B({}),Se({})},children:[(0,s.jsx)("p",{children:(C=u.itemLogs[0])===null||C===void 0?void 0:C.config.name}),((R=t.logicIns)===null||R===void 0?void 0:R.version)==u.version?(0,s.jsx)("p",{}):(0,s.jsxs)("p",{style:{color:"red"},children:["\u7248\u672C\u53D8\u66F4:",u.version]}),(0,s.jsx)("p",{children:u.serverTime}),(0,s.jsx)("p",{children:u.message})]})}),color:u.success?"green":"red"})})),Ge(v)},[t.debugLogs,t.logicIns,o,x]),(0,r.useEffect)(function(){if($){try{var f=(0,_e.K)(),j=f.Shapes;(0,we.m)(j)}catch(u){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(u)}var v=new Q.kJ({container:$e.current,embedding:{enabled:!0,validate:function(C){return C.child.setData({hoverNode:C.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new Q.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(C){var R=C.targetMagnet;return!!R}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}},background:{color:"#F2F7FA"},grid:!0});v.use(new ve.H({enabled:!0,sharp:!0})).use(new ae.A({enabled:!0})).use(new F.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new U.T({enabled:!0})).use(new he.N),v.on("edge:dblclick",function(){}),v.on("edge:mouseenter",function(){}),v.on("edge:mouseleave",function(){}),v.on("node:moved",function(){}),v.on("node:mouseenter",function(){}),v.on("node:mouseleave",function(){}),v.on("node:added",function(){}),v.on("node:dblclick",function(u){var C=u.node;Y(!1)}),v.on("blank:dblclick",function(u){var C=u.x,R=u.y}),v.fromJSON($.visualConfig),(0,ze.V)(v),A(v)}},[$]),(0,r.useEffect)(function(){o==null||o.off("node:click",Ce),o==null||o.on("node:click",Ce)},[x]);var Xe=function(){},Ye=[{key:"1",label:"\u65E5\u5FD7",children:(0,s.jsx)(He.gcu,{src:g})},{key:"2",label:"\u8282\u70B9\u914D\u7F6E",children:(0,s.jsx)(Me.Z,{editNode:Ue,configSchemaProvider:t.configSchemaProvider})}];return(0,s.jsxs)(_.Z,{style:{margin:0,height:"100vh"},children:[(0,s.jsxs)(_.Z.Sider,{theme:"light",collapsed:O,collapsedWidth:0,width:300,style:{padding:5},children:[(0,s.jsx)("h3",{children:"\u6700\u8FD1\u8BF7\u6C42"}),(0,s.jsx)(Ne,{items:Ke})]}),(0,s.jsxs)(_.Z,{style:{},children:[(0,s.jsxs)(_.Z.Header,{style:{padding:0,backgroundColor:"white"},children:[(0,s.jsx)(de.ZP,{type:"text",icon:O?(0,s.jsx)(P.Z,{}):(0,s.jsx)(N.Z,{}),onClick:function(){T(!O)},style:{fontSize:"16px",width:64,height:64}}),(0,s.jsx)(Te.Z,{direction:"horizontal",children:(d=t.btns)===null||d===void 0?void 0:d.map(function(f){return f})}),(0,s.jsx)(de.ZP,{type:"text",icon:M?(0,s.jsx)(N.Z,{}):(0,s.jsx)(P.Z,{}),onClick:function(){Y(!M)},style:{float:"right",right:"16px",fontSize:"16px",width:64,height:64}})]}),(0,s.jsx)(_.Z.Content,{className:"app-content",children:(0,s.jsx)(De.Z,{ref:$e})})]}),(0,s.jsxs)(_.Z.Sider,{theme:"light",collapsed:M,collapsedWidth:0,style:{overflow:"scroll"},title:"ddd",width:500,children:[(0,s.jsx)(de.ZP,{type:"text",onClick:function(){Y(!M)},style:{float:"right",fontSize:"16px",width:64,height:64},children:"x"}),(0,s.jsx)(Be.Z,{items:Ye,defaultActiveKey:"1"})]})]})},Ae=We},514:function(Le,ie,i){i.d(ie,{Uh:function(){return se},YH:function(){return _},az:function(){return Z},b9:function(){return q},gC:function(){return le},m9:function(){return oe}});var re=i(25359),b=i.n(re),I=i(49811),P=i.n(I),N=i(70517),Q=i(5726),ae=i.n(Q);function he(c){return F.apply(this,arguments)}function F(){return F=_asyncToGenerator(_regeneratorRuntime().mark(function c(m){return _regeneratorRuntime().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",axios.post("/api/ide/pub/logic/dev-to-test".concat(m)));case 1:case"end":return l.stop()}},c)})),F.apply(this,arguments)}function ve(c){return U.apply(this,arguments)}function U(){return U=_asyncToGenerator(_regeneratorRuntime().mark(function c(m){return _regeneratorRuntime().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",axios.get("/api/ide/logic/".concat(m)));case 1:case"end":return l.stop()}},c)})),U.apply(this,arguments)}function _(c){return J.apply(this,arguments)}function J(){return J=P()(b()().mark(function c(m){return b()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",N.Z.get("/api/ide/logic/".concat(m,"/config")).then(function(p){var h;return(h=p.data)===null||h===void 0?void 0:h.data}));case 1:case"end":return l.stop()}},c)})),J.apply(this,arguments)}function Z(c,m,S){return r.apply(this,arguments)}function r(){return r=P()(b()().mark(function c(m,S,l){return b()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",N.Z.put("/api/ide/logic/edit/".concat(m),{version:S,configJson:l,updateTime:ae()().format("YYYY-MM-DD HH:mm:ss")}));case 1:case"end":return h.stop()}},c)})),r.apply(this,arguments)}function oe(c){return H.apply(this,arguments)}function H(){return H=P()(b()().mark(function c(m){return b()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",N.Z.get("/api/ide/logic-instance/".concat(m)).then(function(p){var h=p.data.data;return h}));case 1:case"end":return l.stop()}},c)})),H.apply(this,arguments)}function le(c){return k.apply(this,arguments)}function k(){return k=P()(b()().mark(function c(m){return b()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",N.Z.post("/api/ide/logic-logs",{filters:[{dataIndex:"logicId",values:[m.logicId],type:"and"},{dataIndex:"bizId",values:[m.bizId],type:"and"}],orderBy:[{dataIndex:"serverTime"}]}).then(function(p){var h=p.data.data.records;return h&&h.map(function(L){L.itemLogs&&(L.itemLogs=JSON.parse(L.itemLogs))}),h}));case 1:case"end":return l.stop()}},c)})),k.apply(this,arguments)}function q(c,m){return K.apply(this,arguments)}function K(){return K=P()(b()().mark(function c(m,S){return b()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",N.Z.post("/api/ide/logic-baks",{filters:[{dataIndex:"id",values:[m],type:"and"},{dataIndex:"version",values:[S],type:"and"}]}).then(function(h){var L=h.data.data.records[0].configJson,G=JSON.parse(L);return G}));case 1:case"end":return p.stop()}},c)})),K.apply(this,arguments)}function se(c,m){return W.apply(this,arguments)}function W(){return W=P()(b()().mark(function c(m,S){return b()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",N.Z.post("/api/ide/logic-baks",{filters:[{dataIndex:"id",values:[m],type:"and"},{dataIndex:"version",values:[S],type:"and"}]}).then(function(h){var L=h.data.data.records[0],G=L.configJson;return L.configJson=JSON.parse(G),L}));case 1:case"end":return p.stop()}},c)})),W.apply(this,arguments)}}}]);
