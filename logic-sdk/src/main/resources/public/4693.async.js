"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[4693],{55104:function(ct,q,t){var $=t(54306),g=t.n($),J=t(70517),w=t(90010),U=t.n(w),K=t(23620),A=t(52943),a=t(87363),V=t.n(a),y=t(94744),F=t(84191),R=t(83195),k=t(33358),c=t(49500),x=t(16123),r=t(33130),E=function(Z){var h=(0,a.useContext)(R.r),S=h.logic,X=(0,a.useState)(),et=g()(X,2),it=et[0],pt=et[1];function G(L,P,I){L==="formSubmited"&&(console.log("\u5185\u90E8\u8868\u5355\u63D0\u4EA4\u4E86",I),Z.onSubmit(I))}(0,a.useEffect)(function(){var L=it==null?void 0:it.getComponentByName("page1.form1");console.log("update values",Z.values),L==null||L.props.store.clear(),L==null||L.props.store.setValues(Z.values)},[Z.config,Z.values]);var W=(0,a.useState)(),nt=g()(W,2),C=nt[0],_=nt[1];function rt(L){L.type=="editor"&&L.language=="javascript"?L.editorDidMount=function(P,I){if(_(I),S){var Y,at,dt,Q;console.log("editor autotip by logic");var ht=y.y.getJsonByParams((Y=S.variables)!==null&&Y!==void 0?Y:[]),ot=(0,F.k)("_var",ht),yt=y.y.getJsonByParams((at=S.params)!==null&&at!==void 0?at:[]),mt=(0,F.k)("_par",yt),Nt=y.y.getJsonByParams((dt=S.returns)!==null&&dt!==void 0?dt:[]),Ct=(0,F.k)("_ret",Nt),Dt=y.y.getJsonByParams((Q=S.envs)!==null&&Q!==void 0?Q:[]),Ft=(0,F.k)("_env",Dt);I==null||I.languages.typescript.javascriptDefaults.addExtraLib(ot,"var.ts"),I==null||I.languages.typescript.javascriptDefaults.addExtraLib(mt,"input.ts"),I==null||I.languages.typescript.javascriptDefaults.addExtraLib(Ct,"return.ts"),I==null||I.languages.typescript.javascriptDefaults.addExtraLib(Ft,"env.ts"),I==null||I.languages.typescript.javascriptDefaults.addExtraLib("let _lastRet:{}","lastRet.ts")}return function(){var Et,Pt;console.log("effect dispose"),P==null||P.dispose(),P==null||(Et=P.current)===null||Et===void 0||Et.dispose(),I==null||(Pt=I.current)===null||Pt===void 0||Pt.dispose()}}:L.body&&L.body.forEach(function(P){rt(P)})}return(0,a.useEffect)(function(){if(Z.config&&Z.config.body){var L,P=Z.config.body[0];(L=P.body)===null||L===void 0||L.forEach(function(I){console.log("deal editor autotip"),rt(I)})}},[Z.config]),(0,a.useEffect)(function(){if(S){var L,P,I,Y;console.log("monaco editor autotip by logic");var at=y.y.getJsonByParams((L=S.variables)!==null&&L!==void 0?L:[]),dt=(0,F.k)("_var",at),Q=y.y.getJsonByParams((P=S.params)!==null&&P!==void 0?P:[]),ht=(0,F.k)("_par",Q),ot=y.y.getJsonByParams((I=S.returns)!==null&&I!==void 0?I:[]),yt=(0,F.k)("_ret",ot),mt=y.y.getJsonByParams((Y=S.envs)!==null&&Y!==void 0?Y:[]),Nt=(0,F.k)("_env",mt);C==null||C.languages.typescript.javascriptDefaults.addExtraLib(dt,"var.ts"),C==null||C.languages.typescript.javascriptDefaults.addExtraLib(ht,"input.ts"),C==null||C.languages.typescript.javascriptDefaults.addExtraLib(yt,"return.ts"),C==null||C.languages.typescript.javascriptDefaults.addExtraLib(Nt,"env.ts"),C==null||C.languages.typescript.javascriptDefaults.addExtraLib("let _lastRet:{}","lastRet.ts")}},[S,S==null?void 0:S.params,S==null?void 0:S.variables,S==null?void 0:S.returns,S==null?void 0:S.envs]),(0,r.jsxs)("div",{children:[(0,r.jsx)(A.qR,{theme:"cxd",position:"top-right",locale:"zh-CN"},"toast"),(0,r.jsx)(A.wx,{theme:"cxd",locale:"zh-CN"},"alert"),(0,K.sYA)(Z==null?void 0:Z.config,{onBroadcast:G,data:Z.values,scopeRef:function(P){return pt(P)}},{fetcher:function(P){var I=P.url,Y=P.method,at=P.data,dt=P.responseType,Q=P.config,ht=P.headers;return Q=Q||{},Q.withCredentials=!0,dt&&(Q.responseType=dt),Q.cancelExecutor&&(Q.cancelToken=new J.Z.CancelToken(Q.cancelExecutor)),Q.headers=ht||{},Y!=="post"&&Y!=="put"&&Y!=="patch"?(at&&(Q.params=at),J.Z[Y](I,Q)):(at&&at instanceof FormData?(Q.headers=Q.headers||{},Q.headers["Content-Type"]="multipart/form-data"):at&&typeof at!="string"&&!(at instanceof Blob)&&!(at instanceof ArrayBuffer)&&(at=JSON.stringify(at),Q.headers=Q.headers||{},Q.headers["Content-Type"]="application/json"),J.Z[Y](I,at,Q))},isCancel:function(P){return J.Z.isCancel(P)},copy:function(P){U()(P),A.Am.success("\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u7C98\u8D34\u677F")},theme:"cxd",jumpTo:function(P,I){debugger;I.blank==!0?window.open(window.location.origin+window.location.pathname+"#"+P,"_blank"):window.location.hash=P}})]})};q.Z=V().memo(E)},72107:function(ct,q,t){t.d(q,{Ld:function(){return $},Iz:function(){return y},Du:function(){return F},dO:function(){return k},z1:function(){return B},X0:function(){return V},_w:function(){return Z}});var $=function(h){return h.TypeAnnotation="TypeAnnotation",h.Structure="Structure",h.StructureProperty="StructureProperty",h.TypeParam="TypeParam",h.Variable="Variable",h.Logic="Logic",h.LogicItem="LogicItem",h}({}),g=function(h){return h.start="start",h.end="end",h.switch="switch",h["switch-case"]="switch-case",h["switch-def"]="switch-def",h["mqtt-pub"]="mqtt-pub",h["mqtt-sub"]="mqtt-sub",h["mqtt-unsub"]="mqtt-unsub",h["mqtt-client"]="mqtt-client",h["mqtt-server"]="mqtt-server",h["mqtt-broker"]="mqtt-broker",h.http="http",h.logic="logic",h.js="js",h.wait="wait",h}({}),J=t(63466),w=t.n(J),U=t(21140),K=t.n(U),A=t(52510),a=t.n(A),V=w()(function h(S){K()(this,h),a()(this,"concept",void 0),a()(this,"name",void 0),a()(this,"label",void 0),a()(this,"description",void 0),a()(this,"typeAnnotation",void 0),a()(this,"required",!1),a()(this,"defaultValue",void 0),this.concept=$.StructureProperty,this.name=S}),y=w()(function h(S){K()(this,h),a()(this,"concept",$.Logic),a()(this,"schemeVersion",void 0),a()(this,"version",void 0),a()(this,"id",void 0),a()(this,"name",void 0),a()(this,"label",void 0),a()(this,"description",void 0),a()(this,"triggerType",void 0),a()(this,"cron",void 0),a()(this,"typeParams",void 0),a()(this,"params",void 0),a()(this,"returns",void 0),a()(this,"variables",void 0),a()(this,"envs",void 0),a()(this,"items",[]),a()(this,"visualConfig",void 0),this.id=S,this.schemeVersion="0.1"}),F=w()(function h(S,X){var et=this;K()(this,h),a()(this,"concept","LogicItem"),a()(this,"id",void 0),a()(this,"name",void 0),a()(this,"type",void 0),a()(this,"label",void 0),a()(this,"description",void 0),a()(this,"params",void 0),a()(this,"returns",void 0),a()(this,"envs",void 0),a()(this,"afterReturnAdaptor",void 0),a()(this,"returnAccept",void 0),a()(this,"nextId",void 0),a()(this,"endId",void 0),a()(this,"condition",void 0),a()(this,"script",void 0),a()(this,"timeout",void 0),a()(this,"branches",void 0),a()(this,"url",void 0),a()(this,"method",void 0),a()(this,"headers",void 0),a()(this,"queryParams",void 0),a()(this,"body",void 0),a()(this,"setEnv",function(it){et.envs=it}),this.type=X,this.id=S}),R=null,k=w()(function h(S){K()(this,h),a()(this,"concept","Param"),a()(this,"name",void 0),a()(this,"description",void 0),a()(this,"typeAnnotation",void 0),a()(this,"required",void 0),a()(this,"defaultValue",void 0),this.name=S}),c=t(58853),x=t.n(c),r=t(38888),E=t.n(r),B=function(h){x()(X,h);var S=E()(X);function X(et){var it;return K()(this,X),it=S.call(this,et),it.concept="Return",it}return w()(X)}(k),Z=function(h){x()(X,h);var S=E()(X);function X(et){var it;return K()(this,X),it=S.call(this,et),it.concept="Variable",it}return w()(X)}(k)},94744:function(ct,q,t){t.d(q,{y:function(){return F}});var $=t(37635),g=t.n($),J=t(21140),w=t.n(J),U=t(63466),K=t.n(U),A=t(72107),a=t(52510),V=t.n(a),y=K()(function R(k){w()(this,R),V()(this,"concept","EnvParam"),V()(this,"name",void 0),V()(this,"description",void 0),V()(this,"typeAnnotation",void 0),V()(this,"required",!1),V()(this,"defaultValue",void 0),this.name=k}),F=function(){function R(){w()(this,R)}return K()(R,null,[{key:"valueToTypeAnnotaion",value:function(c){var x=this,r={concept:A.Ld.TypeAnnotation,typeKind:"primitive",typeName:"string",defaultValue:c};if(Array.isArray(c))r.typeName="array";else{var E=g()(c);switch(E){case"boolean":r.typeKind="primitive",r.typeName="boolean";break;case"number":r.typeKind="primitive",r.typeName="number";break;case"string":r.typeKind="primitive",r.typeName="string";break;case"object":c==null?r.typeName="null":c instanceof Date?(r.typeKind="primitive",r.typeName="date"):c instanceof RegExp?(r.typeKind="primitive",r.typeName="regexp"):c instanceof Function?(r.typeKind="primitive",r.typeName="function"):(r.typeKind="anonymousStructure",r.typeName="object",r.properties=[],Object.keys(c).map(function(B){var Z,h=c[B],S=x.valueToTypeAnnotaion(h),X=new A.X0(B);X.typeAnnotation=S,X.defaultValue=h,(Z=r.properties)===null||Z===void 0||Z.push(X)}));break;default:r.typeKind="unknown",r.typeName=E;break}}return r}},{key:"typeAnnotaionToValue",value:function(c){var x,r,E=this,B;switch(c.typeName){case"array":B=(x=c.defaultValue)!==null&&x!==void 0?x:[];break;case"boolean":B=c.defaultValue?c.defaultValue=="true":!1;break;case"number":B=parseFloat(c.defaultValue);break;case"null":B=null;break;case"date":B=new Date(c.defaultValue);break;case"regexp":B=new RegExp(c.defaultValue);break;case"object":B={},(r=c.properties)===null||r===void 0||r.forEach(function(Z){B[Z.name]=E.typeAnnotaionToValue(Z.typeAnnotation)});break;case"string":case"function":default:B=c.defaultValue;break}return B}},{key:"getParamArrayByJson",value:function(c){var x=[];return c&&Object.keys(c).forEach(function(r){var E=new A.dO(r);E.typeAnnotation=R.valueToTypeAnnotaion(c[r]),E.defaultValue=c[r],x.push(E)}),x}},{key:"getReturnArrayByJson",value:function(c){var x=[];return c&&Object.keys(c).forEach(function(r){var E=new A.z1(r);E.typeAnnotation=R.valueToTypeAnnotaion(c[r]),E.defaultValue=c[r],x.push(E)}),x}},{key:"getVariableArrayByJson",value:function(c){var x=[];return c&&Object.keys(c).forEach(function(r){var E=new A._w(r);E.typeAnnotation=R.valueToTypeAnnotaion(c[r]),E.defaultValue=c[r],x.push(E)}),x}},{key:"getEnvsArrayByJson",value:function(c){var x=[];return c&&Object.keys(c).forEach(function(r){var E=new y(r);E.typeAnnotation=R.valueToTypeAnnotaion(c[r]),E.defaultValue=c[r],x.push(E)}),x}},{key:"getJsonByParams",value:function(c){var x=this,r={};return c==null||c.forEach(function(E){r[E.name]=E.typeAnnotation?x.typeAnnotaionToValue(E.typeAnnotation):E.defaultValue}),r}}]),R}()},84191:function(ct,q,t){t.d(q,{k:function(){return w}});var $=t(37635),g=t.n($),J=function U(K){var A="{";return Object.keys(K).forEach(function(a){var V=K[a];A+="".concat(a,":"),Array.isArray(V)?A+="[],":g()(V)=="object"?A+=U(V)+",":typeof V=="string"?A+="'".concat(V,"',"):A+="".concat(V,",")}),A+="}",A},w=function(K,A){var a="";A&&(Object.keys(A).forEach(function(y){var F=A[y];a+="".concat(y,":"),Array.isArray(F)?a+="[],":g()(F)=="object"?a+=J(F)+",":typeof F=="string"?a+="'".concat(F,"',"):a+="".concat(F,",")}),a=a.substring(0,a.length-1));var V="const ".concat(K,"={").concat(a,"}");return V}},83195:function(ct,q,t){t.d(q,{r:function(){return zt},Z:function(){return pe}});var $=t(57213),g=t.n($),J=t(93525),w=t.n(J),U=t(21140),K=t.n(U),A=t(63466),a=t.n(A),V=t(68608),y=t.n(V),F=t(58853),R=t.n(F),k=t(38888),c=t.n(k),x=t(52510),r=t.n(x),E=t(22465),B=t(14990),Z=t(72237),h=t(11150),S=t(93853),X=t(28110),et=t(5671),it=t(9722),pt=t(17696),G=t(19227),W=t(75476),nt=t(1167),C=t(22046),_=t(22150),rt=t(11250),L=t(43702),P=t(58856),I=t(40767),Y=t(75904),at=t(29830),dt=t(46464),Q=t(32246),ht=t(47097),ot=t(87363),yt=t.n(ot),mt=t(72107),Nt=null;function Ct(s,n,d,N){var e,M,b=s.data.config,j=b.type,p=d.flatMap(function(u){return u.source.cell===s.id?n[u.target.cell]:[]}),m=s.attrs,O=new mt.Du((e=s.id)!==null&&e!==void 0?e:"",j);if(O=g()(g()({},b),{},{id:s.id,name:m==null||(M=m.text)===null||M===void 0?void 0:M.text}),!(N.findIndex(function(u){return u.id===O.id})>-1)&&(N.push(O),p.length!==0))switch(j){default:if(p.length>1||O.type==="switch"){var f;console.log((f=s.data)===null||f===void 0?void 0:f.config),console.log(p),O.branches=[],p.forEach(function(u){var o,v,D,z;console.log((o=u.data)===null||o===void 0?void 0:o.config),(v=O.branches)===null||v===void 0||v.push({when:(D=u.data)===null||D===void 0||(z=D.config)===null||z===void 0?void 0:z.case,nextId:u.id}),Ct(n[u.id],n,d,N)})}else O.nextId=p[0].id,Ct(n[p[0].id],n,d,N);break}}function Dt(s,n){var d=new mt.Iz(s),N=[],e=[],M={},b=void 0;if(n.forEach(function(j){var p=j.id||"";if(j.shape==="edge")N.push(j);else{var m=j.attrs;M[p]=j,e.push(j),j.data.config.type==="start"&&(b=j)}}),!b){L.ZP.error("\u672A\u53D1\u73B0\u5F00\u59CB\u8282\u70B9\uFF0C\u8BF7\u914D\u7F6E\uFF01");return}return Ct(b,M,N,d.items),console.log("logic.items"),console.log(d.items),d}function Ft(s){var n=[];return s.items.forEach(function(d){var N={id:d.id,shape:d.type,size:{width:80,height:40},data:{config:d},attrs:{text:{text:d.name}}};if(n.push(N),d.branches&&d.branches.length>0)d.branches.forEach(function(M){var b={shape:"edge",source:{cell:d.id},target:{cell:M.nextId},labels:[{position:.5,attrs:{label:{text:M.when}}}]};n.push(b)});else if(d.nextId){var e={shape:"edge",source:{cell:d.id},target:{cell:d.nextId}};n.push(e)}}),n}var Et=t(5981),Pt=t(32125),Tt=t(97944),Vt=t(97563),Wt=t(86965),l=t(33130);function Kt(s){var n=[{key:"sharps-panel",label:(0,l.jsx)(Et.Z,{style:{fontSize:"20px",marginTop:10}}),children:(0,l.jsx)("div",{ref:s.refStencil,style:{margin:0,height:"100vh",width:"100%"}})},{key:"logic",label:(0,l.jsx)(Pt.Z,{style:{fontSize:"20px",marginTop:10}}),children:(0,l.jsxs)("div",{style:{margin:0,height:"100vh"},children:[(0,l.jsx)(Vt.Z,{title:"\u7528\u4E8E\u89E3\u6790\u6267\u884C\u7F16\u6392\u7684\u903B\u8F91\u3002",children:(0,l.jsx)("h3",{children:"Logic DSL"})}),(0,l.jsx)(Tt.ZP,{defaultLanguage:"json",options:{lineNumbers:"off",lineDecorationsWidth:0,minimap:{enabled:!1}},value:JSON.stringify(s.logic),onChange:s.onConfigChange})]})}];return(0,l.jsx)(Wt.Z,{tabPosition:"left",style:{margin:0},items:n,tabBarStyle:{width:50,margin:0}})}var Ut=Kt,kt=t(54306),St=t.n(kt),Lt=t(55104),At=t(70256),Bt=function(s){var n,d=(0,ot.useState)({type:"form"}),N=St()(d,2),e=N[0],M=N[1],b=(0,ot.useState)({}),j=St()(b,2),p=j[0],m=j[1],O=s.configSchemaProvider,f=function(v){var D,z,i;(D=s.editNode)===null||D===void 0||D.setAttrByPath("text/text",v.name);var T=(z=s.editNode)===null||z===void 0?void 0:z.data.config;s.editNode&&(console.log("update graph data",v),s.editNode.setData({config:g()(g()({},T),v)},{overwrite:!0})),console.log("submit---props.editNode.data.config"),console.log((i=s.editNode)===null||i===void 0?void 0:i.data.config),s==null||s.onSubmit()},u=function(v){if(v&&v.data){var D,z=v.data.config||{},i=v.attrs;return z.name=i==null||(D=i.text)===null||D===void 0?void 0:D.text,z}else return{name:""}};return(0,ot.useEffect)(function(){if(s.editNode&&s.editNode.data){var o=s.editNode.data.config||{};(0,At.CD)(s.editNode.data.configSchema||o.type).then(function(v){console.log("nodeConfigSchema"),console.log(v),M(v)})}},[s.editNode]),(0,ot.useEffect)(function(){var o,v,D=((o=s.editNode)===null||o===void 0?void 0:o.data.config)||{},z=g()({},D),i=(v=s.editNode)===null||v===void 0?void 0:v.attrs;i&&i.text&&i.text.text&&(z.name=i.text.text),m(z)},[e,(n=s.editNode)===null||n===void 0?void 0:n.data]),(0,l.jsx)(Lt.Z,{config:e,values:g()({},p),onSubmit:f})};function Gt(s){var n=[{key:"1",label:"\u8282\u70B9\u914D\u7F6E",children:(0,l.jsx)("div",{style:{padding:5},children:(0,l.jsx)(Bt,{editNode:s.editNode,onSubmit:s.onSubmit})})}];return(0,l.jsxs)("div",{style:{margin:0,height:"95vh",overflowY:"scroll"},children:[(0,l.jsx)(Bt,{logic:s.logic,editNode:s.editNode,onSubmit:s.onSubmit}),s!=null&&s.isCollapsed?"":(0,l.jsx)(Y.ZP,{type:"text",style:{position:"absolute",top:10,right:15,fontSize:20,textAlign:"center"},onClick:function(){s==null||s.onClose()},children:"x"})]})}var Yt=Gt,Ht=t(10486),Rt=t(14232),Xt=t(37555),Qt=function(n){var d=(0,ot.useState)({type:"page"}),N=St()(d,2),e=N[0],M=N[1];(0,ot.useEffect)(function(){(0,At.CD)(n.formId).then(function(j){M(j)})},[n.formId]);function b(j,p,m){console.log(j),console.log(m),j==="formSubmited"&&(console.log("\u5185\u90E8\u8868\u5355\u63D0\u4EA4\u4E86"),n.onSubmit(m))}return(0,l.jsx)(Lt.Z,g()(g()({},n),{},{config:e}))},It=Qt,gt=t(94744),$t=function(n){var d,N=(0,ot.useState)({}),e=St()(N,2),M=e[0],b=e[1];(0,ot.useEffect)(function(){var p=n.values,m=p.params,O=p.variables,f=p.envs,u=p.returns;b({params:JSON.stringify(gt.y.getJsonByParams(m)),variables:JSON.stringify(gt.y.getJsonByParams(O)),returns:JSON.stringify(gt.y.getJsonByParams(u)),envs:JSON.stringify(gt.y.getJsonByParams(f))})},[n.values]);var j=(0,ot.useCallback)(function(p){try{return JSON.parse(p),!0}catch(m){return!1}},[]);return(0,l.jsxs)("span",{children:[n.children,(0,l.jsx)(dt.Z,{open:(d=n.open)!==null&&d!==void 0?d:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return n==null?void 0:n.setOpen(!1)},children:(0,l.jsx)(It,{formId:"logic-setting",values:M,onSubmit:function(m){console.log("\u63D0\u4EA4\u53C2\u6570"),console.log(m);var O=!1;Object.keys(m).forEach(function(f){var u=m[f];if(!j(u)){var o=f==="params"?"\u5165\u53C2":f==="variables"?"\u5C40\u90E8\u53D8\u91CF":f==="returns"?"\u8FD4\u56DE\u53C2\u6570":"\u73AF\u5883\u53D8\u91CF";return L.ZP.error("".concat(o,"json\u683C\u5F0F\u9519\u8BEF")),O=!0,!1}}),O||(n!=null&&n.onSubmit&&n.onSubmit(m),n==null||n.setOpen(!1))}})})]})},_t=$t,xt=t(36808),qt=function(n,d){var N,e,M,b,j=d.getData(),p=d.getPosition(),m=n.getNodes(),O;if(["ExtSharp","polygon"].indexOf(d.shape)>-1)switch(j.config.type){case"switch":var f=200,u=n.addNode({shape:"switch",position:p,width:f,height:50,ports:xt.Tt,data:d.data,attrs:{body:{stroke:"#8f8f8f",strokeWidth:1,fill:"#fff",rx:6,ry:6}}});n.removeNode(d);var o=n.addNode({shape:"switch-case",position:{y:p.y+100,x:p.x-f/2},width:120,height:50,ports:xt.Tt,data:{config:{type:"switch-case"}}}),v=n.addNode({shape:"switch-default",position:{y:p.y+100,x:p.x+f},width:120,height:50,ports:xt.Tt,data:{config:{type:"switch-default"}}}),D=n.addEdge({source:u,sourcePort:(N=u.ports.items.find(function(lt){return lt.group=="bottom"}))===null||N===void 0?void 0:N.id,target:o,targetPort:(e=o.ports.items.find(function(lt){return lt.group=="top"}))===null||e===void 0?void 0:e.id,zIndex:0}),z=n.addEdge({source:u,sourcePort:(M=u.ports.items.find(function(lt){return lt.group=="bottom"}))===null||M===void 0?void 0:M.id,target:v,targetPort:(b=v.ports.items.find(function(lt){return lt.group=="top"}))===null||b===void 0?void 0:b.id,zIndex:0});O=u;break;case"switch-case":var i=n.createNode({shape:"switch-case",position:d.position(),width:120,height:50,ports:xt.Tt,data:d.data});n.removeNode(d),n.addNode(i),O=i;break;case"string":var T=n.createNode({shape:"string",position:d.position(),width:100,height:50,ports:xt.Tt,data:d.data});n.removeNode(d),n.addNode(T),O=T;break;case"num":var H=n.createNode({shape:"num",position:d.position(),width:100,height:50,ports:xt.Tt,data:d.data});n.removeNode(d),n.addNode(H),O=H;break;case"assignment":var tt=n.createNode({shape:"assignment",position:d.position(),width:220,height:50,ports:xt.Tt,data:d.data});n.removeNode(d),n.addNode(tt),O=tt;break;default:break}if(console.log("node:added"),O&&m.length==1){var st,ut,vt,ft,bt;n.addEdge({source:m[0],sourcePort:(st=m[0].ports.items.find(function(lt){return lt.group=="bottom"}))===null||st===void 0?void 0:st.id,target:O,targetPort:(ut=O)===null||ut===void 0||(vt=ut.ports)===null||vt===void 0||(ft=vt.items)===null||ft===void 0||(bt=ft.find(function(lt){return lt.group=="top"}))===null||bt===void 0?void 0:bt.id,zIndex:0})}},te=t(59998),ee=t(788),ne=function(n){var d,N=(0,ee.cI)();(0,ot.useEffect)(function(){var b=n.values.params;N.setValues({params:JSON.stringify(gt.y.getJsonByParams(b))})},[n.values]);var e=(0,ot.useCallback)(function(b){try{return JSON.parse(b),!0}catch(j){return!1}},[]);function M(b){var j=!1;Object.keys(b).forEach(function(p){var m=b[p];if(["params","headers"].indexOf(p)>-1&&!e(m)){var O=p==="params"?"\u5165\u53C2":"\u8BF7\u6C42\u5934";return L.ZP.error("".concat(O,"json\u683C\u5F0F\u9519\u8BEF")),j=!0,!1}}),j||(n!=null&&n.onSubmit&&n.onSubmit(b,b.debugType),n==null||n.setOpen(!1))}return(0,l.jsxs)("span",{children:[n.children,(0,l.jsx)(dt.Z,{open:(d=n.open)!==null&&d!==void 0?d:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return n==null?void 0:n.setOpen(!1)},children:(0,l.jsx)(It,{formId:"logic-debug-input",onSubmit:M})})]})},ae=ne,oe=t(61719),ie=t(47503),re=t(49425),ye=null,se=function(n){var d=(0,Tt.Ik)(),N=(0,ot.useState)(!1),e=St()(N,2),M=e[0],b=e[1];return(0,l.jsx)("div",{style:{width:"100%"},children:M?(0,l.jsx)(ie.Z,{title:"js\u7F16\u8F91\u5668",centered:!0,width:1200,bodyStyle:{height:"80vh"},open:M,footer:null,onCancel:function(){return b(!1)},children:(0,l.jsx)(Tt.ML,g()(g()({theme:"vs-dark",defaultValue:n.value,defaultLanguage:n.language,options:{minimap:{enabled:!1}}},n),{},{height:"100%"}))}):(0,l.jsxs)("div",{children:[(0,l.jsx)(Tt.ML,g()({className:"editorByLoader",theme:"vs-dark",defaultValue:n.value,defaultLanguage:n.language,onMount:function(p){var m;(m=p.getAction("editor.action.formatDocument"))===null||m===void 0||m.run(),p.setValue(p.getValue())},options:{minimap:{enabled:!1}},height:500},n)),(0,l.jsx)(Y.ZP,{size:"small",type:"text",icon:(0,l.jsx)(re.Z,{}),style:{position:"absolute",top:0,right:0,margin:"10px",color:"whitesmoke"},onClick:function(){return b(!0)}})]})})},le=yt().memo(se),de=t(5726),ue=t.n(de),Zt=t(23620),ce=t(71731),jt=t(70517),ve=t(90010),fe=t.n(ve),Ot=t(52943),xe=t(33358),be=t(49500),Se=t(16123);jt.Z.interceptors.response.use(function(s){return console.log("axios response"),console.log(s),s&&s.data?(console.log("--\u8BF7\u6C42\u672A\u62A5\u9519\uFF0C\u9002\u914Dstatus=0"),s.data.error||(s.data.error={code:0}),s.data.status=0,s.data.data&&s.data.data.records&&(s.data.data.items=s.data.data.records),s):(console.log("--\u8FD4\u56DE\u6570\u636E\u4E3A\u7A7A\uFF0C\u5224\u65AD\u4E3A\u5F02\u5E38"),console.log(s.data),Promise.reject(new Error(s.data.message)))},function(s){if(console.log("\u6355\u6349axios error"),console.log(s),s.response&&s.response.data){var n,d=s.response;return console.log("--data\u6709\u8FD4\u56DE\u503C\uFF0C\u5224\u5B9A\u4E3A\u4E1A\u52A1\u5F02\u5E38\uFF0C\u7EE7\u7EED\u8FD4\u56DEresponse,\u9002\u914Dstatus=500\uFF01"),((n=s.response.data.error)===null||n===void 0?void 0:n.code)==0&&(s.response.data.error.code=500),console.log(d),d}return Promise.reject(s)});var he=function(n){var d=(0,ot.useState)({type:"page"}),N=St()(d,2),e=N[0],M=N[1],b="cxd",j="zh-CN";return(0,ot.useEffect)(function(){(0,At.UD)(n.pageId).then(function(p){M(p)})},[n.pageId]),(0,l.jsxs)("div",{children:[(0,l.jsx)(Ot.qR,{theme:b,position:"top-right",locale:j},"toast"),(0,l.jsx)(Ot.wx,{theme:b,locale:j},"alert"),(0,Zt.sYA)(e,{data:n.data},{fetcher:function(m){var O=m.url,f=m.method,u=m.data,o=m.responseType,v=m.config,D=m.headers;return v=v||{},v.withCredentials=!0,o&&(v.responseType=o),v.cancelExecutor&&(v.cancelToken=new jt.Z.CancelToken(v.cancelExecutor)),v.headers=D||{},f!=="post"&&f!=="put"&&f!=="patch"?(u&&(v.params=u),jt.Z[f](O,v)):(u&&u instanceof FormData?(v.headers=v.headers||{},v.headers["Content-Type"]="multipart/form-data"):u&&typeof u!="string"&&!(u instanceof Blob)&&!(u instanceof ArrayBuffer)&&(u=JSON.stringify(u),v.headers=v.headers||{},v.headers["Content-Type"]="application/json"),jt.Z[f](O,u,v))},isCancel:function(m){return jt.Z.isCancel(m)},copy:function(m){fe()(m),Ot.Am.success("\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u7C98\u8D34\u677F")},theme:b,jumpTo:function(m,O){debugger;O.blank==!0?window.open(window.location.origin+window.location.pathname+"#"+m,"_blank"):window.location.hash=m}})]})},Mt=he,ge=[{key:"saveToPng",label:"\u5BFC\u51FA\u56FE\u7247"},{key:"saveToClipboard",label:"\u590D\u5236\u5230\u526A\u8D34\u677F"}],zt=yt().createContext({logic:new mt.Iz("")}),Jt=function(n,d){for(var N=0,e=n.length;N<e;N+=1)n[N].style.visibility=d?"visible":"hidden"},pe=function(s){R()(d,s);var n=c()(d);function d(N){var e;K()(this,d),e=n.call(this,N),r()(y()(e),"container",void 0),r()(y()(e),"stencilContainer",void 0),r()(y()(e),"state",{editingNode:void 0,openEdgeEditor:!1,embeddingEnable:!1,editingEdge:void 0,leftToolCollapsed:!1,rightToolCollapsed:!0,openFlowSetting:!1,openRunLogic:!1,editorCtx:{logic:new mt.Iz("1")},logs:[],panel:{nodes:[],groups:[]}}),r()(y()(e),"handleEdgeSubmit",function(f){var u;(u=e.state.editingEdge)===null||u===void 0||u.setLabels(f)}),r()(y()(e),"initGraph",function(f){var u,o=new et.kJ({container:f,embedding:{enabled:e.state.embeddingEnable,validate:function(T){return T.child.setData({hoverNode:T.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new et.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(T){var H=T.targetMagnet;return!!H}},background:{color:"#F2F7FA"},grid:!0});o.use(new nt.H({enabled:!0,sharp:!0})).use(new pt.A({enabled:!0})).use(new W.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new _.T({enabled:!0})).use(new G.N).use(new it.T).use(new rt.D).use(new ce.w({resizing:{enabled:!0,minWidth:50,maxWidth:200,minHeight:50,maxHeight:50,orthogonal:!1,restrict:!1,preserveAspectRatio:!1}})),o.on("edge:dblclick",function(i){var T=i.cell}),o.on("edge:mouseenter",function(i){var T=i.cell;T.addTools([{name:"button-remove",args:{distance:-40}}])}),o.on("edge:mouseleave",function(i){var T=i.cell;T.removeTools()}),o.on("node:moved",function(i){var T,H=i.e,tt=i.x,st=i.y,ut=i.node,vt=i.view,ft=(T=ut.data)===null||T===void 0?void 0:T.hoverNode;if(e.state.embeddingEnable&&ft){var bt,lt,me=o.createEdge({source:ft,sourcePort:(bt=ft.ports.items.find(function(wt){return wt.group=="bottom"}))===null||bt===void 0?void 0:bt.id,target:ut,targetPort:(lt=ut.ports.items.find(function(wt){return wt.group=="top"}))===null||lt===void 0?void 0:lt.id,zIndex:0});ut.data.hoverNode=void 0,o.addEdge(me),e.autoLayout(o)}}),o.on("node:mouseenter",function(i){var T,H,tt,st=i.cell;((T=st.data)===null||T===void 0||(H=T.config)===null||H===void 0?void 0:H.type)!="start"&&st.addTools([{name:"button-remove",args:{x:"100%",y:0,offset:{x:-10,y:10}}}]);var ut=(tt=e.container)===null||tt===void 0?void 0:tt.querySelectorAll(".x6-port-body");Jt(ut,!0)}),o.on("node:mouseleave",function(i){var T,H=i.cell;H.removeTools();var tt=(T=e.container)===null||T===void 0?void 0:T.querySelectorAll(".x6-port-body");Jt(tt,!1)}),o.on("node:click",function(i){var T=i.e,H=i.x,tt=i.y,st=i.node,ut=i.view;st.removeTools(),e.setState({editingNode:st})}),o.on("node:added",function(i){var T=i.node,H=i.index,tt=i.options;qt(o,T)}),o.on("node:dblclick",function(i){var T=i.e,H=i.x,tt=i.y,st=i.node,ut=i.view;e.setState({rightToolCollapsed:!1,editingNode:st})}),o.bindKey(["meta+c","ctrl+c"],function(){var i=o.getSelectedCells();return i.length&&o.copy(i),!1}),o.bindKey(["meta+x","ctrl+x"],function(){var i=o.getSelectedCells();return i.length&&o.cut(i),!1}),o.bindKey(["meta+v","ctrl+v"],function(){if(!o.isClipboardEmpty()){var i=o.paste({offset:32});o.cleanSelection(),o.select(i)}return!1}),o.bindKey(["meta+z","ctrl+z"],function(){return o.canUndo()&&o.undo(),!1}),o.bindKey(["meta+shift+z","ctrl+shift+z"],function(){return o.canRedo()&&o.redo(),!1}),o.bindKey("backspace",function(){var i=o.getSelectedCells();i.length&&(i.find(function(T){var H;return T.data?["start"].indexOf((H=T.data.config)===null||H===void 0?void 0:H.type)>-1:!1})?L.ZP.error("\u7981\u6B62\u5220\u9664\u5F00\u59CB\u8282\u70B9\uFF01"):o.removeCells(i))}),o.on("blank:dblclick",function(i){var T=i.e,H=i.x,tt=i.y;console.log("blank:dbclick",H,tt),e.autoLayout(o)}),o.bindKey(["ctrl+1","meta+1"],function(){var i=o.zoom();i<1.5&&o.zoom(.1)}),o.bindKey(["ctrl+2","meta+2"],function(){var i=o.zoom();i>.5&&o.zoom(-.1)}),e.state.graph=o;var v=e.state.panel.groups,D=new C.t({title:"\u5C55\u5F00/\u6536\u8D77",target:o,search:function(T,H){var tt=T.getAttrByPath("text/text");return(tt==null?void 0:tt.indexOf(H))!==-1},notFoundText:"\u672A\u627E\u5230",collapsable:!0,stencilGraphWidth:250,groups:v,layoutOptions:{rowHeight:100}}),z={};return e.state.panel.nodes.forEach(function(i){var T=o.createNode(i);v.forEach(function(H){i.groups.includes(H.name)&&(z[H.name]?z[H.name].push(T):z[H.name]=[T])})}),Object.keys(z).forEach(function(i){D.load(w()(z[i]),i)}),(u=e.stencilContainer)===null||u===void 0||u.appendChild(D.container),e.props.config?(e.state.editorCtx.logic=e.props.config,o.fromJSON(e.state.editorCtx.logic.visualConfig)):((0,Rt.X)(o),e.autoLayout(o)),o}),r()(y()(e),"autoLayout",function(f){(0,te.V)(f)}),r()(y()(e),"refContainer",function(f){e.container=f}),r()(y()(e),"refStencil",function(f){e.stencilContainer=f}),r()(y()(e),"handleSubmit",function(f){e.saveAndConvertGraphToDsl()}),r()(y()(e),"handleOnConfigChange",function(f){try{var u=JSON.parse(f);e.setState({stepFlow:u})}catch(o){console.log(o)}}),r()(y()(e),"onSaveMenuClick",function(f){var u;switch(f.key){case"saveToBrowser":break;case"loadFromBrowser":var o=localStorage.getItem("logic-json");if(o){var v,D=JSON.parse(o);e.state.editorCtx.logic=D,(v=e.state.graph)===null||v===void 0||v.fromJSON(D.visualConfig),e.saveAndConvertGraphToDsl()}else L.ZP.info("\u6D4F\u89C8\u5668\u65E0\u7F13\u5B58\u6570\u636E");break;case"saveToClipboard":try{navigator.clipboard.writeText(JSON.stringify(e.state.editorCtx.logic))}catch(z){console.error(z)}break;case"saveToPng":(u=e.state.graph)===null||u===void 0||u.exportPNG(new Date().toLocaleDateString(),{backgroundColor:"#F2F7FA",padding:10,quality:1});break}}),r()(y()(e),"updateLogicAndEditorCtx",function(f){var u=g()(g()({},e.state.editorCtx.logic),f);return u.version=ue()(Date.now()).format("YYYYMMDDHHmmss"),e.setState({editorCtx:g()(g()({},e.state.editorCtx),{},{logic:u})}),u}),r()(y()(e),"saveAndConvertGraphToDsl",function(){var f,u=(f=e.state.graph)===null||f===void 0?void 0:f.toJSON(),o=e.convertGraphToDsl(u);if(o){var v,D=e.updateLogicAndEditorCtx({items:o.items,visualConfig:o.visualConfig});e.props.config&&(D.id=(v=e.props.config)===null||v===void 0?void 0:v.id),e.props.onSave&&e.props.onSave(D);var z=JSON.stringify(D);localStorage.setItem("logic-"+D.name,z)}}),r()(y()(e),"saveFlowSettingAndConvertGraphToDsl",function(f){var u,o,v,D,z=gt.y.getParamArrayByJson(JSON.parse((u=f.params)!==null&&u!==void 0?u:"{}")),i=gt.y.getReturnArrayByJson(JSON.parse((o=f.returns)!==null&&o!==void 0?o:"{}")),T=gt.y.getVariableArrayByJson(JSON.parse((v=f.variables)!==null&&v!==void 0?v:"{}")),H=gt.y.getEnvsArrayByJson(JSON.parse((D=f.envs)!==null&&D!==void 0?D:"{}")),tt=e.updateLogicAndEditorCtx({params:z,returns:i,variables:T,envs:H}),st=JSON.stringify(tt);localStorage.setItem("logic-json-"+tt.id,st)}),r()(y()(e),"convertGraphToDsl",function(f){var u,o=Dt((u=e.props.config)===null||u===void 0?void 0:u.id,f.cells);return o&&(o.visualConfig=f),o}),r()(y()(e),"setFlowSetting",function(f){e.setState({openFlowSetting:f})});try{var M,b,j=(0,Ht.K)(N.customNodes,N.customGroups,N.customSharps),p=j.Nodes,m=j.Shapes,O=j.Groups;(0,Rt.m)(m),e.state.leftToolCollapsed=!(!((M=N.showLeft)!==null&&M!==void 0)||M),e.state.rightToolCollapsed=!((b=N.showRight)!==null&&b!==void 0&&b),e.state.panel.nodes=p,e.state.panel.groups=O}catch(f){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(f)}return e}return a()(d,[{key:"componentDidUpdate",value:function(e,M,b){if(this.props.config&&this.state.editorCtx.logic.id!=this.props.config.id){var j,p,m,O;this.state.editorCtx.logic=this.props.config,(j=this.state.editorCtx)!==null&&j!==void 0&&(p=j.logic)!==null&&p!==void 0&&p.visualConfig&&((m=this.state.graph)===null||m===void 0||m.fromJSON((O=this.state.editorCtx.logic)===null||O===void 0?void 0:O.visualConfig)),this.setState({editingNode:void 0})}}},{key:"componentDidMount",value:function(){var e;this.initGraph(this.container),this.updateLogicAndEditorCtx((e=this.state.editorCtx)===null||e===void 0?void 0:e.logic)}},{key:"render",value:function(){var e=this,M,b=this.state,j=b.editingNode,p=b.leftToolCollapsed,m=b.rightToolCollapsed,O=b.editorCtx,f=b.embeddingEnable,u=b.graph,o=b.openFlowSetting,v=b.openRunLogic,D=O.logic;return console.log("editorCtx",O),(0,l.jsx)(zt.Provider,{value:O,children:(0,l.jsxs)(P.Z,{style:{height:"100vh",width:"100%",margin:0},children:[(0,l.jsx)(P.Z.Sider,{theme:"light",collapsed:p,collapsedWidth:0,width:300,children:(0,l.jsx)(Ut,{refStencil:this.refStencil,graph:this.state.graph,logic:D,onConfigChange:this.handleOnConfigChange})}),(0,l.jsxs)(P.Z,{style:{height:"100%"},children:[(0,l.jsxs)(P.Z.Header,{style:{padding:0,backgroundColor:"white"},children:[(0,l.jsxs)(I.Z,{direction:"horizontal",children:[(0,l.jsx)(Y.ZP,{type:"text",icon:p?(0,l.jsx)(E.Z,{}):(0,l.jsx)(B.Z,{}),onClick:function(){e.setState({leftToolCollapsed:!p})},style:{fontSize:"16px",width:64,height:64}}),(0,l.jsx)(at.Z.Button,{style:{float:"inline-start"},menu:{items:ge,onClick:this.onSaveMenuClick},buttonsRender:function(i){return[(0,l.jsx)(Y.ZP,{type:"primary",icon:(0,l.jsx)(Z.Z,{}),onClick:e.saveAndConvertGraphToDsl,children:"\u4FDD\u5B58"}),(0,l.jsx)(Y.ZP,{type:"primary",icon:(0,l.jsx)(h.Z,{})})]},children:"\u4FDD\u5B58"}),(0,l.jsx)(_t,{open:o,values:g()({},D),setOpen:this.setFlowSetting,onSubmit:this.saveFlowSettingAndConvertGraphToDsl,children:(0,l.jsx)(Y.ZP,{onClick:function(){return e.setFlowSetting(!0)},icon:(0,l.jsx)(S.Z,{}),children:"\u914D\u7F6E\u53C2\u6570"})}),(M=this.props.btns)===null||M===void 0?void 0:M.map(function(z){return(0,l.jsx)(Y.ZP,g()({},z))}),(0,l.jsx)(ae,{open:v,setOpen:function(i){return e.setState({openRunLogic:i})},values:{params:D==null?void 0:D.params},onSubmit:function(i,T){if(e.setState({openRunLogic:!1}),D){var H=i.params,tt=i.bizId,st=i.headers,ut=i.bizStartCode;(0,oe.L7)(D.id,JSON.parse(H),tt,ut,T,JSON.parse(st)).then(function(vt){vt.data.code==0?dt.Z.success({title:"\u6267\u884C\u6210\u529F",width:"1000px",closable:!0,content:(0,l.jsx)("div",{children:(0,l.jsx)(Mt,{pageId:"debug-info",data:vt.data})})}):dt.Z.error({title:(0,l.jsx)("span",{children:vt.data.msg}),width:"1200px",closable:!0,content:(0,l.jsx)("div",{children:(0,l.jsx)(Mt,{pageId:"debug-info",data:vt.data})})})}).catch(function(vt){var ft=vt.response.data;dt.Z.error({title:(0,l.jsx)("span",{children:ft.msg}),width:"1200px",closable:!0,content:(0,l.jsx)("div",{children:(0,l.jsx)(Q.Z,{children:(0,l.jsx)(ht.Z,{children:(0,l.jsxs)(Q.Z,{children:[(0,l.jsxs)(ht.Z,{span:12,children:[(0,l.jsx)("h4",{children:"\u9519\u8BEF\u8BE6\u7EC6:"}),(0,l.jsx)(Zt.gcu,{src:ft.error,collapsed:1})]}),(0,l.jsxs)(ht.Z,{span:12,children:[(0,l.jsx)("h4",{children:"\u8FD4\u56DE\u6570\u636E:"}),(0,l.jsx)(le,{language:"json",value:JSON.stringify(ft.data),width:500})]})]})})})})})}),e.state.logs.push({data:new Date().toLocaleTimeString()})}},children:(0,l.jsx)(Y.ZP,{type:"default",onClick:function(){e.setState({openRunLogic:!0})},icon:(0,l.jsx)(X.Z,{}),children:"\u8C03\u8BD5"})}),(0,l.jsxs)("span",{children:["\u5F53\u524D\u7248\u672C:",D.version]})]}),(0,l.jsx)(I.Z,{style:{float:"right",right:"16px"}})]}),(0,l.jsx)(P.Z.Content,{className:"app-content",children:(0,l.jsx)(Xt.Z,{ref:this.refContainer})})]}),(0,l.jsx)(P.Z.Sider,{theme:"light",collapsed:m,collapsedWidth:0,width:600,children:(0,l.jsx)(Yt,{logic:D,onClear:function(){return e.setState({logs:[]})},editNode:j,onSubmit:this.handleSubmit,logs:this.state.logs,onClose:function(){e.setState({rightToolCollapsed:!0})},isCollapsed:m})})]})})}}]),d}(yt().Component)},37555:function(ct,q,t){t.d(q,{Z:function(){return w}});var $=t(87363),g=t(33130),J=(0,$.forwardRef)(function(U,K){return(0,g.jsx)("div",{className:"drag-graph",ref:K})}),w=J},59998:function(ct,q,t){t.d(q,{V:function(){return g}});var $=t(59490),g=function(w){var U=new $.Vq({type:"dagre",begin:[400,100],rankdir:"TB",ranksep:20,nodeSize:50,controlPoints:!0}),K=w.getNodes(),A=w.getEdges(),a=U.layout({nodes:K,edges:A}),V=a.nodes,y=V===void 0?[]:V;K.forEach(function(F){var R=y.find(function(k){return k.id===F.id});R.x-=F.size().width/2,R.y-=F.size().height/2,F.position(R.x,R.y)})}},36808:function(ct,q,t){t.d(q,{Hi:function(){return J},Tt:function(){return $}});var $={groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]},g={groups:{right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1}},items:[{group:"right"}]},J={groups:{bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1}},items:[{group:"bottom"}]}},14232:function(ct,q,t){t.d(q,{X:function(){return r},m:function(){return x}});var $=t(5671),g=t(95812),J=t(54882),w={customNode:"customNode___AyPI8",input:"input___Q5PmS",switchNode:"switchNode___fqB9a"},U=t(33130),K=function(B){return(0,U.jsx)("div",{className:w.customNode,children:(0,U.jsx)(J.Z,{className:"input",value:B==null?void 0:B.data,width:80})})},A=t(42761),a=function(B){return(0,U.jsx)("div",{className:styles.customNode,children:(0,U.jsx)(A.Z,{className:"input",value:B==null?void 0:B.data,width:80})})},V=t(57213),y=t.n(V),F=function(B){var Z,h,S,X=B.node,et=(Z=X.data.config)===null||Z===void 0?void 0:Z.name,it=et||"case";return(0,U.jsxs)("div",{className:w.customNode,children:[(0,U.jsx)("span",{children:"case"}),(0,U.jsx)(J.Z,{addonAfter:et,className:"input",value:X==null||(h=X.data)===null||h===void 0||(S=h.config)===null||S===void 0?void 0:S.case,width:150,onChange:function(G){var W=X.data;X.setData(y()(y()({},W),{},{config:y()(y()({},W.config),{},{case:G.target.value})}))}})]})},R=function(B){var Z,h=B.node;return(0,U.jsx)("div",{className:w.customNode,children:(0,U.jsx)(J.Z,{addonBefore:"switch",className:"input",value:(Z=h.data)===null||Z===void 0?void 0:Z.config.condition,onChange:function(X){var et=h.data;h.setData(y()(y()({},et),{},{config:y()(y()({},et.config),{},{condition:X.target.value})}))},width:100})})},k=t(36808),c=function(B){return(0,U.jsx)("div",{className:w.customNode,children:(0,U.jsx)("div",{style:{textAlign:"center",fontSize:"15px"},children:"default"})})};function x(E){E.forEach(function(B){console.log("\u6CE8\u518C\u65B0\u8282\u70B9:"+B.name),$.kJ.registerNode(B.name,B.config,!0)}),(0,g.z2)({shape:"string",component:K}),(0,g.z2)({shape:"num",component:a}),(0,g.z2)({shape:"switch",component:R}),(0,g.z2)({shape:"switch-case",component:F}),(0,g.z2)({shape:"switch-default",component:c})}function r(E){var B=E.createNode({shape:"circle",label:"start",width:50,height:50,attrs:{body:{}},ports:k.Hi,data:{config:{type:"start"}}});E.addNode(B)}},10486:function(ct,q,t){t.d(q,{K:function(){return A}});var $=t(57213),g=t.n($),J=t(36808),w=50,U=50,K=[{name:"ExtSharp",config:{width:100,height:U,attrs:{body:{rx:6,ry:6,stroke:"#5F95FF",strokeWidth:1,fill:"rgba(95,149,255,0.05)",refWidth:1,refHeight:1},image:{refX:2,refY:0},text:{refX:4,refY:20,fontSize:12,"text-anchor":"start"}},markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}}];function A(a,V,y){var F=50,R=50,k={body:{}},c=[{shape:"circle",width:F,height:R,attrs:{body:g()(g()({},k.body),{},{fill:"white"}),text:{text:"\u4EA4\u4E92\u70B9"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:J.Tt,data:{config:{type:"wait-for-continue"}},groups:["global"]},{shape:"circle",label:"end",width:F,height:R,attrs:{body:g()(g()({},k.body),{},{fill:"#d9d9d9"}),text:{text:"end"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:J.Tt,data:{config:{type:"end"}},groups:["global"]},{shape:"ExtSharp",attrs:{text:{text:"http\u8BF7\u6C42",fontSize:14},image:{"xlink:href":"/icons/http.svg",width:20,x:2,y:2}},data:{config:{type:"http",method:"POST"}},ports:J.Tt,groups:["biz"]},{shape:"ExtSharp",ports:J.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/code.svg"},text:{text:"js\u4EE3\u7801\u5757",fontSize:14}},data:{config:{type:"js"}},groups:["biz"]},{shape:"ExtSharp",ports:J.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/code.svg"},text:{text:"java\u4EE3\u7801\u5757",fontSize:14}},data:{config:{type:"java"}},groups:["biz"]},{shape:"ExtSharp",ports:J.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/CarbonSubflowLocal.svg"},text:{text:"\u590D\u7528\u903B\u8F91",fontSize:14}},data:{config:{type:"sub-logic"}},groups:["biz"]},{shape:"ExtSharp",width:50,height:R,label:"switch",attrs:{image:{"xlink:href":"/icons/switch.svg",width:45,x:1,y:2},text:{text:"switch",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"switch"}},ports:J.Tt,groups:["ctrl"]},{shape:"ExtSharp",width:F,height:R,attrs:{image:{"xlink:href":"/icons/text.svg",width:30,x:8,y:10},text:{text:"case",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"switch-case"}},ports:J.Tt,groups:["ctrl"]},{shape:"ExtSharp",width:F,height:R,attrs:{image:{"xlink:href":"/icons/delay.svg",width:30,x:8,y:10},text:{text:"\u7B49\u5F85",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"wait",timeout:"2000"}},ports:J.Tt,groups:["ctrl"]}];a&&a.length>0&&Array.prototype.push.apply(c,a);var x=[{name:"global",title:"\u5168\u5C40\u8282\u70B9",graphHeight:110},{name:"ctrl",title:"\u903B\u8F91\u63A7\u5236",graphHeight:220},{name:"biz",title:"\u4E1A\u52A1\u8C03\u7528",graphHeight:220}];V&&V.length>0&&Array.prototype.push.apply(x,V);var r=K;return y&&y.length>0&&Array.prototype.push.apply(r,y),{Shapes:r,Nodes:c,Groups:x}}},61719:function(ct,q,t){t.d(q,{_5:function(){return h},dS:function(){return X},XY:function(){return it},L7:function(){return c}});var $=t(57213),g=t.n($),J=t(25359),w=t.n(J),U=t(49811),K=t.n(U),A=t(70517);function a(G,W){return axios.get(G,W)}function V(G,W,nt){return axios.put(G,W,nt)}function y(G,W){return axios.delete(G,W)}function F(G,W,nt){return A.Z.post(G,W,nt)}function R(G,W){return k.apply(this,arguments)}function k(){return k=_asyncToGenerator(_regeneratorRuntime().mark(function G(W,nt){return _regeneratorRuntime().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.abrupt("return",post("/api/runtime/logic/v1/run-fn/".concat(W),nt,{headers:{"Content-Type":"application/json"}}));case 1:case"end":return _.stop()}},G)})),k.apply(this,arguments)}function c(G,W,nt,C,_,rt){return x.apply(this,arguments)}function x(){return x=K()(w()().mark(function G(W,nt,C,_,rt,L){var P;return w()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:P="",Y.t0=rt,Y.next=Y.t0==="bizStepByStep"?4:6;break;case 4:return P="/api/runtime/logic/v1/step-by-step/".concat(W,"/").concat(C,"?debug=true"),Y.abrupt("break",8);case 6:return C?_?P="/api/runtime/logic/v1/biz/".concat(W,"/").concat(_,"/").concat(C,"?debug=true"):P="/api/runtime/logic/v1/run-biz/".concat(W,"/").concat(C,"?debug=true"):P="/api/runtime/logic/v1/run-api/".concat(W,"?debug=true"),Y.abrupt("break",8);case 8:return Y.abrupt("return",F(P,nt,{headers:g()({"Content-Type":"application/json"},L)}));case 9:case"end":return Y.stop()}},G)})),x.apply(this,arguments)}function r(G,W){return E.apply(this,arguments)}function E(){return E=_asyncToGenerator(_regeneratorRuntime().mark(function G(W,nt){return _regeneratorRuntime().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.abrupt("return",axios.post("/api/form/logic_instance/query",{filters:[{dataIndex:"logicId",values:[W],type:"="},{dataIndex:"bizId",values:[nt],type:"="}]}).then(function(rt){var L=rt.data.result.items[0];return L}));case 1:case"end":return _.stop()}},G)})),E.apply(this,arguments)}function B(G){return Z.apply(this,arguments)}function Z(){return Z=_asyncToGenerator(_regeneratorRuntime().mark(function G(W){return _regeneratorRuntime().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.abrupt("return",axios.get("/api/ide/logic-instance/".concat(W)).then(function(_){var rt=_.data.data;return rt}));case 1:case"end":return C.stop()}},G)})),Z.apply(this,arguments)}function h(G){return S.apply(this,arguments)}function S(){return S=K()(w()().mark(function G(W){return w()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.abrupt("return",A.Z.post("/api/form/logic/add",W).then(function(_){var rt=_.data.result;return rt}));case 1:case"end":return C.stop()}},G)})),S.apply(this,arguments)}function X(G){return et.apply(this,arguments)}function et(){return et=K()(w()().mark(function G(W){return w()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.abrupt("return",A.Z.delete("/api/form/logic/delete/".concat(W)).then(function(_){return _.data.result}));case 1:case"end":return C.stop()}},G)})),et.apply(this,arguments)}function it(){return pt.apply(this,arguments)}function pt(){return pt=K()(w()().mark(function G(){var W,nt,C=arguments;return w()().wrap(function(rt){for(;;)switch(rt.prev=rt.next){case 0:return W=C.length>0&&C[0]!==void 0?C[0]:1,nt=C.length>1&&C[1]!==void 0?C[1]:10,rt.abrupt("return",A.Z.post("/api/form/logic/query",{page:W,pageSize:nt}).then(function(L){return L.data}));case 3:case"end":return rt.stop()}},G)})),pt.apply(this,arguments)}},70256:function(ct,q,t){t.d(q,{CD:function(){return a},UD:function(){return K},n4:function(){return y}});var $=t(25359),g=t.n($),J=t(49811),w=t.n(J),U=t(70517);function K(R){return A.apply(this,arguments)}function A(){return A=w()(g()().mark(function R(k){return g()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,U.Z.get("/setting/pages/".concat(k,".json"));case 2:return x.abrupt("return",x.sent.data);case 3:case"end":return x.stop()}},R)})),A.apply(this,arguments)}function a(R){return V.apply(this,arguments)}function V(){return V=w()(g()().mark(function R(k){return g()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,U.Z.get("/setting/forms/".concat(k,".json"));case 2:return x.abrupt("return",x.sent.data);case 3:case"end":return x.stop()}},R)})),V.apply(this,arguments)}function y(R,k){return F.apply(this,arguments)}function F(){return F=w()(g()().mark(function R(k,c){return g()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,U.Z.get("/setting/".concat(k,"s/").concat(c,".json"));case 2:return r.abrupt("return",r.sent.data);case 3:case"end":return r.stop()}},R)})),F.apply(this,arguments)}}}]);
