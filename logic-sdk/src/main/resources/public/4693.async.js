"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[4693],{55104:function(ct,q,t){var $=t(54306),p=t.n($),J=t(70517),w=t(90010),U=t.n(w),K=t(23620),O=t(52943),o=t(87363),V=t.n(o),m=t(94744),F=t(84191),R=t(83195),k=t(33358),v=t(49500),x=t(16123),r=t(33130),E=function(Z){var h=(0,o.useContext)(R.r),S=h.logic,X=(0,o.useState)(),et=p()(X,2),it=et[0],pt=et[1];function G(L,P,I){L==="formSubmited"&&(console.log("\u5185\u90E8\u8868\u5355\u63D0\u4EA4\u4E86",I),Z.onSubmit(I))}(0,o.useEffect)(function(){var L=it==null?void 0:it.getComponentByName("page1.form1");console.log("update values",Z.values),L==null||L.props.store.clear(),L==null||L.props.store.setValues(Z.values)},[Z.config,Z.values]);var W=(0,o.useState)(),nt=p()(W,2),C=nt[0],_=nt[1];function rt(L){L.type=="editor"&&L.language=="javascript"?L.editorDidMount=function(P,I){if(_(I),S){var Y,ot,dt,Q;console.log("editor autotip by logic");var ht=m.y.getJsonByParams((Y=S.variables)!==null&&Y!==void 0?Y:[]),at=(0,F.k)("_var",ht),yt=m.y.getJsonByParams((ot=S.params)!==null&&ot!==void 0?ot:[]),mt=(0,F.k)("_par",yt),Nt=m.y.getJsonByParams((dt=S.returns)!==null&&dt!==void 0?dt:[]),Ct=(0,F.k)("_ret",Nt),Dt=m.y.getJsonByParams((Q=S.envs)!==null&&Q!==void 0?Q:[]),Ft=(0,F.k)("_env",Dt);I==null||I.languages.typescript.javascriptDefaults.addExtraLib(at,"var.ts"),I==null||I.languages.typescript.javascriptDefaults.addExtraLib(mt,"input.ts"),I==null||I.languages.typescript.javascriptDefaults.addExtraLib(Ct,"return.ts"),I==null||I.languages.typescript.javascriptDefaults.addExtraLib(Ft,"env.ts"),I==null||I.languages.typescript.javascriptDefaults.addExtraLib("let _lastRet:{}","lastRet.ts")}return function(){var Et,Pt;console.log("effect dispose"),P==null||P.dispose(),P==null||(Et=P.current)===null||Et===void 0||Et.dispose(),I==null||(Pt=I.current)===null||Pt===void 0||Pt.dispose()}}:L.body&&L.body.forEach(function(P){rt(P)})}return(0,o.useEffect)(function(){if(Z.config&&Z.config.body){var L,P=Z.config.body[0];(L=P.body)===null||L===void 0||L.forEach(function(I){console.log("deal editor autotip"),rt(I)})}},[Z.config]),(0,o.useEffect)(function(){if(S){var L,P,I,Y;console.log("monaco editor autotip by logic");var ot=m.y.getJsonByParams((L=S.variables)!==null&&L!==void 0?L:[]),dt=(0,F.k)("_var",ot),Q=m.y.getJsonByParams((P=S.params)!==null&&P!==void 0?P:[]),ht=(0,F.k)("_par",Q),at=m.y.getJsonByParams((I=S.returns)!==null&&I!==void 0?I:[]),yt=(0,F.k)("_ret",at),mt=m.y.getJsonByParams((Y=S.envs)!==null&&Y!==void 0?Y:[]),Nt=(0,F.k)("_env",mt);C==null||C.languages.typescript.javascriptDefaults.addExtraLib(dt,"var.ts"),C==null||C.languages.typescript.javascriptDefaults.addExtraLib(ht,"input.ts"),C==null||C.languages.typescript.javascriptDefaults.addExtraLib(yt,"return.ts"),C==null||C.languages.typescript.javascriptDefaults.addExtraLib(Nt,"env.ts"),C==null||C.languages.typescript.javascriptDefaults.addExtraLib("let _lastRet:{}","lastRet.ts")}},[S,S==null?void 0:S.params,S==null?void 0:S.variables,S==null?void 0:S.returns,S==null?void 0:S.envs]),(0,r.jsxs)("div",{children:[(0,r.jsx)(O.qR,{theme:"cxd",position:"top-right",locale:"zh-CN"},"toast"),(0,r.jsx)(O.wx,{theme:"cxd",locale:"zh-CN"},"alert"),(0,K.sYA)(Z==null?void 0:Z.config,{onBroadcast:G,data:Z.values,scopeRef:function(P){return pt(P)}},{fetcher:function(P){var I=P.url,Y=P.method,ot=P.data,dt=P.responseType,Q=P.config,ht=P.headers;return Q=Q||{},Q.withCredentials=!0,dt&&(Q.responseType=dt),Q.cancelExecutor&&(Q.cancelToken=new J.Z.CancelToken(Q.cancelExecutor)),Q.headers=ht||{},Y!=="post"&&Y!=="put"&&Y!=="patch"?(ot&&(Q.params=ot),J.Z[Y](I,Q)):(ot&&ot instanceof FormData?(Q.headers=Q.headers||{},Q.headers["Content-Type"]="multipart/form-data"):ot&&typeof ot!="string"&&!(ot instanceof Blob)&&!(ot instanceof ArrayBuffer)&&(ot=JSON.stringify(ot),Q.headers=Q.headers||{},Q.headers["Content-Type"]="application/json"),J.Z[Y](I,ot,Q))},isCancel:function(P){return J.Z.isCancel(P)},copy:function(P){U()(P),O.Am.success("\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u7C98\u8D34\u677F")},theme:"cxd",jumpTo:function(P,I){debugger;I.blank==!0?window.open(window.location.origin+window.location.pathname+"#"+P,"_blank"):window.location.hash=P}})]})};q.Z=V().memo(E)},72107:function(ct,q,t){t.d(q,{Ld:function(){return $},Iz:function(){return m},Du:function(){return F},dO:function(){return k},z1:function(){return B},X0:function(){return V},_w:function(){return Z}});var $=function(h){return h.TypeAnnotation="TypeAnnotation",h.Structure="Structure",h.StructureProperty="StructureProperty",h.TypeParam="TypeParam",h.Variable="Variable",h.Logic="Logic",h.LogicItem="LogicItem",h}({}),p=function(h){return h.start="start",h.end="end",h.switch="switch",h["switch-case"]="switch-case",h["switch-def"]="switch-def",h["mqtt-pub"]="mqtt-pub",h["mqtt-sub"]="mqtt-sub",h["mqtt-unsub"]="mqtt-unsub",h["mqtt-client"]="mqtt-client",h["mqtt-server"]="mqtt-server",h["mqtt-broker"]="mqtt-broker",h.http="http",h.logic="logic",h.js="js",h.wait="wait",h}({}),J=t(63466),w=t.n(J),U=t(21140),K=t.n(U),O=t(52510),o=t.n(O),V=w()(function h(S){K()(this,h),o()(this,"concept",void 0),o()(this,"name",void 0),o()(this,"label",void 0),o()(this,"description",void 0),o()(this,"typeAnnotation",void 0),o()(this,"required",!1),o()(this,"defaultValue",void 0),this.concept=$.StructureProperty,this.name=S}),m=w()(function h(S){K()(this,h),o()(this,"concept",$.Logic),o()(this,"schemeVersion",void 0),o()(this,"version",void 0),o()(this,"id",void 0),o()(this,"name",void 0),o()(this,"label",void 0),o()(this,"description",void 0),o()(this,"triggerType",void 0),o()(this,"cron",void 0),o()(this,"typeParams",void 0),o()(this,"params",void 0),o()(this,"returns",void 0),o()(this,"variables",void 0),o()(this,"envs",void 0),o()(this,"items",[]),o()(this,"visualConfig",void 0),this.id=S,this.schemeVersion="0.1"}),F=w()(function h(S,X){var et=this;K()(this,h),o()(this,"concept","LogicItem"),o()(this,"id",void 0),o()(this,"name",void 0),o()(this,"type",void 0),o()(this,"label",void 0),o()(this,"description",void 0),o()(this,"params",void 0),o()(this,"returns",void 0),o()(this,"envs",void 0),o()(this,"afterReturnAdaptor",void 0),o()(this,"returnAccept",void 0),o()(this,"nextId",void 0),o()(this,"endId",void 0),o()(this,"condition",void 0),o()(this,"script",void 0),o()(this,"timeout",void 0),o()(this,"branches",void 0),o()(this,"url",void 0),o()(this,"method",void 0),o()(this,"headers",void 0),o()(this,"queryParams",void 0),o()(this,"body",void 0),o()(this,"setEnv",function(it){et.envs=it}),this.type=X,this.id=S}),R=null,k=w()(function h(S){K()(this,h),o()(this,"concept","Param"),o()(this,"name",void 0),o()(this,"description",void 0),o()(this,"typeAnnotation",void 0),o()(this,"required",void 0),o()(this,"defaultValue",void 0),this.name=S}),v=t(58853),x=t.n(v),r=t(38888),E=t.n(r),B=function(h){x()(X,h);var S=E()(X);function X(et){var it;return K()(this,X),it=S.call(this,et),it.concept="Return",it}return w()(X)}(k),Z=function(h){x()(X,h);var S=E()(X);function X(et){var it;return K()(this,X),it=S.call(this,et),it.concept="Variable",it}return w()(X)}(k)},94744:function(ct,q,t){t.d(q,{y:function(){return F}});var $=t(37635),p=t.n($),J=t(21140),w=t.n(J),U=t(63466),K=t.n(U),O=t(72107),o=t(52510),V=t.n(o),m=K()(function R(k){w()(this,R),V()(this,"concept","EnvParam"),V()(this,"name",void 0),V()(this,"description",void 0),V()(this,"typeAnnotation",void 0),V()(this,"required",!1),V()(this,"defaultValue",void 0),this.name=k}),F=function(){function R(){w()(this,R)}return K()(R,null,[{key:"valueToTypeAnnotaion",value:function(v){var x=this,r={concept:O.Ld.TypeAnnotation,typeKind:"primitive",typeName:"string",defaultValue:v};if(Array.isArray(v))r.typeName="array";else{var E=p()(v);switch(E){case"boolean":r.typeKind="primitive",r.typeName="boolean";break;case"number":r.typeKind="primitive",r.typeName="number";break;case"string":r.typeKind="primitive",r.typeName="string";break;case"object":v==null?r.typeName="null":v instanceof Date?(r.typeKind="primitive",r.typeName="date"):v instanceof RegExp?(r.typeKind="primitive",r.typeName="regexp"):v instanceof Function?(r.typeKind="primitive",r.typeName="function"):(r.typeKind="anonymousStructure",r.typeName="object",r.properties=[],Object.keys(v).map(function(B){var Z,h=v[B],S=x.valueToTypeAnnotaion(h),X=new O.X0(B);X.typeAnnotation=S,X.defaultValue=h,(Z=r.properties)===null||Z===void 0||Z.push(X)}));break;default:r.typeKind="unknown",r.typeName=E;break}}return r}},{key:"typeAnnotaionToValue",value:function(v){var x,r,E=this,B;switch(v.typeName){case"array":B=(x=v.defaultValue)!==null&&x!==void 0?x:[];break;case"boolean":B=v.defaultValue?v.defaultValue=="true":!1;break;case"number":B=parseFloat(v.defaultValue);break;case"null":B=null;break;case"date":B=new Date(v.defaultValue);break;case"regexp":B=new RegExp(v.defaultValue);break;case"object":B={},(r=v.properties)===null||r===void 0||r.forEach(function(Z){B[Z.name]=E.typeAnnotaionToValue(Z.typeAnnotation)});break;case"string":case"function":default:B=v.defaultValue;break}return B}},{key:"getParamArrayByJson",value:function(v){var x=[];return v&&Object.keys(v).forEach(function(r){var E=new O.dO(r);E.typeAnnotation=R.valueToTypeAnnotaion(v[r]),E.defaultValue=v[r],x.push(E)}),x}},{key:"getReturnArrayByJson",value:function(v){var x=[];return v&&Object.keys(v).forEach(function(r){var E=new O.z1(r);E.typeAnnotation=R.valueToTypeAnnotaion(v[r]),E.defaultValue=v[r],x.push(E)}),x}},{key:"getVariableArrayByJson",value:function(v){var x=[];return v&&Object.keys(v).forEach(function(r){var E=new O._w(r);E.typeAnnotation=R.valueToTypeAnnotaion(v[r]),E.defaultValue=v[r],x.push(E)}),x}},{key:"getEnvsArrayByJson",value:function(v){var x=[];return v&&Object.keys(v).forEach(function(r){var E=new m(r);E.typeAnnotation=R.valueToTypeAnnotaion(v[r]),E.defaultValue=v[r],x.push(E)}),x}},{key:"getJsonByParams",value:function(v){var x=this,r={};return v==null||v.forEach(function(E){r[E.name]=E.typeAnnotation?x.typeAnnotaionToValue(E.typeAnnotation):E.defaultValue}),r}}]),R}()},84191:function(ct,q,t){t.d(q,{k:function(){return w}});var $=t(37635),p=t.n($),J=function U(K){var O="{";return Object.keys(K).forEach(function(o){var V=K[o];O+="".concat(o,":"),Array.isArray(V)?O+="[],":p()(V)=="object"?O+=U(V)+",":typeof V=="string"?O+="'".concat(V,"',"):O+="".concat(V,",")}),O+="}",O},w=function(K,O){var o="";O&&(Object.keys(O).forEach(function(m){var F=O[m];o+="".concat(m,":"),Array.isArray(F)?o+="[],":p()(F)=="object"?o+=J(F)+",":typeof F=="string"?o+="'".concat(F,"',"):o+="".concat(F,",")}),o=o.substring(0,o.length-1));var V="const ".concat(K,"={").concat(o,"}");return V}},83195:function(ct,q,t){t.d(q,{r:function(){return zt},Z:function(){return xe}});var $=t(57213),p=t.n($),J=t(93525),w=t.n(J),U=t(21140),K=t.n(U),O=t(63466),o=t.n(O),V=t(68608),m=t.n(V),F=t(58853),R=t.n(F),k=t(38888),v=t.n(k),x=t(52510),r=t.n(x),E=t(22465),B=t(14990),Z=t(72237),h=t(11150),S=t(93853),X=t(28110),et=t(5671),it=t(9722),pt=t(17696),G=t(19227),W=t(75476),nt=t(1167),C=t(22046),_=t(22150),rt=t(11250),L=t(43702),P=t(58856),I=t(40767),Y=t(75904),ot=t(29830),dt=t(46464),Q=t(32246),ht=t(47097),at=t(87363),yt=t.n(at),mt=t(72107),Nt=null;function Ct(l,n,d,j){var e,M,y=l.data.config,T=y.type,g=d.flatMap(function(c){return c.source.cell===l.id?n[c.target.cell]:[]}),b=l.attrs,D=new mt.Du((e=l.id)!==null&&e!==void 0?e:"",T);if(D=p()(p()({},y),{},{id:l.id,name:b==null||(M=b.text)===null||M===void 0?void 0:M.text}),!(j.findIndex(function(c){return c.id===D.id})>-1)&&(j.push(D),g.length!==0))switch(T){default:if(g.length>1||D.type==="switch"){var u;console.log((u=l.data)===null||u===void 0?void 0:u.config),console.log(g),D.branches=[],g.forEach(function(c){var a,f,A,z;console.log((a=c.data)===null||a===void 0?void 0:a.config),(f=D.branches)===null||f===void 0||f.push({when:(A=c.data)===null||A===void 0||(z=A.config)===null||z===void 0?void 0:z.case,nextId:c.id}),Ct(n[c.id],n,d,j)})}else D.nextId=g[0].id,Ct(n[g[0].id],n,d,j);break}}function Dt(l,n){var d=new mt.Iz(l),j=[],e=[],M={},y=void 0;if(n.forEach(function(T){var g=T.id||"";if(T.shape==="edge")j.push(T);else{var b=T.attrs;M[g]=T,e.push(T),T.data.config.type==="start"&&(y=T)}}),!y){L.ZP.error("\u672A\u53D1\u73B0\u5F00\u59CB\u8282\u70B9\uFF0C\u8BF7\u914D\u7F6E\uFF01");return}return Ct(y,M,j,d.items),console.log("logic.items"),console.log(d.items),d}function Ft(l){var n=[];return l.items.forEach(function(d){var j={id:d.id,shape:d.type,size:{width:80,height:40},data:{config:d},attrs:{text:{text:d.name}}};if(n.push(j),d.branches&&d.branches.length>0)d.branches.forEach(function(M){var y={shape:"edge",source:{cell:d.id},target:{cell:M.nextId},labels:[{position:.5,attrs:{label:{text:M.when}}}]};n.push(y)});else if(d.nextId){var e={shape:"edge",source:{cell:d.id},target:{cell:d.nextId}};n.push(e)}}),n}var Et=t(5981),Pt=t(32125),Tt=t(97944),Vt=t(97563),Wt=t(86965),s=t(33130);function Kt(l){var n=[{key:"sharps-panel",label:(0,s.jsx)(Et.Z,{style:{fontSize:"20px",marginTop:10}}),children:(0,s.jsx)("div",{ref:l.refStencil,style:{margin:0,height:"100vh",width:"100%"}})},{key:"logic",label:(0,s.jsx)(Pt.Z,{style:{fontSize:"20px",marginTop:10}}),children:(0,s.jsxs)("div",{style:{margin:0,height:"100vh"},children:[(0,s.jsx)(Vt.Z,{title:"\u7528\u4E8E\u89E3\u6790\u6267\u884C\u7F16\u6392\u7684\u903B\u8F91\u3002",children:(0,s.jsx)("h3",{children:"Logic DSL"})}),(0,s.jsx)(Tt.ZP,{defaultLanguage:"json",options:{lineNumbers:"off",lineDecorationsWidth:0,minimap:{enabled:!1}},value:JSON.stringify(l.logic),onChange:l.onConfigChange})]})}];return(0,s.jsx)(Wt.Z,{tabPosition:"left",style:{margin:0},items:n,tabBarStyle:{width:50,margin:0}})}var Ut=Kt,kt=t(54306),xt=t.n(kt),Lt=t(55104),At=t(70256),Bt=function(l){var n,d=(0,at.useState)({type:"form"}),j=xt()(d,2),e=j[0],M=j[1],y=(0,at.useState)({}),T=xt()(y,2),g=T[0],b=T[1],D=l.configSchemaProvider,u=function(f){var A,z,i;(A=l.editNode)===null||A===void 0||A.setAttrByPath("text/text",f.name);var N=(z=l.editNode)===null||z===void 0?void 0:z.data.config;l.editNode&&(console.log("update graph data",f),l.editNode.setData({config:p()(p()({},N),f)},{overwrite:!0})),console.log("submit---props.editNode.data.config"),console.log((i=l.editNode)===null||i===void 0?void 0:i.data.config),l==null||l.onSubmit()},c=function(f){if(f&&f.data){var A,z=f.data.config||{},i=f.attrs;return z.name=i==null||(A=i.text)===null||A===void 0?void 0:A.text,z}else return{name:""}};return(0,at.useEffect)(function(){if(l.editNode&&l.editNode.data){var a=l.editNode.data.config||{};(0,At.CD)(l.editNode.data.configSchema||a.type).then(function(f){console.log("nodeConfigSchema"),console.log(f),M(f)})}},[l.editNode]),(0,at.useEffect)(function(){var a,f,A=((a=l.editNode)===null||a===void 0?void 0:a.data.config)||{},z=p()({},A),i=(f=l.editNode)===null||f===void 0?void 0:f.attrs;i&&i.text&&i.text.text&&(z.name=i.text.text),b(z)},[e,(n=l.editNode)===null||n===void 0?void 0:n.data]),(0,s.jsx)(Lt.Z,{config:e,values:p()({},g),onSubmit:u})};function Gt(l){var n=[{key:"1",label:"\u8282\u70B9\u914D\u7F6E",children:(0,s.jsx)("div",{style:{padding:5},children:(0,s.jsx)(Bt,{editNode:l.editNode,onSubmit:l.onSubmit})})}];return(0,s.jsxs)("div",{style:{margin:0,height:"95vh",overflowY:"scroll"},children:[(0,s.jsx)(Bt,{logic:l.logic,editNode:l.editNode,onSubmit:l.onSubmit}),l!=null&&l.isCollapsed?"":(0,s.jsx)(Y.ZP,{type:"text",style:{position:"absolute",top:10,right:15,fontSize:20,textAlign:"center"},onClick:function(){l==null||l.onClose()},children:"x"})]})}var Yt=Gt,Ht=t(10486),Rt=t(14232),Xt=t(37555),Qt=t(83603),$t=t(98306),_t=t(31120),qt=function(n){var d=(0,at.useState)({type:"page"}),j=xt()(d,2),e=j[0],M=j[1],y=(0,at.useState)(null),T=xt()(y,2),g=T[0],b=T[1];(0,at.useEffect)(function(){(0,At.CD)(n.formId).then(function(u){M(u)})},[n.formId]);function D(u,c,a){console.log(u),console.log(a),u==="formSubmited"&&(console.log("\u5185\u90E8\u8868\u5355\u63D0\u4EA4\u4E86"),n.onSubmit(a))}return(0,s.jsxs)("div",{children:[(0,s.jsx)(Lt.Z,p()(p()({},n),{},{config:e})),(0,s.jsx)(Qt.Z,{offsetBottom:2,target:function(){return g},style:{position:"absolute",right:16},children:(0,s.jsx)($t.rU,{to:"/set/design/form/".concat(n.formId),target:"_blank",children:(0,s.jsx)(_t.Z,{})})})]})},It=qt,gt=t(94744),te=function(n){var d,j=(0,at.useState)({}),e=xt()(j,2),M=e[0],y=e[1];(0,at.useEffect)(function(){var g=n.values,b=g.params,D=g.variables,u=g.envs,c=g.returns;y({params:JSON.stringify(gt.y.getJsonByParams(b)),variables:JSON.stringify(gt.y.getJsonByParams(D)),returns:JSON.stringify(gt.y.getJsonByParams(c)),envs:JSON.stringify(gt.y.getJsonByParams(u))})},[n.values]);var T=(0,at.useCallback)(function(g){try{return JSON.parse(g),!0}catch(b){return!1}},[]);return(0,s.jsxs)("span",{children:[n.children,(0,s.jsx)(dt.Z,{open:(d=n.open)!==null&&d!==void 0?d:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return n==null?void 0:n.setOpen(!1)},children:(0,s.jsx)(It,{formId:"logic-setting",values:M,onSubmit:function(b){console.log("\u63D0\u4EA4\u53C2\u6570"),console.log(b);var D=!1;Object.keys(b).forEach(function(u){var c=b[u];if(!T(c)){var a=u==="params"?"\u5165\u53C2":u==="variables"?"\u5C40\u90E8\u53D8\u91CF":u==="returns"?"\u8FD4\u56DE\u53C2\u6570":"\u73AF\u5883\u53D8\u91CF";return L.ZP.error("".concat(a,"json\u683C\u5F0F\u9519\u8BEF")),D=!0,!1}}),D||(n!=null&&n.onSubmit&&n.onSubmit(b),n==null||n.setOpen(!1))}})})]})},ee=te,bt=t(36808),ne=function(n,d){var j,e,M,y,T=d.getData(),g=d.getPosition(),b=n.getNodes(),D;if(["ExtSharp","polygon"].indexOf(d.shape)>-1)switch(T.config.type){case"switch":var u=200,c=n.addNode({shape:"switch",position:g,width:u,height:50,ports:bt.Tt,data:d.data,attrs:{body:{stroke:"#8f8f8f",strokeWidth:1,fill:"#fff",rx:6,ry:6}}});n.removeNode(d);var a=n.addNode({shape:"switch-case",position:{y:g.y+100,x:g.x-u/2},width:120,height:50,ports:bt.Tt,data:{config:{type:"switch-case"}}}),f=n.addNode({shape:"switch-default",position:{y:g.y+100,x:g.x+u},width:120,height:50,ports:bt.Tt,data:{config:{type:"switch-default"}}}),A=n.addEdge({source:c,sourcePort:(j=c.ports.items.find(function(lt){return lt.group=="bottom"}))===null||j===void 0?void 0:j.id,target:a,targetPort:(e=a.ports.items.find(function(lt){return lt.group=="top"}))===null||e===void 0?void 0:e.id,zIndex:0}),z=n.addEdge({source:c,sourcePort:(M=c.ports.items.find(function(lt){return lt.group=="bottom"}))===null||M===void 0?void 0:M.id,target:f,targetPort:(y=f.ports.items.find(function(lt){return lt.group=="top"}))===null||y===void 0?void 0:y.id,zIndex:0});D=c;break;case"switch-case":var i=n.createNode({shape:"switch-case",position:d.position(),width:120,height:50,ports:bt.Tt,data:d.data});n.removeNode(d),n.addNode(i),D=i;break;case"string":var N=n.createNode({shape:"string",position:d.position(),width:100,height:50,ports:bt.Tt,data:d.data});n.removeNode(d),n.addNode(N),D=N;break;case"num":var H=n.createNode({shape:"num",position:d.position(),width:100,height:50,ports:bt.Tt,data:d.data});n.removeNode(d),n.addNode(H),D=H;break;case"assignment":var tt=n.createNode({shape:"assignment",position:d.position(),width:220,height:50,ports:bt.Tt,data:d.data});n.removeNode(d),n.addNode(tt),D=tt;break;default:break}if(console.log("node:added"),D&&b.length==1){var st,ut,vt,ft,St;n.addEdge({source:b[0],sourcePort:(st=b[0].ports.items.find(function(lt){return lt.group=="bottom"}))===null||st===void 0?void 0:st.id,target:D,targetPort:(ut=D)===null||ut===void 0||(vt=ut.ports)===null||vt===void 0||(ft=vt.items)===null||ft===void 0||(St=ft.find(function(lt){return lt.group=="top"}))===null||St===void 0?void 0:St.id,zIndex:0})}},ae=t(59998),oe=t(788),ie=function(n){var d,j=(0,oe.cI)();(0,at.useEffect)(function(){var y=n.values.params;j.setValues({params:JSON.stringify(gt.y.getJsonByParams(y))})},[n.values]);var e=(0,at.useCallback)(function(y){try{return JSON.parse(y),!0}catch(T){return!1}},[]);function M(y){var T=!1;Object.keys(y).forEach(function(g){var b=y[g];if(["params","headers"].indexOf(g)>-1&&!e(b)){var D=g==="params"?"\u5165\u53C2":"\u8BF7\u6C42\u5934";return L.ZP.error("".concat(D,"json\u683C\u5F0F\u9519\u8BEF")),T=!0,!1}}),T||(n!=null&&n.onSubmit&&n.onSubmit(y,y.debugType),n==null||n.setOpen(!1))}return(0,s.jsxs)("span",{children:[n.children,(0,s.jsx)(dt.Z,{open:(d=n.open)!==null&&d!==void 0?d:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:!1,onCancel:function(){return n==null?void 0:n.setOpen(!1)},children:(0,s.jsx)(It,{formId:"logic-debug-input",onSubmit:M})})]})},re=ie,se=t(61719),le=t(47503),de=t(49425),Se=null,ue=function(n){var d=(0,Tt.Ik)(),j=(0,at.useState)(!1),e=xt()(j,2),M=e[0],y=e[1];return(0,s.jsx)("div",{style:{width:"100%"},children:M?(0,s.jsx)(le.Z,{title:"js\u7F16\u8F91\u5668",centered:!0,width:1200,bodyStyle:{height:"80vh"},open:M,footer:null,onCancel:function(){return y(!1)},children:(0,s.jsx)(Tt.ML,p()(p()({theme:"vs-dark",defaultValue:n.value,defaultLanguage:n.language,options:{minimap:{enabled:!1}}},n),{},{height:"100%"}))}):(0,s.jsxs)("div",{children:[(0,s.jsx)(Tt.ML,p()({className:"editorByLoader",theme:"vs-dark",defaultValue:n.value,defaultLanguage:n.language,onMount:function(g){var b;(b=g.getAction("editor.action.formatDocument"))===null||b===void 0||b.run(),g.setValue(g.getValue())},options:{minimap:{enabled:!1}},height:500},n)),(0,s.jsx)(Y.ZP,{size:"small",type:"text",icon:(0,s.jsx)(de.Z,{}),style:{position:"absolute",top:0,right:0,margin:"10px",color:"whitesmoke"},onClick:function(){return y(!0)}})]})})},ce=yt().memo(ue),ve=t(5726),fe=t.n(ve),Zt=t(23620),he=t(71731),jt=t(70517),ge=t(90010),pe=t.n(ge),Ot=t(52943),Ce=t(33358),Ee=t(49500),Pe=t(16123);jt.Z.interceptors.response.use(function(l){return console.log("axios response"),console.log(l),l&&l.data?(console.log("--\u8BF7\u6C42\u672A\u62A5\u9519\uFF0C\u9002\u914Dstatus=0"),l.data.error||(l.data.error={code:0}),l.data.status=0,l.data.data&&l.data.data.records&&(l.data.data.items=l.data.data.records),l):(console.log("--\u8FD4\u56DE\u6570\u636E\u4E3A\u7A7A\uFF0C\u5224\u65AD\u4E3A\u5F02\u5E38"),console.log(l.data),Promise.reject(new Error(l.data.message)))},function(l){if(console.log("\u6355\u6349axios error"),console.log(l),l.response&&l.response.data){var n,d=l.response;return console.log("--data\u6709\u8FD4\u56DE\u503C\uFF0C\u5224\u5B9A\u4E3A\u4E1A\u52A1\u5F02\u5E38\uFF0C\u7EE7\u7EED\u8FD4\u56DEresponse,\u9002\u914Dstatus=500\uFF01"),((n=l.response.data.error)===null||n===void 0?void 0:n.code)==0&&(l.response.data.error.code=500),console.log(d),d}return Promise.reject(l)});var me=function(n){var d=(0,at.useState)({type:"page"}),j=xt()(d,2),e=j[0],M=j[1],y="cxd",T="zh-CN";return(0,at.useEffect)(function(){(0,At.UD)(n.pageId).then(function(g){M(g)})},[n.pageId]),(0,s.jsxs)("div",{children:[(0,s.jsx)(Ot.qR,{theme:y,position:"top-right",locale:T},"toast"),(0,s.jsx)(Ot.wx,{theme:y,locale:T},"alert"),(0,Zt.sYA)(e,{data:n.data},{fetcher:function(b){var D=b.url,u=b.method,c=b.data,a=b.responseType,f=b.config,A=b.headers;return f=f||{},f.withCredentials=!0,a&&(f.responseType=a),f.cancelExecutor&&(f.cancelToken=new jt.Z.CancelToken(f.cancelExecutor)),f.headers=A||{},u!=="post"&&u!=="put"&&u!=="patch"?(c&&(f.params=c),jt.Z[u](D,f)):(c&&c instanceof FormData?(f.headers=f.headers||{},f.headers["Content-Type"]="multipart/form-data"):c&&typeof c!="string"&&!(c instanceof Blob)&&!(c instanceof ArrayBuffer)&&(c=JSON.stringify(c),f.headers=f.headers||{},f.headers["Content-Type"]="application/json"),jt.Z[u](D,c,f))},isCancel:function(b){return jt.Z.isCancel(b)},copy:function(b){pe()(b),Ot.Am.success("\u5185\u5BB9\u5DF2\u590D\u5236\u5230\u7C98\u8D34\u677F")},theme:y,jumpTo:function(b,D){debugger;D.blank==!0?window.open(window.location.origin+window.location.pathname+"#"+b,"_blank"):window.location.hash=b}})]})},Mt=me,ye=[{key:"saveToPng",label:"\u5BFC\u51FA\u56FE\u7247"},{key:"saveToClipboard",label:"\u590D\u5236\u5230\u526A\u8D34\u677F"}],zt=yt().createContext({logic:new mt.Iz("")}),Jt=function(n,d){for(var j=0,e=n.length;j<e;j+=1)n[j].style.visibility=d?"visible":"hidden"},xe=function(l){R()(d,l);var n=v()(d);function d(j){var e;K()(this,d),e=n.call(this,j),r()(m()(e),"container",void 0),r()(m()(e),"stencilContainer",void 0),r()(m()(e),"state",{editingNode:void 0,openEdgeEditor:!1,embeddingEnable:!1,editingEdge:void 0,leftToolCollapsed:!1,rightToolCollapsed:!0,openFlowSetting:!1,openRunLogic:!1,editorCtx:{logic:new mt.Iz("1")},logs:[],panel:{nodes:[],groups:[]}}),r()(m()(e),"handleEdgeSubmit",function(u){var c;(c=e.state.editingEdge)===null||c===void 0||c.setLabels(u)}),r()(m()(e),"initGraph",function(u){var c,a=new et.kJ({container:u,embedding:{enabled:e.state.embeddingEnable,validate:function(N){return N.child.setData({hoverNode:N.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new et.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(N){var H=N.targetMagnet;return!!H}},background:{color:"#F2F7FA"},grid:!0});a.use(new nt.H({enabled:!0,sharp:!0})).use(new pt.A({enabled:!0})).use(new W.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new _.T({enabled:!0})).use(new G.N).use(new it.T).use(new rt.D).use(new he.w({resizing:{enabled:!0,minWidth:50,maxWidth:200,minHeight:50,maxHeight:50,orthogonal:!1,restrict:!1,preserveAspectRatio:!1}})),a.on("edge:dblclick",function(i){var N=i.cell}),a.on("edge:mouseenter",function(i){var N=i.cell;N.addTools([{name:"button-remove",args:{distance:-40}}])}),a.on("edge:mouseleave",function(i){var N=i.cell;N.removeTools()}),a.on("node:moved",function(i){var N,H=i.e,tt=i.x,st=i.y,ut=i.node,vt=i.view,ft=(N=ut.data)===null||N===void 0?void 0:N.hoverNode;if(e.state.embeddingEnable&&ft){var St,lt,be=a.createEdge({source:ft,sourcePort:(St=ft.ports.items.find(function(wt){return wt.group=="bottom"}))===null||St===void 0?void 0:St.id,target:ut,targetPort:(lt=ut.ports.items.find(function(wt){return wt.group=="top"}))===null||lt===void 0?void 0:lt.id,zIndex:0});ut.data.hoverNode=void 0,a.addEdge(be),e.autoLayout(a)}}),a.on("node:mouseenter",function(i){var N,H,tt,st=i.cell;((N=st.data)===null||N===void 0||(H=N.config)===null||H===void 0?void 0:H.type)!="start"&&st.addTools([{name:"button-remove",args:{x:"100%",y:0,offset:{x:-10,y:10}}}]);var ut=(tt=e.container)===null||tt===void 0?void 0:tt.querySelectorAll(".x6-port-body");Jt(ut,!0)}),a.on("node:mouseleave",function(i){var N,H=i.cell;H.removeTools();var tt=(N=e.container)===null||N===void 0?void 0:N.querySelectorAll(".x6-port-body");Jt(tt,!1)}),a.on("node:click",function(i){var N=i.e,H=i.x,tt=i.y,st=i.node,ut=i.view;st.removeTools(),e.setState({editingNode:st})}),a.on("node:added",function(i){var N=i.node,H=i.index,tt=i.options;ne(a,N)}),a.on("node:dblclick",function(i){var N=i.e,H=i.x,tt=i.y,st=i.node,ut=i.view;e.setState({rightToolCollapsed:!1,editingNode:st})}),a.bindKey(["meta+c","ctrl+c"],function(){var i=a.getSelectedCells();return i.length&&a.copy(i),!1}),a.bindKey(["meta+x","ctrl+x"],function(){var i=a.getSelectedCells();return i.length&&a.cut(i),!1}),a.bindKey(["meta+v","ctrl+v"],function(){if(!a.isClipboardEmpty()){var i=a.paste({offset:32});a.cleanSelection(),a.select(i)}return!1}),a.bindKey(["meta+z","ctrl+z"],function(){return a.canUndo()&&a.undo(),!1}),a.bindKey(["meta+shift+z","ctrl+shift+z"],function(){return a.canRedo()&&a.redo(),!1}),a.bindKey("backspace",function(){var i=a.getSelectedCells();i.length&&(i.find(function(N){var H;return N.data?["start"].indexOf((H=N.data.config)===null||H===void 0?void 0:H.type)>-1:!1})?L.ZP.error("\u7981\u6B62\u5220\u9664\u5F00\u59CB\u8282\u70B9\uFF01"):a.removeCells(i))}),a.on("blank:dblclick",function(i){var N=i.e,H=i.x,tt=i.y;console.log("blank:dbclick",H,tt),e.autoLayout(a)}),a.bindKey(["ctrl+1","meta+1"],function(){var i=a.zoom();i<1.5&&a.zoom(.1)}),a.bindKey(["ctrl+2","meta+2"],function(){var i=a.zoom();i>.5&&a.zoom(-.1)}),e.state.graph=a;var f=e.state.panel.groups,A=new C.t({title:"\u5C55\u5F00/\u6536\u8D77",target:a,search:function(N,H){var tt=N.getAttrByPath("text/text");return(tt==null?void 0:tt.indexOf(H))!==-1},notFoundText:"\u672A\u627E\u5230",collapsable:!0,stencilGraphWidth:250,groups:f,layoutOptions:{rowHeight:100}}),z={};return e.state.panel.nodes.forEach(function(i){var N=a.createNode(i);f.forEach(function(H){i.groups.includes(H.name)&&(z[H.name]?z[H.name].push(N):z[H.name]=[N])})}),Object.keys(z).forEach(function(i){A.load(w()(z[i]),i)}),(c=e.stencilContainer)===null||c===void 0||c.appendChild(A.container),e.props.config?(e.state.editorCtx.logic=e.props.config,a.fromJSON(e.state.editorCtx.logic.visualConfig)):((0,Rt.X)(a),e.autoLayout(a)),a}),r()(m()(e),"autoLayout",function(u){(0,ae.V)(u)}),r()(m()(e),"refContainer",function(u){e.container=u}),r()(m()(e),"refStencil",function(u){e.stencilContainer=u}),r()(m()(e),"handleSubmit",function(u){e.saveAndConvertGraphToDsl()}),r()(m()(e),"handleOnConfigChange",function(u){try{var c=JSON.parse(u);e.setState({stepFlow:c})}catch(a){console.log(a)}}),r()(m()(e),"onSaveMenuClick",function(u){var c;switch(u.key){case"saveToBrowser":break;case"loadFromBrowser":var a=localStorage.getItem("logic-json");if(a){var f,A=JSON.parse(a);e.state.editorCtx.logic=A,(f=e.state.graph)===null||f===void 0||f.fromJSON(A.visualConfig),e.saveAndConvertGraphToDsl()}else L.ZP.info("\u6D4F\u89C8\u5668\u65E0\u7F13\u5B58\u6570\u636E");break;case"saveToClipboard":try{navigator.clipboard.writeText(JSON.stringify(e.state.editorCtx.logic))}catch(z){console.error(z)}break;case"saveToPng":(c=e.state.graph)===null||c===void 0||c.exportPNG(new Date().toLocaleDateString(),{backgroundColor:"#F2F7FA",padding:10,quality:1});break}}),r()(m()(e),"updateLogicAndEditorCtx",function(u){var c=p()(p()({},e.state.editorCtx.logic),u);return c.version=fe()(Date.now()).format("YYYYMMDDHHmmss"),e.setState({editorCtx:p()(p()({},e.state.editorCtx),{},{logic:c})}),c}),r()(m()(e),"saveAndConvertGraphToDsl",function(){var u,c=(u=e.state.graph)===null||u===void 0?void 0:u.toJSON(),a=e.convertGraphToDsl(c);if(a){var f,A=e.updateLogicAndEditorCtx({items:a.items,visualConfig:a.visualConfig});e.props.config&&(A.id=(f=e.props.config)===null||f===void 0?void 0:f.id),e.props.onSave&&e.props.onSave(A);var z=JSON.stringify(A);localStorage.setItem("logic-"+A.name,z)}}),r()(m()(e),"saveFlowSettingAndConvertGraphToDsl",function(u){var c,a,f,A,z=gt.y.getParamArrayByJson(JSON.parse((c=u.params)!==null&&c!==void 0?c:"{}")),i=gt.y.getReturnArrayByJson(JSON.parse((a=u.returns)!==null&&a!==void 0?a:"{}")),N=gt.y.getVariableArrayByJson(JSON.parse((f=u.variables)!==null&&f!==void 0?f:"{}")),H=gt.y.getEnvsArrayByJson(JSON.parse((A=u.envs)!==null&&A!==void 0?A:"{}")),tt=e.updateLogicAndEditorCtx({params:z,returns:i,variables:N,envs:H}),st=JSON.stringify(tt);localStorage.setItem("logic-json-"+tt.id,st)}),r()(m()(e),"convertGraphToDsl",function(u){var c,a=Dt((c=e.props.config)===null||c===void 0?void 0:c.id,u.cells);return a&&(a.visualConfig=u),a}),r()(m()(e),"setFlowSetting",function(u){e.setState({openFlowSetting:u})});try{var M,y,T=(0,Ht.K)(j.customNodes,j.customGroups,j.customSharps),g=T.Nodes,b=T.Shapes,D=T.Groups;(0,Rt.m)(b),e.state.leftToolCollapsed=!(!((M=j.showLeft)!==null&&M!==void 0)||M),e.state.rightToolCollapsed=!((y=j.showRight)!==null&&y!==void 0&&y),e.state.panel.nodes=g,e.state.panel.groups=D}catch(u){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(u)}return e}return o()(d,[{key:"componentDidUpdate",value:function(e,M,y){if(this.props.config&&this.state.editorCtx.logic.id!=this.props.config.id){var T,g,b,D;this.state.editorCtx.logic=this.props.config,(T=this.state.editorCtx)!==null&&T!==void 0&&(g=T.logic)!==null&&g!==void 0&&g.visualConfig&&((b=this.state.graph)===null||b===void 0||b.fromJSON((D=this.state.editorCtx.logic)===null||D===void 0?void 0:D.visualConfig)),this.setState({editingNode:void 0})}}},{key:"componentDidMount",value:function(){var e;this.initGraph(this.container),this.updateLogicAndEditorCtx((e=this.state.editorCtx)===null||e===void 0?void 0:e.logic)}},{key:"render",value:function(){var e=this,M,y=this.state,T=y.editingNode,g=y.leftToolCollapsed,b=y.rightToolCollapsed,D=y.editorCtx,u=y.embeddingEnable,c=y.graph,a=y.openFlowSetting,f=y.openRunLogic,A=D.logic;return console.log("editorCtx",D),(0,s.jsx)(zt.Provider,{value:D,children:(0,s.jsxs)(P.Z,{style:{height:"100vh",width:"100%",margin:0},children:[(0,s.jsx)(P.Z.Sider,{theme:"light",collapsed:g,collapsedWidth:0,width:300,children:(0,s.jsx)(Ut,{refStencil:this.refStencil,graph:this.state.graph,logic:A,onConfigChange:this.handleOnConfigChange})}),(0,s.jsxs)(P.Z,{style:{height:"100%"},children:[(0,s.jsxs)(P.Z.Header,{style:{padding:0,backgroundColor:"white"},children:[(0,s.jsxs)(I.Z,{direction:"horizontal",children:[(0,s.jsx)(Y.ZP,{type:"text",icon:g?(0,s.jsx)(E.Z,{}):(0,s.jsx)(B.Z,{}),onClick:function(){e.setState({leftToolCollapsed:!g})},style:{fontSize:"16px",width:64,height:64}}),(0,s.jsx)(ot.Z.Button,{style:{float:"inline-start"},menu:{items:ye,onClick:this.onSaveMenuClick},buttonsRender:function(i){return[(0,s.jsx)(Y.ZP,{type:"primary",icon:(0,s.jsx)(Z.Z,{}),onClick:e.saveAndConvertGraphToDsl,children:"\u4FDD\u5B58"}),(0,s.jsx)(Y.ZP,{type:"primary",icon:(0,s.jsx)(h.Z,{})})]},children:"\u4FDD\u5B58"}),(0,s.jsx)(ee,{open:a,values:p()({},A),setOpen:this.setFlowSetting,onSubmit:this.saveFlowSettingAndConvertGraphToDsl,children:(0,s.jsx)(Y.ZP,{onClick:function(){return e.setFlowSetting(!0)},icon:(0,s.jsx)(S.Z,{}),children:"\u914D\u7F6E\u53C2\u6570"})}),(M=this.props.btns)===null||M===void 0?void 0:M.map(function(z){return(0,s.jsx)(Y.ZP,p()({},z))}),(0,s.jsx)(re,{open:f,setOpen:function(i){return e.setState({openRunLogic:i})},values:{params:A==null?void 0:A.params},onSubmit:function(i,N){if(e.setState({openRunLogic:!1}),A){var H=i.params,tt=i.bizId,st=i.headers,ut=i.bizStartCode;(0,se.L7)(A.id,JSON.parse(H),tt,ut,N,JSON.parse(st)).then(function(vt){vt.data.code==0?dt.Z.success({title:"\u6267\u884C\u6210\u529F",width:"1000px",closable:!0,content:(0,s.jsx)("div",{children:(0,s.jsx)(Mt,{pageId:"debug-info",data:vt.data})})}):dt.Z.error({title:(0,s.jsx)("span",{children:vt.data.msg}),width:"1200px",closable:!0,content:(0,s.jsx)("div",{children:(0,s.jsx)(Mt,{pageId:"debug-info",data:vt.data})})})}).catch(function(vt){var ft=vt.response.data;dt.Z.error({title:(0,s.jsx)("span",{children:ft.msg}),width:"1200px",closable:!0,content:(0,s.jsx)("div",{children:(0,s.jsx)(Q.Z,{children:(0,s.jsx)(ht.Z,{children:(0,s.jsxs)(Q.Z,{children:[(0,s.jsxs)(ht.Z,{span:12,children:[(0,s.jsx)("h4",{children:"\u9519\u8BEF\u8BE6\u7EC6:"}),(0,s.jsx)(Zt.gcu,{src:ft.error,collapsed:1})]}),(0,s.jsxs)(ht.Z,{span:12,children:[(0,s.jsx)("h4",{children:"\u8FD4\u56DE\u6570\u636E:"}),(0,s.jsx)(ce,{language:"json",value:JSON.stringify(ft.data),width:500})]})]})})})})})}),e.state.logs.push({data:new Date().toLocaleTimeString()})}},children:(0,s.jsx)(Y.ZP,{type:"default",onClick:function(){e.setState({openRunLogic:!0})},icon:(0,s.jsx)(X.Z,{}),children:"\u8C03\u8BD5"})}),(0,s.jsxs)("span",{children:["\u5F53\u524D\u7248\u672C:",A.version]})]}),(0,s.jsx)(I.Z,{style:{float:"right",right:"16px"}})]}),(0,s.jsx)(P.Z.Content,{className:"app-content",children:(0,s.jsx)(Xt.Z,{ref:this.refContainer})})]}),(0,s.jsx)(P.Z.Sider,{theme:"light",collapsed:b,collapsedWidth:0,width:600,children:(0,s.jsx)(Yt,{logic:A,onClear:function(){return e.setState({logs:[]})},editNode:T,onSubmit:this.handleSubmit,logs:this.state.logs,onClose:function(){e.setState({rightToolCollapsed:!0})},isCollapsed:b})})]})})}}]),d}(yt().Component)},37555:function(ct,q,t){t.d(q,{Z:function(){return w}});var $=t(87363),p=t(33130),J=(0,$.forwardRef)(function(U,K){return(0,p.jsx)("div",{className:"drag-graph",ref:K})}),w=J},59998:function(ct,q,t){t.d(q,{V:function(){return p}});var $=t(59490),p=function(w){var U=new $.Vq({type:"dagre",begin:[400,100],rankdir:"TB",ranksep:20,nodeSize:50,controlPoints:!0}),K=w.getNodes(),O=w.getEdges(),o=U.layout({nodes:K,edges:O}),V=o.nodes,m=V===void 0?[]:V;K.forEach(function(F){var R=m.find(function(k){return k.id===F.id});R.x-=F.size().width/2,R.y-=F.size().height/2,F.position(R.x,R.y)})}},36808:function(ct,q,t){t.d(q,{Hi:function(){return J},Tt:function(){return $}});var $={groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]},p={groups:{right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1}},items:[{group:"right"}]},J={groups:{bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1}},items:[{group:"bottom"}]}},14232:function(ct,q,t){t.d(q,{X:function(){return r},m:function(){return x}});var $=t(5671),p=t(95812),J=t(54882),w={customNode:"customNode___AyPI8",input:"input___Q5PmS",switchNode:"switchNode___fqB9a"},U=t(33130),K=function(B){return(0,U.jsx)("div",{className:w.customNode,children:(0,U.jsx)(J.Z,{className:"input",value:B==null?void 0:B.data,width:80})})},O=t(42761),o=function(B){return(0,U.jsx)("div",{className:styles.customNode,children:(0,U.jsx)(O.Z,{className:"input",value:B==null?void 0:B.data,width:80})})},V=t(57213),m=t.n(V),F=function(B){var Z,h,S,X=B.node,et=(Z=X.data.config)===null||Z===void 0?void 0:Z.name,it=et||"case";return(0,U.jsxs)("div",{className:w.customNode,children:[(0,U.jsx)("span",{children:"case"}),(0,U.jsx)(J.Z,{addonAfter:et,className:"input",value:X==null||(h=X.data)===null||h===void 0||(S=h.config)===null||S===void 0?void 0:S.case,width:150,onChange:function(G){var W=X.data;X.setData(m()(m()({},W),{},{config:m()(m()({},W.config),{},{case:G.target.value})}))}})]})},R=function(B){var Z,h=B.node;return(0,U.jsx)("div",{className:w.customNode,children:(0,U.jsx)(J.Z,{addonBefore:"switch",className:"input",value:(Z=h.data)===null||Z===void 0?void 0:Z.config.condition,onChange:function(X){var et=h.data;h.setData(m()(m()({},et),{},{config:m()(m()({},et.config),{},{condition:X.target.value})}))},width:100})})},k=t(36808),v=function(B){return(0,U.jsx)("div",{className:w.customNode,children:(0,U.jsx)("div",{style:{textAlign:"center",fontSize:"15px"},children:"default"})})};function x(E){E.forEach(function(B){console.log("\u6CE8\u518C\u65B0\u8282\u70B9:"+B.name),$.kJ.registerNode(B.name,B.config,!0)}),(0,p.z2)({shape:"string",component:K}),(0,p.z2)({shape:"num",component:o}),(0,p.z2)({shape:"switch",component:R}),(0,p.z2)({shape:"switch-case",component:F}),(0,p.z2)({shape:"switch-default",component:v})}function r(E){var B=E.createNode({shape:"circle",label:"start",width:50,height:50,attrs:{body:{}},ports:k.Hi,data:{config:{type:"start"}}});E.addNode(B)}},10486:function(ct,q,t){t.d(q,{K:function(){return O}});var $=t(57213),p=t.n($),J=t(36808),w=50,U=50,K=[{name:"ExtSharp",config:{width:100,height:U,attrs:{body:{rx:6,ry:6,stroke:"#5F95FF",strokeWidth:1,fill:"rgba(95,149,255,0.05)",refWidth:1,refHeight:1},image:{refX:2,refY:0},text:{refX:4,refY:20,fontSize:12,"text-anchor":"start"}},markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}}];function O(o,V,m){var F=50,R=50,k={body:{}},v=[{shape:"circle",width:F,height:R,attrs:{body:p()(p()({},k.body),{},{fill:"white"}),text:{text:"\u4EA4\u4E92\u70B9"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:J.Tt,data:{config:{type:"wait-for-continue"}},groups:["global"]},{shape:"circle",label:"end",width:F,height:R,attrs:{body:p()(p()({},k.body),{},{fill:"#d9d9d9"}),text:{text:"end"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:J.Tt,data:{config:{type:"end"}},groups:["global"]},{shape:"ExtSharp",attrs:{text:{text:"http\u8BF7\u6C42",fontSize:14},image:{"xlink:href":"/icons/http.svg",width:20,x:2,y:2}},data:{config:{type:"http",method:"POST"}},ports:J.Tt,groups:["biz"]},{shape:"ExtSharp",ports:J.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/code.svg"},text:{text:"js\u4EE3\u7801\u5757",fontSize:14}},data:{config:{type:"js"}},groups:["biz"]},{shape:"ExtSharp",ports:J.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/code.svg"},text:{text:"java\u4EE3\u7801\u5757",fontSize:14}},data:{config:{type:"java"}},groups:["biz"]},{shape:"ExtSharp",ports:J.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/CarbonSubflowLocal.svg"},text:{text:"\u590D\u7528\u903B\u8F91",fontSize:14}},data:{config:{type:"sub-logic"}},groups:["biz"]},{shape:"ExtSharp",width:50,height:R,label:"switch",attrs:{image:{"xlink:href":"/icons/switch.svg",width:45,x:1,y:2},text:{text:"switch",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"switch"}},ports:J.Tt,groups:["ctrl"]},{shape:"ExtSharp",width:F,height:R,attrs:{image:{"xlink:href":"/icons/text.svg",width:30,x:8,y:10},text:{text:"case",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"switch-case"}},ports:J.Tt,groups:["ctrl"]},{shape:"ExtSharp",width:F,height:R,attrs:{image:{"xlink:href":"/icons/delay.svg",width:30,x:8,y:10},text:{text:"\u7B49\u5F85",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"wait",timeout:"2000"}},ports:J.Tt,groups:["ctrl"]}];o&&o.length>0&&Array.prototype.push.apply(v,o);var x=[{name:"global",title:"\u5168\u5C40\u8282\u70B9",graphHeight:110},{name:"ctrl",title:"\u903B\u8F91\u63A7\u5236",graphHeight:220},{name:"biz",title:"\u4E1A\u52A1\u8C03\u7528",graphHeight:220}];V&&V.length>0&&Array.prototype.push.apply(x,V);var r=K;return m&&m.length>0&&Array.prototype.push.apply(r,m),{Shapes:r,Nodes:v,Groups:x}}},61719:function(ct,q,t){t.d(q,{_5:function(){return h},dS:function(){return X},XY:function(){return it},L7:function(){return v}});var $=t(57213),p=t.n($),J=t(25359),w=t.n(J),U=t(49811),K=t.n(U),O=t(70517);function o(G,W){return axios.get(G,W)}function V(G,W,nt){return axios.put(G,W,nt)}function m(G,W){return axios.delete(G,W)}function F(G,W,nt){return O.Z.post(G,W,nt)}function R(G,W){return k.apply(this,arguments)}function k(){return k=_asyncToGenerator(_regeneratorRuntime().mark(function G(W,nt){return _regeneratorRuntime().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.abrupt("return",post("/api/runtime/logic/v1/run-fn/".concat(W),nt,{headers:{"Content-Type":"application/json"}}));case 1:case"end":return _.stop()}},G)})),k.apply(this,arguments)}function v(G,W,nt,C,_,rt){return x.apply(this,arguments)}function x(){return x=K()(w()().mark(function G(W,nt,C,_,rt,L){var P;return w()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:P="",Y.t0=rt,Y.next=Y.t0==="bizStepByStep"?4:6;break;case 4:return P="/api/runtime/logic/v1/step-by-step/".concat(W,"/").concat(C,"?debug=true"),Y.abrupt("break",8);case 6:return C?_?P="/api/runtime/logic/v1/biz/".concat(W,"/").concat(_,"/").concat(C,"?debug=true"):P="/api/runtime/logic/v1/run-biz/".concat(W,"/").concat(C,"?debug=true"):P="/api/runtime/logic/v1/run-api/".concat(W,"?debug=true"),Y.abrupt("break",8);case 8:return Y.abrupt("return",F(P,nt,{headers:p()({"Content-Type":"application/json"},L)}));case 9:case"end":return Y.stop()}},G)})),x.apply(this,arguments)}function r(G,W){return E.apply(this,arguments)}function E(){return E=_asyncToGenerator(_regeneratorRuntime().mark(function G(W,nt){return _regeneratorRuntime().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.abrupt("return",axios.post("/api/form/logic_instance/query",{filters:[{dataIndex:"logicId",values:[W],type:"="},{dataIndex:"bizId",values:[nt],type:"="}]}).then(function(rt){var L=rt.data.result.items[0];return L}));case 1:case"end":return _.stop()}},G)})),E.apply(this,arguments)}function B(G){return Z.apply(this,arguments)}function Z(){return Z=_asyncToGenerator(_regeneratorRuntime().mark(function G(W){return _regeneratorRuntime().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.abrupt("return",axios.get("/api/ide/logic-instance/".concat(W)).then(function(_){var rt=_.data.data;return rt}));case 1:case"end":return C.stop()}},G)})),Z.apply(this,arguments)}function h(G){return S.apply(this,arguments)}function S(){return S=K()(w()().mark(function G(W){return w()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.abrupt("return",O.Z.post("/api/form/logic/add",W).then(function(_){var rt=_.data.result;return rt}));case 1:case"end":return C.stop()}},G)})),S.apply(this,arguments)}function X(G){return et.apply(this,arguments)}function et(){return et=K()(w()().mark(function G(W){return w()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.abrupt("return",O.Z.delete("/api/form/logic/delete/".concat(W)).then(function(_){return _.data.result}));case 1:case"end":return C.stop()}},G)})),et.apply(this,arguments)}function it(){return pt.apply(this,arguments)}function pt(){return pt=K()(w()().mark(function G(){var W,nt,C=arguments;return w()().wrap(function(rt){for(;;)switch(rt.prev=rt.next){case 0:return W=C.length>0&&C[0]!==void 0?C[0]:1,nt=C.length>1&&C[1]!==void 0?C[1]:10,rt.abrupt("return",O.Z.post("/api/form/logic/query",{page:W,pageSize:nt}).then(function(L){return L.data}));case 3:case"end":return rt.stop()}},G)})),pt.apply(this,arguments)}},70256:function(ct,q,t){t.d(q,{CD:function(){return o},UD:function(){return K},n4:function(){return m}});var $=t(25359),p=t.n($),J=t(49811),w=t.n(J),U=t(70517);function K(R){return O.apply(this,arguments)}function O(){return O=w()(p()().mark(function R(k){return p()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,U.Z.get("/setting/pages/".concat(k,".json"));case 2:return x.abrupt("return",x.sent.data);case 3:case"end":return x.stop()}},R)})),O.apply(this,arguments)}function o(R){return V.apply(this,arguments)}function V(){return V=w()(p()().mark(function R(k){return p()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,U.Z.get("/setting/forms/".concat(k,".json"));case 2:return x.abrupt("return",x.sent.data);case 3:case"end":return x.stop()}},R)})),V.apply(this,arguments)}function m(R,k){return F.apply(this,arguments)}function F(){return F=w()(p()().mark(function R(k,v){return p()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,U.Z.get("/setting/".concat(k,"s/").concat(v,".json"));case 2:return r.abrupt("return",r.sent.data);case 3:case"end":return r.stop()}},R)})),F.apply(this,arguments)}}}]);
