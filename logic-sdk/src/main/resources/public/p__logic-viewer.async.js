"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[5039],{23542:function(re,T,e){e.d(T,{Z:function(){return R}});var K=e(57213),a=e.n(K),w=e(788),C=e(63466),B=e(21140),V=e(52510),N=e(54306),s=e.n(N),P=e(97944),F=e(83195),O=e(75904),$=e(47503),D=e(87363),b=e.n(D),o=e(84191),p=e(49425),l=e(94744),u=e(33130),d=null,X=function(j){var g=(0,P.Ik)(),oe=(0,D.useContext)(F.r),h=oe.logic;(0,D.useEffect)(function(){if(h){var _,n,v,H,k=l.y.getJsonByParams((_=h.variables)!==null&&_!==void 0?_:[]),A=(0,o.k)("_var",k),q=l.y.getJsonByParams((n=h.params)!==null&&n!==void 0?n:[]),Y=(0,o.k)("_par",q),U=l.y.getJsonByParams((v=h.returns)!==null&&v!==void 0?v:[]),ee=(0,o.k)("_ret",U),ue=l.y.getJsonByParams((H=h.envs)!==null&&H!==void 0?H:[]),ie=(0,o.k)("_env",ue);g==null||g.languages.typescript.javascriptDefaults.addExtraLib(A,"var.ts"),g==null||g.languages.typescript.javascriptDefaults.addExtraLib(Y,"input.ts"),g==null||g.languages.typescript.javascriptDefaults.addExtraLib(ee,"return.ts"),g==null||g.languages.typescript.javascriptDefaults.addExtraLib(ie,"env.ts"),g==null||g.languages.typescript.javascriptDefaults.addExtraLib("let _lastRet:{}","lastRet.ts")}return function(){var Q;console.log("effect dispose"),g==null||(Q=g.current)===null||Q===void 0||Q.dispose()}},[h==null?void 0:h.params,h==null?void 0:h.variables,h==null?void 0:h.returns,h==null?void 0:h.envs]);var G=(0,D.useState)(!1),m=s()(G,2),y=m[0],x=m[1];return(0,u.jsx)("div",{style:{width:"100%"},children:y?(0,u.jsx)($.Z,{title:"js\u7F16\u8F91\u5668",centered:!0,width:1200,bodyStyle:{height:"80vh"},open:y,footer:null,onCancel:function(){return x(!1)},children:(0,u.jsx)(P.ML,a()(a()({theme:"vs-dark",defaultValue:j.value,defaultLanguage:j.language,options:{minimap:{enabled:!1}}},j),{},{height:"100%"}))}):(0,u.jsxs)("div",{children:[(0,u.jsx)(P.ML,a()({className:"editorByLoader",theme:"vs-dark",defaultValue:j.value,defaultLanguage:j.language,onMount:function(n){var v;(v=n.getAction("editor.action.formatDocument"))===null||v===void 0||v.run(),n.setValue(n.getValue())},options:{minimap:{enabled:!1}},height:500},j)),(0,u.jsx)(O.ZP,{size:"small",type:"text",icon:(0,u.jsx)(p.Z,{}),style:{position:"absolute",top:0,right:0,margin:"10px",color:"whitesmoke"},onClick:function(){return x(!0)}})]})})},Z=b().memo(X),ne=null,z=function(j){return(0,u.jsx)(Z,a()(a()({},j),{},{language:"json"}))},i=z,t=null,L=function(j){return(0,u.jsx)(Z,a()(a()({},j),{},{language:"javascript"}))},r=L,f=e(16414),c=function(j){return(0,D.useEffect)(function(){P._m.config({monaco:f})},[]),(0,u.jsx)(w.ZP,a()({widgets:{json:i,js:r}},j))},I=c,R=c||I},87093:function(re,T,e){var K=e(57213),a=e.n(K),w=e(788),C=e(87363),B=e.n(C),V=e(23542),N=e(33130);T.Z=function(s){var P,F=(0,w.cI)(),O=s.configSchemaProvider,$=function(o){var p,l,u;(p=s.editNode)===null||p===void 0||p.setAttrByPath("text/text",o.name);var d=(l=s.editNode)===null||l===void 0?void 0:l.data.config;s.editNode&&s.editNode.setData({config:a()(a()({},d),o)}),console.log("submit---props.editNode.data.config"),console.log((u=s.editNode)===null||u===void 0?void 0:u.data.config),s==null||s.onSubmit()},D=function(o){if(o&&o.data){var p,l=o.data.config||{},u=o.attrs;return l.name=u==null||(p=u.text)===null||p===void 0?void 0:p.text,l}else return{name:""}};return(0,C.useEffect)(function(){if(s.editNode&&s.editNode.data){var b=s.editNode.data.config||{};O(s.editNode.data.configSchema||b.type).then(function(o){var p,l=s.editNode.attrs;b.name=l==null||(p=l.text)===null||p===void 0?void 0:p.text,console.log("nodeConfigSchema"),console.log(o),F.setSchema(o,!0),F.resetFields(),F.setValues(b)})}},[s.editNode,(P=s.editNode)===null||P===void 0?void 0:P.data]),(0,N.jsx)("div",{children:(0,N.jsx)(V.Z,{form:F,onFinish:$,onReset:function(){var o=D(s.editNode);F.setValues(o)},footer:!!s.onSubmit})})}},98257:function(re,T,e){e.r(T),e.d(T,{default:function(){return h}});var K=e(54306),a=e.n(K),w=e(25359),C=e.n(w),B=e(49811),V=e.n(B),N=e(14990),s=e(22465),P=e(5671),F=e(17696),O=e(19227),$=e(75476),D=e(1167),b=e(22150),o=e(58856),p=e(40767),l=e(75904),u=e(86965),d=e(87363),X=e(10486),Z=e(14232),ne=e(37555),z=e(59998),i=e(87093),t=e(33130),L=function(m){var y,x=(0,d.useState)(),_=a()(x,2),n=_[0],v=_[1],H=(0,d.useState)(),k=a()(H,2),A=k[0],q=k[1],Y=(0,d.useState)(!1),U=a()(Y,2),ee=U[0],ue=U[1],ie=(0,d.useState)(!0),Q=a()(ie,2),ae=Q[0],se=Q[1],ge=(0,d.useState)(),de=a()(ge,2),le=de[0],me=de[1],he=(0,d.useState)(),ce=a()(he,2),pe=ce[0],ye=ce[1],ve=(0,d.useRef)();(0,d.useEffect)(function(){le&&(n==null||n.centerCell(le))},[le,n]),(0,d.useEffect)(function(){var S=n==null?void 0:n.getNodes().find(function(te){return te.id==m.nextId});S==null||S.attr("body/fill","red"),me(S)},[m.nextId]),(0,d.useEffect)(function(){var S;n==null||(S=n.getNodes().find(function(te){return te.id==m.nextId}))===null||S===void 0||S.attr("body/fill","red")},[n]),(0,d.useEffect)(function(){m.config&&q(m.config)},[m.config]),(0,d.useEffect)(function(){if(A){try{var S=(0,X.K)(),te=S.Shapes;(0,Z.m)(te)}catch(M){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(M)}var E=new P.kJ({container:ve.current,embedding:{enabled:!0,validate:function(W){return W.child.setData({hoverNode:W.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new P.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(W){var fe=W.targetMagnet;return!!fe}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}},background:{color:"#F2F7FA"},grid:!0});E.use(new D.H({enabled:!0,sharp:!0})).use(new F.A({enabled:!0})).use(new $.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new b.T({enabled:!0})).use(new O.N),E.on("edge:dblclick",function(){}),E.on("edge:mouseenter",function(){}),E.on("edge:mouseleave",function(){}),E.on("node:moved",function(){}),E.on("node:mouseenter",function(){}),E.on("node:mouseleave",function(){}),E.on("node:added",function(){}),E.on("node:dblclick",function(M){var W=M.node;se(!1)}),E==null||E.on("node:click",function(M){var W=M.node;ye(W)}),E.on("blank:dblclick",function(M){var W=M.x,fe=M.y}),E.fromJSON(A.visualConfig),(0,z.V)(E),v(E)}},[A]);var xe=[{key:"2",label:"\u8282\u70B9\u914D\u7F6E",children:(0,t.jsx)(i.Z,{editNode:pe,configSchemaProvider:m.configSchemaProvider})}];return(0,t.jsxs)(o.Z,{style:{margin:0,height:"100vh"},children:[(0,t.jsxs)(o.Z,{style:{},children:[(0,t.jsxs)(o.Z.Header,{style:{padding:0,backgroundColor:"white"},children:[(0,t.jsx)(p.Z,{direction:"horizontal",children:(y=m.btns)===null||y===void 0?void 0:y.map(function(S){return S})}),(0,t.jsx)(l.ZP,{type:"text",icon:ae?(0,t.jsx)(N.Z,{}):(0,t.jsx)(s.Z,{}),onClick:function(){se(!ae)},style:{float:"right",right:"16px",fontSize:"16px",width:64,height:64}})]}),(0,t.jsx)(o.Z.Content,{className:"app-content",children:(0,t.jsx)(ne.Z,{ref:ve})})]}),(0,t.jsxs)(o.Z.Sider,{theme:"light",collapsed:ae,collapsedWidth:0,style:{overflow:"scroll"},title:"ddd",width:500,children:[(0,t.jsx)(l.ZP,{type:"text",onClick:function(){se(!ae)},style:{float:"right",fontSize:"16px",width:64,height:64},children:"x"}),(0,t.jsx)(u.Z,{items:xe,defaultActiveKey:"1"})]})]})},r=L,f=e(48364),c=e(61719),I=e(52615),R=e(70517),J=e(98306),j=function(){var G=V()(C()().mark(function m(y){var x;return C()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,R.Z.get("/setting/node-form/".concat(y,".json"));case 2:return x=n.sent,console.log(x.data),n.abrupt("return",x.data);case 5:case"end":return n.stop()}},m)}));return function(y){return G.apply(this,arguments)}}(),g=function(){var G=V()(C()().mark(function m(y){var x;return C()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,R.Z.get("/setting/node-log/".concat(y,".json")).catch(function(v){return v});case 2:if(x=n.sent,console.log(x.data),!x.data){n.next=8;break}return n.abrupt("return",x.data);case 8:return n.next=10,R.Z.get("/setting/node-log/_def.json");case 10:return n.abrupt("return",n.sent.data);case 11:case"end":return n.stop()}},m)}));return function(y){return G.apply(this,arguments)}}(),oe=function(){var m=(0,J.UO)(),y=m.id,x=m.version,_=(0,d.useState)(),n=a()(_,2),v=n[0],H=n[1],k=(0,d.useState)(!1),A=a()(k,2),q=A[0],Y=A[1];return(0,d.useEffect)(function(){Y(!0),y&&(0,f.Uh)(y,x).then(function(U){var ee=U;ee.configJson.id=y,H(ee),Y(!1)}).catch(function(U){Y(!1),console.log("err"),console.log(U)})},[y]),(0,t.jsx)("div",{children:(0,t.jsx)(I.Z,{spinning:q,children:(0,t.jsx)(r,{btns:[(0,t.jsxs)("span",{style:{marginLeft:"25px",color:"red"},children:["\u903B\u8F91\u7248\u672C\uFF1A",x]}),(0,t.jsxs)("span",{style:{marginLeft:"10px"},children:["\u66F4\u65B0\u65F6\u95F4\uFF1A",v==null?void 0:v.updateTime]}),(0,t.jsxs)("span",{style:{marginLeft:"10px"},children:["\u540D\u79F0\uFF1A",v==null?void 0:v.name]})],nextId:"",config:v==null?void 0:v.configJson,configSchemaProvider:j,itemLogSchemaProvider:g})})})},h=oe},48364:function(re,T,e){e.d(T,{Uh:function(){return ne},YH:function(){return $},az:function(){return b},b9:function(){return X},gC:function(){return u},m9:function(){return p}});var K=e(25359),a=e.n(K),w=e(49811),C=e.n(w),B=e(70517),V=e(5726),N=e.n(V);function s(i){return P.apply(this,arguments)}function P(){return P=_asyncToGenerator(_regeneratorRuntime().mark(function i(t){return _regeneratorRuntime().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",axios.post("/api/ide/pub/logic/dev-to-test".concat(t)));case 1:case"end":return r.stop()}},i)})),P.apply(this,arguments)}function F(i){return O.apply(this,arguments)}function O(){return O=_asyncToGenerator(_regeneratorRuntime().mark(function i(t){return _regeneratorRuntime().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",axios.get("/api/ide/logic/".concat(t)));case 1:case"end":return r.stop()}},i)})),O.apply(this,arguments)}function $(i){return D.apply(this,arguments)}function D(){return D=C()(a()().mark(function i(t){return a()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",B.Z.get("/api/ide/logic/".concat(t,"/config")).then(function(f){var c;return(c=f.data)===null||c===void 0?void 0:c.data}));case 1:case"end":return r.stop()}},i)})),D.apply(this,arguments)}function b(i,t,L){return o.apply(this,arguments)}function o(){return o=C()(a()().mark(function i(t,L,r){return a()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",B.Z.put("/api/ide/logic/edit/".concat(t),{version:L,configJson:r,updateTime:N()().format("YYYY-MM-DD HH:mm:ss")}));case 1:case"end":return c.stop()}},i)})),o.apply(this,arguments)}function p(i){return l.apply(this,arguments)}function l(){return l=C()(a()().mark(function i(t){return a()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",B.Z.get("/api/ide/logic-instance/".concat(t)).then(function(f){var c=f.data.data;return c}));case 1:case"end":return r.stop()}},i)})),l.apply(this,arguments)}function u(i){return d.apply(this,arguments)}function d(){return d=C()(a()().mark(function i(t){return a()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",B.Z.post("/api/ide/logic-logs",{filters:[{dataIndex:"logicId",values:[t.logicId],type:"="},{dataIndex:"bizId",values:[t.bizId],type:"="}],pageSize:1e3,orderBy:[{dataIndex:"serverTime",desc:!0}]}).then(function(f){var c=f.data.data.records;return c&&c.map(function(I){I.itemLogs&&(I.itemLogs=JSON.parse(I.itemLogs))}),c}));case 1:case"end":return r.stop()}},i)})),d.apply(this,arguments)}function X(i,t){return Z.apply(this,arguments)}function Z(){return Z=C()(a()().mark(function i(t,L){return a()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",B.Z.post("/api/ide/logic-baks",{filters:[{dataIndex:"id",values:[t],type:"="},{dataIndex:"version",values:[L],type:"="}]}).then(function(c){var I=c.data.data.records[0].configJson,R=JSON.parse(I);return R}));case 1:case"end":return f.stop()}},i)})),Z.apply(this,arguments)}function ne(i,t){return z.apply(this,arguments)}function z(){return z=C()(a()().mark(function i(t,L){return a()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",B.Z.post("/api/ide/logic-baks",{filters:[{dataIndex:"id",values:[t],type:"="},{dataIndex:"version",values:[L],type:"="}]}).then(function(c){var I=c.data.data.records[0],R=I.configJson;return I.configJson=JSON.parse(R),I}));case 1:case"end":return f.stop()}},i)})),z.apply(this,arguments)}}}]);
