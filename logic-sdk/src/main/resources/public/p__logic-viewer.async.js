"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[5039],{6460:function(ie,M,e){e.r(M),e.d(M,{default:function(){return ce}});var N=e(54306),o=e.n(N),U=e(25359),p=e.n(U),S=e(49811),O=e.n(S),$=e(86961),q=e(68673),j=e(89769),ee=e(17696),w=e(19227),J=e(75476),P=e(1167),K=e(22150),x=e(69624),z=e(81021),D=e(25232),G=e(82447),i=e(87363),W=e(11275),T=e(92873),k=e(64266),F=e(30685),a=e(88593),n=e(33130),f=function(l){var c,v=(0,i.useState)(),C=o()(v,2),t=C[0],m=C[1],V=(0,i.useState)(),R=o()(V,2),E=R[0],Y=R[1],Z=(0,i.useState)(!1),I=o()(Z,2),H=I[0],xe=I[1],ge=(0,i.useState)(!0),ne=o()(ge,2),A=ne[0],Q=ne[1],fe=(0,i.useState)(),te=o()(fe,2),X=te[0],ve=te[1],me=(0,i.useState)(),re=o()(me,2),pe=re[0],he=re[1],ae=(0,i.useRef)();(0,i.useEffect)(function(){X&&(t==null||t.centerCell(X))},[X,t]),(0,i.useEffect)(function(){var g=t==null?void 0:t.getNodes().find(function(_){return _.id==l.nextId});g==null||g.attr("body/fill","red"),ve(g)},[l.nextId]),(0,i.useEffect)(function(){var g;t==null||(g=t.getNodes().find(function(_){return _.id==l.nextId}))===null||g===void 0||g.attr("body/fill","red")},[t]),(0,i.useEffect)(function(){l.config&&Y(l.config)},[l.config]),(0,i.useEffect)(function(){if(E){try{var g=(0,W.K)(),_=g.Shapes;(0,T.m)(_)}catch(y){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(y)}var d=new j.kJ({container:ae.current,embedding:{enabled:!0,validate:function(L){return L.child.setData({hoverNode:L.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new j.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(L){var oe=L.targetMagnet;return!!oe}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}},background:{color:"#F2F7FA"},grid:!0});d.use(new P.H({enabled:!0,sharp:!0})).use(new ee.A({enabled:!0})).use(new J.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new K.T({enabled:!0})).use(new w.N),d.on("edge:dblclick",function(){}),d.on("edge:mouseenter",function(){}),d.on("edge:mouseleave",function(){}),d.on("node:moved",function(){}),d.on("node:mouseenter",function(){}),d.on("node:mouseleave",function(){}),d.on("node:added",function(){}),d.on("node:dblclick",function(y){var L=y.node;Q(!1)}),d==null||d.on("node:click",function(y){var L=y.node;he(L)}),d.on("blank:dblclick",function(y){var L=y.x,oe=y.y}),d.fromJSON(E.visualConfig),(0,F.V)(d),m(d)}},[E]);var ye=[{key:"2",label:"\u8282\u70B9\u914D\u7F6E",children:(0,n.jsx)(a.Z,{editNode:pe,configSchemaProvider:l.configSchemaProvider})}];return(0,n.jsxs)(x.Z,{style:{margin:0,height:"100vh"},children:[(0,n.jsxs)(x.Z,{style:{},children:[(0,n.jsxs)(x.Z.Header,{style:{padding:0,backgroundColor:"white"},children:[(0,n.jsx)(z.Z,{direction:"horizontal",children:(c=l.btns)===null||c===void 0?void 0:c.map(function(g){return g})}),(0,n.jsx)(D.ZP,{type:"text",icon:A?(0,n.jsx)($.Z,{}):(0,n.jsx)(q.Z,{}),onClick:function(){Q(!A)},style:{float:"right",right:"16px",fontSize:"16px",width:64,height:64}})]}),(0,n.jsx)(x.Z.Content,{className:"app-content",children:(0,n.jsx)(k.Z,{ref:ae})})]}),(0,n.jsxs)(x.Z.Sider,{theme:"light",collapsed:A,collapsedWidth:0,style:{overflow:"scroll"},title:"ddd",width:500,children:[(0,n.jsx)(D.ZP,{type:"text",onClick:function(){Q(!A)},style:{float:"right",fontSize:"16px",width:64,height:64},children:"x"}),(0,n.jsx)(G.Z,{items:ye,defaultActiveKey:"1"})]})]})},r=f,u=e(514),s=e(60246),h=e(25432),b=e(70517),se=e(87845),ue=function(){var B=O()(p()().mark(function l(c){var v;return p()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b.Z.get("/setting/node-form/".concat(c,".json"));case 2:return v=t.sent,console.log(v.data),t.abrupt("return",v.data);case 5:case"end":return t.stop()}},l)}));return function(c){return B.apply(this,arguments)}}(),le=function(){var B=O()(p()().mark(function l(c){var v;return p()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b.Z.get("/setting/node-log/".concat(c,".json")).catch(function(m){return m});case 2:if(v=t.sent,console.log(v.data),!v.data){t.next=8;break}return t.abrupt("return",v.data);case 8:return t.next=10,b.Z.get("/setting/node-log/_def.json");case 10:return t.abrupt("return",t.sent.data);case 11:case"end":return t.stop()}},l)}));return function(c){return B.apply(this,arguments)}}(),de=function(){var l=(0,se.UO)(),c=l.id,v=l.version,C=(0,i.useState)(),t=o()(C,2),m=t[0],V=t[1],R=(0,i.useState)(!1),E=o()(R,2),Y=E[0],Z=E[1];return(0,i.useEffect)(function(){Z(!0),c&&(0,u.Uh)(c,v).then(function(I){var H=I;H.configJson.id=c,V(H),Z(!1)}).catch(function(I){Z(!1),console.log("err"),console.log(I)})},[c]),(0,n.jsx)("div",{children:(0,n.jsx)(h.Z,{spinning:Y,children:(0,n.jsx)(r,{btns:[(0,n.jsxs)("span",{style:{marginLeft:"25px",color:"red"},children:["\u903B\u8F91\u7248\u672C\uFF1A",v]}),(0,n.jsxs)("span",{style:{marginLeft:"10px"},children:["\u66F4\u65B0\u65F6\u95F4\uFF1A",m==null?void 0:m.updateTime]}),(0,n.jsxs)("span",{style:{marginLeft:"10px"},children:["\u540D\u79F0\uFF1A",m==null?void 0:m.name]})],nextId:"",config:m==null?void 0:m.configJson,configSchemaProvider:ue,itemLogSchemaProvider:le})})})},ce=de},514:function(ie,M,e){e.d(M,{Uh:function(){return k},YH:function(){return J},az:function(){return K},b9:function(){return W},gC:function(){return G},m9:function(){return z}});var N=e(25359),o=e.n(N),U=e(49811),p=e.n(U),S=e(70517),O=e(5726),$=e.n(O);function q(a){return j.apply(this,arguments)}function j(){return j=_asyncToGenerator(_regeneratorRuntime().mark(function a(n){return _regeneratorRuntime().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",axios.post("/api/ide/pub/logic/dev-to-test".concat(n)));case 1:case"end":return r.stop()}},a)})),j.apply(this,arguments)}function ee(a){return w.apply(this,arguments)}function w(){return w=_asyncToGenerator(_regeneratorRuntime().mark(function a(n){return _regeneratorRuntime().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",axios.get("/api/ide/logic/".concat(n)));case 1:case"end":return r.stop()}},a)})),w.apply(this,arguments)}function J(a){return P.apply(this,arguments)}function P(){return P=p()(o()().mark(function a(n){return o()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",S.Z.get("/api/ide/logic/".concat(n,"/config")).then(function(u){var s;return(s=u.data)===null||s===void 0?void 0:s.data}));case 1:case"end":return r.stop()}},a)})),P.apply(this,arguments)}function K(a,n,f){return x.apply(this,arguments)}function x(){return x=p()(o()().mark(function a(n,f,r){return o()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",S.Z.put("/api/ide/logic/edit/".concat(n),{version:f,configJson:r,updateTime:$()().format("YYYY-MM-DD HH:mm:ss")}));case 1:case"end":return s.stop()}},a)})),x.apply(this,arguments)}function z(a){return D.apply(this,arguments)}function D(){return D=p()(o()().mark(function a(n){return o()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",S.Z.get("/api/ide/logic-instance/".concat(n)).then(function(u){var s=u.data.data;return s}));case 1:case"end":return r.stop()}},a)})),D.apply(this,arguments)}function G(a){return i.apply(this,arguments)}function i(){return i=p()(o()().mark(function a(n){return o()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",S.Z.post("/api/ide/logic-logs",{filters:[{dataIndex:"logicId",values:[n.logicId],type:"="},{dataIndex:"bizId",values:[n.bizId],type:"="}],pageSize:1e3,orderBy:[{dataIndex:"serverTime",desc:!0}]}).then(function(u){var s=u.data.data.records;return s&&s.map(function(h){h.itemLogs&&(h.itemLogs=JSON.parse(h.itemLogs))}),s}));case 1:case"end":return r.stop()}},a)})),i.apply(this,arguments)}function W(a,n){return T.apply(this,arguments)}function T(){return T=p()(o()().mark(function a(n,f){return o()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",S.Z.post("/api/ide/logic-baks",{filters:[{dataIndex:"id",values:[n],type:"="},{dataIndex:"version",values:[f],type:"="}]}).then(function(s){var h=s.data.data.records[0].configJson,b=JSON.parse(h);return b}));case 1:case"end":return u.stop()}},a)})),T.apply(this,arguments)}function k(a,n){return F.apply(this,arguments)}function F(){return F=p()(o()().mark(function a(n,f){return o()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",S.Z.post("/api/ide/logic-baks",{filters:[{dataIndex:"id",values:[n],type:"="},{dataIndex:"version",values:[f],type:"="}]}).then(function(s){var h=s.data.data.records[0],b=h.configJson;return h.configJson=JSON.parse(b),h}));case 1:case"end":return u.stop()}},a)})),F.apply(this,arguments)}}}]);
