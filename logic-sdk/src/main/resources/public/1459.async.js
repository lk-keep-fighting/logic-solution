"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[1459],{6706:function(ht,Q,t){t.d(Q,{Ld:function(){return K},Iz:function(){return y},Du:function(){return H},dO:function(){return L},z1:function(){return h},X0:function(){return V},_w:function(){return k}});var K=function(u){return u.TypeAnnotation="TypeAnnotation",u.Structure="Structure",u.StructureProperty="StructureProperty",u.TypeParam="TypeParam",u.Variable="Variable",u.Logic="Logic",u.LogicItem="LogicItem",u}({}),v=function(u){return u.start="start",u.end="end",u.switch="switch",u["switch-case"]="switch-case",u["switch-def"]="switch-def",u["mqtt-pub"]="mqtt-pub",u["mqtt-sub"]="mqtt-sub",u["mqtt-unsub"]="mqtt-unsub",u["mqtt-client"]="mqtt-client",u["mqtt-server"]="mqtt-server",u["mqtt-broker"]="mqtt-broker",u.http="http",u.logic="logic",u.js="js",u.wait="wait",u}({}),I=t(63466),P=t.n(I),R=t(21140),z=t.n(R),G=t(52510),i=t.n(G),V=P()(function u(N){z()(this,u),i()(this,"concept",void 0),i()(this,"name",void 0),i()(this,"label",void 0),i()(this,"description",void 0),i()(this,"typeAnnotation",void 0),i()(this,"required",!1),i()(this,"defaultValue",void 0),this.concept=K.StructureProperty,this.name=N}),y=P()(function u(N){z()(this,u),i()(this,"concept",K.Logic),i()(this,"schemeVersion",void 0),i()(this,"version",void 0),i()(this,"id",void 0),i()(this,"name",void 0),i()(this,"label",void 0),i()(this,"description",void 0),i()(this,"triggerType",void 0),i()(this,"cron",void 0),i()(this,"typeParams",void 0),i()(this,"params",void 0),i()(this,"returns",void 0),i()(this,"variables",void 0),i()(this,"envs",void 0),i()(this,"items",[]),i()(this,"visualConfig",void 0),this.id=N,this.schemeVersion="0.1"}),H=P()(function u(N,J){var tt=this;z()(this,u),i()(this,"concept","LogicItem"),i()(this,"id",void 0),i()(this,"name",void 0),i()(this,"type",void 0),i()(this,"label",void 0),i()(this,"description",void 0),i()(this,"params",void 0),i()(this,"returns",void 0),i()(this,"envs",void 0),i()(this,"afterReturnAdaptor",void 0),i()(this,"returnAccept",void 0),i()(this,"nextId",void 0),i()(this,"endId",void 0),i()(this,"condition",void 0),i()(this,"script",void 0),i()(this,"timeout",void 0),i()(this,"branches",void 0),i()(this,"url",void 0),i()(this,"method",void 0),i()(this,"headers",void 0),i()(this,"queryParams",void 0),i()(this,"body",void 0),i()(this,"setEnv",function(it){tt.envs=it}),this.type=J,this.id=N}),w=null,L=P()(function u(N){z()(this,u),i()(this,"concept","Param"),i()(this,"name",void 0),i()(this,"description",void 0),i()(this,"typeAnnotation",void 0),i()(this,"required",void 0),i()(this,"defaultValue",void 0),this.name=N}),l=t(58853),f=t.n(l),o=t(38888),d=t.n(o),h=function(u){f()(J,u);var N=d()(J);function J(tt){var it;return z()(this,J),it=N.call(this,tt),it.concept="Return",it}return P()(J)}(L),k=function(u){f()(J,u);var N=d()(J);function J(tt){var it;return z()(this,J),it=N.call(this,tt),it.concept="Variable",it}return P()(J)}(L)},76898:function(ht,Q,t){t.d(Q,{y:function(){return H}});var K=t(37635),v=t.n(K),I=t(21140),P=t.n(I),R=t(63466),z=t.n(R),G=t(6706),i=t(52510),V=t.n(i),y=z()(function w(L){P()(this,w),V()(this,"concept","EnvParam"),V()(this,"name",void 0),V()(this,"description",void 0),V()(this,"typeAnnotation",void 0),V()(this,"required",!1),V()(this,"defaultValue",void 0),this.name=L}),H=function(){function w(){P()(this,w)}return z()(w,null,[{key:"valueToTypeAnnotaion",value:function(l){var f=this,o={concept:G.Ld.TypeAnnotation,typeKind:"primitive",typeName:"string",defaultValue:l};if(Array.isArray(l))o.typeName="array";else{var d=v()(l);switch(d){case"boolean":o.typeKind="primitive",o.typeName="boolean";break;case"number":o.typeKind="primitive",o.typeName="number";break;case"string":o.typeKind="primitive",o.typeName="string";break;case"object":l==null?o.typeName="null":l instanceof Date?(o.typeKind="primitive",o.typeName="date"):l instanceof RegExp?(o.typeKind="primitive",o.typeName="regexp"):l instanceof Function?(o.typeKind="primitive",o.typeName="function"):(o.typeKind="anonymousStructure",o.typeName="object",o.properties=[],Object.keys(l).map(function(h){var k,u=l[h],N=f.valueToTypeAnnotaion(u),J=new G.X0(h);J.typeAnnotation=N,J.defaultValue=u,(k=o.properties)===null||k===void 0||k.push(J)}));break;default:o.typeKind="unknown",o.typeName=d;break}}return o}},{key:"typeAnnotaionToValue",value:function(l){var f,o,d=this,h;switch(l.typeName){case"array":h=(f=l.defaultValue)!==null&&f!==void 0?f:[];break;case"boolean":h=l.defaultValue?l.defaultValue=="true":!1;break;case"number":h=parseFloat(l.defaultValue);break;case"null":h=null;break;case"date":h=new Date(l.defaultValue);break;case"regexp":h=new RegExp(l.defaultValue);break;case"object":h={},(o=l.properties)===null||o===void 0||o.forEach(function(k){h[k.name]=d.typeAnnotaionToValue(k.typeAnnotation)});break;case"string":case"function":default:h=l.defaultValue;break}return h}},{key:"getParamArrayByJson",value:function(l){var f=[];return l&&Object.keys(l).forEach(function(o){var d=new G.dO(o);d.typeAnnotation=w.valueToTypeAnnotaion(l[o]),d.defaultValue=l[o],f.push(d)}),f}},{key:"getReturnArrayByJson",value:function(l){var f=[];return l&&Object.keys(l).forEach(function(o){var d=new G.z1(o);d.typeAnnotation=w.valueToTypeAnnotaion(l[o]),d.defaultValue=l[o],f.push(d)}),f}},{key:"getVariableArrayByJson",value:function(l){var f=[];return l&&Object.keys(l).forEach(function(o){var d=new G._w(o);d.typeAnnotation=w.valueToTypeAnnotaion(l[o]),d.defaultValue=l[o],f.push(d)}),f}},{key:"getEnvsArrayByJson",value:function(l){var f=[];return l&&Object.keys(l).forEach(function(o){var d=new y(o);d.typeAnnotation=w.valueToTypeAnnotaion(l[o]),d.defaultValue=l[o],f.push(d)}),f}},{key:"getJsonByParams",value:function(l){var f=this,o={};return l==null||l.forEach(function(d){o[d.name]=d.typeAnnotation?f.typeAnnotaionToValue(d.typeAnnotation):d.defaultValue}),o}}]),w}()},83132:function(ht,Q,t){t.d(Q,{Z:function(){return xt}});var K=t(57213),v=t.n(K),I=t(95915),P=t(63466),R=t(21140),z=t(52510),G=t(54306),i=t.n(G),V=t(29384),y=t(74613),H=t(25232),w=t(75657),L=t(87363),l=t.n(L),f=t(37635),o=t.n(f),d=function rt(U){var b="{";return Object.keys(U).forEach(function(M){var et=U[M];b+="".concat(M,":"),Array.isArray(et)?b+="[],":o()(et)=="object"?b+=rt(et)+",":typeof et=="string"?b+="'".concat(et,"',"):b+="".concat(et,",")}),b+="}",b},h=function(U,b){var M="";b&&(Object.keys(b).forEach(function(Et){var st=b[Et];M+="".concat(Et,":"),Array.isArray(st)?M+="[],":o()(st)=="object"?M+=d(st)+",":typeof st=="string"?M+="'".concat(st,"',"):M+="".concat(st,",")}),M=M.substring(0,M.length-1));var et="const ".concat(U,"={").concat(M,"}");return et},k=t(22407),u=t(76898),N=t(33130),J=null,tt=function(U){var b=(0,V.Ik)(),M=(0,L.useContext)(y.r),et=M.logic;(0,L.useEffect)(function(){var Ct,gt,dt,jt,Pt=u.y.getJsonByParams((Ct=et.variables)!==null&&Ct!==void 0?Ct:[]),Jt=h("_var",Pt),Nt=u.y.getJsonByParams((gt=et.params)!==null&&gt!==void 0?gt:[]),Tt=h("_par",Nt),Lt=u.y.getJsonByParams((dt=et.returns)!==null&&dt!==void 0?dt:[]),Zt=h("_ret",Lt),Ot=u.y.getJsonByParams((jt=et.envs)!==null&&jt!==void 0?jt:[]),Ft=h("_env",Ot);return b==null||b.languages.typescript.javascriptDefaults.addExtraLib(Jt,"var.ts"),b==null||b.languages.typescript.javascriptDefaults.addExtraLib(Tt,"input.ts"),b==null||b.languages.typescript.javascriptDefaults.addExtraLib(Zt,"return.ts"),b==null||b.languages.typescript.javascriptDefaults.addExtraLib(Ft,"env.ts"),b==null||b.languages.typescript.javascriptDefaults.addExtraLib("let _lastRet:{}","lastRet.ts"),function(){var e;console.log("effect dispose"),b==null||(e=b.current)===null||e===void 0||e.dispose()}},[et.params,et.variables,et.returns,et.envs]);var Et=(0,L.useState)(!1),st=i()(Et,2),ft=st[0],ct=st[1];return(0,N.jsx)("div",{style:{width:"100%"},children:ft?(0,N.jsx)(w.Z,{title:"js\u7F16\u8F91\u5668",centered:!0,width:1200,bodyStyle:{height:"80vh"},open:ft,footer:null,onCancel:function(){return ct(!1)},children:(0,N.jsx)(V.ML,v()(v()({theme:"vs-dark",defaultValue:U.value,defaultLanguage:U.language,options:{minimap:{enabled:!1}}},U),{},{height:"100%"}))}):(0,N.jsxs)("div",{children:[(0,N.jsx)(V.ML,v()({className:"editorByLoader",theme:"vs-dark",defaultValue:U.value,defaultLanguage:U.language,onMount:function(gt){var dt;(dt=gt.getAction("editor.action.formatDocument"))===null||dt===void 0||dt.run(),gt.setValue(gt.getValue())},options:{minimap:{enabled:!1}},height:500},U)),(0,N.jsx)(H.ZP,{size:"small",type:"text",icon:(0,N.jsx)(k.Z,{}),style:{position:"absolute",top:0,right:0,margin:"10px",color:"whitesmoke"},onClick:function(){return ct(!0)}})]})})},it=l().memo(tt),mt=null,A=function(U){return(0,N.jsx)(it,v()(v()({},U),{},{language:"json"}))},F=A,nt=null,O=function(U){return(0,N.jsx)(it,v()(v()({},U),{},{language:"javascript"}))},$=O,at=function(U){return(0,N.jsx)(I.ZP,v()({widgets:{json:F,js:$}},U))},yt=at,xt=at||yt},88593:function(ht,Q,t){var K=t(57213),v=t.n(K),I=t(95915),P=t(87363),R=t.n(P),z=t(83132),G=t(33130);Q.Z=function(i){var V,y=(0,I.cI)(),H=i.configSchemaProvider,w=function(f){var o,d,h;(o=i.editNode)===null||o===void 0||o.setAttrByPath("text/text",f.name);var k=(d=i.editNode)===null||d===void 0?void 0:d.data.config;i.editNode&&i.editNode.setData({config:v()(v()({},k),f)}),console.log("submit---props.editNode.data.config"),console.log((h=i.editNode)===null||h===void 0?void 0:h.data.config),i==null||i.onSubmit()},L=function(f){if(f&&f.data){var o,d=f.data.config||{},h=f.attrs;return d.name=h==null||(o=h.text)===null||o===void 0?void 0:o.text,d}else return{name:""}};return(0,P.useEffect)(function(){if(i.editNode&&i.editNode.data){var l=i.editNode.data.config||{};H(i.editNode.data.configSchema||l.type).then(function(f){var o,d=i.editNode.attrs;l.name=d==null||(o=d.text)===null||o===void 0?void 0:o.text,console.log("nodeConfigSchema"),console.log(f),y.setSchema(f,!0),y.resetFields(),y.setValues(l)})}},[i.editNode,(V=i.editNode)===null||V===void 0?void 0:V.data]),(0,G.jsx)("div",{children:(0,G.jsx)(z.Z,{form:y,onFinish:w,onReset:function(){var f=L(i.editNode);y.setValues(f)},footer:!!i.onSubmit})})}},74613:function(ht,Q,t){t.d(Q,{r:function(){return Mt},Z:function(){return Ce}});var K=t(57213),v=t.n(K),I=t(93525),P=t.n(I),R=t(21140),z=t.n(R),G=t(63466),i=t.n(G),V=t(68608),y=t.n(V),H=t(58853),w=t.n(H),L=t(38888),l=t.n(L),f=t(52510),o=t.n(f),d=t(68673),h=t(86961),k=t(38563),u=t(96209),N=t(74127),J=t(41181),tt=t(33291),it=t(11165),mt=t(89769),A=t(9722),F=t(17696),nt=t(19227),O=t(75476),$=t(1167),at=t(22046),yt=t(22150),xt=t(11250),rt=t(29384),U=t(52001),b=t(69624),M=t(25232),et=t(81021),Et=t(69145),st=t(52192),ft=t(43889),ct=t(75133),Ct=t(3573),gt=t(57035),dt=t(87363),jt=t.n(dt),Pt=t(6706),Jt=null;function Nt(T,a,c,p){var n,j,E=T.data.config,C=E.type,S=c.flatMap(function(m){return m.source.cell===T.id?a[m.target.cell]:[]}),B=T.attrs,Z=new Pt.Du((n=T.id)!==null&&n!==void 0?n:"",C);if(Z=v()(v()({},E),{},{id:T.id,name:B==null||(j=B.text)===null||j===void 0?void 0:j.text}),!(p.findIndex(function(m){return m.id===Z.id})>-1)&&(p.push(Z),S.length!==0))switch(C){default:if(S.length>1||Z.type==="switch"){var x;console.log((x=T.data)===null||x===void 0?void 0:x.config),console.log(S),Z.branches=[],S.forEach(function(m){var s,X,q,W;console.log((s=m.data)===null||s===void 0?void 0:s.config),(X=Z.branches)===null||X===void 0||X.push({when:(q=m.data)===null||q===void 0||(W=q.config)===null||W===void 0?void 0:W.case,nextId:m.id}),Nt(a[m.id],a,c,p)})}else Z.nextId=S[0].id,Nt(a[S[0].id],a,c,p);break}}function Tt(T,a){var c=new Pt.Iz(T),p=[],n=[],j={},E=void 0;if(a.forEach(function(C){var S=C.id||"";if(C.shape==="edge")p.push(C);else{var B=C.attrs;j[S]=C,n.push(C),C.data.config.type==="start"&&(E=C)}}),!E){U.ZP.error("\u672A\u53D1\u73B0\u5F00\u59CB\u8282\u70B9\uFF0C\u8BF7\u914D\u7F6E\uFF01");return}return Nt(E,j,p,c.items),console.log("logic.items"),console.log(c.items),c}var Lt=t(74095),Zt=t(45202),Ot=t(70823),Ft=t(82447),e=t(33130);function Wt(T){var a=[{key:"sharps-panel",label:(0,e.jsx)(Lt.Z,{style:{fontSize:"20px",marginTop:10}}),children:(0,e.jsx)("div",{ref:T.refStencil,style:{margin:0,height:"100vh",width:"100%"}})},{key:"logic",label:(0,e.jsx)(Zt.Z,{style:{fontSize:"20px",marginTop:10}}),children:(0,e.jsxs)("div",{style:{margin:0,height:"100vh"},children:[(0,e.jsx)(Ot.Z,{title:"\u7528\u4E8E\u89E3\u6790\u6267\u884C\u7F16\u6392\u7684\u903B\u8F91\u3002",children:(0,e.jsx)("h3",{children:"Logic DSL"})}),(0,e.jsx)(rt.ZP,{defaultLanguage:"json",options:{lineNumbers:"off",lineDecorationsWidth:0,minimap:{enabled:!1}},value:JSON.stringify(T.logic),onChange:T.onConfigChange})]})}];return(0,e.jsx)(Ft.Z,{tabPosition:"left",style:{margin:0},items:a,tabBarStyle:{width:50,margin:0}})}var Kt=Wt,Bt=t(85447),Ut=t(56027),It=t(61852),Xt=t(6525),Yt={log:{padding:"1px",marginBottom:"1px",fontFamily:"monospace"}};function Ht(T){var a=T.type,c=T.data,p=null;switch(a){case"axioError":p=(0,e.jsxs)("span",{children:[(0,e.jsx)("pre",{style:{color:"red"},children:c.message}),(0,e.jsx)("pre",{children:c.stack}),(0,e.jsxs)("pre",{children:["config:",JSON.stringify(c.config,null,2)]})]});break;case"err":p=(0,e.jsxs)("span",{children:[(0,e.jsx)("pre",{style:{color:"red"},children:c.message}),(0,e.jsx)("pre",{children:c.stack})]});break;case"json":p=(0,e.jsx)("pre",{children:JSON.stringify(c,null,2)});break;default:p=(0,e.jsx)("span",{children:c});break}return(0,e.jsx)("div",{style:Yt.log,children:p})}var $t=Ht,Qt=function(a){var c=a.data,p=a.onClear;return(0,e.jsxs)("div",{id:"scrollableDiv",style:{overflow:"auto",padding:"0 0px",height:"90vh"},children:[(0,e.jsx)(M.ZP,{icon:(0,e.jsx)(Bt.Z,{}),onClick:function(){p&&p()},children:"\u6E05\u7A7A\u65E5\u5FD7"}),(0,e.jsx)(Xt.Z,{dataLength:c.length,next:function(){},hasMore:!1,loader:(0,e.jsx)(Ut.Z,{avatar:!0,paragraph:{rows:1},active:!0}),scrollableTarget:"scrollableDiv",children:(0,e.jsx)(It.Z,{dataSource:c,renderItem:function(j,E){return(0,e.jsx)(It.Z.Item,{children:(0,e.jsx)($t,v()({},j))},E)}})}),(0,e.jsx)(M.ZP,{icon:(0,e.jsx)(Bt.Z,{}),onClick:function(){p&&p()},children:"\u6E05\u7A7A\u65E5\u5FD7"})]})},qt=Qt,_t=t(88593);function te(T){var a=[{key:"1",label:"\u8282\u70B9\u914D\u7F6E",children:(0,e.jsx)("div",{style:{padding:5},children:(0,e.jsx)(_t.Z,{editNode:T.editNode,onSubmit:T.onSubmit,configSchemaProvider:T.configSchemaProvider})})},{key:"2",label:"\u8FD0\u884C\u65E5\u5FD7",children:(0,e.jsx)("div",{style:{padding:5},children:(0,e.jsx)(qt,{data:T.logs,onClear:T.onClear})})}];return(0,e.jsx)(Ft.Z,{style:{margin:0,height:"95vh",overflowY:"scroll"},items:a})}var ee=te,ne=t(11275),zt=t(92873),At={name:{title:"\u540D\u79F0",type:"string",widget:"textArea",props:{rows:1}}};function ae(T){var a={type:"object",properties:{},column:1};switch(T){case"switch":a.properties=v()(v()({},At),{},{condition:{title:"\u6761\u4EF6\u8868\u8FBE\u5F0F ",type:"string",widget:"js",props:{height:100},extra:"\u76F4\u63A5\u586B\u5199\u8868\u8FBE\u5F0F\u6216\u53D8\u91CF\u540D\uFF0C\u5982_par.outType"}});break;case"switch-case":a.properties=v()(v()({},At),{},{case:{title:"case\u503C ",type:"string",extra:"\u503C\u4F1A\u8F6C\u6362\u4E3A\u5B57\u7B26\u4E32\u8FDB\u884C\u5339\u914D"}});break;case"js":a.properties=v()(v()({},At),{},{script:{title:"js\u811A\u672C ",type:"string",widget:"js",props:{height:500},extra:"js\u4EE3\u7801\u5757\uFF0C\u53EF\u7528\u4E8E\u7B80\u5355\u7684\u903B\u8F91\u5B9A\u5236\uFF0C\u53D8\u91CF\u8D4B\u503C\u7B49"}});break;case"http":a.properties=v()(v()({},At),{},{system:{title:"\u7CFB\u7EDF\u540D ",type:"string",defaultValue:""},url:{title:"\u8BF7\u6C42URL\uFF1A ",type:"string",widget:"js",props:{height:50},extra:"js\u4EE3\u7801\u5757\uFF0C\u9700\u8FD4\u56DEURL\u5B57\u7B26\u4E32"},method:{title:"\u8BF7\u6C42\u7C7B\u578B\uFF1A",type:"string",props:{options:[{label:"POST",value:"POST"},{label:"GET",value:"GET"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"}]},widget:"radio"},headers:{title:"\u8BF7\u6C42\u5934(headers) ",type:"string",widget:"js",props:{height:200},extra:"js\u4EE3\u7801\u5757\uFF0C\u9700\u8FD4\u56DE\u8BF7\u6C42\u5934\u5BF9\u8C61"},body:{title:"body\u8BF7\u6C42\u53C2\u6570",type:"string",widget:"js",props:{height:200},extra:"js\u4EE3\u7801\u5757\uFF0C\u9700\u8FD4\u56DEbody\u5BF9\u8C61"},return:{title:"\u5C06response.data\u8D4B\u503C\u7ED9\u54EA\u4E2A\u53C2\u6570\uFF1F",type:"string",widget:"js",props:{height:100},extra:"\u8F93\u5165\u5C40\u90E8\u53D8\u91CF\u7684\u5B8C\u6574\u5F15\u7528\uFF0C\u5982_var.repData"},queryParams:{title:"url\u53C2\u6570",type:"string",widget:"js",props:{height:100},extra:"js\u4EE3\u7801\u5757\uFF0C\u9700\u8FD4\u56DE\u5BF9\u8C61\uFF0C\u4F1A\u8F6C\u6362\u4E3A\u952E\u503C\u5BF9\u8FFD\u52A0\u5728url\u4E2D"},timeout:{title:"\u6267\u884C\u8D85\u65F6\u65F6\u957F(ms)",defaultValue:2e3,type:"number"}}),a.column=2;break;case"start":a.properties={name:{title:"\u540D\u79F0",type:"string",widget:"textArea",props:{rows:1}}};break;case"end":a.properties={name:{title:"\u540D\u79F0",type:"string",widget:"textArea",props:{rows:1}}};break;case"wait":a.properties={name:{title:"\u540D\u79F0",type:"string",widget:"textArea",props:{rows:1}},timeout:{title:"\u5EF6\u65F6\u8BBE\u7F6E(ms)",defaultValue:2e3,type:"number"}};break;case"mqtt-client":break;default:a.properties=At}return a}var ie=t(64266),pt=t(76898),Vt=t(83132),Rt=t(95915),oe=function(a){var c,p=(0,Rt.cI)();(0,dt.useEffect)(function(){var j=a.values,E=j.params,C=j.variables,S=j.envs,B=j.returns;p.setValues({params:JSON.stringify(pt.y.getJsonByParams(E)),variables:JSON.stringify(pt.y.getJsonByParams(C)),returns:JSON.stringify(pt.y.getJsonByParams(B)),envs:JSON.stringify(pt.y.getJsonByParams(S))})},[a.values]);var n=(0,dt.useCallback)(function(j){try{return JSON.parse(j),!0}catch(E){return!1}},[]);return(0,e.jsxs)("span",{children:[a.children,(0,e.jsx)(st.Z,{open:(c=a.open)!==null&&c!==void 0?c:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,onOk:function(){var E=p.getValues(),C=!1;Object.keys(E).forEach(function(S){var B=E[S];if(!n(B)){var Z=S==="params"?"\u5165\u53C2":S==="variables"?"\u5C40\u90E8\u53D8\u91CF":S==="returns"?"\u8FD4\u56DE\u53C2\u6570":"\u73AF\u5883\u53D8\u91CF";return U.ZP.error("".concat(Z,"json\u683C\u5F0F\u9519\u8BEF")),C=!0,!1}}),C||(a!=null&&a.onSubmit&&a.onSubmit(E),a==null||a.setOpen(!1))},onCancel:function(){return a==null?void 0:a.setOpen(!1)},children:(0,e.jsx)(Vt.Z,{form:p,schema:{type:"object",properties:{params:{title:"\u5165\u53C2\u58F0\u660E",type:"string",widget:"json",props:{height:200},extra:"\u7F16\u8F91\u5668\u4E2D\u53EF\u901A\u8FC7 _par. \u83B7\u53D6"},variables:{title:"\u5C40\u90E8\u53D8\u91CF\u58F0\u660E",type:"string",widget:"json",props:{height:200},extra:"\u7F16\u8F91\u5668\u4E2D\u53EF\u901A\u8FC7 _var. \u83B7\u53D6"},envs:{title:"\u73AF\u5883\u53D8\u91CF\u58F0\u660E",type:"string",widget:"json",props:{height:200},extra:"\u7F16\u8F91\u5668\u4E2D\u53EF\u901A\u8FC7 _env. \u83B7\u53D6"}},column:2}})})]})},re=oe,St=t(34230),se=function(a,c){var p,n,j,E,C=c.getData(),S=c.getPosition(),B=a.getNodes(),Z;if(["ExtSharp","polygon"].indexOf(c.shape)>-1)switch(C.config.type){case"switch":var x=200,m=a.addNode({shape:"switch",position:S,width:x,height:50,ports:St.Tt,data:c.data,attrs:{body:{stroke:"#8f8f8f",strokeWidth:1,fill:"#fff",rx:6,ry:6}}});a.removeNode(c);var s=a.addNode({shape:"switch-case",position:{y:S.y+100,x:S.x-x/2},width:120,height:50,ports:St.Tt,data:{config:{type:"switch-case"}}}),X=a.addNode({shape:"switch-default",position:{y:S.y+100,x:S.x+x},width:120,height:50,ports:St.Tt,data:{config:{type:"switch-default"}}}),q=a.addEdge({source:m,sourcePort:(p=m.ports.items.find(function(lt){return lt.group=="bottom"}))===null||p===void 0?void 0:p.id,target:s,targetPort:(n=s.ports.items.find(function(lt){return lt.group=="top"}))===null||n===void 0?void 0:n.id,zIndex:0}),W=a.addEdge({source:m,sourcePort:(j=m.ports.items.find(function(lt){return lt.group=="bottom"}))===null||j===void 0?void 0:j.id,target:X,targetPort:(E=X.ports.items.find(function(lt){return lt.group=="top"}))===null||E===void 0?void 0:E.id,zIndex:0});Z=m;break;case"switch-case":var r=a.createNode({shape:"switch-case",position:c.position(),width:120,height:50,ports:St.Tt,data:c.data});a.removeNode(c),a.addNode(r),Z=r;break;case"string":var g=a.createNode({shape:"string",position:c.position(),width:100,height:50,ports:St.Tt,data:c.data});a.removeNode(c),a.addNode(g),Z=g;break;case"num":var D=a.createNode({shape:"num",position:c.position(),width:100,height:50,ports:St.Tt,data:c.data});a.removeNode(c),a.addNode(D),Z=D;break;case"assignment":var Y=a.createNode({shape:"assignment",position:c.position(),width:220,height:50,ports:St.Tt,data:c.data});a.removeNode(c),a.addNode(Y),Z=Y;break;default:break}if(console.log("node:added"),Z&&B.length==1){var ot,_,ut,vt,bt;a.addEdge({source:B[0],sourcePort:(ot=B[0].ports.items.find(function(lt){return lt.group=="bottom"}))===null||ot===void 0?void 0:ot.id,target:Z,targetPort:(_=Z)===null||_===void 0||(ut=_.ports)===null||ut===void 0||(vt=ut.items)===null||vt===void 0||(bt=vt.find(function(lt){return lt.group=="top"}))===null||bt===void 0?void 0:bt.id,zIndex:0})}},le=t(30685),de=function(a){var c,p=(0,Rt.cI)();(0,dt.useEffect)(function(){var j=a.values.params;p.setValues({params:JSON.stringify(pt.y.getJsonByParams(j))})},[a.values]);var n=(0,dt.useCallback)(function(j){try{return JSON.parse(j),!0}catch(E){return!1}},[]);return(0,e.jsxs)("span",{children:[a.children,(0,e.jsx)(st.Z,{open:(c=a.open)!==null&&c!==void 0?c:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,onOk:function(){var E=p.getValues(),C=!1;Object.keys(E).forEach(function(S){var B=E[S];if(["params","headers"].indexOf(S)>-1&&!n(B)){var Z=S==="params"?"\u5165\u53C2":"\u8BF7\u6C42\u5934";return U.ZP.error("".concat(Z,"json\u683C\u5F0F\u9519\u8BEF")),C=!0,!1}}),C||(a!=null&&a.onSubmit&&a.onSubmit(E),a==null||a.setOpen(!1))},onCancel:function(){return a==null?void 0:a.setOpen(!1)},children:(0,e.jsx)(Vt.Z,{form:p,schema:{type:"object",properties:{params:{title:"\u5165\u53C2",type:"string",widget:"json",props:{height:200},extra:"\u7F16\u8F91\u5668\u4E2D\u53EF\u901A\u8FC7 _par. \u83B7\u53D6"},headers:{title:"\u8BF7\u6C42\u5934(headers)",type:"string",widget:"json",default:"{}",props:{height:200},extra:"\u53EF\u5B9A\u4E49\u8BF7\u6C42\u5934\uFF0C\u5982\u6743\u9650"},bizId:{title:"\u4E1A\u52A1\u6807\u8BC6",type:"string",props:{},extra:"\u6839\u636E\u4E1A\u52A1\u6807\u8BC6\u8DDF\u8E2A\u903B\u8F91\u5B9E\u4F8B"}},column:2}})})]})},ue=de,ce=t(60246),ve=t(54306),he=t.n(ve),fe=t(75657),ge=t(22407),Se=null,pe=function(a){var c=(0,rt.Ik)(),p=(0,dt.useState)(!1),n=he()(p,2),j=n[0],E=n[1];return(0,e.jsx)("div",{style:{width:"100%"},children:j?(0,e.jsx)(fe.Z,{title:"js\u7F16\u8F91\u5668",centered:!0,width:1200,bodyStyle:{height:"80vh"},open:j,footer:null,onCancel:function(){return E(!1)},children:(0,e.jsx)(rt.ML,v()(v()({theme:"vs-dark",defaultValue:a.value,defaultLanguage:a.language,options:{minimap:{enabled:!1}}},a),{},{height:"100%"}))}):(0,e.jsxs)("div",{children:[(0,e.jsx)(rt.ML,v()({className:"editorByLoader",theme:"vs-dark",defaultValue:a.value,defaultLanguage:a.language,onMount:function(S){var B;(B=S.getAction("editor.action.formatDocument"))===null||B===void 0||B.run(),S.setValue(S.getValue())},options:{minimap:{enabled:!1}},height:500},a)),(0,e.jsx)(M.ZP,{size:"small",type:"text",icon:(0,e.jsx)(ge.Z,{}),style:{position:"absolute",top:0,right:0,margin:"10px",color:"whitesmoke"},onClick:function(){return E(!0)}})]})})},kt=jt().memo(pe),me=t(5726),ye=t.n(me),Dt=t(48204),xe=[{key:"saveToPng",label:"\u5BFC\u51FA\u56FE\u7247"},{key:"saveToClipboard",label:"\u590D\u5236\u5230\u526A\u8D34\u677F"}],Mt=jt().createContext({logic:new Pt.Iz("")}),Gt=function(a,c){for(var p=0,n=a.length;p<n;p+=1)a[p].style.visibility=c?"visible":"hidden"},Ce=function(T){w()(c,T);var a=l()(c);function c(p){var n;z()(this,c),n=a.call(this,p),o()(y()(n),"container",void 0),o()(y()(n),"stencilContainer",void 0),o()(y()(n),"state",{editingNode:void 0,openEdgeEditor:!1,embeddingEnable:!1,editingEdge:void 0,leftToolCollapsed:!1,rightToolCollapsed:!0,openFlowSetting:!1,openRunLogic:!1,editorCtx:{logic:new Pt.Iz("1")},logs:[],panel:{nodes:[],groups:[]}}),o()(y()(n),"handleEdgeSubmit",function(x){var m;(m=n.state.editingEdge)===null||m===void 0||m.setLabels(x)}),o()(y()(n),"initGraph",function(x){var m,s=new mt.kJ({container:x,embedding:{enabled:n.state.embeddingEnable,validate:function(g){return g.child.setData({hoverNode:g.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new mt.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(g){var D=g.targetMagnet;return!!D}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}},background:{color:"#F2F7FA"},grid:!0});s.use(new $.H({enabled:!0,sharp:!0})).use(new F.A({enabled:!0})).use(new O.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new yt.T({enabled:!0})).use(new nt.N).use(new A.T).use(new xt.D),s.on("edge:dblclick",function(r){var g=r.cell}),s.on("edge:mouseenter",function(r){var g=r.cell;g.addTools([{name:"button-remove",args:{distance:-40}}])}),s.on("edge:mouseleave",function(r){var g=r.cell;g.removeTools()}),s.on("node:moved",function(r){var g,D=r.e,Y=r.x,ot=r.y,_=r.node,ut=r.view,vt=(g=_.data)===null||g===void 0?void 0:g.hoverNode;if(n.state.embeddingEnable&&vt){var bt,lt,je=s.createEdge({source:vt,sourcePort:(bt=vt.ports.items.find(function(wt){return wt.group=="bottom"}))===null||bt===void 0?void 0:bt.id,target:_,targetPort:(lt=_.ports.items.find(function(wt){return wt.group=="top"}))===null||lt===void 0?void 0:lt.id,zIndex:0});_.data.hoverNode=void 0,s.addEdge(je),n.autoLayout(s)}}),s.on("node:mouseenter",function(r){var g,D,Y,ot=r.cell;((g=ot.data)===null||g===void 0||(D=g.config)===null||D===void 0?void 0:D.type)!="start"&&ot.addTools([{name:"button-remove",args:{x:"100%",y:0,offset:{x:-10,y:10}}}]);var _=(Y=n.container)===null||Y===void 0?void 0:Y.querySelectorAll(".x6-port-body");Gt(_,!0)}),s.on("node:mouseleave",function(r){var g,D=r.cell;D.removeTools();var Y=(g=n.container)===null||g===void 0?void 0:g.querySelectorAll(".x6-port-body");Gt(Y,!1)}),s.on("node:click",function(r){var g=r.e,D=r.x,Y=r.y,ot=r.node,_=r.view;ot.removeTools(),n.setState({editingNode:ot})}),s.on("node:added",function(r){var g=r.node,D=r.index,Y=r.options;se(s,g)}),s.on("node:dblclick",function(r){var g=r.e,D=r.x,Y=r.y,ot=r.node,_=r.view;n.setState({rightToolCollapsed:!1,editingNode:ot})}),s.bindKey(["meta+c","ctrl+c"],function(){var r=s.getSelectedCells();return r.length&&s.copy(r),!1}),s.bindKey(["meta+x","ctrl+x"],function(){var r=s.getSelectedCells();return r.length&&s.cut(r),!1}),s.bindKey(["meta+v","ctrl+v"],function(){if(!s.isClipboardEmpty()){var r=s.paste({offset:32});s.cleanSelection(),s.select(r)}return!1}),s.bindKey(["meta+z","ctrl+z"],function(){return s.canUndo()&&s.undo(),!1}),s.bindKey(["meta+shift+z","ctrl+shift+z"],function(){return s.canRedo()&&s.redo(),!1}),s.bindKey("backspace",function(){var r=s.getSelectedCells();r.length&&(r.find(function(g){var D;return g.data?["start"].indexOf((D=g.data.config)===null||D===void 0?void 0:D.type)>-1:!1})?U.ZP.error("\u7981\u6B62\u5220\u9664\u5F00\u59CB\u8282\u70B9\uFF01"):s.removeCells(r))}),s.on("blank:dblclick",function(r){var g=r.e,D=r.x,Y=r.y;console.log("blank:dbclick",D,Y),n.autoLayout(s)}),s.bindKey(["ctrl+1","meta+1"],function(){var r=s.zoom();r<1.5&&s.zoom(.1)}),s.bindKey(["ctrl+2","meta+2"],function(){var r=s.zoom();r>.5&&s.zoom(-.1)}),n.state.graph=s;var X=n.state.panel.groups,q=new at.t({title:"\u5C55\u5F00/\u6536\u8D77",target:s,search:function(g,D){var Y=g.getAttrByPath("text/text");return(Y==null?void 0:Y.indexOf(D))!==-1},notFoundText:"\u672A\u627E\u5230",collapsable:!0,stencilGraphWidth:250,groups:X,layoutOptions:{rowHeight:100}}),W={};return n.state.panel.nodes.forEach(function(r){var g=s.createNode(r);X.forEach(function(D){r.groups.includes(D.name)&&(W[D.name]?W[D.name].push(g):W[D.name]=[g])})}),Object.keys(W).forEach(function(r){q.load(P()(W[r]),r)}),(m=n.stencilContainer)===null||m===void 0||m.appendChild(q.container),n.props.config?(n.state.editorCtx.logic=n.props.config,s.fromJSON(n.state.editorCtx.logic.visualConfig)):((0,zt.X)(s),n.autoLayout(s)),s}),o()(y()(n),"autoLayout",function(x){(0,le.V)(x)}),o()(y()(n),"refContainer",function(x){n.container=x}),o()(y()(n),"refStencil",function(x){n.stencilContainer=x}),o()(y()(n),"handleSubmit",function(x){n.saveAndConvertGraphToDsl()}),o()(y()(n),"handleOnConfigChange",function(x){try{var m=JSON.parse(x);n.setState({stepFlow:m})}catch(s){console.log(s)}}),o()(y()(n),"onSaveMenuClick",function(x){var m;switch(x.key){case"saveToBrowser":break;case"loadFromBrowser":var s=localStorage.getItem("logic-json");if(s){var X,q=JSON.parse(s);n.state.editorCtx.logic=q,(X=n.state.graph)===null||X===void 0||X.fromJSON(q.visualConfig),n.saveAndConvertGraphToDsl()}else U.ZP.info("\u6D4F\u89C8\u5668\u65E0\u7F13\u5B58\u6570\u636E");break;case"saveToClipboard":try{navigator.clipboard.writeText(JSON.stringify(n.state.editorCtx.logic))}catch(W){console.error(W)}break;case"saveToPng":(m=n.state.graph)===null||m===void 0||m.exportPNG(new Date().toLocaleDateString(),{backgroundColor:"#F2F7FA",padding:10,quality:1});break}}),o()(y()(n),"updateLogicAndEditorCtx",function(x){var m=v()(v()({},n.state.editorCtx.logic),x);return m.version=ye()(Date.now()).format("YYYYMMDDHHmmss"),n.setState({editorCtx:v()(v()({},n.state.editorCtx),{},{logic:m})}),m}),o()(y()(n),"saveAndConvertGraphToDsl",function(){var x,m=(x=n.state.graph)===null||x===void 0?void 0:x.toJSON(),s=n.convertGraphToDsl(m);if(s){var X,q=n.updateLogicAndEditorCtx({items:s.items,visualConfig:s.visualConfig});n.props.config&&(q.id=(X=n.props.config)===null||X===void 0?void 0:X.id),n.props.onSave&&n.props.onSave(q);var W=JSON.stringify(q);localStorage.setItem("logic-"+q.name,W)}}),o()(y()(n),"saveFlowSettingAndConvertGraphToDsl",function(x){var m,s,X,q,W=pt.y.getParamArrayByJson(JSON.parse((m=x.params)!==null&&m!==void 0?m:"{}")),r=pt.y.getReturnArrayByJson(JSON.parse((s=x.returns)!==null&&s!==void 0?s:"{}")),g=pt.y.getVariableArrayByJson(JSON.parse((X=x.variables)!==null&&X!==void 0?X:"{}")),D=pt.y.getEnvsArrayByJson(JSON.parse((q=x.envs)!==null&&q!==void 0?q:"{}")),Y=n.updateLogicAndEditorCtx({params:W,returns:r,variables:g,envs:D}),ot=JSON.stringify(Y);localStorage.setItem("logic-json-"+Y.id,ot)}),o()(y()(n),"convertGraphToDsl",function(x){var m,s=Tt((m=n.props.config)===null||m===void 0?void 0:m.id,x.cells);return s&&(s.visualConfig=x),s}),o()(y()(n),"setFlowSetting",function(x){n.setState({openFlowSetting:x})});try{var j,E,C=(0,ne.K)(p.customNodes,p.customGroups,p.customSharps),S=C.Nodes,B=C.Shapes,Z=C.Groups;(0,zt.m)(B),n.state.leftToolCollapsed=!(!((j=p.showLeft)!==null&&j!==void 0)||j),n.state.rightToolCollapsed=!((E=p.showRight)!==null&&E!==void 0&&E),n.state.panel.nodes=S,n.state.panel.groups=Z}catch(x){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(x)}return n}return i()(c,[{key:"componentDidUpdate",value:function(n,j,E){if(this.props.config&&this.state.editorCtx.logic.id!=this.props.config.id){var C,S,B,Z;this.state.editorCtx.logic=this.props.config,(C=this.state.editorCtx)!==null&&C!==void 0&&(S=C.logic)!==null&&S!==void 0&&S.visualConfig&&((B=this.state.graph)===null||B===void 0||B.fromJSON((Z=this.state.editorCtx.logic)===null||Z===void 0?void 0:Z.visualConfig)),this.setState({editingNode:void 0})}}},{key:"componentDidMount",value:function(){var n;this.initGraph(this.container),this.updateLogicAndEditorCtx((n=this.state.editorCtx)===null||n===void 0?void 0:n.logic),rt._m.config({monaco:gt})}},{key:"render",value:function(){var n=this,j,E,C=this.state,S=C.editingNode,B=C.leftToolCollapsed,Z=C.rightToolCollapsed,x=C.editorCtx,m=C.embeddingEnable,s=C.graph,X=C.openFlowSetting,q=C.openRunLogic,W=x.logic;return console.log("editorCtx",x),(0,e.jsx)(Mt.Provider,{value:x,children:(0,e.jsxs)(b.Z,{style:{height:"100vh",width:"100%",margin:0},children:[(0,e.jsx)(b.Z.Sider,{theme:"light",collapsed:B,collapsedWidth:0,width:300,children:(0,e.jsx)(Kt,{refStencil:this.refStencil,graph:this.state.graph,logic:W,onConfigChange:this.handleOnConfigChange})}),(0,e.jsxs)(b.Z,{style:{height:"100%"},children:[(0,e.jsxs)(b.Z.Header,{style:{padding:0,backgroundColor:"white"},children:[(0,e.jsx)(M.ZP,{type:"text",icon:B?(0,e.jsx)(d.Z,{}):(0,e.jsx)(h.Z,{}),onClick:function(){n.setState({leftToolCollapsed:!B})},style:{fontSize:"16px",width:64,height:64}}),(0,e.jsxs)(et.Z,{direction:"horizontal",children:[(0,e.jsx)(Et.Z.Button,{style:{float:"inline-start"},menu:{items:xe,onClick:this.onSaveMenuClick},buttonsRender:function(g){return[(0,e.jsx)(M.ZP,{type:"primary",icon:(0,e.jsx)(k.Z,{}),onClick:n.saveAndConvertGraphToDsl,children:"\u4FDD\u5B58"}),(0,e.jsx)(M.ZP,{type:"primary",icon:(0,e.jsx)(u.Z,{})})]},children:"\u4FDD\u5B58"}),(0,e.jsx)(re,{open:X,values:v()({},W),setOpen:this.setFlowSetting,onSubmit:this.saveFlowSettingAndConvertGraphToDsl,children:(0,e.jsx)(M.ZP,{onClick:function(){return n.setFlowSetting(!0)},icon:(0,e.jsx)(N.Z,{}),children:"\u914D\u7F6E\u53C2\u6570"})}),(j=this.props.btns)===null||j===void 0?void 0:j.map(function(r){return(0,e.jsx)(M.ZP,v()({},r))}),(0,e.jsx)(ue,{open:q,setOpen:function(g){return n.setState({openRunLogic:g})},values:{params:W==null?void 0:W.params},onSubmit:function(g){if(n.setState({openRunLogic:!1}),W){var D=g.params,Y=g.bizId,ot=g.headers;(0,ce.nt)(W.id,JSON.parse(D),Y,JSON.parse(ot)).then(function(_){if(_.data.code==0){var ut;st.Z.success({title:"\u6267\u884C\u6210\u529F",width:"1000px",closable:!0,content:(0,e.jsx)("div",{children:(0,e.jsx)(ft.Z,{children:(0,e.jsx)(ct.Z,{children:(0,e.jsx)(ft.Z,{children:(0,e.jsxs)(ct.Z,{span:24,children:[(0,e.jsx)("h4",{children:_.data.msg}),(0,e.jsx)(Dt.gcu,{src:(ut=_.data)!==null&&ut!==void 0?ut:{},collapsed:1})]})})})})})})}else{var vt;st.Z.error({title:(0,e.jsx)("span",{children:_.data.msg}),width:"1000px",closable:!0,content:(0,e.jsx)("div",{children:(0,e.jsx)(ft.Z,{children:(0,e.jsx)(ct.Z,{children:(0,e.jsxs)(ft.Z,{children:[(0,e.jsxs)(ct.Z,{span:12,children:[(0,e.jsx)("h4",{children:"\u9519\u8BEF\u8BE6\u7EC6:"}),(0,e.jsx)(Dt.gcu,{src:(vt=_.data.error)!==null&&vt!==void 0?vt:{},collapsed:1})]}),(0,e.jsxs)(ct.Z,{span:12,children:[(0,e.jsx)("h4",{children:"\u8FD4\u56DE\u6570\u636E:"}),(0,e.jsx)(kt,{language:"json",value:JSON.stringify(_.data),width:500})]})]})})})})})}}).catch(function(_){var ut=_.response.data;st.Z.error({title:(0,e.jsx)("span",{children:ut.msg}),width:"1000px",closable:!0,content:(0,e.jsx)("div",{children:(0,e.jsx)(ft.Z,{children:(0,e.jsx)(ct.Z,{children:(0,e.jsxs)(ft.Z,{children:[(0,e.jsxs)(ct.Z,{span:12,children:[(0,e.jsx)("h4",{children:"\u9519\u8BEF\u8BE6\u7EC6:"}),(0,e.jsx)(Dt.gcu,{src:ut.error,collapsed:1})]}),(0,e.jsxs)(ct.Z,{span:12,children:[(0,e.jsx)("h4",{children:"\u8FD4\u56DE\u6570\u636E:"}),(0,e.jsx)(kt,{language:"json",value:JSON.stringify(ut.data),width:500})]})]})})})})})}),n.state.logs.push({data:new Date().toLocaleTimeString()})}},children:(0,e.jsx)(M.ZP,{type:"default",onClick:function(){n.setState({openRunLogic:!0})},icon:(0,e.jsx)(J.Z,{}),children:"\u8C03\u8BD5"})}),(0,e.jsxs)("span",{children:["\u5F53\u524D\u7248\u672C:",W.version]})]}),(0,e.jsxs)(et.Z,{style:{float:"right",right:"16px"},children:[(0,e.jsxs)("span",{children:["\u62D6\u62FD\u8FDE\u7EBF",(0,e.jsx)(Ct.Z,{checked:m,onChange:function(g){n.setState({embeddingEnable:g})},checkedChildren:(0,e.jsx)(tt.Z,{}),unCheckedChildren:(0,e.jsx)(it.Z,{})})]}),(0,e.jsx)(M.ZP,{type:"text",icon:Z?(0,e.jsx)(h.Z,{}):(0,e.jsx)(d.Z,{}),onClick:function(){n.setState({rightToolCollapsed:!Z})},style:{fontSize:"16px",width:64,height:64}})]})]}),(0,e.jsx)(b.Z.Content,{className:"app-content",children:(0,e.jsx)(ie.Z,{ref:this.refContainer})})]}),(0,e.jsxs)(b.Z.Sider,{theme:"light",collapsed:Z,collapsedWidth:0,width:600,children:[(0,e.jsx)(M.ZP,{type:"text",onClick:function(){n.setState({rightToolCollapsed:!Z})},style:{float:"right",fontSize:"16px",width:64,height:64},children:"x"}),(0,e.jsx)(ee,{onClear:function(){return n.setState({logs:[]})},editNode:S,onSubmit:this.handleSubmit,logs:this.state.logs,configSchemaProvider:(E=this.props.configSchemaProvider)!==null&&E!==void 0?E:ae})]})]})})}}]),c}(jt().Component)},64266:function(ht,Q,t){t.d(Q,{Z:function(){return P}});var K=t(87363),v=t(33130),I=(0,K.forwardRef)(function(R,z){return(0,v.jsx)("div",{className:"drag-graph",ref:z})}),P=I},30685:function(ht,Q,t){t.d(Q,{V:function(){return v}});var K=t(59197),v=function(P){var R=new K.Vq({type:"dagre",begin:[400,100],rankdir:"TB",ranksep:20,nodeSize:50,controlPoints:!0}),z=P.getNodes(),G=P.getEdges(),i=R.layout({nodes:z,edges:G}),V=i.nodes,y=V===void 0?[]:V;z.forEach(function(H){var w=y.find(function(L){return L.id===H.id});w.x-=H.size().width/2,w.y-=H.size().height/2,H.position(w.x,w.y)})}},34230:function(ht,Q,t){t.d(Q,{Hi:function(){return I},Tt:function(){return K}});var K={groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]},v={groups:{right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1}},items:[{group:"right"}]},I={groups:{bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1}},items:[{group:"bottom"}]}},92873:function(ht,Q,t){t.d(Q,{X:function(){return o},m:function(){return f}});var K=t(89769),v=t(17851),I=t(43118),P={customNode:"customNode___AyPI8",input:"input___Q5PmS",switchNode:"switchNode___fqB9a"},R=t(33130),z=function(h){return(0,R.jsx)("div",{className:P.customNode,children:(0,R.jsx)(I.Z,{className:"input",value:h==null?void 0:h.data,width:80})})},G=t(52205),i=function(h){return(0,R.jsx)("div",{className:styles.customNode,children:(0,R.jsx)(G.Z,{className:"input",value:h==null?void 0:h.data,width:80})})},V=t(57213),y=t.n(V),H=function(h){var k,u,N,J=h.node,tt=(k=J.data.config)===null||k===void 0?void 0:k.name,it=tt||"case";return(0,R.jsxs)("div",{className:P.customNode,children:[(0,R.jsx)("span",{children:"case"}),(0,R.jsx)(I.Z,{addonAfter:tt,className:"input",value:J==null||(u=J.data)===null||u===void 0||(N=u.config)===null||N===void 0?void 0:N.case,width:150,onChange:function(A){var F=J.data;J.setData(y()(y()({},F),{},{config:y()(y()({},F.config),{},{case:A.target.value})}))}})]})},w=function(h){var k,u=h.node;return(0,R.jsx)("div",{className:P.customNode,children:(0,R.jsx)(I.Z,{addonBefore:"switch",className:"input",value:(k=u.data)===null||k===void 0?void 0:k.config.condition,onChange:function(J){var tt=u.data;u.setData(y()(y()({},tt),{},{config:y()(y()({},tt.config),{},{condition:J.target.value})}))},width:100})})},L=t(34230),l=function(h){return(0,R.jsx)("div",{className:P.customNode,children:(0,R.jsx)("div",{style:{textAlign:"center",fontSize:"15px"},children:"default"})})};function f(d){d.forEach(function(h){console.log("\u6CE8\u518C\u65B0\u8282\u70B9:"+h.name),K.kJ.registerNode(h.name,h.config,!0)}),(0,v.z2)({shape:"string",component:z}),(0,v.z2)({shape:"num",component:i}),(0,v.z2)({shape:"switch",component:w}),(0,v.z2)({shape:"switch-case",component:H}),(0,v.z2)({shape:"switch-default",component:l})}function o(d){var h=d.createNode({shape:"circle",label:"start",width:50,height:50,attrs:{body:{}},ports:L.Hi,data:{config:{type:"start"}}});d.addNode(h)}},11275:function(ht,Q,t){t.d(Q,{K:function(){return G}});var K=t(57213),v=t.n(K),I=t(34230),P=50,R=50,z=[{name:"ExtSharp",config:{width:100,height:R,attrs:{body:{rx:6,ry:6,stroke:"#5F95FF",strokeWidth:1,fill:"rgba(95,149,255,0.05)",refWidth:1,refHeight:1},image:{refX:2,refY:0},text:{refX:4,refY:20,fontSize:12,"text-anchor":"start"}},markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}}];function G(i,V,y){var H=50,w=50,L={body:{}},l=[{shape:"circle",width:H,height:w,attrs:{body:v()(v()({},L.body),{},{fill:"white"}),text:{text:"\u4EA4\u4E92\u70B9"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:I.Tt,data:{config:{type:"wait-for-continue"}},groups:["global"]},{shape:"circle",label:"end",width:H,height:w,attrs:{body:v()(v()({},L.body),{},{fill:"#d9d9d9"}),text:{text:"end"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:I.Tt,data:{config:{type:"end"}},groups:["global"]},{shape:"ExtSharp",attrs:{text:{text:"http\u8BF7\u6C42",fontSize:14},image:{"xlink:href":"/icons/http.svg",width:20,x:2,y:2}},data:{config:{type:"http",method:"POST"}},ports:I.Tt,groups:["biz"]},{shape:"ExtSharp",ports:I.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/code.svg"},text:{text:"js\u4EE3\u7801\u5757",fontSize:14}},data:{config:{type:"js"}},groups:["biz"]},{shape:"ExtSharp",ports:I.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/CarbonSubflowLocal.svg"},text:{text:"\u590D\u7528\u903B\u8F91",fontSize:14}},data:{config:{type:"sub-logic"}},groups:["biz"]},{shape:"ExtSharp",width:50,height:w,label:"switch",attrs:{image:{"xlink:href":"/icons/switch.svg",width:45,x:1,y:2},text:{text:"switch",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"switch"}},ports:I.Tt,groups:["ctrl"]},{shape:"ExtSharp",width:H,height:w,attrs:{image:{"xlink:href":"/icons/text.svg",width:30,x:8,y:10},text:{text:"case",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"switch-case"}},ports:I.Tt,groups:["ctrl"]}];i&&i.length>0&&Array.prototype.push.apply(l,i);var f=[{name:"global",title:"\u5168\u5C40\u8282\u70B9",graphHeight:110},{name:"ctrl",title:"\u903B\u8F91\u63A7\u5236",graphHeight:110},{name:"biz",title:"\u4E1A\u52A1\u8C03\u7528",graphHeight:220}];V&&V.length>0&&Array.prototype.push.apply(f,V);var o=z;return y&&y.length>0&&Array.prototype.push.apply(o,y),{Shapes:o,Nodes:l,Groups:f}}},60246:function(ht,Q,t){t.d(Q,{_5:function(){return u},dS:function(){return J},XY:function(){return it},nt:function(){return l}});var K=t(57213),v=t.n(K),I=t(25359),P=t.n(I),R=t(49811),z=t.n(R),G=t(70517);function i(A,F){return axios.get(A,F)}function V(A,F,nt){return axios.put(A,F,nt)}function y(A,F){return axios.delete(A,F)}function H(A,F,nt){return G.Z.post(A,F,nt)}function w(A,F){return L.apply(this,arguments)}function L(){return L=_asyncToGenerator(_regeneratorRuntime().mark(function A(F,nt){return _regeneratorRuntime().wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.abrupt("return",post("/api/runtime/logic/v1/run-fn/".concat(F),nt,{headers:{"Content-Type":"application/json"}}));case 1:case"end":return $.stop()}},A)})),L.apply(this,arguments)}function l(A,F,nt,O){return f.apply(this,arguments)}function f(){return f=z()(P()().mark(function A(F,nt,O,$){var at;return P()().wrap(function(xt){for(;;)switch(xt.prev=xt.next){case 0:return O?at="/api/runtime/logic/v1/run-biz/".concat(F,"/").concat(O,"?debug=true"):at="/api/runtime/logic/v1/run-api/".concat(F,"?debug=true"),xt.abrupt("return",H(at,nt,{headers:v()({"Content-Type":"application/json"},$)}));case 2:case"end":return xt.stop()}},A)})),f.apply(this,arguments)}function o(A,F){return d.apply(this,arguments)}function d(){return d=_asyncToGenerator(_regeneratorRuntime().mark(function A(F,nt){return _regeneratorRuntime().wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.abrupt("return",axios.post("/api/form/logic_instance/query",{filters:[{dataIndex:"logicId",values:[F],type:"and"},{dataIndex:"bizId",values:[nt],type:"and"}]}).then(function(at){var yt=at.data.result.items[0];return yt}));case 1:case"end":return $.stop()}},A)})),d.apply(this,arguments)}function h(A){return k.apply(this,arguments)}function k(){return k=_asyncToGenerator(_regeneratorRuntime().mark(function A(F){return _regeneratorRuntime().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.abrupt("return",axios.get("/api/ide/logic-instance/".concat(F)).then(function($){var at=$.data.data;return at}));case 1:case"end":return O.stop()}},A)})),k.apply(this,arguments)}function u(A){return N.apply(this,arguments)}function N(){return N=z()(P()().mark(function A(F){return P()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.abrupt("return",G.Z.post("/api/form/logic/add",F).then(function($){var at=$.data.result;return at}));case 1:case"end":return O.stop()}},A)})),N.apply(this,arguments)}function J(A){return tt.apply(this,arguments)}function tt(){return tt=z()(P()().mark(function A(F){return P()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.abrupt("return",G.Z.delete("/api/form/logic/delete/".concat(F)).then(function($){return $.data.result}));case 1:case"end":return O.stop()}},A)})),tt.apply(this,arguments)}function it(){return mt.apply(this,arguments)}function mt(){return mt=z()(P()().mark(function A(){var F,nt,O=arguments;return P()().wrap(function(at){for(;;)switch(at.prev=at.next){case 0:return F=O.length>0&&O[0]!==void 0?O[0]:1,nt=O.length>1&&O[1]!==void 0?O[1]:10,at.abrupt("return",G.Z.post("/api/form/logic/query",{page:F,pageSize:nt}).then(function(yt){return yt.data}));case 3:case"end":return at.stop()}},A)})),mt.apply(this,arguments)}}}]);
