"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[1459],{6706:function(ct,q,t){t.d(q,{Ld:function(){return K},Iz:function(){return y},Du:function(){return W},dO:function(){return T},z1:function(){return h},X0:function(){return B},_w:function(){return R}});var K=function(c){return c.TypeAnnotation="TypeAnnotation",c.Structure="Structure",c.StructureProperty="StructureProperty",c.TypeParam="TypeParam",c.Variable="Variable",c.Logic="Logic",c.LogicItem="LogicItem",c}({}),d=function(c){return c.start="start",c.end="end",c.switch="switch",c["switch-case"]="switch-case",c["switch-def"]="switch-def",c["mqtt-pub"]="mqtt-pub",c["mqtt-sub"]="mqtt-sub",c["mqtt-unsub"]="mqtt-unsub",c["mqtt-client"]="mqtt-client",c["mqtt-server"]="mqtt-server",c["mqtt-broker"]="mqtt-broker",c.http="http",c.logic="logic",c.js="js",c.wait="wait",c}({}),V=t(63466),Z=t.n(V),J=t(21140),G=t.n(J),_=t(52510),i=t.n(_),B=Z()(function c(N){G()(this,c),i()(this,"concept",void 0),i()(this,"name",void 0),i()(this,"label",void 0),i()(this,"description",void 0),i()(this,"typeAnnotation",void 0),i()(this,"required",!1),i()(this,"defaultValue",void 0),this.concept=K.StructureProperty,this.name=N}),y=Z()(function c(N){G()(this,c),i()(this,"concept",K.Logic),i()(this,"schemeVersion",void 0),i()(this,"version",void 0),i()(this,"id",void 0),i()(this,"name",void 0),i()(this,"label",void 0),i()(this,"description",void 0),i()(this,"triggerType",void 0),i()(this,"cron",void 0),i()(this,"typeParams",void 0),i()(this,"params",void 0),i()(this,"returns",void 0),i()(this,"variables",void 0),i()(this,"envs",void 0),i()(this,"items",[]),i()(this,"visualConfig",void 0),this.id=N,this.schemeVersion="0.1"}),W=Z()(function c(N,I){var et=this;G()(this,c),i()(this,"concept","LogicItem"),i()(this,"id",void 0),i()(this,"name",void 0),i()(this,"type",void 0),i()(this,"label",void 0),i()(this,"description",void 0),i()(this,"params",void 0),i()(this,"returns",void 0),i()(this,"envs",void 0),i()(this,"afterReturnAdaptor",void 0),i()(this,"returnAccept",void 0),i()(this,"nextId",void 0),i()(this,"endId",void 0),i()(this,"condition",void 0),i()(this,"script",void 0),i()(this,"timeout",void 0),i()(this,"branches",void 0),i()(this,"url",void 0),i()(this,"method",void 0),i()(this,"headers",void 0),i()(this,"queryParams",void 0),i()(this,"body",void 0),i()(this,"setEnv",function(j){et.envs=j}),this.type=I,this.id=N}),w=null,T=Z()(function c(N){G()(this,c),i()(this,"concept","Param"),i()(this,"name",void 0),i()(this,"description",void 0),i()(this,"typeAnnotation",void 0),i()(this,"required",void 0),i()(this,"defaultValue",void 0),this.name=N}),l=t(58853),f=t.n(l),o=t(38888),u=t.n(o),h=function(c){f()(I,c);var N=u()(I);function I(et){var j;return G()(this,I),j=N.call(this,et),j.concept="Return",j}return Z()(I)}(T),R=function(c){f()(I,c);var N=u()(I);function I(et){var j;return G()(this,I),j=N.call(this,et),j.concept="Variable",j}return Z()(I)}(T)},76898:function(ct,q,t){t.d(q,{y:function(){return W}});var K=t(37635),d=t.n(K),V=t(21140),Z=t.n(V),J=t(63466),G=t.n(J),_=t(6706),i=t(52510),B=t.n(i),y=G()(function w(T){Z()(this,w),B()(this,"concept","EnvParam"),B()(this,"name",void 0),B()(this,"description",void 0),B()(this,"typeAnnotation",void 0),B()(this,"required",!1),B()(this,"defaultValue",void 0),this.name=T}),W=function(){function w(){Z()(this,w)}return G()(w,null,[{key:"valueToTypeAnnotaion",value:function(l){var f=this,o={concept:_.Ld.TypeAnnotation,typeKind:"primitive",typeName:"string",defaultValue:l};if(Array.isArray(l))o.typeName="array";else{var u=d()(l);switch(u){case"boolean":o.typeKind="primitive",o.typeName="boolean";break;case"number":o.typeKind="primitive",o.typeName="number";break;case"string":o.typeKind="primitive",o.typeName="string";break;case"object":l==null?o.typeName="null":l instanceof Date?(o.typeKind="primitive",o.typeName="date"):l instanceof RegExp?(o.typeKind="primitive",o.typeName="regexp"):l instanceof Function?(o.typeKind="primitive",o.typeName="function"):(o.typeKind="anonymousStructure",o.typeName="object",o.properties=[],Object.keys(l).map(function(h){var R,c=l[h],N=f.valueToTypeAnnotaion(c),I=new _.X0(h);I.typeAnnotation=N,I.defaultValue=c,(R=o.properties)===null||R===void 0||R.push(I)}));break;default:o.typeKind="unknown",o.typeName=u;break}}return o}},{key:"typeAnnotaionToValue",value:function(l){var f,o,u=this,h;switch(l.typeName){case"array":h=(f=l.defaultValue)!==null&&f!==void 0?f:[];break;case"boolean":h=l.defaultValue?l.defaultValue=="true":!1;break;case"number":h=parseFloat(l.defaultValue);break;case"null":h=null;break;case"date":h=new Date(l.defaultValue);break;case"regexp":h=new RegExp(l.defaultValue);break;case"object":h={},(o=l.properties)===null||o===void 0||o.forEach(function(R){h[R.name]=u.typeAnnotaionToValue(R.typeAnnotation)});break;case"string":case"function":default:h=l.defaultValue;break}return h}},{key:"getParamArrayByJson",value:function(l){var f=[];return l&&Object.keys(l).forEach(function(o){var u=new _.dO(o);u.typeAnnotation=w.valueToTypeAnnotaion(l[o]),u.defaultValue=l[o],f.push(u)}),f}},{key:"getReturnArrayByJson",value:function(l){var f=[];return l&&Object.keys(l).forEach(function(o){var u=new _.z1(o);u.typeAnnotation=w.valueToTypeAnnotaion(l[o]),u.defaultValue=l[o],f.push(u)}),f}},{key:"getVariableArrayByJson",value:function(l){var f=[];return l&&Object.keys(l).forEach(function(o){var u=new _._w(o);u.typeAnnotation=w.valueToTypeAnnotaion(l[o]),u.defaultValue=l[o],f.push(u)}),f}},{key:"getEnvsArrayByJson",value:function(l){var f=[];return l&&Object.keys(l).forEach(function(o){var u=new y(o);u.typeAnnotation=w.valueToTypeAnnotaion(l[o]),u.defaultValue=l[o],f.push(u)}),f}},{key:"getJsonByParams",value:function(l){var f=this,o={};return l==null||l.forEach(function(u){o[u.name]=u.typeAnnotation?f.typeAnnotaionToValue(u.typeAnnotation):u.defaultValue}),o}}]),w}()},83132:function(ct,q,t){t.d(q,{Z:function(){return Ft}});var K=t(57213),d=t.n(K),V=t(95915),Z=t(63466),J=t(21140),G=t(52510),_=t(54306),i=t.n(_),B=t(29384),y=t(74613),W=t(25232),w=t(75657),T=t(87363),l=t.n(T),f=t(37635),o=t.n(f),u=function ot(X){var P="{";return Object.keys(X).forEach(function(k){var nt=X[k];P+="".concat(k,":"),Array.isArray(nt)?P+="[],":o()(nt)=="object"?P+=ot(nt)+",":typeof nt=="string"?P+="'".concat(nt,"',"):P+="".concat(nt,",")}),P+="}",P},h=function(X,P){var k="";P&&(Object.keys(P).forEach(function(jt){var rt=P[jt];k+="".concat(jt,":"),Array.isArray(rt)?k+="[],":o()(rt)=="object"?k+=u(rt)+",":typeof rt=="string"?k+="'".concat(rt,"',"):k+="".concat(rt,",")}),k=k.substring(0,k.length-1));var nt="const ".concat(X,"={").concat(k,"}");return nt},R=t(22407),c=t(76898),N=t(33130),I=null,et=function(X){var P=(0,B.Ik)(),k=(0,T.useContext)(y.r),nt=k.logic;(0,T.useEffect)(function(){var gt,ft,lt,mt,St=c.y.getJsonByParams((gt=nt.variables)!==null&&gt!==void 0?gt:[]),Jt=h("_var",St),bt=c.y.getJsonByParams((ft=nt.params)!==null&&ft!==void 0?ft:[]),Tt=h("_par",bt),Lt=c.y.getJsonByParams((lt=nt.returns)!==null&&lt!==void 0?lt:[]),Zt=h("_ret",Lt),Ot=c.y.getJsonByParams((mt=nt.envs)!==null&&mt!==void 0?mt:[]),Nt=h("_env",Ot);return P==null||P.languages.typescript.javascriptDefaults.addExtraLib(Jt,"var.ts"),P==null||P.languages.typescript.javascriptDefaults.addExtraLib(Tt,"input.ts"),P==null||P.languages.typescript.javascriptDefaults.addExtraLib(Zt,"return.ts"),P==null||P.languages.typescript.javascriptDefaults.addExtraLib(Nt,"env.ts"),P==null||P.languages.typescript.javascriptDefaults.addExtraLib("let _lastRet:{}","lastRet.ts"),function(){var e;console.log("effect dispose"),P==null||(e=P.current)===null||e===void 0||e.dispose()}},[nt.params,nt.variables,nt.returns,nt.envs]);var jt=(0,T.useState)(!1),rt=i()(jt,2),ht=rt[0],ut=rt[1];return(0,N.jsx)("div",{style:{width:"100%"},children:ht?(0,N.jsx)(w.Z,{title:"js\u7F16\u8F91\u5668",centered:!0,width:1200,bodyStyle:{height:"80vh"},open:ht,footer:null,onCancel:function(){return ut(!1)},children:(0,N.jsx)(B.ML,d()(d()({theme:"vs-dark",defaultValue:X.value,defaultLanguage:X.language,options:{minimap:{enabled:!1}}},X),{},{height:"100%"}))}):(0,N.jsxs)("div",{children:[(0,N.jsx)(B.ML,d()({className:"editorByLoader",theme:"vs-dark",defaultValue:X.value,defaultLanguage:X.language,onMount:function(ft){var lt;(lt=ft.getAction("editor.action.formatDocument"))===null||lt===void 0||lt.run(),ft.setValue(ft.getValue())},options:{minimap:{enabled:!1}},height:500},X)),(0,N.jsx)(W.ZP,{size:"small",type:"text",icon:(0,N.jsx)(R.Z,{}),style:{position:"absolute",top:0,right:0,margin:"10px",color:"whitesmoke"},onClick:function(){return ut(!0)}})]})})},j=l().memo(et),O=null,Q=function(X){return(0,N.jsx)(j,d()(d()({},X),{},{language:"json"}))},A=Q,U=null,it=function(X){return(0,N.jsx)(j,d()(d()({},X),{},{language:"javascript"}))},dt=it,Pt=function(X){return(0,N.jsx)(V.ZP,d()({widgets:{json:A,js:dt}},X))},At=Pt,Ft=Pt||At},88593:function(ct,q,t){var K=t(57213),d=t.n(K),V=t(95915),Z=t(87363),J=t.n(Z),G=t(83132),_=t(33130);q.Z=function(i){var B,y=(0,V.cI)(),W=i.configSchemaProvider,w=function(f){var o,u,h;(o=i.editNode)===null||o===void 0||o.setAttrByPath("text/text",f.name);var R=(u=i.editNode)===null||u===void 0?void 0:u.data.config;i.editNode&&i.editNode.setData({config:d()(d()({},R),f)}),console.log("submit---props.editNode.data.config"),console.log((h=i.editNode)===null||h===void 0?void 0:h.data.config),i==null||i.onSubmit()},T=function(f){if(f&&f.data){var o,u=f.data.config||{},h=f.attrs;return u.name=h==null||(o=h.text)===null||o===void 0?void 0:o.text,u}else return{name:""}};return(0,Z.useEffect)(function(){if(i.editNode&&i.editNode.data){var l=i.editNode.data.config||{};W(i.editNode.data.configSchema||l.type).then(function(f){var o,u=i.editNode.attrs;l.name=u==null||(o=u.text)===null||o===void 0?void 0:o.text,console.log("nodeConfigSchema"),console.log(f),y.setSchema(f,!0),y.resetFields(),y.setValues(l)})}},[i.editNode,(B=i.editNode)===null||B===void 0?void 0:B.data]),(0,_.jsx)("div",{children:(0,_.jsx)(G.Z,{form:y,onFinish:w,onReset:function(){var f=T(i.editNode);y.setValues(f)},footer:!!i.onSubmit})})}},74613:function(ct,q,t){t.d(q,{r:function(){return Mt},Z:function(){return Ce}});var K=t(57213),d=t.n(K),V=t(93525),Z=t.n(V),J=t(21140),G=t.n(J),_=t(63466),i=t.n(_),B=t(68608),y=t.n(B),W=t(58853),w=t.n(W),T=t(38888),l=t.n(T),f=t(52510),o=t.n(f),u=t(68673),h=t(86961),R=t(38563),c=t(96209),N=t(74127),I=t(41181),et=t(33291),j=t(11165),O=t(89769),Q=t(9722),A=t(17696),U=t(19227),it=t(75476),dt=t(1167),Pt=t(22046),At=t(22150),Ft=t(11250),ot=t(29384),X=t(52001),P=t(69624),k=t(25232),nt=t(81021),jt=t(69145),rt=t(52192),ht=t(43889),ut=t(75133),gt=t(3573),ft=t(57035),lt=t(87363),mt=t.n(lt),St=t(6706),Jt=null;function bt(F,a,v,g){var n,S,b=F.data.config,x=b.type,E=v.flatMap(function(m){return m.source.cell===F.id?a[m.target.cell]:[]}),z=F.attrs,L=new St.Du((n=F.id)!==null&&n!==void 0?n:"",x);if(L=d()(d()({},b),{},{id:F.id,name:z==null||(S=z.text)===null||S===void 0?void 0:S.text}),!(g.findIndex(function(m){return m.id===L.id})>-1)&&(g.push(L),E.length!==0))switch(x){default:if(E.length>1||L.type==="switch"){var C;console.log((C=F.data)===null||C===void 0?void 0:C.config),console.log(E),L.branches=[],E.forEach(function(m){var s,Y,tt,M;console.log((s=m.data)===null||s===void 0?void 0:s.config),(Y=L.branches)===null||Y===void 0||Y.push({when:(tt=m.data)===null||tt===void 0||(M=tt.config)===null||M===void 0?void 0:M.case,nextId:m.id}),bt(a[m.id],a,v,g)})}else L.nextId=E[0].id,bt(a[E[0].id],a,v,g);break}}function Tt(F,a){var v=new St.Iz(F),g=[],n=[],S={},b=void 0;if(a.forEach(function(x){var E=x.id||"";if(x.shape==="edge")g.push(x);else{var z=x.attrs;S[E]=x,n.push(x),x.data.config.type==="start"&&(b=x)}}),!b){X.ZP.error("\u672A\u53D1\u73B0\u5F00\u59CB\u8282\u70B9\uFF0C\u8BF7\u914D\u7F6E\uFF01");return}return bt(b,S,g,v.items),console.log("logic.items"),console.log(v.items),v}var Lt=t(74095),Zt=t(45202),Ot=t(70823),Nt=t(82447),e=t(33130);function Wt(F){var a=[{key:"sharps-panel",label:(0,e.jsx)(Lt.Z,{style:{fontSize:"20px",marginTop:10}}),children:(0,e.jsx)("div",{ref:F.refStencil,style:{margin:0,height:"100vh",width:"100%"}})},{key:"logic",label:(0,e.jsx)(Zt.Z,{style:{fontSize:"20px",marginTop:10}}),children:(0,e.jsxs)("div",{style:{margin:0,height:"100vh"},children:[(0,e.jsx)(Ot.Z,{title:"\u7528\u4E8E\u89E3\u6790\u6267\u884C\u7F16\u6392\u7684\u903B\u8F91\u3002",children:(0,e.jsx)("h3",{children:"Logic DSL"})}),(0,e.jsx)(ot.ZP,{defaultLanguage:"json",options:{lineNumbers:"off",lineDecorationsWidth:0,minimap:{enabled:!1}},value:JSON.stringify(F.logic),onChange:F.onConfigChange})]})}];return(0,e.jsx)(Nt.Z,{tabPosition:"left",style:{margin:0},items:a,tabBarStyle:{width:50,margin:0}})}var Kt=Wt,Bt=t(85447),Ut=t(56027),It=t(61852),Xt=t(6525),Yt={log:{padding:"1px",marginBottom:"1px",fontFamily:"monospace"}};function $t(F){var a=F.type,v=F.data,g=null;switch(a){case"axioError":g=(0,e.jsxs)("span",{children:[(0,e.jsx)("pre",{style:{color:"red"},children:v.message}),(0,e.jsx)("pre",{children:v.stack}),(0,e.jsxs)("pre",{children:["config:",JSON.stringify(v.config,null,2)]})]});break;case"err":g=(0,e.jsxs)("span",{children:[(0,e.jsx)("pre",{style:{color:"red"},children:v.message}),(0,e.jsx)("pre",{children:v.stack})]});break;case"json":g=(0,e.jsx)("pre",{children:JSON.stringify(v,null,2)});break;default:g=(0,e.jsx)("span",{children:v});break}return(0,e.jsx)("div",{style:Yt.log,children:g})}var Ht=$t,Qt=function(a){var v=a.data,g=a.onClear;return(0,e.jsxs)("div",{id:"scrollableDiv",style:{overflow:"auto",padding:"0 0px",height:"90vh"},children:[(0,e.jsx)(k.ZP,{icon:(0,e.jsx)(Bt.Z,{}),onClick:function(){g&&g()},children:"\u6E05\u7A7A\u65E5\u5FD7"}),(0,e.jsx)(Xt.Z,{dataLength:v.length,next:function(){},hasMore:!1,loader:(0,e.jsx)(Ut.Z,{avatar:!0,paragraph:{rows:1},active:!0}),scrollableTarget:"scrollableDiv",children:(0,e.jsx)(It.Z,{dataSource:v,renderItem:function(S,b){return(0,e.jsx)(It.Z.Item,{children:(0,e.jsx)(Ht,d()({},S))},b)}})}),(0,e.jsx)(k.ZP,{icon:(0,e.jsx)(Bt.Z,{}),onClick:function(){g&&g()},children:"\u6E05\u7A7A\u65E5\u5FD7"})]})},qt=Qt,_t=t(88593);function te(F){var a=[{key:"1",label:"\u8282\u70B9\u914D\u7F6E",children:(0,e.jsx)("div",{style:{padding:5},children:(0,e.jsx)(_t.Z,{editNode:F.editNode,onSubmit:F.onSubmit,configSchemaProvider:F.configSchemaProvider})})},{key:"2",label:"\u8FD0\u884C\u65E5\u5FD7",children:(0,e.jsx)("div",{style:{padding:5},children:(0,e.jsx)(qt,{data:F.logs,onClear:F.onClear})})}];return(0,e.jsx)(Nt.Z,{style:{margin:0,height:"95vh",overflowY:"scroll"},items:a})}var ee=te,ne=t(11275),zt=t(92873),Et={name:{title:"\u540D\u79F0",type:"string",widget:"textArea",props:{rows:1}}};function ae(F){var a={type:"object",properties:{},column:1};switch(F){case"switch":a.properties=d()(d()({},Et),{},{condition:{title:"\u6761\u4EF6\u8868\u8FBE\u5F0F ",type:"string",widget:"js",props:{height:100},extra:"\u76F4\u63A5\u586B\u5199\u8868\u8FBE\u5F0F\u6216\u53D8\u91CF\u540D\uFF0C\u5982_par.outType"}});break;case"switch-case":a.properties=d()(d()({},Et),{},{case:{title:"case\u503C ",type:"string",extra:"\u503C\u4F1A\u8F6C\u6362\u4E3A\u5B57\u7B26\u4E32\u8FDB\u884C\u5339\u914D"}});break;case"js":a.properties=d()(d()({},Et),{},{script:{title:"js\u811A\u672C ",type:"string",widget:"js",props:{height:500},extra:"js\u4EE3\u7801\u5757\uFF0C\u53EF\u7528\u4E8E\u7B80\u5355\u7684\u903B\u8F91\u5B9A\u5236\uFF0C\u53D8\u91CF\u8D4B\u503C\u7B49"}});break;case"http":a.properties=d()(d()({},Et),{},{system:{title:"\u7CFB\u7EDF\u540D ",type:"string",defaultValue:""},url:{title:"\u8BF7\u6C42URL\uFF1A ",type:"string",widget:"js",props:{height:50},extra:"js\u4EE3\u7801\u5757\uFF0C\u9700\u8FD4\u56DEURL\u5B57\u7B26\u4E32"},method:{title:"\u8BF7\u6C42\u7C7B\u578B\uFF1A",type:"string",props:{options:[{label:"POST",value:"POST"},{label:"GET",value:"GET"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"}]},widget:"radio"},headers:{title:"\u8BF7\u6C42\u5934(headers) ",type:"string",widget:"js",props:{height:200},extra:"js\u4EE3\u7801\u5757\uFF0C\u9700\u8FD4\u56DE\u8BF7\u6C42\u5934\u5BF9\u8C61"},body:{title:"body\u8BF7\u6C42\u53C2\u6570",type:"string",widget:"js",props:{height:200},extra:"js\u4EE3\u7801\u5757\uFF0C\u9700\u8FD4\u56DEbody\u5BF9\u8C61"},return:{title:"\u5C06response.data\u8D4B\u503C\u7ED9\u54EA\u4E2A\u53C2\u6570\uFF1F",type:"string",widget:"js",props:{height:100},extra:"\u8F93\u5165\u5C40\u90E8\u53D8\u91CF\u7684\u5B8C\u6574\u5F15\u7528\uFF0C\u5982_var.repData"},queryParams:{title:"url\u53C2\u6570",type:"string",widget:"js",props:{height:100},extra:"js\u4EE3\u7801\u5757\uFF0C\u9700\u8FD4\u56DE\u5BF9\u8C61\uFF0C\u4F1A\u8F6C\u6362\u4E3A\u952E\u503C\u5BF9\u8FFD\u52A0\u5728url\u4E2D"},timeout:{title:"\u6267\u884C\u8D85\u65F6\u65F6\u957F(ms)",defaultValue:2e3,type:"number"}}),a.column=2;break;case"start":a.properties={name:{title:"\u540D\u79F0",type:"string",widget:"textArea",props:{rows:1}}};break;case"end":a.properties={name:{title:"\u540D\u79F0",type:"string",widget:"textArea",props:{rows:1}}};break;case"wait":a.properties={name:{title:"\u540D\u79F0",type:"string",widget:"textArea",props:{rows:1}},timeout:{title:"\u5EF6\u65F6\u8BBE\u7F6E(ms)",defaultValue:2e3,type:"number"}};break;case"mqtt-client":break;default:a.properties=Et}return a}var ie=t(64266),vt=t(76898),Vt=t(83132),Rt=t(95915),oe=function(a){var v,g=(0,Rt.cI)();(0,lt.useEffect)(function(){var S=a.values,b=S.params,x=S.variables,E=S.envs,z=S.returns;g.setValues({params:JSON.stringify(vt.y.getJsonByParams(b)),variables:JSON.stringify(vt.y.getJsonByParams(x)),returns:JSON.stringify(vt.y.getJsonByParams(z)),envs:JSON.stringify(vt.y.getJsonByParams(E))})},[a.values]);var n=(0,lt.useCallback)(function(S){try{return JSON.parse(S),!0}catch(b){return!1}},[]);return(0,e.jsxs)("span",{children:[a.children,(0,e.jsx)(rt.Z,{open:(v=a.open)!==null&&v!==void 0?v:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,onOk:function(){var b=g.getValues(),x=!1;Object.keys(b).forEach(function(E){var z=b[E];if(!n(z)){var L=E==="params"?"\u5165\u53C2":E==="variables"?"\u5C40\u90E8\u53D8\u91CF":E==="returns"?"\u8FD4\u56DE\u53C2\u6570":"\u73AF\u5883\u53D8\u91CF";return X.ZP.error("".concat(L,"json\u683C\u5F0F\u9519\u8BEF")),x=!0,!1}}),x||(a!=null&&a.onSubmit&&a.onSubmit(b),a==null||a.setOpen(!1))},onCancel:function(){return a==null?void 0:a.setOpen(!1)},children:(0,e.jsx)(Vt.Z,{form:g,schema:{type:"object",properties:{params:{title:"\u5165\u53C2\u58F0\u660E",type:"string",widget:"json",props:{height:200},extra:"\u7F16\u8F91\u5668\u4E2D\u53EF\u901A\u8FC7 _par. \u83B7\u53D6"},variables:{title:"\u5C40\u90E8\u53D8\u91CF\u58F0\u660E",type:"string",widget:"json",props:{height:200},extra:"\u7F16\u8F91\u5668\u4E2D\u53EF\u901A\u8FC7 _var. \u83B7\u53D6"},envs:{title:"\u73AF\u5883\u53D8\u91CF\u58F0\u660E",type:"string",widget:"json",props:{height:200},extra:"\u7F16\u8F91\u5668\u4E2D\u53EF\u901A\u8FC7 _env. \u83B7\u53D6"}},column:2}})})]})},re=oe,yt=t(34230),se=function(a,v){var g,n,S,b,x=v.getData(),E=v.getPosition(),z=a.getNodes(),L;if(["ExtSharp","polygon"].indexOf(v.shape)>-1)switch(x.config.type){case"switch":var C=200,m=a.addNode({shape:"switch",position:E,width:C,height:50,ports:yt.Tt,data:v.data,attrs:{body:{stroke:"#8f8f8f",strokeWidth:1,fill:"#fff",rx:6,ry:6}}});a.removeNode(v);var s=a.addNode({shape:"switch-case",position:{y:E.y+100,x:E.x-C/2},width:120,height:50,ports:yt.Tt,data:{config:{type:"switch-case"}}}),Y=a.addNode({shape:"switch-default",position:{y:E.y+100,x:E.x+C},width:120,height:50,ports:yt.Tt,data:{config:{type:"switch-default"}}}),tt=a.addEdge({source:m,sourcePort:(g=m.ports.items.find(function(st){return st.group=="bottom"}))===null||g===void 0?void 0:g.id,target:s,targetPort:(n=s.ports.items.find(function(st){return st.group=="top"}))===null||n===void 0?void 0:n.id,zIndex:0}),M=a.addEdge({source:m,sourcePort:(S=m.ports.items.find(function(st){return st.group=="bottom"}))===null||S===void 0?void 0:S.id,target:Y,targetPort:(b=Y.ports.items.find(function(st){return st.group=="top"}))===null||b===void 0?void 0:b.id,zIndex:0});L=m;break;case"switch-case":var r=a.createNode({shape:"switch-case",position:v.position(),width:120,height:50,ports:yt.Tt,data:v.data});a.removeNode(v),a.addNode(r),L=r;break;case"string":var p=a.createNode({shape:"string",position:v.position(),width:100,height:50,ports:yt.Tt,data:v.data});a.removeNode(v),a.addNode(p),L=p;break;case"num":var D=a.createNode({shape:"num",position:v.position(),width:100,height:50,ports:yt.Tt,data:v.data});a.removeNode(v),a.addNode(D),L=D;break;case"assignment":var $=a.createNode({shape:"assignment",position:v.position(),width:220,height:50,ports:yt.Tt,data:v.data});a.removeNode(v),a.addNode($),L=$;break;default:break}if(console.log("node:added"),L&&z.length==1){var H,at,pt,xt,Ct;a.addEdge({source:z[0],sourcePort:(H=z[0].ports.items.find(function(st){return st.group=="bottom"}))===null||H===void 0?void 0:H.id,target:L,targetPort:(at=L)===null||at===void 0||(pt=at.ports)===null||pt===void 0||(xt=pt.items)===null||xt===void 0||(Ct=xt.find(function(st){return st.group=="top"}))===null||Ct===void 0?void 0:Ct.id,zIndex:0})}},le=t(30685),de=function(a){var v,g=(0,Rt.cI)();(0,lt.useEffect)(function(){var S=a.values,b=S.params,x=S.envs;g.setValues({params:JSON.stringify(vt.y.getJsonByParams(b)),envs:JSON.stringify(vt.y.getJsonByParams(x))})},[a.values]);var n=(0,lt.useCallback)(function(S){try{return JSON.parse(S),!0}catch(b){return!1}},[]);return(0,e.jsxs)("span",{children:[a.children,(0,e.jsx)(rt.Z,{open:(v=a.open)!==null&&v!==void 0?v:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,onOk:function(){var b=g.getValues(),x=!1;Object.keys(b).forEach(function(E){var z=b[E];if(["params","envs"].indexOf(E)>-1&&!n(z)){var L=E==="params"?"\u5165\u53C2":"\u73AF\u5883\u53D8\u91CF";return X.ZP.error("".concat(L,"json\u683C\u5F0F\u9519\u8BEF")),x=!0,!1}}),x||(a!=null&&a.onSubmit&&a.onSubmit(b),a==null||a.setOpen(!1))},onCancel:function(){return a==null?void 0:a.setOpen(!1)},children:(0,e.jsx)(Vt.Z,{form:g,schema:{type:"object",properties:{params:{title:"\u5165\u53C2",type:"string",widget:"json",props:{height:200},extra:"\u7F16\u8F91\u5668\u4E2D\u53EF\u901A\u8FC7 _par. \u83B7\u53D6"},envs:{title:"\u73AF\u5883\u53D8\u91CF",type:"string",widget:"json",props:{height:200},extra:"\u7F16\u8F91\u5668\u4E2D\u53EF\u901A\u8FC7 _env. \u83B7\u53D6"},bizId:{title:"\u4E1A\u52A1\u6807\u8BC6",type:"string",props:{},extra:"\u6839\u636E\u4E1A\u52A1\u6807\u8BC6\u8DDF\u8E2A\u903B\u8F91\u5B9E\u4F8B"}},column:2}})})]})},ue=de,ce=t(60246),ve=t(54306),he=t.n(ve),fe=t(75657),ge=t(22407),Se=null,pe=function(a){var v=(0,ot.Ik)(),g=(0,lt.useState)(!1),n=he()(g,2),S=n[0],b=n[1];return(0,e.jsx)("div",{style:{width:"100%"},children:S?(0,e.jsx)(fe.Z,{title:"js\u7F16\u8F91\u5668",centered:!0,width:1200,bodyStyle:{height:"80vh"},open:S,footer:null,onCancel:function(){return b(!1)},children:(0,e.jsx)(ot.ML,d()(d()({theme:"vs-dark",defaultValue:a.value,defaultLanguage:a.language,options:{minimap:{enabled:!1}}},a),{},{height:"100%"}))}):(0,e.jsxs)("div",{children:[(0,e.jsx)(ot.ML,d()({className:"editorByLoader",theme:"vs-dark",defaultValue:a.value,defaultLanguage:a.language,onMount:function(E){var z;(z=E.getAction("editor.action.formatDocument"))===null||z===void 0||z.run(),E.setValue(E.getValue())},options:{minimap:{enabled:!1}},height:500},a)),(0,e.jsx)(k.ZP,{size:"small",type:"text",icon:(0,e.jsx)(ge.Z,{}),style:{position:"absolute",top:0,right:0,margin:"10px",color:"whitesmoke"},onClick:function(){return b(!0)}})]})})},kt=mt().memo(pe),me=t(5726),ye=t.n(me),Dt=t(48204),xe=[{key:"saveToPng",label:"\u5BFC\u51FA\u56FE\u7247"},{key:"saveToClipboard",label:"\u590D\u5236\u5230\u526A\u8D34\u677F"}],Mt=mt().createContext({logic:new St.Iz("")}),Gt=function(a,v){for(var g=0,n=a.length;g<n;g+=1)a[g].style.visibility=v?"visible":"hidden"},Ce=function(F){w()(v,F);var a=l()(v);function v(g){var n;G()(this,v),n=a.call(this,g),o()(y()(n),"container",void 0),o()(y()(n),"stencilContainer",void 0),o()(y()(n),"state",{editingNode:void 0,openEdgeEditor:!1,embeddingEnable:!1,editingEdge:void 0,leftToolCollapsed:!1,rightToolCollapsed:!0,openFlowSetting:!1,openRunLogic:!1,editorCtx:{logic:new St.Iz("1")},logs:[],panel:{nodes:[],groups:[]}}),o()(y()(n),"handleEdgeSubmit",function(C){var m;(m=n.state.editingEdge)===null||m===void 0||m.setLabels(C)}),o()(y()(n),"initGraph",function(C){var m,s=new O.kJ({container:C,embedding:{enabled:n.state.embeddingEnable,validate:function(p){return p.child.setData({hoverNode:p.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new O.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(p){var D=p.targetMagnet;return!!D}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}},background:{color:"#F2F7FA"},grid:!0});s.use(new dt.H({enabled:!0,sharp:!0})).use(new A.A({enabled:!0})).use(new it.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new At.T({enabled:!0})).use(new U.N).use(new Q.T).use(new Ft.D),s.on("edge:dblclick",function(r){var p=r.cell}),s.on("edge:mouseenter",function(r){var p=r.cell;p.addTools([{name:"button-remove",args:{distance:-40}}])}),s.on("edge:mouseleave",function(r){var p=r.cell;p.removeTools()}),s.on("node:moved",function(r){var p,D=r.e,$=r.x,H=r.y,at=r.node,pt=r.view,xt=(p=at.data)===null||p===void 0?void 0:p.hoverNode;if(n.state.embeddingEnable&&xt){var Ct,st,je=s.createEdge({source:xt,sourcePort:(Ct=xt.ports.items.find(function(wt){return wt.group=="bottom"}))===null||Ct===void 0?void 0:Ct.id,target:at,targetPort:(st=at.ports.items.find(function(wt){return wt.group=="top"}))===null||st===void 0?void 0:st.id,zIndex:0});at.data.hoverNode=void 0,s.addEdge(je),n.autoLayout(s)}}),s.on("node:mouseenter",function(r){var p,D,$,H=r.cell;((p=H.data)===null||p===void 0||(D=p.config)===null||D===void 0?void 0:D.type)!="start"&&H.addTools([{name:"button-remove",args:{x:"100%",y:0,offset:{x:-10,y:10}}}]);var at=($=n.container)===null||$===void 0?void 0:$.querySelectorAll(".x6-port-body");Gt(at,!0)}),s.on("node:mouseleave",function(r){var p,D=r.cell;D.removeTools();var $=(p=n.container)===null||p===void 0?void 0:p.querySelectorAll(".x6-port-body");Gt($,!1)}),s.on("node:click",function(r){var p=r.e,D=r.x,$=r.y,H=r.node,at=r.view;H.removeTools(),n.setState({editingNode:H})}),s.on("node:added",function(r){var p=r.node,D=r.index,$=r.options;se(s,p)}),s.on("node:dblclick",function(r){var p=r.e,D=r.x,$=r.y,H=r.node,at=r.view;n.setState({rightToolCollapsed:!1,editingNode:H})}),s.bindKey(["meta+c","ctrl+c"],function(){var r=s.getSelectedCells();return r.length&&s.copy(r),!1}),s.bindKey(["meta+x","ctrl+x"],function(){var r=s.getSelectedCells();return r.length&&s.cut(r),!1}),s.bindKey(["meta+v","ctrl+v"],function(){if(!s.isClipboardEmpty()){var r=s.paste({offset:32});s.cleanSelection(),s.select(r)}return!1}),s.bindKey(["meta+z","ctrl+z"],function(){return s.canUndo()&&s.undo(),!1}),s.bindKey(["meta+shift+z","ctrl+shift+z"],function(){return s.canRedo()&&s.redo(),!1}),s.bindKey("backspace",function(){var r=s.getSelectedCells();r.length&&(r.find(function(p){var D;return p.data?["start"].indexOf((D=p.data.config)===null||D===void 0?void 0:D.type)>-1:!1})?X.ZP.error("\u7981\u6B62\u5220\u9664\u5F00\u59CB\u8282\u70B9\uFF01"):s.removeCells(r))}),s.on("blank:dblclick",function(r){var p=r.e,D=r.x,$=r.y;console.log("blank:dbclick",D,$),n.autoLayout(s)}),s.bindKey(["ctrl+1","meta+1"],function(){var r=s.zoom();r<1.5&&s.zoom(.1)}),s.bindKey(["ctrl+2","meta+2"],function(){var r=s.zoom();r>.5&&s.zoom(-.1)}),n.state.graph=s;var Y=n.state.panel.groups,tt=new Pt.t({title:"\u5C55\u5F00/\u6536\u8D77",target:s,search:function(p,D){var $=p.getAttrByPath("text/text");return($==null?void 0:$.indexOf(D))!==-1},notFoundText:"\u672A\u627E\u5230",collapsable:!0,stencilGraphWidth:250,groups:Y,layoutOptions:{rowHeight:100}}),M={};return n.state.panel.nodes.forEach(function(r){var p=s.createNode(r);Y.forEach(function(D){r.groups.includes(D.name)&&(M[D.name]?M[D.name].push(p):M[D.name]=[p])})}),Object.keys(M).forEach(function(r){tt.load(Z()(M[r]),r)}),(m=n.stencilContainer)===null||m===void 0||m.appendChild(tt.container),n.props.config?(n.state.editorCtx.logic=n.props.config,s.fromJSON(n.state.editorCtx.logic.visualConfig)):((0,zt.X)(s),n.autoLayout(s)),s}),o()(y()(n),"autoLayout",function(C){(0,le.V)(C)}),o()(y()(n),"refContainer",function(C){n.container=C}),o()(y()(n),"refStencil",function(C){n.stencilContainer=C}),o()(y()(n),"handleSubmit",function(C){n.saveAndConvertGraphToDsl()}),o()(y()(n),"handleOnConfigChange",function(C){try{var m=JSON.parse(C);n.setState({stepFlow:m})}catch(s){console.log(s)}}),o()(y()(n),"onSaveMenuClick",function(C){var m;switch(C.key){case"saveToBrowser":break;case"loadFromBrowser":var s=localStorage.getItem("logic-json");if(s){var Y,tt=JSON.parse(s);n.state.editorCtx.logic=tt,(Y=n.state.graph)===null||Y===void 0||Y.fromJSON(tt.visualConfig),n.saveAndConvertGraphToDsl()}else X.ZP.info("\u6D4F\u89C8\u5668\u65E0\u7F13\u5B58\u6570\u636E");break;case"saveToClipboard":try{navigator.clipboard.writeText(JSON.stringify(n.state.editorCtx.logic))}catch(M){console.error(M)}break;case"saveToPng":(m=n.state.graph)===null||m===void 0||m.exportPNG(new Date().toLocaleDateString(),{backgroundColor:"#F2F7FA",padding:10,quality:1});break}}),o()(y()(n),"updateLogicAndEditorCtx",function(C){var m=d()(d()({},n.state.editorCtx.logic),C);return m.version=ye()(Date.now()).format("YYYYMMDDHHmmss"),n.setState({editorCtx:d()(d()({},n.state.editorCtx),{},{logic:m})}),m}),o()(y()(n),"saveAndConvertGraphToDsl",function(){var C,m=(C=n.state.graph)===null||C===void 0?void 0:C.toJSON(),s=n.convertGraphToDsl(m);if(s){var Y,tt=n.updateLogicAndEditorCtx({items:s.items,visualConfig:s.visualConfig});n.props.config&&(tt.id=(Y=n.props.config)===null||Y===void 0?void 0:Y.id),n.props.onSave&&n.props.onSave(tt);var M=JSON.stringify(tt);localStorage.setItem("logic-"+tt.name,M)}}),o()(y()(n),"saveFlowSettingAndConvertGraphToDsl",function(C){var m,s,Y,tt,M=vt.y.getParamArrayByJson(JSON.parse((m=C.params)!==null&&m!==void 0?m:"{}")),r=vt.y.getReturnArrayByJson(JSON.parse((s=C.returns)!==null&&s!==void 0?s:"{}")),p=vt.y.getVariableArrayByJson(JSON.parse((Y=C.variables)!==null&&Y!==void 0?Y:"{}")),D=vt.y.getEnvsArrayByJson(JSON.parse((tt=C.envs)!==null&&tt!==void 0?tt:"{}")),$=n.updateLogicAndEditorCtx({params:M,returns:r,variables:p,envs:D}),H=JSON.stringify($);localStorage.setItem("logic-json-"+$.id,H)}),o()(y()(n),"convertGraphToDsl",function(C){var m,s=Tt((m=n.props.config)===null||m===void 0?void 0:m.id,C.cells);return s&&(s.visualConfig=C),s}),o()(y()(n),"setFlowSetting",function(C){n.setState({openFlowSetting:C})});try{var S,b,x=(0,ne.K)(g.customNodes,g.customGroups,g.customSharps),E=x.Nodes,z=x.Shapes,L=x.Groups;(0,zt.m)(z),n.state.leftToolCollapsed=!(!((S=g.showLeft)!==null&&S!==void 0)||S),n.state.rightToolCollapsed=!((b=g.showRight)!==null&&b!==void 0&&b),n.state.panel.nodes=E,n.state.panel.groups=L}catch(C){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(C)}return n}return i()(v,[{key:"componentDidUpdate",value:function(n,S,b){if(this.props.config&&this.state.editorCtx.logic.id!=this.props.config.id){var x,E,z,L;this.state.editorCtx.logic=this.props.config,(x=this.state.editorCtx)!==null&&x!==void 0&&(E=x.logic)!==null&&E!==void 0&&E.visualConfig&&((z=this.state.graph)===null||z===void 0||z.fromJSON((L=this.state.editorCtx.logic)===null||L===void 0?void 0:L.visualConfig)),this.setState({editingNode:void 0})}}},{key:"componentDidMount",value:function(){var n;this.initGraph(this.container),this.updateLogicAndEditorCtx((n=this.state.editorCtx)===null||n===void 0?void 0:n.logic),ot._m.config({monaco:ft})}},{key:"render",value:function(){var n=this,S,b,x=this.state,E=x.editingNode,z=x.leftToolCollapsed,L=x.rightToolCollapsed,C=x.editorCtx,m=x.embeddingEnable,s=x.graph,Y=x.openFlowSetting,tt=x.openRunLogic,M=C.logic;return console.log("editorCtx",C),(0,e.jsx)(Mt.Provider,{value:C,children:(0,e.jsxs)(P.Z,{style:{height:"100vh",width:"100%",margin:0},children:[(0,e.jsx)(P.Z.Sider,{theme:"light",collapsed:z,collapsedWidth:0,width:300,children:(0,e.jsx)(Kt,{refStencil:this.refStencil,graph:this.state.graph,logic:M,onConfigChange:this.handleOnConfigChange})}),(0,e.jsxs)(P.Z,{style:{height:"100%"},children:[(0,e.jsxs)(P.Z.Header,{style:{padding:0,backgroundColor:"white"},children:[(0,e.jsx)(k.ZP,{type:"text",icon:z?(0,e.jsx)(u.Z,{}):(0,e.jsx)(h.Z,{}),onClick:function(){n.setState({leftToolCollapsed:!z})},style:{fontSize:"16px",width:64,height:64}}),(0,e.jsxs)(nt.Z,{direction:"horizontal",children:[(0,e.jsx)(jt.Z.Button,{style:{float:"inline-start"},menu:{items:xe,onClick:this.onSaveMenuClick},buttonsRender:function(p){return[(0,e.jsx)(k.ZP,{type:"primary",icon:(0,e.jsx)(R.Z,{}),onClick:n.saveAndConvertGraphToDsl,children:"\u4FDD\u5B58"}),(0,e.jsx)(k.ZP,{type:"primary",icon:(0,e.jsx)(c.Z,{})})]},children:"\u4FDD\u5B58"}),(0,e.jsx)(re,{open:Y,values:d()({},M),setOpen:this.setFlowSetting,onSubmit:this.saveFlowSettingAndConvertGraphToDsl,children:(0,e.jsx)(k.ZP,{onClick:function(){return n.setFlowSetting(!0)},icon:(0,e.jsx)(N.Z,{}),children:"\u914D\u7F6E\u53C2\u6570"})}),(S=this.props.btns)===null||S===void 0?void 0:S.map(function(r){return(0,e.jsx)(k.ZP,d()({},r))}),(0,e.jsx)(ue,{open:tt,setOpen:function(p){return n.setState({openRunLogic:p})},values:{params:M==null?void 0:M.params},onSubmit:function(p){if(n.setState({openRunLogic:!1}),M){var D=p.params,$=p.bizId;(0,ce.nt)(M.id,JSON.parse(D),$).then(function(H){if(H.data.code==0){var at;rt.Z.success({title:"\u6267\u884C\u6210\u529F",width:"1000px",closable:!0,content:(0,e.jsx)("div",{children:(0,e.jsx)(ht.Z,{children:(0,e.jsx)(ut.Z,{children:(0,e.jsx)(ht.Z,{children:(0,e.jsxs)(ut.Z,{span:24,children:[(0,e.jsx)("h4",{children:H.data.msg}),(0,e.jsx)(Dt.gcu,{src:(at=H.data)!==null&&at!==void 0?at:{},collapsed:1})]})})})})})})}else{var pt;rt.Z.error({title:(0,e.jsx)("span",{children:H.data.msg}),width:"1000px",closable:!0,content:(0,e.jsx)("div",{children:(0,e.jsx)(ht.Z,{children:(0,e.jsx)(ut.Z,{children:(0,e.jsxs)(ht.Z,{children:[(0,e.jsxs)(ut.Z,{span:12,children:[(0,e.jsx)("h4",{children:"\u9519\u8BEF\u8BE6\u7EC6:"}),(0,e.jsx)(Dt.gcu,{src:(pt=H.data.error)!==null&&pt!==void 0?pt:{},collapsed:1})]}),(0,e.jsxs)(ut.Z,{span:12,children:[(0,e.jsx)("h4",{children:"\u8FD4\u56DE\u6570\u636E:"}),(0,e.jsx)(kt,{language:"json",value:JSON.stringify(H.data),width:500})]})]})})})})})}}).catch(function(H){var at=H.response.data;rt.Z.error({title:(0,e.jsx)("span",{children:at.msg}),width:"1000px",closable:!0,content:(0,e.jsx)("div",{children:(0,e.jsx)(ht.Z,{children:(0,e.jsx)(ut.Z,{children:(0,e.jsxs)(ht.Z,{children:[(0,e.jsxs)(ut.Z,{span:12,children:[(0,e.jsx)("h4",{children:"\u9519\u8BEF\u8BE6\u7EC6:"}),(0,e.jsx)(Dt.gcu,{src:at.error,collapsed:1})]}),(0,e.jsxs)(ut.Z,{span:12,children:[(0,e.jsx)("h4",{children:"\u8FD4\u56DE\u6570\u636E:"}),(0,e.jsx)(kt,{language:"json",value:JSON.stringify(at.data),width:500})]})]})})})})})}),n.state.logs.push({data:new Date().toLocaleTimeString()})}},children:(0,e.jsx)(k.ZP,{type:"default",onClick:function(){n.setState({openRunLogic:!0})},icon:(0,e.jsx)(I.Z,{}),children:"\u8C03\u8BD5"})}),(0,e.jsxs)("span",{children:["\u5F53\u524D\u7248\u672C:",M.version]})]}),(0,e.jsxs)(nt.Z,{style:{float:"right",right:"16px"},children:[(0,e.jsxs)("span",{children:["\u62D6\u62FD\u8FDE\u7EBF",(0,e.jsx)(gt.Z,{checked:m,onChange:function(p){n.setState({embeddingEnable:p})},checkedChildren:(0,e.jsx)(et.Z,{}),unCheckedChildren:(0,e.jsx)(j.Z,{})})]}),(0,e.jsx)(k.ZP,{type:"text",icon:L?(0,e.jsx)(h.Z,{}):(0,e.jsx)(u.Z,{}),onClick:function(){n.setState({rightToolCollapsed:!L})},style:{fontSize:"16px",width:64,height:64}})]})]}),(0,e.jsx)(P.Z.Content,{className:"app-content",children:(0,e.jsx)(ie.Z,{ref:this.refContainer})})]}),(0,e.jsxs)(P.Z.Sider,{theme:"light",collapsed:L,collapsedWidth:0,width:600,children:[(0,e.jsx)(k.ZP,{type:"text",onClick:function(){n.setState({rightToolCollapsed:!L})},style:{float:"right",fontSize:"16px",width:64,height:64},children:"x"}),(0,e.jsx)(ee,{onClear:function(){return n.setState({logs:[]})},editNode:E,onSubmit:this.handleSubmit,logs:this.state.logs,configSchemaProvider:(b=this.props.configSchemaProvider)!==null&&b!==void 0?b:ae})]})]})})}}]),v}(mt().Component)},64266:function(ct,q,t){t.d(q,{Z:function(){return Z}});var K=t(87363),d=t(33130),V=(0,K.forwardRef)(function(J,G){return(0,d.jsx)("div",{className:"drag-graph",ref:G})}),Z=V},30685:function(ct,q,t){t.d(q,{V:function(){return d}});var K=t(59197),d=function(Z){var J=new K.Vq({type:"dagre",begin:[400,100],rankdir:"TB",ranksep:20,nodeSize:50,controlPoints:!0}),G=Z.getNodes(),_=Z.getEdges(),i=J.layout({nodes:G,edges:_}),B=i.nodes,y=B===void 0?[]:B;G.forEach(function(W){var w=y.find(function(T){return T.id===W.id});w.x-=W.size().width/2,w.y-=W.size().height/2,W.position(w.x,w.y)})}},34230:function(ct,q,t){t.d(q,{Hi:function(){return V},Tt:function(){return K}});var K={groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]},d={groups:{right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1}},items:[{group:"right"}]},V={groups:{bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1}},items:[{group:"bottom"}]}},92873:function(ct,q,t){t.d(q,{X:function(){return o},m:function(){return f}});var K=t(89769),d=t(17851),V=t(43118),Z={customNode:"customNode___AyPI8",input:"input___Q5PmS",switchNode:"switchNode___fqB9a"},J=t(33130),G=function(h){return(0,J.jsx)("div",{className:Z.customNode,children:(0,J.jsx)(V.Z,{className:"input",value:h==null?void 0:h.data,width:80})})},_=t(52205),i=function(h){return(0,J.jsx)("div",{className:styles.customNode,children:(0,J.jsx)(_.Z,{className:"input",value:h==null?void 0:h.data,width:80})})},B=t(57213),y=t.n(B),W=function(h){var R,c,N,I=h.node,et=(R=I.data.config)===null||R===void 0?void 0:R.name,j=et||"case";return(0,J.jsxs)("div",{className:Z.customNode,children:[(0,J.jsx)("span",{children:"case"}),(0,J.jsx)(V.Z,{addonAfter:et,className:"input",value:I==null||(c=I.data)===null||c===void 0||(N=c.config)===null||N===void 0?void 0:N.case,width:150,onChange:function(Q){var A=I.data;I.setData(y()(y()({},A),{},{config:y()(y()({},A.config),{},{case:Q.target.value})}))}})]})},w=function(h){var R,c=h.node;return(0,J.jsx)("div",{className:Z.customNode,children:(0,J.jsx)(V.Z,{addonBefore:"switch",className:"input",value:(R=c.data)===null||R===void 0?void 0:R.config.condition,onChange:function(I){var et=c.data;c.setData(y()(y()({},et),{},{config:y()(y()({},et.config),{},{condition:I.target.value})}))},width:100})})},T=t(34230),l=function(h){return(0,J.jsx)("div",{className:Z.customNode,children:(0,J.jsx)("div",{style:{textAlign:"center",fontSize:"15px"},children:"default"})})};function f(u){u.forEach(function(h){console.log("\u6CE8\u518C\u65B0\u8282\u70B9:"+h.name),K.kJ.registerNode(h.name,h.config,!0)}),(0,d.z2)({shape:"string",component:G}),(0,d.z2)({shape:"num",component:i}),(0,d.z2)({shape:"switch",component:w}),(0,d.z2)({shape:"switch-case",component:W}),(0,d.z2)({shape:"switch-default",component:l})}function o(u){var h=u.createNode({shape:"circle",label:"start",width:50,height:50,attrs:{body:{}},ports:T.Hi,data:{config:{type:"start"}}});u.addNode(h)}},11275:function(ct,q,t){t.d(q,{K:function(){return _}});var K=t(57213),d=t.n(K),V=t(34230),Z=50,J=50,G=[{name:"ExtSharp",config:{width:100,height:J,attrs:{body:{rx:6,ry:6,stroke:"#5F95FF",strokeWidth:1,fill:"rgba(95,149,255,0.05)",refWidth:1,refHeight:1},image:{refX:2,refY:0},text:{refX:4,refY:20,fontSize:12,"text-anchor":"start"}},markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}}];function _(i,B,y){var W=50,w=50,T={body:{}},l=[{shape:"circle",width:W,height:w,attrs:{body:d()(d()({},T.body),{},{fill:"white"}),text:{text:"\u4EA4\u4E92\u70B9"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:V.Tt,data:{config:{type:"wait-for-continue"}},groups:["global"]},{shape:"circle",label:"end",width:W,height:w,attrs:{body:d()(d()({},T.body),{},{fill:"#d9d9d9"}),text:{text:"end"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:V.Tt,data:{config:{type:"end"}},groups:["global"]},{shape:"ExtSharp",attrs:{text:{text:"http\u8BF7\u6C42",fontSize:14},image:{"xlink:href":"/icons/http.svg",width:20,x:2,y:2}},data:{config:{type:"http",method:"POST"}},ports:V.Tt,groups:["biz"]},{shape:"ExtSharp",ports:V.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/code.svg"},text:{text:"js\u4EE3\u7801\u5757",fontSize:14}},data:{config:{type:"js"}},groups:["biz"]},{shape:"ExtSharp",ports:V.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/CarbonSubflowLocal.svg"},text:{text:"\u590D\u7528\u903B\u8F91",fontSize:14}},data:{config:{type:"process"}},groups:["biz"]},{shape:"ExtSharp",width:50,height:w,label:"switch",attrs:{image:{"xlink:href":"/icons/switch.svg",width:45,x:1,y:2},text:{text:"switch",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"switch"}},ports:V.Tt,groups:["ctrl"]},{shape:"ExtSharp",width:W,height:w,attrs:{image:{"xlink:href":"/icons/text.svg",width:30,x:8,y:10},text:{text:"case",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"switch-case"}},ports:V.Tt,groups:["ctrl"]}];i&&i.length>0&&Array.prototype.push.apply(l,i);var f=[{name:"global",title:"\u5168\u5C40\u8282\u70B9",graphHeight:110},{name:"ctrl",title:"\u903B\u8F91\u63A7\u5236",graphHeight:110},{name:"biz",title:"\u4E1A\u52A1\u8C03\u7528",graphHeight:220}];B&&B.length>0&&Array.prototype.push.apply(f,B);var o=G;return y&&y.length>0&&Array.prototype.push.apply(o,y),{Shapes:o,Nodes:l,Groups:f}}},60246:function(ct,q,t){t.d(q,{_5:function(){return h},dS:function(){return c},XY:function(){return I},nt:function(){return w}});var K=t(25359),d=t.n(K),V=t(49811),Z=t.n(V),J=t(70517);function G(j,O){return axios.get(j,O)}function _(j,O,Q){return axios.put(j,O,Q)}function i(j,O){return axios.delete(j,O)}function B(j,O,Q){return J.Z.post(j,O,Q)}function y(j,O){return W.apply(this,arguments)}function W(){return W=_asyncToGenerator(_regeneratorRuntime().mark(function j(O,Q){return _regeneratorRuntime().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.abrupt("return",post("/api/runtime/logic/v1/run-fn/".concat(O),Q,{headers:{"Content-Type":"application/json"}}));case 1:case"end":return U.stop()}},j)})),W.apply(this,arguments)}function w(j,O,Q){return T.apply(this,arguments)}function T(){return T=Z()(d()().mark(function j(O,Q,A){var U;return d()().wrap(function(dt){for(;;)switch(dt.prev=dt.next){case 0:return A?U="/api/runtime/logic/v1/run-biz/".concat(O,"/").concat(A,"?debug=true"):U="/api/runtime/logic/v1/run-api/".concat(O,"?debug=true"),dt.abrupt("return",B(U,Q,{headers:{"Content-Type":"application/json"}}));case 2:case"end":return dt.stop()}},j)})),T.apply(this,arguments)}function l(j,O){return f.apply(this,arguments)}function f(){return f=_asyncToGenerator(_regeneratorRuntime().mark(function j(O,Q){return _regeneratorRuntime().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.abrupt("return",axios.post("/api/form/logic_instance/query",{filters:[{dataIndex:"logicId",values:[O],type:"and"},{dataIndex:"bizId",values:[Q],type:"and"}]}).then(function(it){var dt=it.data.result.items[0];return dt}));case 1:case"end":return U.stop()}},j)})),f.apply(this,arguments)}function o(j){return u.apply(this,arguments)}function u(){return u=_asyncToGenerator(_regeneratorRuntime().mark(function j(O){return _regeneratorRuntime().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.abrupt("return",axios.get("/api/ide/logic-instance/".concat(O)).then(function(U){var it=U.data.data;return it}));case 1:case"end":return A.stop()}},j)})),u.apply(this,arguments)}function h(j){return R.apply(this,arguments)}function R(){return R=Z()(d()().mark(function j(O){return d()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.abrupt("return",J.Z.post("/api/form/logic/add",O).then(function(U){var it=U.data.result;return it}));case 1:case"end":return A.stop()}},j)})),R.apply(this,arguments)}function c(j){return N.apply(this,arguments)}function N(){return N=Z()(d()().mark(function j(O){return d()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.abrupt("return",J.Z.delete("/api/form/logic/delete/".concat(O)).then(function(U){return U.data.result}));case 1:case"end":return A.stop()}},j)})),N.apply(this,arguments)}function I(){return et.apply(this,arguments)}function et(){return et=Z()(d()().mark(function j(){var O,Q,A=arguments;return d()().wrap(function(it){for(;;)switch(it.prev=it.next){case 0:return O=A.length>0&&A[0]!==void 0?A[0]:1,Q=A.length>1&&A[1]!==void 0?A[1]:10,it.abrupt("return",J.Z.post("/api/form/logic/query",{page:O,pageSize:Q}).then(function(dt){return dt.data}));case 3:case"end":return it.stop()}},j)})),et.apply(this,arguments)}}}]);
