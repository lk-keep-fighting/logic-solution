"use strict";(self.webpackChunkxuanwu_logic_web_design=self.webpackChunkxuanwu_logic_web_design||[]).push([[4784],{6706:function(ft,$,t){t.d($,{Ld:function(){return Y},Iz:function(){return m},Du:function(){return X},dO:function(){return T},z1:function(){return h},X0:function(){return V},_w:function(){return G}});var Y=function(u){return u.TypeAnnotation="TypeAnnotation",u.Structure="Structure",u.StructureProperty="StructureProperty",u.TypeParam="TypeParam",u.Variable="Variable",u.Logic="Logic",u.LogicItem="LogicItem",u}({}),v=function(u){return u.start="start",u.end="end",u.switch="switch",u["switch-case"]="switch-case",u["switch-def"]="switch-def",u["mqtt-pub"]="mqtt-pub",u["mqtt-sub"]="mqtt-sub",u["mqtt-unsub"]="mqtt-unsub",u["mqtt-client"]="mqtt-client",u["mqtt-server"]="mqtt-server",u["mqtt-broker"]="mqtt-broker",u.http="http",u.logic="logic",u.js="js",u.wait="wait",u}({}),J=t(63466),P=t.n(J),M=t(21140),k=t.n(M),W=t(52510),i=t.n(W),V=P()(function u(N){k()(this,u),i()(this,"concept",void 0),i()(this,"name",void 0),i()(this,"label",void 0),i()(this,"description",void 0),i()(this,"typeAnnotation",void 0),i()(this,"required",!1),i()(this,"defaultValue",void 0),this.concept=Y.StructureProperty,this.name=N}),m=P()(function u(N){k()(this,u),i()(this,"concept",Y.Logic),i()(this,"schemeVersion",void 0),i()(this,"version",void 0),i()(this,"id",void 0),i()(this,"name",void 0),i()(this,"label",void 0),i()(this,"description",void 0),i()(this,"triggerType",void 0),i()(this,"cron",void 0),i()(this,"typeParams",void 0),i()(this,"params",void 0),i()(this,"returns",void 0),i()(this,"variables",void 0),i()(this,"envs",void 0),i()(this,"items",[]),i()(this,"visualConfig",void 0),this.id=N,this.schemeVersion="0.1"}),X=P()(function u(N,I){var q=this;k()(this,u),i()(this,"concept","LogicItem"),i()(this,"id",void 0),i()(this,"name",void 0),i()(this,"type",void 0),i()(this,"label",void 0),i()(this,"description",void 0),i()(this,"params",void 0),i()(this,"returns",void 0),i()(this,"envs",void 0),i()(this,"afterReturnAdaptor",void 0),i()(this,"returnAccept",void 0),i()(this,"nextId",void 0),i()(this,"endId",void 0),i()(this,"condition",void 0),i()(this,"script",void 0),i()(this,"timeout",void 0),i()(this,"branches",void 0),i()(this,"url",void 0),i()(this,"method",void 0),i()(this,"headers",void 0),i()(this,"queryParams",void 0),i()(this,"body",void 0),i()(this,"setEnv",function(it){q.envs=it}),this.type=I,this.id=N}),z=null,T=P()(function u(N){k()(this,u),i()(this,"concept","Param"),i()(this,"name",void 0),i()(this,"description",void 0),i()(this,"typeAnnotation",void 0),i()(this,"required",void 0),i()(this,"defaultValue",void 0),this.name=N}),l=t(58853),f=t.n(l),o=t(38888),d=t.n(o),h=function(u){f()(I,u);var N=d()(I);function I(q){var it;return k()(this,I),it=N.call(this,q),it.concept="Return",it}return P()(I)}(T),G=function(u){f()(I,u);var N=d()(I);function I(q){var it;return k()(this,I),it=N.call(this,q),it.concept="Variable",it}return P()(I)}(T)},76898:function(ft,$,t){t.d($,{y:function(){return X}});var Y=t(37635),v=t.n(Y),J=t(21140),P=t.n(J),M=t(63466),k=t.n(M),W=t(6706),i=t(52510),V=t.n(i),m=k()(function z(T){P()(this,z),V()(this,"concept","EnvParam"),V()(this,"name",void 0),V()(this,"description",void 0),V()(this,"typeAnnotation",void 0),V()(this,"required",!1),V()(this,"defaultValue",void 0),this.name=T}),X=function(){function z(){P()(this,z)}return k()(z,null,[{key:"valueToTypeAnnotaion",value:function(l){var f=this,o={concept:W.Ld.TypeAnnotation,typeKind:"primitive",typeName:"string",defaultValue:l};if(Array.isArray(l))o.typeName="array";else{var d=v()(l);switch(d){case"boolean":o.typeKind="primitive",o.typeName="boolean";break;case"number":o.typeKind="primitive",o.typeName="number";break;case"string":o.typeKind="primitive",o.typeName="string";break;case"object":l==null?o.typeName="null":l instanceof Date?(o.typeKind="primitive",o.typeName="date"):l instanceof RegExp?(o.typeKind="primitive",o.typeName="regexp"):l instanceof Function?(o.typeKind="primitive",o.typeName="function"):(o.typeKind="anonymousStructure",o.typeName="object",o.properties=[],Object.keys(l).map(function(h){var G,u=l[h],N=f.valueToTypeAnnotaion(u),I=new W.X0(h);I.typeAnnotation=N,I.defaultValue=u,(G=o.properties)===null||G===void 0||G.push(I)}));break;default:o.typeKind="unknown",o.typeName=d;break}}return o}},{key:"typeAnnotaionToValue",value:function(l){var f,o,d=this,h;switch(l.typeName){case"array":h=(f=l.defaultValue)!==null&&f!==void 0?f:[];break;case"boolean":h=l.defaultValue?l.defaultValue=="true":!1;break;case"number":h=parseFloat(l.defaultValue);break;case"null":h=null;break;case"date":h=new Date(l.defaultValue);break;case"regexp":h=new RegExp(l.defaultValue);break;case"object":h={},(o=l.properties)===null||o===void 0||o.forEach(function(G){h[G.name]=d.typeAnnotaionToValue(G.typeAnnotation)});break;case"string":case"function":default:h=l.defaultValue;break}return h}},{key:"getParamArrayByJson",value:function(l){var f=[];return l&&Object.keys(l).forEach(function(o){var d=new W.dO(o);d.typeAnnotation=z.valueToTypeAnnotaion(l[o]),d.defaultValue=l[o],f.push(d)}),f}},{key:"getReturnArrayByJson",value:function(l){var f=[];return l&&Object.keys(l).forEach(function(o){var d=new W.z1(o);d.typeAnnotation=z.valueToTypeAnnotaion(l[o]),d.defaultValue=l[o],f.push(d)}),f}},{key:"getVariableArrayByJson",value:function(l){var f=[];return l&&Object.keys(l).forEach(function(o){var d=new W._w(o);d.typeAnnotation=z.valueToTypeAnnotaion(l[o]),d.defaultValue=l[o],f.push(d)}),f}},{key:"getEnvsArrayByJson",value:function(l){var f=[];return l&&Object.keys(l).forEach(function(o){var d=new m(o);d.typeAnnotation=z.valueToTypeAnnotaion(l[o]),d.defaultValue=l[o],f.push(d)}),f}},{key:"getJsonByParams",value:function(l){var f=this,o={};return l==null||l.forEach(function(d){o[d.name]=d.typeAnnotation?f.typeAnnotaionToValue(d.typeAnnotation):d.defaultValue}),o}}]),z}()},83132:function(ft,$,t){t.d($,{Z:function(){return Et}});var Y=t(57213),v=t.n(Y),J=t(69947),P=t(63466),M=t(21140),k=t(52510),W=t(54306),i=t.n(W),V=t(29384),m=t(60463),X=t(25232),z=t(75657),T=t(87363),l=t.n(T),f=t(37635),o=t.n(f),d=function Z(nt){var E="{";return Object.keys(nt).forEach(function(_){var F=nt[_];E+="".concat(_,":"),Array.isArray(F)?E+="[],":o()(F)=="object"?E+=Z(F)+",":typeof F=="string"?E+="'".concat(F,"',"):E+="".concat(F,",")}),E+="}",E},h=function(nt,E){var _="";E&&(Object.keys(E).forEach(function(ht){var vt=E[ht];_+="".concat(ht,":"),Array.isArray(vt)?_+="[],":o()(vt)=="object"?_+=d(vt)+",":typeof vt=="string"?_+="'".concat(vt,"',"):_+="".concat(vt,",")}),_=_.substring(0,_.length-1));var F="const ".concat(nt,"={").concat(_,"}");return F},G=t(22407),u=t(76898),N=t(33130),I=null,q=function(nt){var E=(0,V.Ik)(),_=(0,T.useContext)(m.r),F=_.logic;(0,T.useEffect)(function(){if(F){var gt,pt,yt,Pt,Lt=u.y.getJsonByParams((gt=F.variables)!==null&&gt!==void 0?gt:[]),bt=h("_var",Lt),wt=u.y.getJsonByParams((pt=F.params)!==null&&pt!==void 0?pt:[]),Ft=h("_par",wt),a=u.y.getJsonByParams((yt=F.returns)!==null&&yt!==void 0?yt:[]),Zt=h("_ret",a),Dt=u.y.getJsonByParams((Pt=F.envs)!==null&&Pt!==void 0?Pt:[]),Ot=h("_env",Dt);E==null||E.languages.typescript.javascriptDefaults.addExtraLib(bt,"var.ts"),E==null||E.languages.typescript.javascriptDefaults.addExtraLib(Ft,"input.ts"),E==null||E.languages.typescript.javascriptDefaults.addExtraLib(Zt,"return.ts"),E==null||E.languages.typescript.javascriptDefaults.addExtraLib(Ot,"env.ts"),E==null||E.languages.typescript.javascriptDefaults.addExtraLib("let _lastRet:{}","lastRet.ts")}return function(){var Nt;console.log("effect dispose"),E==null||(Nt=E.current)===null||Nt===void 0||Nt.dispose()}},[F==null?void 0:F.params,F==null?void 0:F.variables,F==null?void 0:F.returns,F==null?void 0:F.envs]);var ht=(0,T.useState)(!1),vt=i()(ht,2),Ct=vt[0],Tt=vt[1];return(0,N.jsx)("div",{style:{width:"100%"},children:Ct?(0,N.jsx)(z.Z,{title:"js\u7F16\u8F91\u5668",centered:!0,width:1200,bodyStyle:{height:"80vh"},open:Ct,footer:null,onCancel:function(){return Tt(!1)},children:(0,N.jsx)(V.ML,v()(v()({theme:"vs-dark",defaultValue:nt.value,defaultLanguage:nt.language,options:{minimap:{enabled:!1}}},nt),{},{height:"100%"}))}):(0,N.jsxs)("div",{children:[(0,N.jsx)(V.ML,v()({className:"editorByLoader",theme:"vs-dark",defaultValue:nt.value,defaultLanguage:nt.language,onMount:function(pt){var yt;(yt=pt.getAction("editor.action.formatDocument"))===null||yt===void 0||yt.run(),pt.setValue(pt.getValue())},options:{minimap:{enabled:!1}},height:500},nt)),(0,N.jsx)(X.ZP,{size:"small",type:"text",icon:(0,N.jsx)(G.Z,{}),style:{position:"absolute",top:0,right:0,margin:"10px",color:"whitesmoke"},onClick:function(){return Tt(!0)}})]})})},it=l().memo(q),xt=null,L=function(nt){return(0,N.jsx)(it,v()(v()({},nt),{},{language:"json"}))},A=L,et=null,w=function(nt){return(0,N.jsx)(it,v()(v()({},nt),{},{language:"javascript"}))},U=w,ot=t(57035),ut=function(nt){return(0,T.useEffect)(function(){V._m.config({monaco:ot})},[]),(0,N.jsx)(J.ZP,v()({widgets:{json:A,js:U}},nt))},lt=ut,Et=ut||lt},88593:function(ft,$,t){var Y=t(57213),v=t.n(Y),J=t(69947),P=t(87363),M=t.n(P),k=t(83132),W=t(33130);$.Z=function(i){var V,m=(0,J.cI)(),X=i.configSchemaProvider,z=function(f){var o,d,h;(o=i.editNode)===null||o===void 0||o.setAttrByPath("text/text",f.name);var G=(d=i.editNode)===null||d===void 0?void 0:d.data.config;i.editNode&&i.editNode.setData({config:v()(v()({},G),f)}),console.log("submit---props.editNode.data.config"),console.log((h=i.editNode)===null||h===void 0?void 0:h.data.config),i==null||i.onSubmit()},T=function(f){if(f&&f.data){var o,d=f.data.config||{},h=f.attrs;return d.name=h==null||(o=h.text)===null||o===void 0?void 0:o.text,d}else return{name:""}};return(0,P.useEffect)(function(){if(i.editNode&&i.editNode.data){var l=i.editNode.data.config||{};X(i.editNode.data.configSchema||l.type).then(function(f){var o,d=i.editNode.attrs;l.name=d==null||(o=d.text)===null||o===void 0?void 0:o.text,console.log("nodeConfigSchema"),console.log(f),m.setSchema(f,!0),m.resetFields(),m.setValues(l)})}},[i.editNode,(V=i.editNode)===null||V===void 0?void 0:V.data]),(0,W.jsx)("div",{children:(0,W.jsx)(k.Z,{form:m,onFinish:z,onReset:function(){var f=T(i.editNode);m.setValues(f)},footer:!!i.onSubmit})})}},60463:function(ft,$,t){t.d($,{r:function(){return kt},Z:function(){return le}});var Y=t(57213),v=t.n(Y),J=t(93525),P=t.n(J),M=t(21140),k=t.n(M),W=t(63466),i=t.n(W),V=t(68608),m=t.n(V),X=t(58853),z=t.n(X),T=t(38888),l=t.n(T),f=t(52510),o=t.n(f),d=t(68673),h=t(86961),G=t(38563),u=t(96209),N=t(74127),I=t(41181),q=t(89769),it=t(9722),xt=t(17696),L=t(19227),A=t(75476),et=t(1167),w=t(22046),U=t(22150),ot=t(11250),ut=t(52001),lt=t(69624),Et=t(81021),Z=t(25232),nt=t(69145),E=t(52192),_=t(43889),F=t(75133),ht=t(87363),vt=t.n(ht),Ct=t(6706),Tt=null;function gt(R,n,c,S){var e,b,C=R.data.config,y=C.type,j=c.flatMap(function(x){return x.source.cell===R.id?n[x.target.cell]:[]}),O=R.attrs,D=new Ct.Du((e=R.id)!==null&&e!==void 0?e:"",y);if(D=v()(v()({},C),{},{id:R.id,name:O==null||(b=O.text)===null||b===void 0?void 0:b.text}),!(S.findIndex(function(x){return x.id===D.id})>-1)&&(S.push(D),j.length!==0))switch(y){default:if(j.length>1||D.type==="switch"){var p;console.log((p=R.data)===null||p===void 0?void 0:p.config),console.log(j),D.branches=[],j.forEach(function(x){var s,H,tt,K;console.log((s=x.data)===null||s===void 0?void 0:s.config),(H=D.branches)===null||H===void 0||H.push({when:(tt=x.data)===null||tt===void 0||(K=tt.config)===null||K===void 0?void 0:K.case,nextId:x.id}),gt(n[x.id],n,c,S)})}else D.nextId=j[0].id,gt(n[j[0].id],n,c,S);break}}function pt(R,n){var c=new Ct.Iz(R),S=[],e=[],b={},C=void 0;if(n.forEach(function(y){var j=y.id||"";if(y.shape==="edge")S.push(y);else{var O=y.attrs;b[j]=y,e.push(y),y.data.config.type==="start"&&(C=y)}}),!C){ut.ZP.error("\u672A\u53D1\u73B0\u5F00\u59CB\u8282\u70B9\uFF0C\u8BF7\u914D\u7F6E\uFF01");return}return gt(C,b,S,c.items),console.log("logic.items"),console.log(c.items),c}function yt(R){var n=[];return R.items.forEach(function(c){var S={id:c.id,shape:c.type,size:{width:80,height:40},data:{config:c},attrs:{text:{text:c.name}}};if(n.push(S),c.branches&&c.branches.length>0)c.branches.forEach(function(b){var C={shape:"edge",source:{cell:c.id},target:{cell:b.nextId},labels:[{position:.5,attrs:{label:{text:b.when}}}]};n.push(C)});else if(c.nextId){var e={shape:"edge",source:{cell:c.id},target:{cell:c.nextId}};n.push(e)}}),n}var Pt=t(74095),Lt=t(45202),bt=t(29384),wt=t(70823),Ft=t(82447),a=t(33130);function Zt(R){var n=[{key:"sharps-panel",label:(0,a.jsx)(Pt.Z,{style:{fontSize:"20px",marginTop:10}}),children:(0,a.jsx)("div",{ref:R.refStencil,style:{margin:0,height:"100vh",width:"100%"}})},{key:"logic",label:(0,a.jsx)(Lt.Z,{style:{fontSize:"20px",marginTop:10}}),children:(0,a.jsxs)("div",{style:{margin:0,height:"100vh"},children:[(0,a.jsx)(wt.Z,{title:"\u7528\u4E8E\u89E3\u6790\u6267\u884C\u7F16\u6392\u7684\u903B\u8F91\u3002",children:(0,a.jsx)("h3",{children:"Logic DSL"})}),(0,a.jsx)(bt.ZP,{defaultLanguage:"json",options:{lineNumbers:"off",lineDecorationsWidth:0,minimap:{enabled:!1}},value:JSON.stringify(R.logic),onChange:R.onConfigChange})]})}];return(0,a.jsx)(Ft.Z,{tabPosition:"left",style:{margin:0},items:n,tabBarStyle:{width:50,margin:0}})}var Dt=Zt,Ot=t(88593);function Nt(R){var n=[{key:"1",label:"\u8282\u70B9\u914D\u7F6E",children:(0,a.jsx)("div",{style:{padding:5},children:(0,a.jsx)(Ot.Z,{editNode:R.editNode,onSubmit:R.onSubmit,configSchemaProvider:R.configSchemaProvider})})}];return(0,a.jsx)(Ft.Z,{style:{margin:0,height:"95vh",overflowY:"scroll"},items:n})}var Gt=Nt,Wt=t(11275),Jt=t(92873),At={name:{title:"\u540D\u79F0",type:"string",widget:"textArea",props:{rows:1}}};function Kt(R){var n={type:"object",properties:{},column:1};switch(R){case"switch":n.properties=v()(v()({},At),{},{condition:{title:"\u6761\u4EF6\u8868\u8FBE\u5F0F ",type:"string",widget:"js",props:{height:100},extra:"\u76F4\u63A5\u586B\u5199\u8868\u8FBE\u5F0F\u6216\u53D8\u91CF\u540D\uFF0C\u5982_par.outType"}});break;case"switch-case":n.properties=v()(v()({},At),{},{case:{title:"case\u503C ",type:"string",extra:"\u503C\u4F1A\u8F6C\u6362\u4E3A\u5B57\u7B26\u4E32\u8FDB\u884C\u5339\u914D"}});break;case"js":n.properties=v()(v()({},At),{},{script:{title:"js\u811A\u672C ",type:"string",widget:"js",props:{height:500},extra:"js\u4EE3\u7801\u5757\uFF0C\u53EF\u7528\u4E8E\u7B80\u5355\u7684\u903B\u8F91\u5B9A\u5236\uFF0C\u53D8\u91CF\u8D4B\u503C\u7B49"}});break;case"http":n.properties=v()(v()({},At),{},{system:{title:"\u7CFB\u7EDF\u540D ",type:"string",defaultValue:""},url:{title:"\u8BF7\u6C42URL\uFF1A ",type:"string",widget:"js",props:{height:50},extra:"js\u4EE3\u7801\u5757\uFF0C\u9700\u8FD4\u56DEURL\u5B57\u7B26\u4E32"},method:{title:"\u8BF7\u6C42\u7C7B\u578B\uFF1A",type:"string",props:{options:[{label:"POST",value:"POST"},{label:"GET",value:"GET"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"}]},widget:"radio"},headers:{title:"\u8BF7\u6C42\u5934(headers) ",type:"string",widget:"js",props:{height:200},extra:"js\u4EE3\u7801\u5757\uFF0C\u9700\u8FD4\u56DE\u8BF7\u6C42\u5934\u5BF9\u8C61"},body:{title:"body\u8BF7\u6C42\u53C2\u6570",type:"string",widget:"js",props:{height:200},extra:"js\u4EE3\u7801\u5757\uFF0C\u9700\u8FD4\u56DEbody\u5BF9\u8C61"},return:{title:"\u5C06response.data\u8D4B\u503C\u7ED9\u54EA\u4E2A\u53C2\u6570\uFF1F",type:"string",widget:"js",props:{height:100},extra:"\u8F93\u5165\u5C40\u90E8\u53D8\u91CF\u7684\u5B8C\u6574\u5F15\u7528\uFF0C\u5982_var.repData"},queryParams:{title:"url\u53C2\u6570",type:"string",widget:"js",props:{height:100},extra:"js\u4EE3\u7801\u5757\uFF0C\u9700\u8FD4\u56DE\u5BF9\u8C61\uFF0C\u4F1A\u8F6C\u6362\u4E3A\u952E\u503C\u5BF9\u8FFD\u52A0\u5728url\u4E2D"},timeout:{title:"\u6267\u884C\u8D85\u65F6\u65F6\u957F(ms)",defaultValue:2e3,type:"number"}}),n.column=2;break;case"start":n.properties={name:{title:"\u540D\u79F0",type:"string",widget:"textArea",props:{rows:1}}};break;case"end":n.properties={name:{title:"\u540D\u79F0",type:"string",widget:"textArea",props:{rows:1}}};break;case"wait":n.properties={name:{title:"\u540D\u79F0",type:"string",widget:"textArea",props:{rows:1}},timeout:{title:"\u5EF6\u65F6\u8BBE\u7F6E(ms)",defaultValue:2e3,type:"number"}};break;case"mqtt-client":break;default:n.properties=At}return n}var Ut=t(64266),mt=t(76898),Vt=t(83132),It=t(69947),Yt=function(n){var c,S=(0,It.cI)();(0,ht.useEffect)(function(){var b=n.values,C=b.params,y=b.variables,j=b.envs,O=b.returns;S.setValues({params:JSON.stringify(mt.y.getJsonByParams(C)),variables:JSON.stringify(mt.y.getJsonByParams(y)),returns:JSON.stringify(mt.y.getJsonByParams(O)),envs:JSON.stringify(mt.y.getJsonByParams(j))})},[n.values]);var e=(0,ht.useCallback)(function(b){try{return JSON.parse(b),!0}catch(C){return!1}},[]);return(0,a.jsxs)("span",{children:[n.children,(0,a.jsx)(E.Z,{open:(c=n.open)!==null&&c!==void 0?c:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,onOk:function(){var C=S.getValues(),y=!1;Object.keys(C).forEach(function(j){var O=C[j];if(!e(O)){var D=j==="params"?"\u5165\u53C2":j==="variables"?"\u5C40\u90E8\u53D8\u91CF":j==="returns"?"\u8FD4\u56DE\u53C2\u6570":"\u73AF\u5883\u53D8\u91CF";return ut.ZP.error("".concat(D,"json\u683C\u5F0F\u9519\u8BEF")),y=!0,!1}}),y||(n!=null&&n.onSubmit&&n.onSubmit(C),n==null||n.setOpen(!1))},onCancel:function(){return n==null?void 0:n.setOpen(!1)},children:(0,a.jsx)(Vt.Z,{form:S,schema:{type:"object",properties:{params:{title:"\u5165\u53C2\u58F0\u660E",type:"string",widget:"json",props:{height:200},extra:"\u7F16\u8F91\u5668\u4E2D\u53EF\u901A\u8FC7 _par. \u83B7\u53D6"},variables:{title:"\u5C40\u90E8\u53D8\u91CF\u58F0\u660E",type:"string",widget:"json",props:{height:200},extra:"\u7F16\u8F91\u5668\u4E2D\u53EF\u901A\u8FC7 _var. \u83B7\u53D6"},envs:{title:"\u73AF\u5883\u53D8\u91CF\u58F0\u660E",type:"string",widget:"json",props:{height:200},extra:"\u7F16\u8F91\u5668\u4E2D\u53EF\u901A\u8FC7 _env. \u83B7\u53D6"}},column:2}})})]})},Xt=Yt,St=t(34230),Ht=function(n,c){var S,e,b,C,y=c.getData(),j=c.getPosition(),O=n.getNodes(),D;if(["ExtSharp","polygon"].indexOf(c.shape)>-1)switch(y.config.type){case"switch":var p=200,x=n.addNode({shape:"switch",position:j,width:p,height:50,ports:St.Tt,data:c.data,attrs:{body:{stroke:"#8f8f8f",strokeWidth:1,fill:"#fff",rx:6,ry:6}}});n.removeNode(c);var s=n.addNode({shape:"switch-case",position:{y:j.y+100,x:j.x-p/2},width:120,height:50,ports:St.Tt,data:{config:{type:"switch-case"}}}),H=n.addNode({shape:"switch-default",position:{y:j.y+100,x:j.x+p},width:120,height:50,ports:St.Tt,data:{config:{type:"switch-default"}}}),tt=n.addEdge({source:x,sourcePort:(S=x.ports.items.find(function(at){return at.group=="bottom"}))===null||S===void 0?void 0:S.id,target:s,targetPort:(e=s.ports.items.find(function(at){return at.group=="top"}))===null||e===void 0?void 0:e.id,zIndex:0}),K=n.addEdge({source:x,sourcePort:(b=x.ports.items.find(function(at){return at.group=="bottom"}))===null||b===void 0?void 0:b.id,target:H,targetPort:(C=H.ports.items.find(function(at){return at.group=="top"}))===null||C===void 0?void 0:C.id,zIndex:0});D=x;break;case"switch-case":var r=n.createNode({shape:"switch-case",position:c.position(),width:120,height:50,ports:St.Tt,data:c.data});n.removeNode(c),n.addNode(r),D=r;break;case"string":var g=n.createNode({shape:"string",position:c.position(),width:100,height:50,ports:St.Tt,data:c.data});n.removeNode(c),n.addNode(g),D=g;break;case"num":var B=n.createNode({shape:"num",position:c.position(),width:100,height:50,ports:St.Tt,data:c.data});n.removeNode(c),n.addNode(B),D=B;break;case"assignment":var Q=n.createNode({shape:"assignment",position:c.position(),width:220,height:50,ports:St.Tt,data:c.data});n.removeNode(c),n.addNode(Q),D=Q;break;default:break}if(console.log("node:added"),D&&O.length==1){var rt,ct,jt,st,dt;n.addEdge({source:O[0],sourcePort:(rt=O[0].ports.items.find(function(at){return at.group=="bottom"}))===null||rt===void 0?void 0:rt.id,target:D,targetPort:(ct=D)===null||ct===void 0||(jt=ct.ports)===null||jt===void 0||(st=jt.items)===null||st===void 0||(dt=st.find(function(at){return at.group=="top"}))===null||dt===void 0?void 0:dt.id,zIndex:0})}},Qt=t(30685),$t=function(n){var c,S=(0,It.cI)();(0,ht.useEffect)(function(){var C=n.values.params;S.setValues({params:JSON.stringify(mt.y.getJsonByParams(C))})},[n.values]);var e=(0,ht.useCallback)(function(C){try{return JSON.parse(C),!0}catch(y){return!1}},[]);function b(C){var y=S.getValues(),j=!1;Object.keys(y).forEach(function(O){var D=y[O];if(["params","headers"].indexOf(O)>-1&&!e(D)){var p=O==="params"?"\u5165\u53C2":"\u8BF7\u6C42\u5934";return ut.ZP.error("".concat(p,"json\u683C\u5F0F\u9519\u8BEF")),j=!0,!1}}),j||(n!=null&&n.onSubmit&&n.onSubmit(y,C),n==null||n.setOpen(!1))}return(0,a.jsxs)("span",{children:[n.children,(0,a.jsx)(E.Z,{open:(c=n.open)!==null&&c!==void 0?c:!1,title:"\u53C2\u6570\u914D\u7F6E\uFF08\u901A\u8FC7json\u683C\u5F0F\u58F0\u660E\uFF09",width:1e3,footer:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z.ZP,{type:"primary",onClick:function(){b("")},children:"\u8FD0\u884C"}),(0,a.jsx)(Z.ZP,{type:"primary",onClick:function(){b("bizStepByStep")},children:"bizStep\u6A21\u5F0F"}),(0,a.jsx)(Z.ZP,{onClick:function(){return n==null?void 0:n.setOpen(!1)},children:"\u53D6\u6D88"})]}),onCancel:function(){return n==null?void 0:n.setOpen(!1)},children:(0,a.jsx)(Vt.Z,{form:S,schema:{type:"object",properties:{params:{title:"\u5165\u53C2",type:"string",widget:"json",props:{height:200},extra:"\u7F16\u8F91\u5668\u4E2D\u53EF\u901A\u8FC7 _par. \u83B7\u53D6"},headers:{title:"\u8BF7\u6C42\u5934(headers)",type:"string",widget:"json",default:"{}",props:{height:200},extra:"\u53EF\u5B9A\u4E49\u8BF7\u6C42\u5934\uFF0C\u5982\u6743\u9650"},bizId:{title:"\u4E1A\u52A1\u6807\u8BC6",type:"string",props:{},extra:"\u6839\u636E\u4E1A\u52A1\u6807\u8BC6\u8DDF\u8E2A\u903B\u8F91\u5B9E\u4F8B"},bizStartCode:{title:"\u6307\u5B9A\u6267\u884C\u4EA4\u4E92\u70B9",type:"string",props:{},extra:"\u82E5\u5F53\u524D\u6D41\u7A0B\u5F85\u6267\u884C\u4EA4\u4E92\u70B9\u4E0E\u6307\u5B9A\u4EA4\u4E92\u70B9\u4E0D\u4E00\u81F4\u5219\u62A5\u9519"}},column:2}})})]})},qt=$t,_t=t(60246),te=t(54306),ee=t.n(te),ne=t(75657),ae=t(22407),ue=null,ie=function(n){var c=(0,bt.Ik)(),S=(0,ht.useState)(!1),e=ee()(S,2),b=e[0],C=e[1];return(0,a.jsx)("div",{style:{width:"100%"},children:b?(0,a.jsx)(ne.Z,{title:"js\u7F16\u8F91\u5668",centered:!0,width:1200,bodyStyle:{height:"80vh"},open:b,footer:null,onCancel:function(){return C(!1)},children:(0,a.jsx)(bt.ML,v()(v()({theme:"vs-dark",defaultValue:n.value,defaultLanguage:n.language,options:{minimap:{enabled:!1}}},n),{},{height:"100%"}))}):(0,a.jsxs)("div",{children:[(0,a.jsx)(bt.ML,v()({className:"editorByLoader",theme:"vs-dark",defaultValue:n.value,defaultLanguage:n.language,onMount:function(j){var O;(O=j.getAction("editor.action.formatDocument"))===null||O===void 0||O.run(),j.setValue(j.getValue())},options:{minimap:{enabled:!1}},height:500},n)),(0,a.jsx)(Z.ZP,{size:"small",type:"text",icon:(0,a.jsx)(ae.Z,{}),style:{position:"absolute",top:0,right:0,margin:"10px",color:"whitesmoke"},onClick:function(){return C(!0)}})]})})},Rt=vt().memo(ie),oe=t(5726),re=t.n(oe),Bt=t(48204),se=[{key:"saveToPng",label:"\u5BFC\u51FA\u56FE\u7247"},{key:"saveToClipboard",label:"\u590D\u5236\u5230\u526A\u8D34\u677F"}],kt=vt().createContext({logic:new Ct.Iz("")}),Mt=function(n,c){for(var S=0,e=n.length;S<e;S+=1)n[S].style.visibility=c?"visible":"hidden"},le=function(R){z()(c,R);var n=l()(c);function c(S){var e;k()(this,c),e=n.call(this,S),o()(m()(e),"container",void 0),o()(m()(e),"stencilContainer",void 0),o()(m()(e),"state",{editingNode:void 0,openEdgeEditor:!1,embeddingEnable:!1,editingEdge:void 0,leftToolCollapsed:!1,rightToolCollapsed:!0,openFlowSetting:!1,openRunLogic:!1,editorCtx:{logic:new Ct.Iz("1")},logs:[],panel:{nodes:[],groups:[]}}),o()(m()(e),"handleEdgeSubmit",function(p){var x;(x=e.state.editingEdge)===null||x===void 0||x.setLabels(p)}),o()(m()(e),"initGraph",function(p){var x,s=new q.kJ({container:p,embedding:{enabled:e.state.embeddingEnable,validate:function(g){return g.child.setData({hoverNode:g.parent}),!0}},mousewheel:{enabled:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:15}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,allowMulti:!0,snap:{radius:20},createEdge:function(){return new q.bn.kS({tools:[{name:"edge-editor",args:{attrs:{backgroundColor:"#fff"}}}],zIndex:0})},validateConnection:function(g){var B=g.targetMagnet;return!!B}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}},background:{color:"#F2F7FA"},grid:!0});s.use(new et.H({enabled:!0,sharp:!0})).use(new xt.A({enabled:!0})).use(new A.Y({enabled:!0,multiple:!0,strict:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,pointerEvents:"none"})).use(new U.T({enabled:!0})).use(new L.N).use(new it.T).use(new ot.D),s.on("edge:dblclick",function(r){var g=r.cell}),s.on("edge:mouseenter",function(r){var g=r.cell;g.addTools([{name:"button-remove",args:{distance:-40}}])}),s.on("edge:mouseleave",function(r){var g=r.cell;g.removeTools()}),s.on("node:moved",function(r){var g,B=r.e,Q=r.x,rt=r.y,ct=r.node,jt=r.view,st=(g=ct.data)===null||g===void 0?void 0:g.hoverNode;if(e.state.embeddingEnable&&st){var dt,at,de=s.createEdge({source:st,sourcePort:(dt=st.ports.items.find(function(zt){return zt.group=="bottom"}))===null||dt===void 0?void 0:dt.id,target:ct,targetPort:(at=ct.ports.items.find(function(zt){return zt.group=="top"}))===null||at===void 0?void 0:at.id,zIndex:0});ct.data.hoverNode=void 0,s.addEdge(de),e.autoLayout(s)}}),s.on("node:mouseenter",function(r){var g,B,Q,rt=r.cell;((g=rt.data)===null||g===void 0||(B=g.config)===null||B===void 0?void 0:B.type)!="start"&&rt.addTools([{name:"button-remove",args:{x:"100%",y:0,offset:{x:-10,y:10}}}]);var ct=(Q=e.container)===null||Q===void 0?void 0:Q.querySelectorAll(".x6-port-body");Mt(ct,!0)}),s.on("node:mouseleave",function(r){var g,B=r.cell;B.removeTools();var Q=(g=e.container)===null||g===void 0?void 0:g.querySelectorAll(".x6-port-body");Mt(Q,!1)}),s.on("node:click",function(r){var g=r.e,B=r.x,Q=r.y,rt=r.node,ct=r.view;rt.removeTools(),e.setState({editingNode:rt})}),s.on("node:added",function(r){var g=r.node,B=r.index,Q=r.options;Ht(s,g)}),s.on("node:dblclick",function(r){var g=r.e,B=r.x,Q=r.y,rt=r.node,ct=r.view;e.setState({rightToolCollapsed:!1,editingNode:rt})}),s.bindKey(["meta+c","ctrl+c"],function(){var r=s.getSelectedCells();return r.length&&s.copy(r),!1}),s.bindKey(["meta+x","ctrl+x"],function(){var r=s.getSelectedCells();return r.length&&s.cut(r),!1}),s.bindKey(["meta+v","ctrl+v"],function(){if(!s.isClipboardEmpty()){var r=s.paste({offset:32});s.cleanSelection(),s.select(r)}return!1}),s.bindKey(["meta+z","ctrl+z"],function(){return s.canUndo()&&s.undo(),!1}),s.bindKey(["meta+shift+z","ctrl+shift+z"],function(){return s.canRedo()&&s.redo(),!1}),s.bindKey("backspace",function(){var r=s.getSelectedCells();r.length&&(r.find(function(g){var B;return g.data?["start"].indexOf((B=g.data.config)===null||B===void 0?void 0:B.type)>-1:!1})?ut.ZP.error("\u7981\u6B62\u5220\u9664\u5F00\u59CB\u8282\u70B9\uFF01"):s.removeCells(r))}),s.on("blank:dblclick",function(r){var g=r.e,B=r.x,Q=r.y;console.log("blank:dbclick",B,Q),e.autoLayout(s)}),s.bindKey(["ctrl+1","meta+1"],function(){var r=s.zoom();r<1.5&&s.zoom(.1)}),s.bindKey(["ctrl+2","meta+2"],function(){var r=s.zoom();r>.5&&s.zoom(-.1)}),e.state.graph=s;var H=e.state.panel.groups,tt=new w.t({title:"\u5C55\u5F00/\u6536\u8D77",target:s,search:function(g,B){var Q=g.getAttrByPath("text/text");return(Q==null?void 0:Q.indexOf(B))!==-1},notFoundText:"\u672A\u627E\u5230",collapsable:!0,stencilGraphWidth:250,groups:H,layoutOptions:{rowHeight:100}}),K={};return e.state.panel.nodes.forEach(function(r){var g=s.createNode(r);H.forEach(function(B){r.groups.includes(B.name)&&(K[B.name]?K[B.name].push(g):K[B.name]=[g])})}),Object.keys(K).forEach(function(r){tt.load(P()(K[r]),r)}),(x=e.stencilContainer)===null||x===void 0||x.appendChild(tt.container),e.props.config?(e.state.editorCtx.logic=e.props.config,s.fromJSON(e.state.editorCtx.logic.visualConfig)):((0,Jt.X)(s),e.autoLayout(s)),s}),o()(m()(e),"autoLayout",function(p){(0,Qt.V)(p)}),o()(m()(e),"refContainer",function(p){e.container=p}),o()(m()(e),"refStencil",function(p){e.stencilContainer=p}),o()(m()(e),"handleSubmit",function(p){e.saveAndConvertGraphToDsl()}),o()(m()(e),"handleOnConfigChange",function(p){try{var x=JSON.parse(p);e.setState({stepFlow:x})}catch(s){console.log(s)}}),o()(m()(e),"onSaveMenuClick",function(p){var x;switch(p.key){case"saveToBrowser":break;case"loadFromBrowser":var s=localStorage.getItem("logic-json");if(s){var H,tt=JSON.parse(s);e.state.editorCtx.logic=tt,(H=e.state.graph)===null||H===void 0||H.fromJSON(tt.visualConfig),e.saveAndConvertGraphToDsl()}else ut.ZP.info("\u6D4F\u89C8\u5668\u65E0\u7F13\u5B58\u6570\u636E");break;case"saveToClipboard":try{navigator.clipboard.writeText(JSON.stringify(e.state.editorCtx.logic))}catch(K){console.error(K)}break;case"saveToPng":(x=e.state.graph)===null||x===void 0||x.exportPNG(new Date().toLocaleDateString(),{backgroundColor:"#F2F7FA",padding:10,quality:1});break}}),o()(m()(e),"updateLogicAndEditorCtx",function(p){var x=v()(v()({},e.state.editorCtx.logic),p);return x.version=re()(Date.now()).format("YYYYMMDDHHmmss"),e.setState({editorCtx:v()(v()({},e.state.editorCtx),{},{logic:x})}),x}),o()(m()(e),"saveAndConvertGraphToDsl",function(){var p,x=(p=e.state.graph)===null||p===void 0?void 0:p.toJSON(),s=e.convertGraphToDsl(x);if(s){var H,tt=e.updateLogicAndEditorCtx({items:s.items,visualConfig:s.visualConfig});e.props.config&&(tt.id=(H=e.props.config)===null||H===void 0?void 0:H.id),e.props.onSave&&e.props.onSave(tt);var K=JSON.stringify(tt);localStorage.setItem("logic-"+tt.name,K)}}),o()(m()(e),"saveFlowSettingAndConvertGraphToDsl",function(p){var x,s,H,tt,K=mt.y.getParamArrayByJson(JSON.parse((x=p.params)!==null&&x!==void 0?x:"{}")),r=mt.y.getReturnArrayByJson(JSON.parse((s=p.returns)!==null&&s!==void 0?s:"{}")),g=mt.y.getVariableArrayByJson(JSON.parse((H=p.variables)!==null&&H!==void 0?H:"{}")),B=mt.y.getEnvsArrayByJson(JSON.parse((tt=p.envs)!==null&&tt!==void 0?tt:"{}")),Q=e.updateLogicAndEditorCtx({params:K,returns:r,variables:g,envs:B}),rt=JSON.stringify(Q);localStorage.setItem("logic-json-"+Q.id,rt)}),o()(m()(e),"convertGraphToDsl",function(p){var x,s=pt((x=e.props.config)===null||x===void 0?void 0:x.id,p.cells);return s&&(s.visualConfig=p),s}),o()(m()(e),"setFlowSetting",function(p){e.setState({openFlowSetting:p})});try{var b,C,y=(0,Wt.K)(S.customNodes,S.customGroups,S.customSharps),j=y.Nodes,O=y.Shapes,D=y.Groups;(0,Jt.m)(O),e.state.leftToolCollapsed=!(!((b=S.showLeft)!==null&&b!==void 0)||b),e.state.rightToolCollapsed=!((C=S.showRight)!==null&&C!==void 0&&C),e.state.panel.nodes=j,e.state.panel.groups=D}catch(p){console.error("\u6CE8\u518C\u8282\u70B9\u51FA\u9519\uFF1A"),console.error(p)}return e}return i()(c,[{key:"componentDidUpdate",value:function(e,b,C){if(this.props.config&&this.state.editorCtx.logic.id!=this.props.config.id){var y,j,O,D;this.state.editorCtx.logic=this.props.config,(y=this.state.editorCtx)!==null&&y!==void 0&&(j=y.logic)!==null&&j!==void 0&&j.visualConfig&&((O=this.state.graph)===null||O===void 0||O.fromJSON((D=this.state.editorCtx.logic)===null||D===void 0?void 0:D.visualConfig)),this.setState({editingNode:void 0})}}},{key:"componentDidMount",value:function(){var e;this.initGraph(this.container),this.updateLogicAndEditorCtx((e=this.state.editorCtx)===null||e===void 0?void 0:e.logic)}},{key:"render",value:function(){var e=this,b,C,y=this.state,j=y.editingNode,O=y.leftToolCollapsed,D=y.rightToolCollapsed,p=y.editorCtx,x=y.embeddingEnable,s=y.graph,H=y.openFlowSetting,tt=y.openRunLogic,K=p.logic;return console.log("editorCtx",p),(0,a.jsx)(kt.Provider,{value:p,children:(0,a.jsxs)(lt.Z,{style:{height:"100vh",width:"100%",margin:0},children:[(0,a.jsx)(lt.Z.Sider,{theme:"light",collapsed:O,collapsedWidth:0,width:300,children:(0,a.jsx)(Dt,{refStencil:this.refStencil,graph:this.state.graph,logic:K,onConfigChange:this.handleOnConfigChange})}),(0,a.jsxs)(lt.Z,{style:{height:"100%"},children:[(0,a.jsxs)(lt.Z.Header,{style:{padding:0,backgroundColor:"white"},children:[(0,a.jsxs)(Et.Z,{direction:"horizontal",children:[(0,a.jsx)(Z.ZP,{type:"text",icon:O?(0,a.jsx)(d.Z,{}):(0,a.jsx)(h.Z,{}),onClick:function(){e.setState({leftToolCollapsed:!O})},style:{fontSize:"16px",width:64,height:64}}),(0,a.jsx)(nt.Z.Button,{style:{float:"inline-start"},menu:{items:se,onClick:this.onSaveMenuClick},buttonsRender:function(g){return[(0,a.jsx)(Z.ZP,{type:"primary",icon:(0,a.jsx)(G.Z,{}),onClick:e.saveAndConvertGraphToDsl,children:"\u4FDD\u5B58"}),(0,a.jsx)(Z.ZP,{type:"primary",icon:(0,a.jsx)(u.Z,{})})]},children:"\u4FDD\u5B58"}),(0,a.jsx)(Xt,{open:H,values:v()({},K),setOpen:this.setFlowSetting,onSubmit:this.saveFlowSettingAndConvertGraphToDsl,children:(0,a.jsx)(Z.ZP,{onClick:function(){return e.setFlowSetting(!0)},icon:(0,a.jsx)(N.Z,{}),children:"\u914D\u7F6E\u53C2\u6570"})}),(b=this.props.btns)===null||b===void 0?void 0:b.map(function(r){return(0,a.jsx)(Z.ZP,v()({},r))}),(0,a.jsx)(qt,{open:tt,setOpen:function(g){return e.setState({openRunLogic:g})},values:{params:K==null?void 0:K.params},onSubmit:function(g,B){if(e.setState({openRunLogic:!1}),K){var Q=g.params,rt=g.bizId,ct=g.headers,jt=g.bizStartCode;(0,_t.L7)(K.id,JSON.parse(Q),rt,jt,B,JSON.parse(ct)).then(function(st){if(st.data.code==0){var dt;E.Z.success({title:"\u6267\u884C\u6210\u529F",width:"1000px",closable:!0,content:(0,a.jsx)("div",{children:(0,a.jsx)(_.Z,{children:(0,a.jsx)(F.Z,{children:(0,a.jsx)(_.Z,{children:(0,a.jsxs)(F.Z,{span:24,children:[(0,a.jsx)("h4",{children:st.data.msg}),(0,a.jsx)(Bt.gcu,{src:(dt=st.data)!==null&&dt!==void 0?dt:{},collapsed:1})]})})})})})})}else{var at;E.Z.error({title:(0,a.jsx)("span",{children:st.data.msg}),width:"1200px",closable:!0,content:(0,a.jsx)("div",{children:(0,a.jsx)(_.Z,{children:(0,a.jsx)(F.Z,{children:(0,a.jsxs)(_.Z,{children:[(0,a.jsxs)(F.Z,{span:12,children:[(0,a.jsx)("h4",{children:"\u9519\u8BEF\u8BE6\u7EC6:"}),(0,a.jsx)(Bt.gcu,{src:(at=st.data.error)!==null&&at!==void 0?at:{},collapsed:1})]}),(0,a.jsxs)(F.Z,{span:12,children:[(0,a.jsx)("h4",{children:"\u8FD4\u56DE\u6570\u636E:"}),(0,a.jsx)(Rt,{language:"json",value:JSON.stringify(st.data),width:500})]})]})})})})})}}).catch(function(st){var dt=st.response.data;E.Z.error({title:(0,a.jsx)("span",{children:dt.msg}),width:"1200px",closable:!0,content:(0,a.jsx)("div",{children:(0,a.jsx)(_.Z,{children:(0,a.jsx)(F.Z,{children:(0,a.jsxs)(_.Z,{children:[(0,a.jsxs)(F.Z,{span:12,children:[(0,a.jsx)("h4",{children:"\u9519\u8BEF\u8BE6\u7EC6:"}),(0,a.jsx)(Bt.gcu,{src:dt.error,collapsed:1})]}),(0,a.jsxs)(F.Z,{span:12,children:[(0,a.jsx)("h4",{children:"\u8FD4\u56DE\u6570\u636E:"}),(0,a.jsx)(Rt,{language:"json",value:JSON.stringify(dt.data),width:500})]})]})})})})})}),e.state.logs.push({data:new Date().toLocaleTimeString()})}},children:(0,a.jsx)(Z.ZP,{type:"default",onClick:function(){e.setState({openRunLogic:!0})},icon:(0,a.jsx)(I.Z,{}),children:"\u8C03\u8BD5"})}),(0,a.jsxs)("span",{children:["\u5F53\u524D\u7248\u672C:",K.version]})]}),(0,a.jsx)(Et.Z,{style:{float:"right",right:"16px"},children:(0,a.jsx)(Z.ZP,{type:"text",icon:D?(0,a.jsx)(h.Z,{}):(0,a.jsx)(d.Z,{}),onClick:function(){e.setState({rightToolCollapsed:!D})},style:{fontSize:"16px",width:64,height:64}})})]}),(0,a.jsx)(lt.Z.Content,{className:"app-content",children:(0,a.jsx)(Ut.Z,{ref:this.refContainer})})]}),(0,a.jsxs)(lt.Z.Sider,{theme:"light",collapsed:D,collapsedWidth:0,width:600,children:[(0,a.jsx)(Z.ZP,{type:"text",onClick:function(){e.setState({rightToolCollapsed:!D})},style:{float:"right",fontSize:"16px",width:64,height:64},children:"x"}),(0,a.jsx)(Gt,{onClear:function(){return e.setState({logs:[]})},editNode:j,onSubmit:this.handleSubmit,logs:this.state.logs,configSchemaProvider:(C=this.props.configSchemaProvider)!==null&&C!==void 0?C:Kt})]})]})})}}]),c}(vt().Component)},64266:function(ft,$,t){t.d($,{Z:function(){return P}});var Y=t(87363),v=t(33130),J=(0,Y.forwardRef)(function(M,k){return(0,v.jsx)("div",{className:"drag-graph",ref:k})}),P=J},30685:function(ft,$,t){t.d($,{V:function(){return v}});var Y=t(59197),v=function(P){var M=new Y.Vq({type:"dagre",begin:[400,100],rankdir:"TB",ranksep:20,nodeSize:50,controlPoints:!0}),k=P.getNodes(),W=P.getEdges(),i=M.layout({nodes:k,edges:W}),V=i.nodes,m=V===void 0?[]:V;k.forEach(function(X){var z=m.find(function(T){return T.id===X.id});z.x-=X.size().width/2,z.y-=X.size().height/2,X.position(z.x,z.y)})}},34230:function(ft,$,t){t.d($,{Hi:function(){return J},Tt:function(){return Y}});var Y={groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]},v={groups:{right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1}},items:[{group:"right"}]},J={groups:{bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}},zIndex:1}},items:[{group:"bottom"}]}},92873:function(ft,$,t){t.d($,{X:function(){return o},m:function(){return f}});var Y=t(89769),v=t(17851),J=t(43118),P={customNode:"customNode___AyPI8",input:"input___Q5PmS",switchNode:"switchNode___fqB9a"},M=t(33130),k=function(h){return(0,M.jsx)("div",{className:P.customNode,children:(0,M.jsx)(J.Z,{className:"input",value:h==null?void 0:h.data,width:80})})},W=t(52205),i=function(h){return(0,M.jsx)("div",{className:styles.customNode,children:(0,M.jsx)(W.Z,{className:"input",value:h==null?void 0:h.data,width:80})})},V=t(57213),m=t.n(V),X=function(h){var G,u,N,I=h.node,q=(G=I.data.config)===null||G===void 0?void 0:G.name,it=q||"case";return(0,M.jsxs)("div",{className:P.customNode,children:[(0,M.jsx)("span",{children:"case"}),(0,M.jsx)(J.Z,{addonAfter:q,className:"input",value:I==null||(u=I.data)===null||u===void 0||(N=u.config)===null||N===void 0?void 0:N.case,width:150,onChange:function(L){var A=I.data;I.setData(m()(m()({},A),{},{config:m()(m()({},A.config),{},{case:L.target.value})}))}})]})},z=function(h){var G,u=h.node;return(0,M.jsx)("div",{className:P.customNode,children:(0,M.jsx)(J.Z,{addonBefore:"switch",className:"input",value:(G=u.data)===null||G===void 0?void 0:G.config.condition,onChange:function(I){var q=u.data;u.setData(m()(m()({},q),{},{config:m()(m()({},q.config),{},{condition:I.target.value})}))},width:100})})},T=t(34230),l=function(h){return(0,M.jsx)("div",{className:P.customNode,children:(0,M.jsx)("div",{style:{textAlign:"center",fontSize:"15px"},children:"default"})})};function f(d){d.forEach(function(h){console.log("\u6CE8\u518C\u65B0\u8282\u70B9:"+h.name),Y.kJ.registerNode(h.name,h.config,!0)}),(0,v.z2)({shape:"string",component:k}),(0,v.z2)({shape:"num",component:i}),(0,v.z2)({shape:"switch",component:z}),(0,v.z2)({shape:"switch-case",component:X}),(0,v.z2)({shape:"switch-default",component:l})}function o(d){var h=d.createNode({shape:"circle",label:"start",width:50,height:50,attrs:{body:{}},ports:T.Hi,data:{config:{type:"start"}}});d.addNode(h)}},11275:function(ft,$,t){t.d($,{K:function(){return W}});var Y=t(57213),v=t.n(Y),J=t(34230),P=50,M=50,k=[{name:"ExtSharp",config:{width:100,height:M,attrs:{body:{rx:6,ry:6,stroke:"#5F95FF",strokeWidth:1,fill:"rgba(95,149,255,0.05)",refWidth:1,refHeight:1},image:{refX:2,refY:0},text:{refX:4,refY:20,fontSize:12,"text-anchor":"start"}},markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}}];function W(i,V,m){var X=50,z=50,T={body:{}},l=[{shape:"circle",width:X,height:z,attrs:{body:v()(v()({},T.body),{},{fill:"white"}),text:{text:"\u4EA4\u4E92\u70B9"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:J.Tt,data:{config:{type:"wait-for-continue"}},groups:["global"]},{shape:"circle",label:"end",width:X,height:z,attrs:{body:v()(v()({},T.body),{},{fill:"#d9d9d9"}),text:{text:"end"}},markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}],ports:J.Tt,data:{config:{type:"end"}},groups:["global"]},{shape:"ExtSharp",attrs:{text:{text:"http\u8BF7\u6C42",fontSize:14},image:{"xlink:href":"/icons/http.svg",width:20,x:2,y:2}},data:{config:{type:"http",method:"POST"}},ports:J.Tt,groups:["biz"]},{shape:"ExtSharp",ports:J.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/code.svg"},text:{text:"js\u4EE3\u7801\u5757",fontSize:14}},data:{config:{type:"js"}},groups:["biz"]},{shape:"ExtSharp",ports:J.Tt,attrs:{image:{width:15,x:2,y:2,"xlink:href":"/icons/CarbonSubflowLocal.svg"},text:{text:"\u590D\u7528\u903B\u8F91",fontSize:14}},data:{config:{type:"sub-logic"}},groups:["biz"]},{shape:"ExtSharp",width:50,height:z,label:"switch",attrs:{image:{"xlink:href":"/icons/switch.svg",width:45,x:1,y:2},text:{text:"switch",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"switch"}},ports:J.Tt,groups:["ctrl"]},{shape:"ExtSharp",width:X,height:z,attrs:{image:{"xlink:href":"/icons/text.svg",width:30,x:8,y:10},text:{text:"case",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"switch-case"}},ports:J.Tt,groups:["ctrl"]},{shape:"ExtSharp",width:X,height:z,attrs:{image:{"xlink:href":"/icons/delay.svg",width:30,x:8,y:10},text:{text:"\u7B49\u5F85",fontSize:14,refX:.5,refY:"100%",refY2:4,textAnchor:"middle",textVerticalAnchor:"top"}},data:{config:{type:"wait",timeout:"2000"}},ports:J.Tt,groups:["ctrl"]}];i&&i.length>0&&Array.prototype.push.apply(l,i);var f=[{name:"global",title:"\u5168\u5C40\u8282\u70B9",graphHeight:110},{name:"ctrl",title:"\u903B\u8F91\u63A7\u5236",graphHeight:220},{name:"biz",title:"\u4E1A\u52A1\u8C03\u7528",graphHeight:220}];V&&V.length>0&&Array.prototype.push.apply(f,V);var o=k;return m&&m.length>0&&Array.prototype.push.apply(o,m),{Shapes:o,Nodes:l,Groups:f}}},60246:function(ft,$,t){t.d($,{_5:function(){return u},dS:function(){return I},XY:function(){return it},L7:function(){return l}});var Y=t(57213),v=t.n(Y),J=t(25359),P=t.n(J),M=t(49811),k=t.n(M),W=t(70517);function i(L,A){return axios.get(L,A)}function V(L,A,et){return axios.put(L,A,et)}function m(L,A){return axios.delete(L,A)}function X(L,A,et){return W.Z.post(L,A,et)}function z(L,A){return T.apply(this,arguments)}function T(){return T=_asyncToGenerator(_regeneratorRuntime().mark(function L(A,et){return _regeneratorRuntime().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.abrupt("return",post("/api/runtime/logic/v1/run-fn/".concat(A),et,{headers:{"Content-Type":"application/json"}}));case 1:case"end":return U.stop()}},L)})),T.apply(this,arguments)}function l(L,A,et,w,U,ot){return f.apply(this,arguments)}function f(){return f=k()(P()().mark(function L(A,et,w,U,ot,ut){var lt;return P()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:lt="",Z.t0=ot,Z.next=Z.t0==="bizStepByStep"?4:6;break;case 4:return lt="/api/runtime/logic/v1/step-by-step/".concat(A,"/").concat(w,"?debug=true"),Z.abrupt("break",8);case 6:return w?U?lt="/api/runtime/logic/v1/biz/".concat(A,"/").concat(U,"/").concat(w,"?debug=true"):lt="/api/runtime/logic/v1/run-biz/".concat(A,"/").concat(w,"?debug=true"):lt="/api/runtime/logic/v1/run-api/".concat(A,"?debug=true"),Z.abrupt("break",8);case 8:return Z.abrupt("return",X(lt,et,{headers:v()({"Content-Type":"application/json"},ut)}));case 9:case"end":return Z.stop()}},L)})),f.apply(this,arguments)}function o(L,A){return d.apply(this,arguments)}function d(){return d=_asyncToGenerator(_regeneratorRuntime().mark(function L(A,et){return _regeneratorRuntime().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.abrupt("return",axios.post("/api/form/logic_instance/query",{filters:[{dataIndex:"logicId",values:[A],type:"="},{dataIndex:"bizId",values:[et],type:"="}]}).then(function(ot){var ut=ot.data.result.items[0];return ut}));case 1:case"end":return U.stop()}},L)})),d.apply(this,arguments)}function h(L){return G.apply(this,arguments)}function G(){return G=_asyncToGenerator(_regeneratorRuntime().mark(function L(A){return _regeneratorRuntime().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.abrupt("return",axios.get("/api/ide/logic-instance/".concat(A)).then(function(U){var ot=U.data.data;return ot}));case 1:case"end":return w.stop()}},L)})),G.apply(this,arguments)}function u(L){return N.apply(this,arguments)}function N(){return N=k()(P()().mark(function L(A){return P()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.abrupt("return",W.Z.post("/api/form/logic/add",A).then(function(U){var ot=U.data.result;return ot}));case 1:case"end":return w.stop()}},L)})),N.apply(this,arguments)}function I(L){return q.apply(this,arguments)}function q(){return q=k()(P()().mark(function L(A){return P()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.abrupt("return",W.Z.delete("/api/form/logic/delete/".concat(A)).then(function(U){return U.data.result}));case 1:case"end":return w.stop()}},L)})),q.apply(this,arguments)}function it(){return xt.apply(this,arguments)}function xt(){return xt=k()(P()().mark(function L(){var A,et,w=arguments;return P()().wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:return A=w.length>0&&w[0]!==void 0?w[0]:1,et=w.length>1&&w[1]!==void 0?w[1]:10,ot.abrupt("return",W.Z.post("/api/form/logic/query",{page:A,pageSize:et}).then(function(ut){return ut.data}));case 3:case"end":return ot.stop()}},L)})),xt.apply(this,arguments)}}}]);
