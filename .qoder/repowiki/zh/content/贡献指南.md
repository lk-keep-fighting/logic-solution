# 贡献指南

<cite>
**本文档中引用的文件**  
- [CONTRIBUTING.md](file://CONTRIBUTING.md)
- [pom.xml](file://pom.xml)
- [logic-runtime/pom.xml](file://logic-runtime/pom.xml)
- [logic-sdk/pom.xml](file://logic-sdk/pom.xml)
- [logic-ide/pom.xml](file://logic-ide/pom.xml)
- [LogicRuntimeApplicationTests.java](file://logic-runtime/src/test/java/com/aims/logic/runtime/LogicRuntimeApplicationTests.java)
</cite>

## 目录
1. [简介](#简介)
2. [开发环境搭建](#开发环境搭建)
3. [代码风格规范](#代码风格规范)
4. [分支管理策略](#分支管理策略)
5. [提交信息格式](#提交信息格式)
6. [Pull Request流程](#pull-request流程)
7. [单元测试要求](#单元测试要求)
8. [代码审查标准](#代码审查标准)
9. [贡献类型](#贡献类型)
10. [附录](#附录)

## 简介

欢迎参与 Xuanwu-Logic 项目开发！本指南旨在为外部贡献者提供清晰的参与路径，涵盖从环境配置到代码提交的完整流程。项目采用模块化架构，包含 `logic-ide`、`logic-runtime` 和 `logic-sdk` 等核心模块，基于 Spring Boot 与 Java 17 构建。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L1-L225)

## 开发环境搭建

### 前置依赖
- JDK 17
- Maven 3.6+
- Git

### 克隆与初始化
```bash
# 克隆仓库
git clone https://github.com/YOUR_USERNAME/xuanwu-logic.git
cd xuanwu-logic

# 添加上游源
git remote add upstream https://github.com/aims/xuanwu-logic.git

# 安装依赖
mvn clean install
```

### 本地运行
```bash
# 编译并运行 logic-ide 模块
cd logic-ide
mvn spring-boot:run
```

服务默认启动于 `http://localhost:8080`。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L25-L50)
- [pom.xml](file://pom.xml#L15-L20)

## 代码风格规范

### Java 编码标准
- 遵循 [阿里巴巴 Java 开发手册](https://github.com/alibaba/p3c)
- 使用 4 空格缩进，禁止使用 Tab
- 单行长度不超过 120 字符
- 命名规范：
  - 类名：大驼峰（PascalCase）
  - 方法名：小驼峰（camelCase）
  - 常量：全大写下划线（UPPER_CASE）
  - 包名：全小写（com.aims.logic.runtime）

### 注释规范
所有公共方法必须包含 Javadoc 注释，格式如下：
```java
/**
 * 执行逻辑实例
 *
 * @param logicId 逻辑编号
 * @param params  执行参数
 * @return 执行结果
 * @author contributor
 * @since 1.0.0
 */
```

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L95-L130)

## 分支管理策略

采用功能分支开发模式：
- 主分支：`main`（保护分支，仅允许 PR 合并）
- 功能分支：`feature/功能描述`（如 `feature/user-authentication`）
- 修复分支：`fix/问题描述`（如 `fix/null-pointer-exception`）
- 发布分支：`release/x.x.x`

创建分支示例：
```bash
git checkout -b feature/custom-node-types
```

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L55-L60)

## 提交信息格式

采用 [Conventional Commits](https://conventionalcommits.org/) 规范：

| 类型 | 说明 |
|------|------|
| `feat` | 新功能 |
| `fix` | Bug 修复 |
| `docs` | 文档更新 |
| `style` | 代码格式调整 |
| `refactor` | 代码重构 |
| `test` | 测试相关 |
| `chore` | 构建或辅助工具变动 |

示例：
```
feat: 添加自定义节点类型支持
fix: 修复 LogicRunner 状态更新中的空指针异常
docs: 更新安装指南
```

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L70-L85)

## Pull Request流程

### PR 创建步骤
1. 推送功能分支至 Fork 仓库
2. 在 GitHub 上创建 Pull Request
3. 关联相关 Issue（如有）
4. 填写 PR 描述模板

### PR 描述模板
```markdown
## 变更类型
- [ ] 新功能
- [ ] Bug 修复
- [ ] 文档更新
- [ ] 代码重构
- [ ] 其他

## 变更说明
简要描述此 PR 解决的问题或新增的功能。

## 测试
- [ ] 已添加单元测试
- [ ] 已添加集成测试
- [ ] 所有测试通过
- [ ] 已完成手动测试

## 检查清单
- [ ] 代码遵循项目规范
- [ ] 相关文档已更新
- [ ] 未引入破坏性变更（如有，请说明）
- [ ] PR 标题和描述清晰准确
```

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L150-L190)

## 单元测试要求

### 测试框架
- 使用 JUnit 5 进行单元测试
- 使用 Mockito 进行模拟
- 重要功能需添加 `@SpringBootTest` 集成测试

### 测试覆盖率
- 新功能测试覆盖率不低于 70%
- 核心模块建议达到 85%+

### 测试命名规范
```java
@Test
void shouldReturnSuccessWhenLogicExecutedCorrectly() {
    // 测试逻辑
}
```

### 示例测试文件
`LogicRuntimeApplicationTests.java` 包含运行时核心功能的测试用例，涵盖 JS 函数执行、上下文管理等场景。

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L132-L148)
- [LogicRuntimeApplicationTests.java](file://logic-runtime/src/test/java/com/aims/logic/runtime/LogicRuntimeApplicationTests.java#L1-L40)

## 代码审查标准

### 自检清单
- [ ] 代码编译无错误
- [ ] 所有测试通过
- [ ] 代码格式正确
- [ ] 无明显性能问题
- [ ] 异常处理完善

### 审查重点
- 代码逻辑正确性
- 边界条件与异常处理
- 性能影响评估
- 安全性考虑
- 向后兼容性

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L192-L210)

## 贡献类型

### 鼓励的贡献
- **新功能开发**：如新增节点类型、扩展 SDK 功能
- **缺陷修复**：修复已知 Bug 或性能问题
- **文档改进**：完善 README、添加使用示例、翻译文档
- **测试增强**：补充缺失的测试用例
- **社区支持**：回答 Issues、分享使用经验

### 贡献流程
1. 查阅 [现有 Issues](https://github.com/aims/xuanwu-logic/issues)
2. 若为新功能，建议先在 Discussions 中讨论
3. 创建 Issue 或关联已有 Issue
4. 按上述流程开发并提交 PR

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L212-L225)

## 附录

### 项目模块说明
| 模块 | 说明 |
|------|------|
| `logic-ide` | 逻辑开发 IDE 后端服务 |
| `logic-runtime` | 逻辑执行引擎核心 |
| `logic-sdk` | 开发者 SDK 与注解支持 |
| `test-suite` | 综合测试套件 |

### 版本管理
- 遵循 [语义化版本](https://semver.org/lang/zh-CN/)
- 版本号格式：`主版本号.次版本号.修订号`
- 快照版本以 `-SNAPSHOT` 结尾

**Section sources**
- [pom.xml](file://pom.xml#L10-L20)
- [logic-runtime/pom.xml](file://logic-runtime/pom.xml#L5-L10)
- [logic-sdk/pom.xml](file://logic-sdk/pom.xml#L5-L10)