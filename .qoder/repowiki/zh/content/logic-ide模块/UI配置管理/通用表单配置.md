# 通用表单配置

<cite>
**本文档引用文件**  
- [assign-global.json](file://logic-ide/src/main/resources/public/setting/forms/assign-global.json)
- [js.json](file://logic-ide/src/main/resources/public/setting/forms/js.json)
- [if.json](file://logic-ide/src/main/resources/public/setting/forms/if.json)
- [LogicItemTreeNode.java](file://logic-runtime/src/main/java/com/aims/logic/runtime/contract/dsl/LogicItemTreeNode.java)
- [LogicItemController.java](file://logic-ide/src/main/java/com/aims/logic/ide/controller/LogicItemController.java)
</cite>

## 目录
1. [引言](#引言)
2. [核心表单配置结构解析](#核心表单配置结构解析)
3. [字段类型与校验机制](#字段类型与校验机制)
4. [表单与后端DSL映射机制](#表单与后端dsl映射机制)
5. [新增通用配置项设计规范](#新增通用配置项设计规范)
6. [最佳实践与总结](#最佳实践与总结)

## 引言
本文档深入解析逻辑编排系统中`forms`目录下的通用表单配置文件，重点阐述`assign-global.json`、`js.json`和`if.json`三类核心配置文件的结构设计与功能实现。通过分析这些JSON配置如何驱动前端动态渲染表单界面，并结合`LogicItemTreeNode`模型说明表单字段与后端DSL节点属性的映射关系，为开发者提供新增通用配置项时的JSON结构设计规范及与后端字段同步的最佳实践指导。

## 核心表单配置结构解析

### assign-global.json：全局变量赋值界面配置
`assign-global.json`定义了全局变量赋值节点的完整表单结构，包含名称、变量名、值、事务组编号和备注等字段。该配置通过`type`为`input-text`和`editor`的组件构建用户界面，其中`editor`组件用于输入JavaScript表达式作为变量值。

```json
{
  "type": "page",
  "body": [
    {
      "type": "form",
      "title": "节点配置",
      "body": [
        {
          "type": "input-text",
          "label": "名称",
          "name": "name"
        },
        {
          "type": "input-text",
          "label": "变量名",
          "name": "url"
        },
        {
          "type": "editor",
          "label": "值",
          "name": "body",
          "language": "javascript"
        },
        {
          "type": "editor",
          "label": "事务组编号",
          "name": "tranGroupId",
          "language": "javascript"
        },
        {
          "type": "textarea",
          "label": "备注",
          "name": "memo"
        }
      ]
    }
  ]
}
```

**表单字段说明**
- `name`：节点显示名称
- `url`：目标全局变量名
- `body`：赋值表达式或固定值
- `tranGroupId`：事务组标识符
- `memo`：节点备注信息

**配置特点**
- 使用`editor`组件支持JavaScript表达式输入
- 提供详细的字段描述帮助用户理解用途
- 支持动态事务组编号配置

**表单来源**
- [assign-global.json](file://logic-ide/src/main/resources/public/setting/forms/assign-global.json)

### js.json：JavaScript节点代码编辑区域配置
`js.json`文件定义了JavaScript节点的配置表单，核心是`script`字段的代码编辑器配置。该配置通过`editor`组件提供完整的JavaScript代码编辑能力，支持语法高亮和代码提示。

```json
{
  "type": "page",
  "body": [
    {
      "type": "form",
      "title": "节点配置",
      "body": [
        {
          "type": "input-text",
          "label": "名称",
          "name": "name"
        },
        {
          "type": "editor",
          "label": "js脚本",
          "name": "script",
          "language": "javascript"
        },
        {
          "type": "editor",
          "label": "事务组编号",
          "name": "tranGroupId",
          "language": "javascript"
        },
        {
          "type": "textarea",
          "label": "备注",
          "name": "memo"
        }
      ]
    }
  ]
}
```

**关键特性**
- `script`字段使用`editor`类型，提供专业代码编辑体验
- 支持JavaScript语言模式，包含语法检查和自动补全
- 事务组编号支持表达式动态计算

**应用场景**
- 自定义业务逻辑实现
- 数据转换与处理
- 复杂条件判断

**表单来源**
- [js.json](file://logic-ide/src/main/resources/public/setting/forms/js.json)

### if.json：条件表达式输入框构建方式
`if.json`配置文件专门用于构建条件分支节点的表单界面，其核心是`condition`字段的表达式输入配置。该配置通过`editor`组件允许用户输入JavaScript条件表达式。

```json
{
  "type": "page",
  "body": [
    {
      "type": "form",
      "title": "节点配置",
      "body": [
        {
          "type": "input-text",
          "label": "名称",
          "name": "name"
        },
        {
          "type": "editor",
          "label": "条件表达式",
          "name": "condition",
          "language": "javascript",
          "description": "直接填写表达式或变量名，如_par.outType"
        }
      ]
    }
  ]
}
```

**设计要点**
- `condition`字段直接映射到`LogicItemTreeNode`的同名属性
- 支持完整的JavaScript表达式语法
- 提供示例说明降低使用门槛

**交互逻辑**
- 表达式结果为`true`时执行`if`分支
- 结果为`false`时跳过该分支
- 支持复杂逻辑运算和函数调用

**表单来源**
- [if.json](file://logic-ide/src/main/resources/public/setting/forms/if.json)

## 字段类型与校验机制

### 核心字段类型解析
系统支持多种表单字段类型，每种类型对应特定的用户输入场景和数据处理逻辑。

**输入字段类型**
- `input-text`：单行文本输入，适用于名称、标识符等短文本
- `editor`：代码编辑器，支持语法高亮和智能提示
- `textarea`：多行文本输入，适用于备注、描述等长文本
- `radios`：单选按钮组，用于模式选择
- `select`：下拉选择框，用于枚举值选择

**字段属性说明**
- `type`：字段组件类型
- `name`：对应后端模型的属性名
- `label`：用户界面显示标签
- `description`：字段使用说明
- `language`：代码编辑器的语言模式
- `size`：组件尺寸配置

### 校验规则与数据驱动
表单配置通过字段类型和属性实现数据驱动的前端渲染，确保用户输入符合预期格式。

**校验机制**
- 类型校验：根据字段类型进行基本类型验证
- 必填校验：通过配置确定是否为必填字段
- 格式校验：对特定格式（如JSON、JavaScript）进行语法检查
- 范围校验：对数值类型进行范围限制

**数据驱动特性**
- 字段`name`直接映射到`LogicItemTreeNode`属性
- `type`决定前端渲染组件类型
- `language`配置代码编辑器行为
- `description`提供上下文帮助信息

**表单来源**
- [assign-global.json](file://logic-ide/src/main/resources/public/setting/forms/assign-global.json)
- [js.json](file://logic-ide/src/main/resources/public/setting/forms/js.json)
- [if.json](file://logic-ide/src/main/resources/public/setting/forms/if.json)

## 表单与后端DSL映射机制

### LogicItemTreeNode模型解析
`LogicItemTreeNode`是后端DSL的核心数据模型，定义了逻辑节点的所有属性和行为。前端表单配置通过字段`name`与该模型的属性直接映射。

```java
public class LogicItemTreeNode extends BaseLASL {
    String id;
    String name;
    String type;
    String url;
    String body;
    String condition;
    String tranGroupId;
    String memo;
    // 其他字段...
}
```

**关键属性说明**
- `name`：节点名称，对应表单中的名称字段
- `url`：目标变量或资源路径
- `body`：节点主体内容，如赋值表达式
- `condition`：条件表达式，用于分支判断
- `tranGroupId`：事务组标识，控制事务边界
- `memo`：备注信息，用于文档化

### 映射关系详解
表单字段与后端模型属性通过`name`属性建立一对一映射关系。

**映射示例**
| 表单字段名 | 后端属性 | 数据类型 | 用途 |
|-----------|---------|---------|------|
| name | name | String | 节点显示名称 |
| url | url | String | 目标变量名 |
| body | body | String | 赋值表达式 |
| condition | condition | String | 条件表达式 |
| tranGroupId | tranGroupId | String | 事务组编号 |
| memo | memo | String | 节点备注 |

**数据流分析**
1. 用户在前端表单中输入数据
2. 表单数据按`name`映射到`LogicItemTreeNode`属性
3. 序列化为JSON发送到后端
4. 后端反序列化为`LogicItemTreeNode`对象
5. 在运行时环境中执行相应逻辑

**模型来源**
- [LogicItemTreeNode.java](file://logic-runtime/src/main/java/com/aims/logic/runtime/contract/dsl/LogicItemTreeNode.java)

## 新增通用配置项设计规范

### JSON结构设计原则
新增通用配置项时应遵循统一的设计规范，确保配置的一致性和可维护性。

**基本结构**
```json
{
  "type": "page",
  "body": [
    {
      "type": "form",
      "title": "节点配置",
      "body": [
        // 字段配置数组
      ]
    }
  ]
}
```

**设计准则**
- 保持与现有配置文件结构一致
- 使用清晰的字段命名
- 提供完整的字段描述
- 合理选择字段类型
- 考虑用户体验和易用性

### 字段命名规范
字段命名应遵循驼峰命名法，并与后端模型属性保持一致。

**命名规则**
- 使用有意义的英文单词
- 避免缩写和简写
- 保持命名一致性
- 与后端属性名完全匹配

### 最佳实践建议
**配置文件组织**
- 按功能模块组织配置文件
- 保持文件命名清晰明确
- 维护统一的目录结构

**字段设计**
- 优先使用标准字段类型
- 合理设置默认值
- 提供详细的帮助信息
- 考虑国际化支持

**测试验证**
- 在开发环境中充分测试
- 验证数据映射正确性
- 检查边界条件处理
- 确保向后兼容性

## 最佳实践与总结

### 配置管理最佳实践
1. **版本控制**：将配置文件纳入版本管理系统
2. **文档化**：为每个配置项提供详细文档
3. **复用性**：设计可复用的配置模板
4. **安全性**：避免在配置中硬编码敏感信息
5. **可维护性**：保持配置简洁和易于理解

### 总结
通用表单配置系统通过JSON配置文件实现了前端界面与后端DSL模型的无缝对接。`assign-global.json`、`js.json`和`if.json`等配置文件展示了如何通过标准化的字段类型和命名约定，实现灵活而强大的表单功能。理解这些配置文件的结构和映射机制，对于扩展系统功能和维护代码质量具有重要意义。

**核心要点回顾**
- 表单配置通过`name`属性与`LogicItemTreeNode`模型映射
- `editor`类型支持代码编辑功能
- `input-text`用于简单文本输入
- 配置文件驱动前端动态渲染
- 新增配置应遵循统一设计规范

**表单来源**
- [assign-global.json](file://logic-ide/src/main/resources/public/setting/forms/assign-global.json)
- [js.json](file://logic-ide/src/main/resources/public/setting/forms/js.json)
- [if.json](file://logic-ide/src/main/resources/public/setting/forms/if.json)
- [LogicItemTreeNode.java](file://logic-runtime/src/main/java/com/aims/logic/runtime/contract/dsl/LogicItemTreeNode.java)
- [LogicItemController.java](file://logic-ide/src/main/java/com/aims/logic/ide/controller/LogicItemController.java)